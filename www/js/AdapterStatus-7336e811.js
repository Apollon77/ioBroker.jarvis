var q=Object.defineProperty,D=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var T=(e,s,i)=>s in e?q(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i,$=(e,s)=>{for(var i in s||(s={}))O.call(s,i)&&T(e,i,s[i]);if(B)for(var i of B(s))z.call(s,i)&&T(e,i,s[i]);return e},Q=(e,s)=>D(e,F(s));import{Q as w}from"./QTooltip-2f29a30f.js";import{_ as E,x as G,L as H,dn as P,aM as J,de as Z,dE as K,a as A,a0 as j,m as W,bP as X,dv as Y,q as l,S as I,w as t,N as k,ah as h,o as m,b as c,l as p,t as r,k as g,R as u,ag as L,O as _,f as M,s as x,g as C,cZ as ee,M as ae,j as le,Q as te,F as oe}from"./index-c6b5b085.js";import{Q as se}from"./QBadge-93d1ec67.js";import{C as de}from"./ClosePopup-3741b231.js";const re=G({name:"AdapterStatus",props:["widget"],setup(e){const s=Y.getConnection,i=H(),b=P(),R=J(e.widget,"config"),n=Z.joinConfig(R.value,K);n.list=n.list?n.list.replace(/, /g,",").toLowerCase().split(","):null,n.blacklist=n.blacklist?n.blacklist.replace(/, /g,",").toLowerCase().split(","):null;const f=A(()=>{let o=b.instances;if(o=o&&o.val&&!o.val.error?$({},o.val):{},n.list)for(const d in o){const v=d.substr(0,d.indexOf("."));!n.list.includes(d)&&!n.list.includes(v)&&delete o[d]}else if(n.blacklist)for(const d in o){const v=d.substr(0,d.indexOf("."));(n.blacklist.includes(d)||n.blacklist.includes(v))&&delete o[d]}return o}),a=j([]),U=j([]);s.subscribeState("admin.0.info.updatesList",({err:o,state:d})=>{if(d){const v=d&&d.val?d.val.replace("js-controller,","").replace("js-controller",""):"";a.value=v?v.split(","):[],U.value=a.value.map(y=>f.value[y+".0"]?f.value[y+".0"].title+" ("+f.value[y+".0"].name+")":y).join(", ")}});const S=j({}),N=(o,d)=>{S.value[o]=!0,s.setAdapter(o,d).then(()=>{b.join("instances",{val:Q($({},b.instances.val),{[o]:Q($({},b.instances.val[o]),{enabled:d})}),ts:Date.now()})}).catch(v=>{console.error(v)}).finally(()=>{S.value[o]=!1})},V=A(()=>{const o=i.settings.language;return o?o.substr(0,2):null});return{activeRepo:A(()=>b.meta.activeRepo),adapterUpdates:a,adapterUpdateList:U,instances:f,language:V,loading:S,moduleConfig:n,onSet:N}}}),ne=C("br",null,null,-1),ie=p(", "),ue={class:"UpdateAvailable"},pe={key:1},fe={key:2};function me(e,s,i,b,R,n){const f=W("icon");return X([e.widget.revision],()=>l(I,null,{default:t(()=>[k(l(_,{class:"UpdateAvailableListItem",style:{"background-color":"var(--q-accent)"}},{default:t(()=>[e.adapterUpdateList.length>60?(m(),c(w,{key:0},{default:t(()=>[p(r(e.adapterUpdateList),1)]),_:1})):g("",!0),l(u,{avatar:""},{default:t(()=>[l(f,{name:"refresh"})]),_:1}),l(u,null,{default:t(()=>[l(L,null,{default:t(()=>[p(r(e.adapterUpdateList.length>60?e.adapterUpdateList.substr(0,58)+"...":e.adapterUpdateList),1)]),_:1}),l(L,{caption:"",style:{color:"#fff"}},{default:t(()=>[p(r(e.adapterUpdates.length)+" "+r(e.$t("Updates available")),1),ne,p(" "+r(e.$t("Repository")+": "+e.activeRepo),1)]),_:1})]),_:1}),l(u,{side:""},{default:t(()=>[l(se,{rounded:"",color:"white",style:{color:"var(--q-accent)"},label:e.adapterUpdates.length},null,8,["label"])]),_:1})]),_:1},512),[[h,e.moduleConfig.updates&&e.adapterUpdates.length>0]]),(m(!0),M(oe,null,x(e.instances,a=>(m(),c(_,{key:a.id,clickable:e.moduleConfig.switch&&a.mode!=="none"&&a.mode!=="once"&&e.loading[a.id]!==!0,"v-ripple":e.moduleConfig.switch&&a.mode!=="none"&&a.mode!=="once"&&e.loading[a.id]!==!0},{default:t(()=>[l(u,{avatar:""},{default:t(()=>[l(f,{name:"img:"+a.extIcon},null,8,["name"])]),_:2},1024),l(u,null,{default:t(()=>[l(L,null,{default:t(()=>[p(r(a.titleLang&&a.titleLang[e.language]||a.titleLang||a.title),1)]),_:2},1024),l(L,{caption:""},{default:t(()=>[C("span",null,r(a.id)+", v"+r(a.version),1),k(C("span",null,[ie,C("span",ue,r(e.$t("Update available")+" v"+a.update),1)],512),[[h,a.update]]),k(C("span",null,", "+r(e.$t("Compact Mode"))+" "+r(e.$t("on"))+" ("+r(e.$t("Group")+" "+a.compactGroup)+")",513),[[h,a.runAsCompactMode]])]),_:2},1024)]),_:2},1024),a.mode!=="none"&&a.mode!=="once"?k((m(),c(u,{key:0,side:""},{default:t(()=>[e.loading[a.id]===!0?(m(),c(ee,{key:0,color:"primary",size:"21px"})):g("",!0),e.loading[a.id]!==!0&&a.alive!==!1&&a.connectedToHost!==!1&&a.connectedToInstance!==!1?(m(),M("div",pe,[l(f,{color:"positive",name:"mdi-check-circle"}),l(w,null,{default:t(()=>[p(r(e.$t("Adapter")+" "+e.$t("alive")),1)]),_:1})])):g("",!0),e.loading[a.id]!==!0&&a.alive===!1||a.connectedToHost===!1||a.connectedToInstance===!1?(m(),M("div",fe,[l(f,{color:"warning",name:"mdi-alert"}),l(w,null,{default:t(()=>[p(r(e.$t("Adapter")+" "+e.$t("not alive")),1)]),_:1})])):g("",!0)]),_:2},1536)),[[h,a.enabled===!0]]):g("",!0),a.mode!=="none"&&a.mode!=="once"?k((m(),c(u,{key:1,side:""},{default:t(()=>[l(f,{name:"mdi-close"}),l(w,null,{default:t(()=>[p(r(e.$t("Adapter")+" "+e.$t("disabled")),1)]),_:1})]),_:2},1536)),[[h,a.enabled===!1]]):g("",!0),e.moduleConfig.switch&&a.mode!=="none"&&a.mode!=="once"&&e.loading[a.id]!==!0?(m(),c(ae,{key:2,ref_for:!0,ref:"menu","touch-position":""},{default:t(()=>[l(I,{style:{"min-width":"120px","man-width":"150px"},class:"body"},{default:t(()=>[l(_,{class:le("text-white bg-"+(a.enabled?"positive":"negative"))},{default:t(()=>[l(u,{avatar:""}),l(u,null,{default:t(()=>[p(r(e.$t(a.enabled?"Currently running":"Currently stopped")),1)]),_:2},1024),l(u,{side:""})]),_:2},1032,["class"]),k((m(),c(_,{clickable:"",onClick:U=>e.onSet(a.id,!a.enabled)},{default:t(()=>[l(u,{avatar:""},{default:t(()=>[l(te,{color:a.enabled?"negative":"positive",name:a.enabled?"mdi-pause":"mdi-play"},null,8,["color","name"])]),_:2},1024),l(u,null,{default:t(()=>[p(r(e.$t(a.enabled?"Stop":"Start")+" "+e.$t("Adapter")),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[de]])]),_:2},1024)]),_:2},1536)):g("",!0)]),_:2},1032,["clickable","v-ripple"]))),128))]),_:1}),s,0)}var Ce=E(re,[["render",me]]);export{Ce as default};
