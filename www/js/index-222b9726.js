var se=Object.defineProperty,te=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var P=(e,a,n)=>a in e?se(e,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[a]=n,S=(e,a)=>{for(var n in a||(a={}))ie.call(a,n)&&P(e,n,a[n]);if(B)for(var n of B(a))oe.call(a,n)&&P(e,n,a[n]);return e},M=(e,a)=>te(e,ae(a));import{Q as G}from"./QSpace-72ed55b6.js";import{x as N,cv as K,ds as L,a as b,a0 as z,C as W,cJ as Y,_ as Q,dv as Z,m as w,o as r,f as g,s as U,q as i,w as o,aj as re,j as H,b as c,g as y,l as $,t as h,k,ak as q,d8 as ne,N as A,ah as V,am as le,U as _,a8 as de,F as R,al as I,cX as ce,R as O,ag as F,u as C,O as ue,S as J,L as pe}from"./index-0a47fe55.js";import{Q as ve}from"./QToolbar-b7d7dc3b.js";import{Q as me}from"./QHeader-35dcdcb1.js";import{Q as he}from"./QDrawer-690e2f34.js";import{C as T}from"./ClosePopup-e538a7d3.js";import{Q as X}from"./QVirtualScroll-0ac95a23.js";import{Q as D}from"./QTooltip-94e00f66.js";const fe=N({name:"NotificationEventPopup",setup(e){const a=Z.getConnection,n=K(),v=L(),f=b(()=>n.dark.isActive),m=z({}),d=z(0),t={},s=(p,l=50)=>{setTimeout(()=>{t[p.id]=Math.max(0,t[p.id]-l),d.value=Date.now(),t[p.id]>0?s(p):m.value[p.id]=!1},l)},u=p=>v.set({notificationId:p.id,props:{state:"read"}}),j=p=>v.set({notificationId:p.id,props:{state:"archived"}}),x=p=>v.del({notificationId:p.id});W(()=>v.new,p=>ee(p.notifications));const E=z([]),ee=p=>{p=Y(p),p.forEach(l=>{l.devices=!l.devices||Array.isArray(l.devices)?l.devices:l.devices.indexOf(",")>-1?l.devices.split(","):[l.devices],l.display==="popup"&&(!l.devices||l.devices.includes(a.client.id))&&((l.timeout||l.autoHideDuration||l.progress)&&(l.progress=!0,l.timeout=l.timeout||l.autoHideDuration||5e3,t[l.id]=l.timeout,s(l,500)),m.value[l.id]=!0,E.value.push(l))})};return{isDark:f,notificationList:E,dialogs:m,markAsArchived:j,markAsRead:u,remove:x}}}),ke={class:"text-h6"},ge={key:0,class:"text-caption"},ye=["innerHTML"];function _e(e,a,n,v,f,m){const d=w("icon");return r(!0),g(R,null,U(e.notificationList,t=>(r(),g("div",{key:t.id},[i(de,{"model-value":e.dialogs[t.id],onHide:s=>e.dialogs[t.id]=!1,"transition-show":"scale","transition-hide":"scale"},{default:o(()=>[i(re,{class:H({"jarvis-notification-event-popup":!0,[t.category]:t.category!==void 0,["bg-"+(t.color||t.type||t.criticality||"primary")]:!0,["text-"+(t.textColor||"white")]:!0}),style:{width:"550px","max-width":"95vw"}},{default:o(()=>[t.title||t.caption?(r(),c(q,{key:0,class:"jarvis-notification-event-popup-title"},{default:o(()=>[y("div",ke,[i(d,{name:t.icon,color:t.iconColor||"primary"},null,8,["name","color"]),$(" "+h(t.title),1)]),t.caption?(r(),g("div",ge,h(t.caption),1)):k("",!0)]),_:2},1024)):k("",!0),t.message?(r(),c(q,{key:1,class:"q-pt-none jarvis-notification-event-popup-message"},{default:o(()=>[y("div",{innerHTML:t.message},null,8,ye)]),_:2},1024)):k("",!0),t.progress?(r(),c(q,{key:2,class:H(["q-pa-none",{["updated-"+e.refresh]:!0,["text-"+(t.textColor||t.type||t.criticality||"primary")]:!0,["bg-"+(t.color||"white")]:!0}])},{default:o(()=>[i(ne,{value:e.timers[t.id]?e.timers[t.id]/t.timeout:0,class:"q-mt-md",color:t.color||t.type||t.criticality||"accent"},null,8,["value","color"])]),_:2},1032,["class"])):k("",!0),A(i(le,{class:H(["jarvis-notification-event-popup-actions nowrap",{["bg-"+(t.textColor||t.type||t.criticality||(e.isDark?"grey-10":"white"))]:!0,["text-"+(t.color||"primary")]:!0}])},{default:o(()=>[A(i(_,{dense:"",flat:"",label:e.$t("Delete"),icon:"mdi-delete",color:t.type==="negative"||t.criticality==="negative"?"yellow":"negative",onClick:s=>e.remove(t)},null,8,["label","color","onClick"]),[[T]]),i(G),A(i(_,{dense:"",flat:"",label:e.$t("Archive"),icon:"mdi-package-down",onClick:s=>e.markAsArchived(t)},null,8,["label","onClick"]),[[T]]),A(i(_,{dense:"",flat:"",label:e.$t("Mark as Read"),icon:"mdi-check",onClick:s=>e.markAsRead(t)},null,8,["label","onClick"]),[[T]])]),_:2},1032,["class"]),[[V,t.state!=="delete"]])]),_:2},1032,["class"])]),_:2},1032,["model-value","onHide"])]))),128)}var $e=Q(fe,[["render",_e]]);const we=N({name:"NotificationEventSnackbar",setup(){const e=K(),a=Z.getConnection,n=L(),v=s=>n.set({notificationId:s.id,props:{state:"read"}}),f=s=>n.set({notificationId:s.id,props:{state:"archived"}}),m=s=>n.del({notificationId:s.id}),d=(s={})=>{!s.type&&s.criticality&&(s.type=s.criticality==="error"?"negative":s.criticality==="success"?"positive":s.criticality),!s.position&&s.snackbarOrigin&&(s.position=[],s.snackbarOrigin.horizontal&&s.position.push(s.snackbarOrigin.horizontal),s.snackbarOrigin.vertical&&s.position.push(s.snackbarOrigin.vertical),s.position=s.position.join(s.position.length===2?"-":""));const u=M(S({badgeStyle:"display: none",html:!0,position:"bottom-right",progress:!0,progressClass:"jarvis-notification-event-snackbar-progress",classes:"jarvis-notification-event-snackbar "+(s.category||""),actions:s.state!=="delete"&&[{icon:"mdi-circle-slice-8",size:"sm",color:s.textColor||"white",handler:()=>v(s)},{icon:"mdi-package-down",size:"sm",color:s.textColor||"white",handler:()=>f(s)},{icon:"mdi-delete",size:"sm",color:s.type==="negative"||s.criticality==="negative"?"yellow":"negative",handler:()=>m(s)}]},s),{color:s.type||s.criticality||s.color||"primary",textColor:"white",type:s.type||s.criticality||void 0,timeout:s.timeout||s.autoHideDuration||5e3,message:s.title||s.message,group:s.id});e.notify(u)};W(()=>n.new,s=>t(s.notifications));const t=s=>{s=Y(s),s.forEach(u=>{u.devices=!u.devices||Array.isArray(u.devices)?u.devices:u.devices.indexOf(",")>-1?u.devices.split(","):[u.devices],u.display==="snackbar"&&(!u.devices||u.devices.includes(a.client.id))&&d(u)})};return{}}});function Ae(e,a,n,v,f,m){return r(),g("div")}var Ce=Q(we,[["render",Ae]]);const be=N({name:"Divider",props:["label"]}),Ne={class:"row full-width"},Qe={class:"col",style:{margin:"auto 0"}},De={style:{"text-align":"center"}},Ie=$(" \xA0\xA0"),Le=$("\xA0\xA0 "),je={class:"col",style:{margin:"auto 0"}};function ze(e,a,n,v,f,m){return r(),g("div",Ne,[y("div",Qe,[i(I)]),y("div",De,[Ie,y("em",null,h(e.label),1),Le]),y("div",je,[i(I)])])}var He=Q(be,[["render",ze]]);const Re=N({name:"NotificationListItem",props:["notification"],setup(e){const a=L();return{show:()=>{a.setNew({notifications:[M(S({},e.notification),{progress:!1,autoHideDuration:null,timeout:null})]})},markAsRead:()=>a.set({notificationId:e.notification.id,props:{state:"read"}}),markAsUnread:()=>a.set({notificationId:e.notification.id,props:{state:"unread"}}),markAsArchived:()=>a.set({notificationId:e.notification.id,props:{state:"archived"}}),remove:()=>a.del({notificationId:e.notification.id})}}}),Se={class:"text-weight-medium"},Me=["innerHTML"],qe={class:"text-grey-8 q-gutter-xs"};function Oe(e,a,n,v,f,m){const d=w("icon");return r(),g("div",null,[A((r(),c(ue,{clickable:"",class:H(["jarvis-notifications-item",{[e.notification.state||"unread"]:!0,[e.notification.category]:e.notification.category!==void 0}]),onClick:C(e.show,["stop"]),id:"notification-"+e.notification.id},{default:o(()=>[i(O,{avatar:""},{default:o(()=>[i(d,{name:e.notification.icon||"mdi-comment",color:e.notification.iconColor||"primary",size:"sm"},null,8,["name","color"])]),_:1}),i(O,null,{default:o(()=>[i(F,{lines:"1"},{default:o(()=>[y("span",Se,h(e.notification.title),1),A(y("span",null," - "+h(e.notification.caption),513),[[V,e.notification.caption]])]),_:1}),e.notification.message?(r(),c(F,{key:0,caption:"",lines:"1",style:{"max-height":"200px"}},{default:o(()=>[y("div",{innerHTML:e.notification.message,class:"overflow-dots"},null,8,Me)]),_:1})):k("",!0)]),_:1}),i(O,{side:""},{default:o(()=>[y("div",qe,[e.notification.state==="read"?(r(),c(_,{key:0,onClick:C(e.markAsUnread,["stop"]),class:"gt-xs",size:"12px",flat:"",dense:"",round:"",icon:"mdi-check"},{default:o(()=>[i(D,null,{default:o(()=>[$(h(e.$t("Mark as Unread")),1)]),_:1})]),_:1},8,["onClick"])):k("",!0),e.notification.state!=="read"&&e.notification.state!=="archived"?(r(),c(_,{key:1,onClick:C(e.markAsRead,["stop"]),class:"gt-xs",size:"12px",flat:"",dense:"",round:"",icon:"mdi-circle-outline"},{default:o(()=>[i(D,null,{default:o(()=>[$(h(e.$t("Mark as Read")),1)]),_:1})]),_:1},8,["onClick"])):k("",!0),e.notification.state!=="archived"?(r(),c(_,{key:2,onClick:C(e.markAsArchived,["stop"]),class:"gt-xs",size:"12px",flat:"",dense:"",round:"",icon:"mdi-package-down"},{default:o(()=>[i(D,null,{default:o(()=>[$(h(e.$t("Archive")),1)]),_:1})]),_:1},8,["onClick"])):k("",!0),e.notification.state==="archived"?(r(),c(_,{key:3,onClick:C(e.markAsUnread,["stop"]),class:"gt-xs",size:"12px",flat:"",dense:"",round:"",icon:"mdi-package-up"},{default:o(()=>[i(D,null,{default:o(()=>[$(h(e.$t("Restore from Archive")),1)]),_:1})]),_:1},8,["onClick"])):k("",!0),e.notification.state==="archived"?(r(),c(_,{key:4,onClick:C(e.remove,["stop"]),color:"negative",class:"gt-xs",size:"12px",flat:"",dense:"",round:"",icon:"delete"},{default:o(()=>[i(D,null,{default:o(()=>[$(h(e.$t("Delete")),1)]),_:1})]),_:1},8,["onClick"])):k("",!0)])]),_:1})]),_:1},8,["class","onClick","id"])),[[ce]]),i(I)])}var Te=Q(Re,[["render",Oe]]);const Ue=N({name:"NotificationList",components:{NotificationItem:Te,Divider:He},setup(){const e=L();return{showArchived:z(!1),notificationsActive:b(()=>e.getActive),notificationsArchived:b(()=>e.getArchived)}}}),Ve={class:"q-mt-xs jarvis-notifications-items"},Ee={key:2};function Be(e,a,n,v,f,m){const d=w("notification-item"),t=w("divider");return r(),g("div",Ve,[i(I),e.notificationsActive.length<200?(r(),c(J,{key:0},{default:o(()=>[(r(!0),g(R,null,U(e.notificationsActive,s=>(r(),c(d,{key:s.id,notification:s},null,8,["notification"]))),128))]),_:1})):(r(),c(X,{key:1,items:e.notificationsActive},{default:o(({item:s})=>[i(d,{notification:s},null,8,["notification"])]),_:1},8,["items"])),A(i(_,{flat:"",class:"full-width",onClick:a[0]||(a[0]=s=>e.showArchived=!e.showArchived)},{default:o(()=>[e.showArchived?(r(),c(t,{key:0,label:e.$t("hide archived notifications")},null,8,["label"])):(r(),c(t,{key:1,label:e.$t("show archived notifications")},null,8,["label"]))]),_:1},512),[[V,e.notificationsArchived&&e.notificationsArchived.length>0]]),e.showArchived?(r(),g("div",Ee,[i(I),e.notificationsArchived.length<200?(r(),c(J,{key:0},{default:o(()=>[(r(!0),g(R,null,U(e.notificationsArchived,s=>(r(),c(d,{key:s.id,notification:s},null,8,["notification"]))),128))]),_:1})):(r(),c(X,{key:1,items:e.notificationsArchived},{default:o(({item:s})=>[i(d,{notification:s},null,8,["notification"])]),_:1},8,["items"]))])):k("",!0)])}var Pe=Q(Ue,[["render",Be]]);const Fe=N({name:"NotificationDrawer",components:{NotificationEventPopup:$e,NotificationEventSnackbar:Ce,NotificationList:Pe},setup(){const e=pe(),a=L(),n=d=>e.set("drawerNotifications",d),v=b({get(){return e.drawerNotifications},set(d){n(d)}}),f=b(()=>a.getUnread.length),m=b(()=>a.getActive.length+a.getArchived.length);return{toggleNotifications:n,drawerNotifications:v,unread:f,all:m}}});function Je(e,a,n,v,f,m){const d=w("notification-event-popup"),t=w("notification-event-snackbar"),s=w("icon"),u=w("notification-list");return r(),g(R,null,[i(d),i(t),i(he,{modelValue:e.drawerNotifications,"onUpdate:modelValue":a[1]||(a[1]=j=>e.drawerNotifications=j),side:"right",behavior:"mobile",width:500,overlay:"",bordered:"","content-class":"jarvis-notifications body",class:"jarvis-notifications-container"},{default:o(()=>[i(me,{style:{position:"relative",left:"0"}},{default:o(()=>[i(ve,null,{default:o(()=>[y("h6",null,[i(s,{name:"mdi-bell"}),$(" "+h(e.$t("Notifications"))+" ("+h(e.unread)+" / "+h(e.all)+") ",1)]),i(G),i(_,{flat:"",dense:"",round:"",icon:"mdi-chevron-right","aria-label":"Menu",onClick:a[0]||(a[0]=j=>e.toggleNotifications(!1))})]),_:1})]),_:1}),e.drawerNotifications?(r(),c(u,{key:0})):k("",!0)]),_:1},8,["modelValue"])],64)}var ts=Q(Fe,[["render",Je]]);export{ts as default};
