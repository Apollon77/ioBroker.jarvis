import{dz as O,dA as K,dB as F,bX as Z,cQ as ee,b_ as ae,cR as te,c4 as re,Q as w,ac as j,b6 as oe,a9 as ne,cM as U,bI as ce,bt as ie,a4 as le,cj as ve,u as se,d7 as de,dC as pe,k as y,dD as ge,an as ue,aw as fe,aG as A,ay as _,W as Q,b3 as P,bn as B,a2 as s,c$ as me,X as u,U as be,b1 as f,bN as R,D as C,bT as he,bC as ye,bO as we,bM as xe,bQ as ke,V as Ce,I as De,aE as ze,dE as Se,a1 as je,C as _e,bs as Me,dp as Ye}from"./index-b364605d.js";import qe from"./EventList-ccc2007c.js";import{n as Ae}from"./index-cef5a460.js";import{s as I}from"./index-be2eb72d.js";import"./QTooltip-96e5fd0a.js";import"./___vite-browser-external_commonjs-proxy-afe9cd7a.js";import"./_commonjsHelpers-55d1ff45.js";function T(e,o){O(2,arguments);var l=K(e),p=F(o);return isNaN(p)?new Date(NaN):(p&&l.setDate(l.getDate()+p),l)}function Qe(e,o){O(2,arguments);var l=F(o);return T(e,-l)}var Pe=Z({name:"QInnerLoading",props:{...ee,...ae,showing:Boolean,color:String,size:{type:[String,Number],default:42},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(e,{slots:o}){const l=ne(),p=te(e,l.proxy.$q),{transition:D,transitionStyle:c}=re(e,w(()=>e.showing)),x=w(()=>"q-inner-loading absolute-full column flex-center"+(p.value===!0?" q-inner-loading--dark":"")),m=w(()=>"q-inner-loading__label"+(e.labelClass!==void 0?` ${e.labelClass}`:""));function d(){const g=[j(U,{size:e.size,color:e.color})];return e.label!==void 0&&g.push(j("div",{class:m.value,style:e.labelStyle},[e.label])),g}function r(){return e.showing===!0?j("div",{class:x.value,style:c.value},o.default!==void 0?o.default():d()):null}return()=>j(oe,{name:D.value,appear:!0},r)}});function Be(e=!1){const o=ce(),l=o.locale.value||o.locale;return e?l.substr(0,2):l}const Ie=le({name:"ModuleCalendar",props:["_size","widget"],components:{EventList:qe},setup(e){const o=Ye.getConnection,l=ve(),p=Be(!0),D=se(e.widget,"config"),c=de.joinConfig(D.value,pe);c.timezone=c.timezone||"Europe/Amsterdam",c.calendars=c.calendars||[];const x=w(()=>l.dark.isActive),m=y(!1),d=y(new Date);Ae.scheduleJob("0 0 0 * * *",()=>{d.value=new Date});const r=y({year:d.value.getFullYear(),month:d.value.getMonth()+1}),g=({year:a,month:t})=>{(r.value.month!==t||r.value.year!==a)&&(r.value.year=a,r.value.month=t,m.value=E[a+"-"+t]||!1,S(a,t).then(()=>{z()}))},b=I(Qe(d.value,c.daysReview)),V=I(T(d.value,c.daysPreview)),h=y([b,V]),W=({date:a})=>{c.calendarAgenda===!1||c.calendarAgenda!==!1&&h.value.length===2?h.value=[a]:a<h.value[0]?h.value.unshift(a):h.value.push(a),z()},H=w(()=>{let[a,t]=h.value;return t=I(t?a.getMonth()!==t.getMonth()?ge(a):t:a),d.value.getFullYear()!==r.value.year||d.value.getMonth()+1!==r.value.month?[]:[{key:"selectedEnd",highlight:{contentStyle:{backgroundColor:"var(--q-accent)",opacity:1,color:"#fff"}},dates:t,order:102},{key:"selectedStart",highlight:{contentStyle:{backgroundColor:"var(--q-accent)",opacity:1,color:"#fff"}},dates:a,order:101},{key:"selected",highlight:{style:{backgroundColor:"var(--q-accent)",opacity:.3},contentStyle:{color:"var(--q-accent)"}},dates:{start:a,end:t},order:99},{key:"today",highlight:{style:{backgroundColor:"var(--q-primary)"},contentStyle:{color:"#fff",fontWeight:"bold"}},dates:d.value,order:200}]}),N=y([]),$=(a,t)=>{const i=[];L.value.forEach(n=>{!i.some(q=>q.uid===n.uid)&&(n&&n.start>=a&&n.start<=t||n&&n.start<=a&&n.end>=a)&&i.push(n)}),N.value=i},z=()=>{let[a,t]=h.value;if(t=Se(t||a),a.getMonth()===t.getMonth())$(a,t);else{let i=r.value.month+1;const n=i>12?r.value.year+1:r.value.year;i=i>12?1:i,S(n,i).then(()=>{$(a,t)})}},E=y({}),M=y({}),L=w(()=>Object.values(M.value).flat()),X=(a,t,i)=>new Promise((n,q)=>{o.getSpecial("Calendar",{calendar:a,year:t,month:i,options:{...c,language:p}},k=>{if(k.error)return console.warn("Calendar-a99xoa47",e.widget.id,k.error),q(k.error);if(k.events&&Array.isArray(k.events)){const J=k.events.map((v,Fe)=>(v.start=new Date(v.start),v.end=new Date(v.end),{calendar:a,...v,key:v.uid,dot:{style:{backgroundColor:a.color||Me.getPaletteColor("primary")}},popover:{label:v.summary},dates:v.duration<=0?v.start:{start:v.start,end:v.end},customData:{calendar:a,summary:v.summary,time:v.time}}));E[t+"-"+i]=!0,M.value[a.id+":"+t+"-"+i]=J,n(M.value[a.id])}})}),S=(a,t)=>{const i=c.calendars.map(n=>X(n,a,t));return Promise.allSettled(i).then(n=>(m.value=!0,n))};let Y=null;ue(()=>{S(r.value.year,r.value.month).then(()=>{z()}),Y=setInterval(()=>{console.debug("Calendar-d53dca17",e.widget.id,"Refreshing ical data..."),S(r.value.year,r.value.month).then(()=>{z()})},c.refresh*60*1e3)}),fe(()=>Y&&clearInterval(Y));const G=w(()=>[...L.value,...H.value]);return{loaded:m,language:p,isDarkMode:x,moduleConfig:c,setDate:g,setRange:W,attributes:G,agenda:N}}}),Ne={style:{position:"relative"}},$e={class:"text-h6"},Ee=je(' /* :timezone="moduleConfig.timezone" trim-weeks: By default, calendar panes always displays the maximum number of weeks in a month, even if the max week does not contain any days in the current month displayed. */ '),Le={class:"text-xs text-gray-300 font-semibold"},Re={class:"Calendar-Popover-List"};function Oe(e,o,l,p,D,c){const x=A("event-list"),m=A("icon"),d=A("v-calendar");return _(),Q("div",null,[P(s(me,{indeterminate:""},null,512),[[B,!e.loaded]]),u("div",Ne,[e.moduleConfig.calendarAgenda===!1?(_(),be(ke,{key:0,"model-value":e.popup,onHide:o[1]||(o[1]=r=>e.popup=!1)},{default:f(()=>[s(xe,{style:{width:"800px","max-width":"80vw"}},{default:f(()=>[s(R,{class:"row items-center"},{default:f(()=>[u("div",$e,C(e.$t("Calendar Details")),1),s(he),s(ye,{flat:"",round:"",color:"grey",icon:"close",onClick:o[0]||(o[0]=r=>e.popup=!1)})]),_:1}),s(we),s(R,{class:"col q-pa-none scroll body"},{default:f(()=>[s(x,{agenda:e.agenda},null,8,["agenda"])]),_:1})]),_:1})]),_:1},8,["model-value"])):Ce("",!0),P(u("div",null,[s(d,{"onUpdate:toPage":e.setDate,onDayclick:e.setRange,class:"Calendar",attributes:e.attributes,"is-dark":e.isDarkMode,locale:e.language,masks:{dayPopover:"WWW, D. MMMM YYYY"},"trim-weeks":"","show-iso-weeknumbers":"","disable-page-swipe":""},{"header-title":f(({monthLabel:r,year:g})=>[u("div",null,C(r+" "+g),1),s(m,{name:"mdi-calendar-cursor",size:"xs",class:"q-ml-xs"})]),"day-popover":f(({dayTitle:r,attributes:g})=>[u("div",null,[u("strong",Le,C(r),1),u("ul",Re,[(_(!0),Q(De,null,ze(g,b=>(_(),Q("li",{key:b.key+"-"+(b.customData.calendar.color||""),style:_e({color:b.customData.calendar.color||"var(--q-primary)"})},[u("span",null,C(b.customData.time)+", "+C(b.customData.summary),1)],4))),128))])])]),default:f(()=>[Ee]),_:1},8,["onUpdate:toPage","onDayclick","attributes","is-dark","locale","masks"]),s(Pe,{showing:!e.loaded},{default:f(()=>[s(U,{size:"50px",color:"primary"})]),_:1},8,["showing"])],512),[[B,e.moduleConfig.calendarPreview!==!1]]),P(s(x,{agenda:e.agenda},null,8,["agenda"]),[[B,e.moduleConfig.calendarAgenda!==!1]])])])}var Je=ie(Ie,[["render",Oe]]);export{Je as default};
