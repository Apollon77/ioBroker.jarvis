import{_ as S,q as w,de as B,az as I,c as Q,a2 as b,y as M,j as A,o as i,d as N,J as h,a1 as _,k as r,w as l,n as P,c$ as T,i as c,t as u,Q as f,a as m,e as V,f as $,d5 as j,dv as D,cG as E,dm as F,d4 as O,cE as H}from"./index-1c0225fa.js";import{c as J,Q as R,b as g}from"./QTable-38bd00b9.js";import"./QVirtualScroll-737e12d2.js";const q=w({name:"ModuleAdapterLogs",props:["widget","_containerSize"],setup(a){const v=F.getConnection,k=B(),C=I(a.widget,"config"),t=Q(()=>j.joinConfig(C.value,D)),z=[{name:"from",field:"from",label:"Adapter",align:"left",sortable:!0},{name:"ts",field:"ts",label:"Time",align:"left",sortable:!0},{name:"severity",field:"severity",label:"Severity",align:"left",sortable:!0},{name:"message",field:"message",label:"Message",align:"left",sortable:!1}],p=Q(()=>({sortBy:t.value.sortColumn||"",descending:t.value.sortDirection!==void 0?t.value.sortDirection:!1,rowsPerPage:t.value.rowsPerPage||10})),s=e=>!(!t.value.adapters.includes(e.from)||!t.value.severity.includes(e.severity)||t.value.message&&RegExp(t.value.message,"gi").test(e.message)),y=(e,o)=>(e.from.startsWith("host.")||e.from,e.raw=e.message,e._id=O(),e.ts=Number.isInteger(e.ts)?H(e.ts,t.value.timeFormat||"dd.MM.yyyy HH:mm:ss"):e.ts,e.icon=o[e.from]&&o[e.from].extIcon?"img:"+o[e.from].extIcon:"",e.message=e.message.replace(e.from,""),e.message=e.message.indexOf(") ")!==-1?e.message.substr(e.message.indexOf(") ")+2):e.message,e),x=b(!1),L=b(null),d=b();return M(()=>{const e=k.instances.val||{};v.getLogs("current").then(o=>{d.value=o.filter(n=>s(n)).map(n=>y(n,e)),E.getInstance().on("message",n=>{s(n)&&d.value.unshift(y(n,e))}),v.on("_log",n=>{s(n)&&d.value.unshift(y(n,e))})}).catch(o=>{console.error(o),L.value=o.message||o}).finally(()=>{x.value=!0})},{flush:"post"}),{moduleConfig:t,columns:z,columnsVisible:["from","ts","severity","message"],pagination:p,loaded:x,error:L,logs:d}}});function G(a,v,k,C,t,z){const p=A("alert");return i(),N("div",{key:a.widget.revision,class:"jarvis-AdapterLogs",style:P({height:a._containerSize.height+"px"})},[h(r(T,{indeterminate:""},null,512),[[_,!a.loaded&&!a.error]]),h(r(p,null,{default:l(()=>[c(u(a.error),1)]),_:1},512),[[_,a.loaded&&a.error]]),h(r(J,{rows:a.logs,flat:"",dense:a.moduleConfig.dense,pagination:a.pagination,"binary-state-sort":"",columns:a.columns,"row-key":"_id","visible-columns":a.columnsVisible,class:"sticky-table-header full-height"},{body:l(({row:s})=>[r(R,null,{default:l(()=>[r(g,null,{default:l(()=>[r(f,{name:s.icon},null,8,["name"]),c(" \xA0"+u(s.from),1)]),_:2},1024),r(g,null,{default:l(()=>[c(u(s.ts),1)]),_:2},1024),r(g,null,{default:l(()=>[s.severity==="info"?(i(),m(f,{key:0,size:"xs",name:"mdi-information",color:"blue"})):s.severity==="warn"?(i(),m(f,{key:1,size:"xs",name:"mdi-alert-box",color:"warning"})):s.severity==="error"?(i(),m(f,{key:2,size:"xs",name:"mdi-close-box",color:"negative"})):(i(),m(f,{key:3,size:"xs",name:"mdi-bug",color:"grey"})),V("span",{style:{"margin-left":"4px"},class:$("text-"+(s.severity==="info"?"primary":s.severity==="warn"?"warning":s.severity==="error"?"negative":"grey"))},u(s.severity),3)]),_:2},1024),r(g,null,{default:l(()=>[c(u(typeof s.message=="object"?JSON.stringify(s.message):s.message),1)]),_:2},1024)]),_:2},1024)]),_:1},8,["rows","dense","pagination","columns","visible-columns"]),[[_,a.loaded&&!a.error]])],4)}var X=S(q,[["render",G]]);export{X as default};
