import{Q as L}from"./QToolbarTitle-d97275bb.js";import{a4 as J,cp as T,bM as A,cs as F,cq as O,k as I,aZ as X,bt as S,aG as y,ay as l,W as u,a2 as o,b1 as n,I as P,aE as V,b3 as U,bn as j,U as $,a1 as C,D as g,A as v,bB as k,V as E,X as z,cM as Z,bw as K,Q as h,bD as Y,C as x,d6 as ee}from"./index-988ebe8f.js";import{Q as te}from"./QToolbar-b8fbade7.js";import{Q as oe}from"./QExpansionItem-11079e4f.js";import{J as ie}from"./json-editor-e307cf78.js";import{Q as G,a as B,b as W,c as se}from"./QTable-a733a26b.js";import{Q as le}from"./QTooltip-82fe9d6d.js";import{W as ne}from"./WidgetPage-7578f500.js";import"./QSlideTransition-69ee8af7.js";import"./_commonjsHelpers-55d1ff45.js";import"./QVirtualScroll-fd4bf735.js";import"./useDragDrop-5eb48eec.js";const ae=J({name:"WidgetsTable",props:["widgets"],emits:["onEditWidget"],setup(e,{emit:r}){T.dev("DEBUG","WidgetsTable","setup()",e.widgets);const c=A(),p=F(),m=O(),b={sortBy:"title",rowsPerPage:15},w=[{name:"id",label:c.t("ID"),field:"id",align:"left",sortable:!0},{name:"title",label:c.t("Title")+" ("+c.t("ID")+")",field:"title",align:"left",sortable:!0,style:{width:"20%"}},{name:"module",label:c.t("Module"),field:"module",align:"left",sortable:!0,style:{width:"15%"}},{name:"usage",label:c.t("Usage")+" [ #: "+c.t("Tab")+" ("+c.t("Page")+") ]",field:"usage",align:"left",sortable:!0,style:{width:"65%"}}],t=I({});return X(()=>{T.dev("DEBUG","WidgetsTable","watchEffect");const i={};for(const D of m.layout){const M=D.tabs||[];for(const _ of M){const q=[..._.widgetsDesktop||[],..._.widgetsSmartphone||[]];for(const R of q){const H=R.items||[];for(const Q of H)i[Q]=i[Q]||[],i[Q].push({widget:R,tab:_,page:D})}}}t.value=i}),{pagination:b,columns:w,usage:t,copyClipboard:i=>useCopyToClipboard(i),goTo:(i,D,M)=>{T.dev("DEBUG","WidgetsTable","goTo"),m.set({selectedPage:i,selectedTab:D}),p.push({name:"LayoutPage"})},isDeleted:i=>i._deleted===!0,onWidgetEdit:i=>r("onEditWidget",i),onWidgetCopy:i=>m.copyWidget({widget:i}),onWidgetRemove:i=>m.removeWidget({widget:i}),onWidgetRestore:i=>m.restoreWidget({widget:i})}}}),de={class:"q-pa-md"},re={key:0},ue=["onClick"],ce={key:0},ge={key:1},me={key:2};function we(e,r,c,p,m,b){const w=y("icon");return l(),u("div",de,[o(se,{rows:e.widgets,columns:e.columns,pagination:e.pagination,"rows-per-page-label":e.$t("Widgets per page")},{header:n(t=>[o(G,{props:t},{default:n(()=>[o(B,{"auto-width":""}),(l(!0),u(P,null,V(t.cols,a=>U((l(),$(B,{key:a.name,props:t},{default:n(()=>[C(g(a.label),1)]),_:2},1032,["props"])),[[j,a.field!=="id"]])),128)),o(B,{"auto-width":""})]),_:2},1032,["props"])]),body:n(t=>[o(G,{props:t,class:v({rowDeleted:e.isDeleted(t.row)})},{default:n(()=>[o(W,{"auto-width":""},{default:n(()=>[e.isDeleted(t.row)!==!0?(l(),u("div",re,[o(k,{size:"sm",flat:"",round:"",onClick:a=>e.onWidgetEdit(t.row),icon:"mdi-pencil"},null,8,["onClick"]),o(k,{size:"sm",flat:"",round:"",onClick:a=>e.onWidgetCopy(t.row),icon:"mdi-content-copy"},null,8,["onClick"])])):E("",!0)]),_:2},1024),o(W,null,{default:n(()=>[z("div",{class:v({itemDeleted:e.isDeleted(t.row)}),onClick:a=>e.copyClipboard(t.cols[0].value)},[o(le,null,{default:n(()=>[C(" ID: "+g(t.cols[0].value)+" ("+g(e.$t("click to copy to clipboard"))+") ",1)]),_:2},1024),t.cols[1].value?(l(),u("span",ce,g(t.cols[1].value),1)):(l(),u("em",ge,"("+g(e.$t("no title"))+")",1)),t.row.label?(l(),u("span",me," ("+g(t.row.label)+")",1)):E("",!0),o(w,{name:"clipboard-text-multiple-outline",size:"xs",style:{"margin-left":"4px"}})],10,ue)]),_:2},1024),o(W,null,{default:n(()=>[z("div",{class:v({itemDeleted:e.isDeleted(t.row)})},g(t.cols[2].value),3)]),_:2},1024),o(W,null,{default:n(()=>[e.usage[t.row.id]?(l(),u("div",{key:1,class:v({itemDeleted:e.isDeleted(t.row)})},[C(g(e.usage[t.row.id].length)+": ",1),(l(!0),u(P,null,V(e.usage[t.row.id],({widget:a,tab:f,page:d},s)=>(l(),$(Z,{key:t.row.id+"-"+s,square:"",color:"primary","text-color":"white",onClick:N=>e.goTo(d,f,a),clickable:""},{default:n(()=>[C(g(f.title+" ("+d.title+")"),1)]),_:2},1032,["onClick"]))),128))],2)):(l(),u("div",{key:0,class:v({itemDeleted:e.isDeleted(t.row)})},null,2))]),_:2},1024),o(W,{"auto-width":""},{default:n(()=>[e.isDeleted(t.row)!==!0?(l(),$(k,{key:0,size:"sm",flat:"",round:"",onClick:a=>e.onWidgetRemove(t.row),icon:"mdi-delete",color:"negative"},null,8,["onClick"])):E("",!0),e.isDeleted(t.row)?(l(),$(k,{key:1,size:"sm",flat:"",round:"",onClick:a=>e.onWidgetRestore(t.row),icon:"mdi-restore",color:"positive"},null,8,["onClick"])):E("",!0)]),_:2},1024)]),_:2},1032,["props","class"])]),_:1},8,["rows","columns","pagination","rows-per-page-label"])])}var fe=S(ae,[["render",we]]);const pe=J({name:"WidgetsPage",components:{JsonEditor:ie,WidgetsTable:fe,WidgetPage:ne},setup(){T.dev("DEBUG","WidgetsPage","setup()");const e=K(),r=O(),c=h(()=>e.pageHeight),p=h(()=>r.getGroupedWidgets),m=h(()=>r.getWidgetsWthoutDeletionsCount),b=h(()=>r.widgets),w=h(()=>{var s;return(s=r.settings)==null?void 0:s.configExpertMode}),t=I(),a=()=>{t.value=ee()},f=s=>{t.value=s.id},d=s=>{if(s._error){r.addError(s.id,s._error);return}r.removeError(s.id),s.value&&r.set({[s.id]:JSON.parse(s.value)})};return{expanded:I({}),pageHeight:c,groups:p,json:b,expertMode:w,widgetsCount:m,selectedWidgetId:t,addWidget:a,editWidget:f,onJsonEditor:d}}}),be={class:"full-height WidgetsPage"},ve={class:"row no-wrap"};function he(e,r,c,p,m,b){const w=y("widget-page"),t=y("widgets-table"),a=y("json-editor"),f=y("paper");return l(),u("div",be,[z("div",ve,[o(te,{class:"paper",style:{"min-height":"56px"}},{default:n(()=>[o(L,{shrink:""},{default:n(()=>[C(g(e.$t("Widgets"))+" ("+g(e.widgetsCount)+")",1)]),_:1}),o(Y),o(k,{color:"primary",icon:"mdi-plus-circle",label:e.$t("Add Widget"),onClick:e.addWidget},null,8,["label","onClick"])]),_:1})]),o(w,{onOnClose:r[0]||(r[0]=d=>e.selectedWidgetId=null),widgetId:e.selectedWidgetId},null,8,["widgetId"]),(l(!0),u(P,null,V(e.groups,d=>U((l(),u("div",{class:"row no-wrap paper",key:d.id},[o(oe,{modelValue:e.expanded[d.id],"onUpdate:modelValue":s=>e.expanded[d.id]=s,icon:d.icon,label:d.label+" ("+d.widgets.length+")",class:"full-width"},{default:n(()=>[o(t,{onOnEditWidget:e.editWidget,widgets:d.widgets},null,8,["onOnEditWidget","widgets"])]),_:2},1032,["modelValue","onUpdate:modelValue","icon","label"])])),[[j,!e.expertMode&&d.widgets.length>0]])),128)),U(o(f,{style:x({height:e.pageHeight-66-16+"px"})},{default:n(()=>[o(a,{id:"widgets",json:e.json,onOnChange:e.onJsonEditor},null,8,["json","onOnChange"])]),_:1},8,["style"]),[[j,e.expertMode]])])}var Ue=S(pe,[["render",he]]);export{Ue as default};
