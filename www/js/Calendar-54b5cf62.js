import{dE as F,dF as K,dG as O,bx as Z,cW as ee,c2 as ae,cX as te,c8 as ne,Q as y,ac as P,b6 as se,a9 as oe,cQ as R,bM as le,bt as re,a4 as ie,co as de,dc as ue,dH as ce,k as C,dI as ve,an as ge,aw as me,aG as B,ay as Q,W as I,b3 as $,bn as N,a2 as d,d3 as fe,X as m,U as ye,b1 as f,bT as V,D as _,bD as pe,bB as he,bU as be,bS as Ce,bW as ke,V as we,I as De,aE as Se,a1 as _e,dJ as Me,C as qe,dK as Pe,bs as Qe,du as Ae}from"./index-e4fcd5f5.js";import ze from"./EventList-de5c0fff.js";import{n as Be}from"./index-5cc2bcea.js";import{s as E}from"./index-65fad8d5.js";import"./QTooltip-085b3b7e.js";import"./___vite-browser-external_commonjs-proxy-afe9cd7a.js";import"./_commonjsHelpers-55d1ff45.js";function T(e,o){F(2,arguments);var r=K(e),v=O(o);return isNaN(v)?new Date(NaN):(v&&r.setDate(r.getDate()+v),r)}function Ie(e,o){F(2,arguments);var r=O(o);return T(e,-r)}var $e=Z({name:"QInnerLoading",props:{...ee,...ae,showing:Boolean,color:String,size:{type:[String,Number],default:42},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(e,{slots:o}){const r=oe(),v=te(e,r.proxy.$q),{transitionProps:k,transitionStyle:c}=ne(e),w=y(()=>"q-inner-loading absolute-full column flex-center"+(v.value===!0?" q-inner-loading--dark":"")),p=y(()=>"q-inner-loading__label"+(e.labelClass!==void 0?` ${e.labelClass}`:""));function u(){const g=[P(R,{size:e.size,color:e.color})];return e.label!==void 0&&g.push(P("div",{class:p.value,style:e.labelStyle},[e.label])),g}function n(){return e.showing===!0?P("div",{class:w.value,style:c.value},o.default!==void 0?o.default():u()):null}return()=>P(se,k.value,n)}});function Ne(e=!1){const o=le(),r=o.locale.value||o.locale;return e?r.substr(0,2):r}const Ee=ie({name:"ModuleCalendar",props:["_size","widget"],components:{EventList:ze},setup(e){const o=Ae.getConnection,r=de(),v=Ne(!0),k=y(()=>e.widget.config),c=y(()=>({...ue.joinConfig(k.value,ce),timezone:k.value.timezone||"Europe/Amsterdam",calendars:k.value.calendars||[]})),w=y(()=>r.dark.isActive),p=C(!1),u=C(new Date);Be.scheduleJob("0 0 0 * * *",()=>{u.value=new Date});const n=C({year:u.value.getFullYear(),month:u.value.getMonth()+1}),g=({year:a,month:t})=>{(n.value.month!==t||n.value.year!==a)&&(n.value.year=a,n.value.month=t,p.value=W[a+"-"+t]||!1,q(a,t).then(()=>{M()}))},h=E(Ie(u.value,c.value.daysReview)),U=E(T(u.value,c.value.daysPreview)),b=C([h,U]),j=({date:a})=>{c.value.calendarAgenda===!1||c.value.calendarAgenda!==!1&&b.value.length===2?b.value=[a]:a<b.value[0]?b.value.unshift(a):b.value.push(a),M()},G=y(()=>{let[a,t]=b.value;return t=E(t?a.getMonth()!==t.getMonth()?ve(a):t:a),u.value.getFullYear()!==n.value.year||u.value.getMonth()+1!==n.value.month?[]:[{key:"selectedEnd",highlight:{contentStyle:{backgroundColor:"var(--q-accent)",opacity:1,color:"#fff"}},dates:t,order:102},{key:"selectedStart",highlight:{contentStyle:{backgroundColor:"var(--q-accent)",opacity:1,color:"#fff"}},dates:a,order:101},{key:"selected",highlight:{style:{backgroundColor:"var(--q-accent)",opacity:.3},contentStyle:{color:"var(--q-accent)"}},dates:{start:a,end:t},order:99},{key:"today",highlight:{style:{backgroundColor:"var(--q-primary)"},contentStyle:{color:"#fff",fontWeight:"bold"}},dates:u.value,order:200}]}),L=C([]),x=(a,t)=>{const l=[];Y.value.forEach(s=>{!l.some(D=>D.uid===s.uid)&&(s&&s.start>=a&&s.start<=t||s&&s.start<=a&&s.end>=a)&&l.push(s)}),L.value=l.sort((s,D)=>s.start===D.start?0:s.start>D.start?1:-1)},M=()=>{let[a,t]=b.value;if(t=Me(t||a),a.getMonth()===t.getMonth())x(a,t);else{let l=n.value.month+1;const s=l>12?n.value.year+1:n.value.year;l=l>12?1:l,q(s,l).then(()=>{x(a,t)})}},W=C({}),A=C({}),Y=y(()=>Object.values(A.value).flat()),H=(a,t,l)=>(a.color&&Pe("calendar--"+a.name.toLowerCase().replace(/ /g,"-").replace(/\./g,"-"),a.color),new Promise((s,D)=>{o.getSpecial("Calendar",{calendar:a,year:t,month:l,options:{...c.value,language:v}},S=>{if(S.error)return console.warn("Calendar-a99xoa47",e.widget.id,S.error),D(S.error);if(S.events&&Array.isArray(S.events)){const X=S.events.map((i,Fe)=>(i.start=new Date(i.start),i.end=new Date(i.end),{calendar:a,...i,key:i.uid,dot:{style:{backgroundColor:a.color||Qe.getPaletteColor("primary")}},popover:{label:i.summary},dates:i.duration<=0?i.start:{start:i.start,end:i.end},customData:{calendar:a,summary:i.summary,time:i.time}}));W[t+"-"+l]=!0,A.value[a.id+":"+t+"-"+l]=X,s(A.value[a.id])}})})),q=(a,t)=>{const l=c.value.calendars.map(s=>H(s,a,t));return Promise.allSettled(l).then(s=>(p.value=!0,s))};let z=null;ge(()=>{q(n.value.year,n.value.month).then(()=>{M()}),z=setInterval(()=>{console.debug("Calendar-d53dca17",e.widget.id,"Refreshing ical data..."),q(n.value.year,n.value.month).then(()=>{M()})},c.value.refresh*60*1e3)}),me(()=>z&&clearInterval(z));const J=y(()=>[...Y.value,...G.value]);return{loaded:p,language:v,isDarkMode:w,moduleConfig:c,setDate:g,setRange:j,attributes:J,agenda:L}}}),Le={style:{position:"relative"}},xe={class:"text-h6"},We={class:"text-xs text-gray-300 font-semibold"},Ye={class:"Calendar-Popover-List"};function Ve(e,o,r,v,k,c){const w=B("event-list"),p=B("icon"),u=B("v-calendar");return Q(),I("div",null,[$(d(fe,{indeterminate:""},null,512),[[N,!e.loaded]]),m("div",Le,[e.moduleConfig.calendarAgenda===!1?(Q(),ye(ke,{key:0,"model-value":e.popup,onHide:o[1]||(o[1]=n=>e.popup=!1)},{default:f(()=>[d(Ce,{style:{width:"800px","max-width":"80vw"}},{default:f(()=>[d(V,{class:"row items-center"},{default:f(()=>[m("div",xe,_(e.$t("Calendar Details")),1),d(pe),d(he,{flat:"",round:"",color:"grey",icon:"close",onClick:o[0]||(o[0]=n=>e.popup=!1)})]),_:1}),d(be),d(V,{class:"col q-pa-none scroll body"},{default:f(()=>[d(w,{agenda:e.agenda},null,8,["agenda"])]),_:1})]),_:1})]),_:1},8,["model-value"])):we("",!0),$(m("div",null,[d(u,{"onUpdate:toPage":e.setDate,onDayclick:e.setRange,class:"Calendar",attributes:e.attributes,"is-dark":e.isDarkMode,locale:e.language,masks:{dayPopover:"WWW, D. MMMM YYYY"},"trim-weeks":"","show-iso-weeknumbers":"","disable-page-swipe":""},{"header-title":f(({monthLabel:n,year:g})=>[m("div",null,_(n+" "+g),1),d(p,{name:"mdi-calendar-cursor",size:"xs",class:"q-ml-xs"})]),"day-popover":f(({dayTitle:n,attributes:g})=>[m("div",null,[m("strong",We,_(n),1),m("ul",Ye,[(Q(!0),I(De,null,Se(g,h=>(Q(),I("li",{key:h.key+"-"+(h.customData.calendar.color||""),style:qe({color:h.customData.calendar.color||"var(--q-primary)"})},[m("span",null,_(h.customData.time)+", "+_(h.customData.summary),1)],4))),128))])])]),default:f(()=>[_e(' /* :timezone="moduleConfig.timezone" trim-weeks: By default, calendar panes always displays the maximum number of weeks in a month, even if the max week does not contain any days in the current month displayed. */ ')]),_:1},8,["onUpdate:toPage","onDayclick","attributes","is-dark","locale","masks"]),d($e,{showing:!e.loaded},{default:f(()=>[d(R,{size:"50px",color:"primary"})]),_:1},8,["showing"])],512),[[N,e.moduleConfig.calendarPreview!==!1]]),$(d(w,{agenda:e.agenda},null,8,["agenda"]),[[N,e.moduleConfig.calendarAgenda!==!1]])])])}var Je=re(Ee,[["render",Ve]]);export{Je as default};
