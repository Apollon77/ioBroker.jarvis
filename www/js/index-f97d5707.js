import{Q as U}from"./QToolbarTitle-31630b1c.js";import{q as S,X as F,cs as A,cq as M,a4 as I,z as G,_ as N,j as y,o as s,d as r,k as o,w as n,F as j,l as z,J as P,a2 as V,a as D,i as C,t as g,f as v,O as k,g as _,e as J,cL as X,H as K,c as W,ac as Y,n as Z,d6 as x}from"./index-8c8fca3a.js";import{Q as ee}from"./QToolbar-5bbd648e.js";import{Q as te}from"./QExpansionItem-879e7bd2.js";import{J as oe}from"./json-editor-9657b6ce.js";import{Q as B,a as E,b,c as ie}from"./QTable-051274b9.js";import{Q as se}from"./QTooltip-30d1582f.js";import{W as ne}from"./WidgetPage-13c1d92c.js";import"./QSlideTransition-0f1c690c.js";import"./_commonjsHelpers-45ea234c.js";import"./QVirtualScroll-8505407f.js";import"./useDragDrop-4337f0d0.js";import"./vue.runtime.esm-bundler-3e399063.js";const le=S({name:"WidgetsTable",props:["widgets"],emits:["onEditWidget"],setup(e,{emit:c}){const u=F(),f=A(),m=M(),h={sortBy:"title",rowsPerPage:15},p=[{name:"id",label:u.t("ID"),field:"id",align:"left",sortable:!0},{name:"title",label:u.t("Title")+" ("+u.t("ID")+")",field:"title",align:"left",sortable:!0,style:{width:"20%"}},{name:"module",label:u.t("Module"),field:"module",align:"left",sortable:!0,style:{width:"15%"}},{name:"usage",label:u.t("Usage")+" [ #: "+u.t("Tab")+" ("+u.t("Page")+") ]",field:"usage",align:"left",sortable:!0,style:{width:"65%"}}],t=I({});return G(()=>{const i={};for(const $ of m.layout){const O=$.tabs||[];for(const T of O){const H=[...T.widgetsDesktop||[],...T.widgetsSmartphone||[]];for(const R of H){const L=R.items||[];for(const Q of L)i[Q]=i[Q]||[],i[Q].push({widget:R,tab:T,page:$})}}}t.value=i}),{pagination:h,columns:p,usage:t,copyClipboard:i=>useCopyToClipboard(i),goTo:(i,$,O)=>{m.set({selectedPage:i,selectedTab:$}),f.push({name:"LayoutPage"})},isDeleted:i=>i._deleted===!0,onWidgetEdit:i=>c("onEditWidget",i),onWidgetCopy:i=>m.copyWidget({widget:i}),onWidgetRemove:i=>m.removeWidget({widget:i}),onWidgetRestore:i=>m.restoreWidget({widget:i})}}}),ae={class:"q-pa-md"},de={key:0},re=["onClick"],ce={key:0},ue={key:1},ge={key:2};function me(e,c,u,f,m,h){const p=y("icon");return s(),r("div",ae,[o(ie,{rows:e.widgets,columns:e.columns,pagination:e.pagination,"rows-per-page-label":e.$t("Widgets per page")},{header:n(t=>[o(B,{props:t},{default:n(()=>[o(E,{"auto-width":""}),(s(!0),r(j,null,z(t.cols,l=>P((s(),D(E,{key:l.name,props:t},{default:n(()=>[C(g(l.label),1)]),_:2},1032,["props"])),[[V,l.field!=="id"]])),128)),o(E,{"auto-width":""})]),_:2},1032,["props"])]),body:n(t=>[o(B,{props:t,class:v({rowDeleted:e.isDeleted(t.row)})},{default:n(()=>[o(b,{"auto-width":""},{default:n(()=>[e.isDeleted(t.row)!==!0?(s(),r("div",de,[o(k,{size:"sm",flat:"",round:"",onClick:l=>e.onWidgetEdit(t.row),icon:"mdi-pencil"},null,8,["onClick"]),o(k,{size:"sm",flat:"",round:"",onClick:l=>e.onWidgetCopy(t.row),icon:"mdi-content-copy"},null,8,["onClick"])])):_("",!0)]),_:2},1024),o(b,null,{default:n(()=>[J("div",{class:v({itemDeleted:e.isDeleted(t.row)}),onClick:l=>e.copyClipboard(t.cols[0].value)},[o(se,null,{default:n(()=>[C(" ID: "+g(t.cols[0].value)+" ("+g(e.$t("click to copy to clipboard"))+") ",1)]),_:2},1024),t.cols[1].value?(s(),r("span",ce,g(t.cols[1].value),1)):(s(),r("em",ue,"("+g(e.$t("no title"))+")",1)),t.row.label?(s(),r("span",ge," ("+g(t.row.label)+")",1)):_("",!0),o(p,{name:"clipboard-text-multiple-outline",size:"xs",style:{"margin-left":"4px"}})],10,re)]),_:2},1024),o(b,null,{default:n(()=>[J("div",{class:v({itemDeleted:e.isDeleted(t.row)})},g(t.cols[2].value),3)]),_:2},1024),o(b,null,{default:n(()=>[e.usage[t.row.id]?(s(),r("div",{key:1,class:v({itemDeleted:e.isDeleted(t.row)})},[C(g(e.usage[t.row.id].length)+": ",1),(s(!0),r(j,null,z(e.usage[t.row.id],({widget:l,tab:w,page:a},d)=>(s(),D(X,{key:t.row.id+"-"+d,square:"",color:"primary","text-color":"white",onClick:q=>e.goTo(a,w,l),clickable:""},{default:n(()=>[C(g(w.title+" ("+a.title+")"),1)]),_:2},1032,["onClick"]))),128))],2)):(s(),r("div",{key:0,class:v({itemDeleted:e.isDeleted(t.row)})},null,2))]),_:2},1024),o(b,{"auto-width":""},{default:n(()=>[e.isDeleted(t.row)!==!0?(s(),D(k,{key:0,size:"sm",flat:"",round:"",onClick:l=>e.onWidgetRemove(t.row),icon:"mdi-delete",color:"negative"},null,8,["onClick"])):_("",!0),e.isDeleted(t.row)?(s(),D(k,{key:1,size:"sm",flat:"",round:"",onClick:l=>e.onWidgetRestore(t.row),icon:"mdi-restore",color:"positive"},null,8,["onClick"])):_("",!0)]),_:2},1024)]),_:2},1032,["props","class"])]),_:1},8,["rows","columns","pagination","rows-per-page-label"])])}var pe=N(le,[["render",me]]);const we=S({name:"WidgetsPage",components:{JsonEditor:oe,WidgetsTable:pe,WidgetPage:ne},setup(){const e=K(),c=M(),u=W(()=>e.pageHeight),f=W(()=>c.getGroupedWidgets),m=W(()=>c.getWidgetsWthoutDeletionsCount),h=W(()=>c.widgets),p=W(()=>{var d;return(d=c.settings)==null?void 0:d.configExpertMode}),t=I(),l=()=>{t.value=x()},w=d=>{t.value=d.id},a=d=>!d._error&&c.set({[d.id]:JSON.parse(d.value)});return{expanded:I({}),pageHeight:u,groups:f,json:h,expertMode:p,widgetsCount:m,selectedWidgetId:t,addWidget:l,editWidget:w,onJsonEditor:a}}}),fe={class:"full-height WidgetsPage"},he={class:"row no-wrap"};function ve(e,c,u,f,m,h){const p=y("widget-page"),t=y("widgets-table"),l=y("json-editor"),w=y("paper");return s(),r("div",fe,[J("div",he,[o(ee,{class:"paper",style:{"min-height":"56px"}},{default:n(()=>[o(U,{shrink:""},{default:n(()=>[C(g(e.$t("Widgets"))+" ("+g(e.widgetsCount)+")",1)]),_:1}),o(Y),o(k,{color:"primary",icon:"mdi-plus-circle",label:e.$t("Add Widget"),onClick:e.addWidget},null,8,["label","onClick"])]),_:1})]),o(p,{onOnClose:c[0]||(c[0]=a=>e.selectedWidgetId=null),widgetId:e.selectedWidgetId},null,8,["widgetId"]),(s(!0),r(j,null,z(e.groups,a=>P((s(),r("div",{class:"row no-wrap paper",key:a.id},[o(te,{modelValue:e.expanded[a.id],"onUpdate:modelValue":d=>e.expanded[a.id]=d,icon:a.icon,label:a.label+" ("+a.widgets.length+")",class:"full-width"},{default:n(()=>[o(t,{onOnEditWidget:e.editWidget,widgets:a.widgets},null,8,["onOnEditWidget","widgets"])]),_:2},1032,["modelValue","onUpdate:modelValue","icon","label"])])),[[V,!e.expertMode&&a.widgets.length>0]])),128)),P(o(w,{style:Z({height:e.pageHeight-66-16+"px"})},{default:n(()=>[o(l,{id:"widgets",json:e.json,onOnChange:e.onJsonEditor},null,8,["json","onOnChange"])]),_:1},8,["style"]),[[V,e.expertMode]])])}var Ve=N(we,[["render",ve]]);export{Ve as default};
