import{dz as U,dA as K,dB as V,bY as Z,cQ as ee,b$ as ae,cR as te,c5 as ne,Q as C,ac as q,b6 as se,a9 as oe,cM as W,bI as le,bt as re,a4 as ie,ck as de,u as ue,d7 as ce,dC as ve,k as b,dD as ge,an as me,aw as fe,aG as $,ay as A,W as B,b3 as I,bn as N,a2 as u,c$ as ye,X as m,U as he,b1 as f,bO as O,D,bU as pe,bC as be,bP as Ce,bN as ke,bR as we,V as De,I as Se,aE as _e,dE as Me,a1 as qe,C as Ae,bs as Pe,dp as Qe}from"./index-f8128eaf.js";import ze from"./EventList-e4325dc3.js";import{n as $e}from"./index-77230059.js";import{s as E}from"./index-3bbdb135.js";import"./QTooltip-8c008f78.js";import"./___vite-browser-external_commonjs-proxy-afe9cd7a.js";import"./_commonjsHelpers-55d1ff45.js";function F(e,s){U(2,arguments);var i=K(e),v=V(s);return isNaN(v)?new Date(NaN):(v&&i.setDate(i.getDate()+v),i)}function Be(e,s){U(2,arguments);var i=V(s);return F(e,-i)}var Ie=Z({name:"QInnerLoading",props:{...ee,...ae,showing:Boolean,color:String,size:{type:[String,Number],default:42},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(e,{slots:s}){const i=oe(),v=te(e,i.proxy.$q),{transition:S,transitionStyle:l}=ne(e,C(()=>e.showing)),k=C(()=>"q-inner-loading absolute-full column flex-center"+(v.value===!0?" q-inner-loading--dark":"")),y=C(()=>"q-inner-loading__label"+(e.labelClass!==void 0?` ${e.labelClass}`:""));function c(){const g=[q(W,{size:e.size,color:e.color})];return e.label!==void 0&&g.push(q("div",{class:y.value,style:e.labelStyle},[e.label])),g}function n(){return e.showing===!0?q("div",{class:k.value,style:l.value},s.default!==void 0?s.default():c()):null}return()=>q(se,{name:S.value,appear:!0},n)}});function Ne(e=!1){const s=le(),i=s.locale.value||s.locale;return e?i.substr(0,2):i}const Ee=ie({name:"ModuleCalendar",props:["_size","widget"],components:{EventList:ze},setup(e){const s=Qe.getConnection,i=de(),v=Ne(!0),S=ue(e.widget,"config"),l=ce.joinConfig(S.value,ve);l.timezone=l.timezone||"Europe/Amsterdam",l.calendars=l.calendars||[];const k=C(()=>i.dark.isActive),y=b(!1),c=b(new Date);$e.scheduleJob("0 0 0 * * *",()=>{c.value=new Date});const n=b({year:c.value.getFullYear(),month:c.value.getMonth()+1}),g=({year:a,month:t})=>{(n.value.month!==t||n.value.year!==a)&&(n.value.year=a,n.value.month=t,y.value=L[a+"-"+t]||!1,M(a,t).then(()=>{_()}))},h=E(Be(c.value,l.daysReview)),T=E(F(c.value,l.daysPreview)),p=b([h,T]),j=({date:a})=>{l.calendarAgenda===!1||l.calendarAgenda!==!1&&p.value.length===2?p.value=[a]:a<p.value[0]?p.value.unshift(a):p.value.push(a),_()},G=C(()=>{let[a,t]=p.value;return t=E(t?a.getMonth()!==t.getMonth()?ge(a):t:a),c.value.getFullYear()!==n.value.year||c.value.getMonth()+1!==n.value.month?[]:[{key:"selectedEnd",highlight:{contentStyle:{backgroundColor:"var(--q-accent)",opacity:1,color:"#fff"}},dates:t,order:102},{key:"selectedStart",highlight:{contentStyle:{backgroundColor:"var(--q-accent)",opacity:1,color:"#fff"}},dates:a,order:101},{key:"selected",highlight:{style:{backgroundColor:"var(--q-accent)",opacity:.3},contentStyle:{color:"var(--q-accent)"}},dates:{start:a,end:t},order:99},{key:"today",highlight:{style:{backgroundColor:"var(--q-primary)"},contentStyle:{color:"#fff",fontWeight:"bold"}},dates:c.value,order:200}]}),R=b([]),Y=(a,t)=>{const r=[];x.value.forEach(o=>{!r.some(z=>z.uid===o.uid)&&(o&&o.start>=a&&o.start<=t||o&&o.start<=a&&o.end>=a)&&r.push(o)}),R.value=r},_=()=>{let[a,t]=p.value;if(t=Me(t||a),a.getMonth()===t.getMonth())Y(a,t);else{let r=n.value.month+1;const o=r>12?n.value.year+1:n.value.year;r=r>12?1:r,M(o,r).then(()=>{Y(a,t)})}},L=b({}),P=b({}),x=C(()=>Object.values(P.value).flat()),H=(a,t,r)=>new Promise((o,z)=>{s.getSpecial("Calendar",{calendar:a,year:t,month:r,options:{...l,language:v}},w=>{if(w.error)return console.warn("Calendar-a99xoa47",e.widget.id,w.error),z(w.error);if(w.events&&Array.isArray(w.events)){const X=w.events.map((d,Ve)=>(d.start=new Date(d.start),d.end=new Date(d.end),{calendar:a,...d,key:d.uid,dot:{style:{backgroundColor:a.color||Pe.getPaletteColor("primary")}},popover:{label:d.summary},dates:d.duration<=0?d.start:{start:d.start,end:d.end},customData:{calendar:a,summary:d.summary,time:d.time}}));L[t+"-"+r]=!0,P.value[a.id+":"+t+"-"+r]=X,o(P.value[a.id])}})}),M=(a,t)=>{const r=l.calendars.map(o=>H(o,a,t));return Promise.allSettled(r).then(o=>(y.value=!0,o))};let Q=null;me(()=>{M(n.value.year,n.value.month).then(()=>{_()}),Q=setInterval(()=>{console.debug("Calendar-d53dca17",e.widget.id,"Refreshing ical data..."),M(n.value.year,n.value.month).then(()=>{_()})},l.refresh*60*1e3)}),fe(()=>Q&&clearInterval(Q));const J=C(()=>[...x.value,...G.value]);return{loaded:y,language:v,isDarkMode:k,moduleConfig:l,setDate:g,setRange:j,attributes:J,agenda:R}}}),Re={style:{position:"relative"}},Ye={class:"text-h6"},Le=qe(' /* :timezone="moduleConfig.timezone" trim-weeks: By default, calendar panes always displays the maximum number of weeks in a month, even if the max week does not contain any days in the current month displayed. */ '),xe={class:"text-xs text-gray-300 font-semibold"},Oe={class:"Calendar-Popover-List"};function Ue(e,s,i,v,S,l){const k=$("event-list"),y=$("icon"),c=$("v-calendar");return A(),B("div",null,[I(u(ye,{indeterminate:""},null,512),[[N,!e.loaded]]),m("div",Re,[e.moduleConfig.calendarAgenda===!1?(A(),he(we,{key:0,"model-value":e.popup,onHide:s[1]||(s[1]=n=>e.popup=!1)},{default:f(()=>[u(ke,{style:{width:"800px","max-width":"80vw"}},{default:f(()=>[u(O,{class:"row items-center"},{default:f(()=>[m("div",Ye,D(e.$t("Calendar Details")),1),u(pe),u(be,{flat:"",round:"",color:"grey",icon:"close",onClick:s[0]||(s[0]=n=>e.popup=!1)})]),_:1}),u(Ce),u(O,{class:"col q-pa-none scroll body"},{default:f(()=>[u(k,{agenda:e.agenda},null,8,["agenda"])]),_:1})]),_:1})]),_:1},8,["model-value"])):De("",!0),I(m("div",null,[u(c,{"onUpdate:toPage":e.setDate,onDayclick:e.setRange,class:"Calendar",attributes:e.attributes,"is-dark":e.isDarkMode,locale:e.language,masks:{dayPopover:"WWW, D. MMMM YYYY"},"trim-weeks":"","show-iso-weeknumbers":"","disable-page-swipe":""},{"header-title":f(({monthLabel:n,year:g})=>[m("div",null,D(n+" "+g),1),u(y,{name:"mdi-calendar-cursor",size:"xs",class:"q-ml-xs"})]),"day-popover":f(({dayTitle:n,attributes:g})=>[m("div",null,[m("strong",xe,D(n),1),m("ul",Oe,[(A(!0),B(Se,null,_e(g,h=>(A(),B("li",{key:h.key+"-"+(h.customData.calendar.color||""),style:Ae({color:h.customData.calendar.color||"var(--q-primary)"})},[m("span",null,D(h.customData.time)+", "+D(h.customData.summary),1)],4))),128))])])]),default:f(()=>[Le]),_:1},8,["onUpdate:toPage","onDayclick","attributes","is-dark","locale","masks"]),u(Ie,{showing:!e.loaded},{default:f(()=>[u(W,{size:"50px",color:"primary"})]),_:1},8,["showing"])],512),[[N,e.moduleConfig.calendarPreview!==!1]]),I(u(k,{agenda:e.agenda},null,8,["agenda"]),[[N,e.moduleConfig.calendarAgenda!==!1]])])])}var Xe=re(Ee,[["render",Ue]]);export{Xe as default};
