var $e=Object.defineProperty,Oe=Object.defineProperties;var ke=Object.getOwnPropertyDescriptors;var fe=Object.getOwnPropertySymbols;var Ee=Object.prototype.hasOwnProperty,Le=Object.prototype.propertyIsEnumerable;var ge=(e,s,i)=>s in e?$e(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i,K=(e,s)=>{for(var i in s||(s={}))Ee.call(s,i)&&ge(e,i,s[i]);if(fe)for(var i of fe(s))Le.call(s,i)&&ge(e,i,s[i]);return e},A=(e,s)=>Oe(e,ke(s));import{Q as Ie}from"./QToolbarTitle-7c40ee5e.js";import{q as H,cE as ye,cs as q,cF as ce,_ as W,j as k,o as m,d as w,k as t,w as n,ab as Z,e as o,t as v,O as y,a as D,i as S,g as O,f as N,a5 as X,a6 as j,p as Se,a7 as pe,a4 as ve,a8 as me,co as ne,a2 as V,c as E,a3 as G,G as we,J as _,a1 as J,m as z,M as $,F,W as de,bV as je,cr as _e,cG as be,cH as Ce,aa as Ke,cI as Ve,cJ as oe,N as ue,cK as ae,L as ee,cL as ie,Z as B,l as R,cM as Qe,ci as Te,n as te,H as Ae,Y as ze,V as Me,K as Ue,Q as Pe}from"./index-49754fed.js";import{Q as Ne}from"./QBtnDropdown-be1a7320.js";import{Q as Fe}from"./QToolbar-c0bd9b87.js";import{Q as se}from"./QExpansionItem-1e6af8f1.js";import{Q as he}from"./QTooltip-7af5cb52.js";import{Q as qe}from"./QTree-2adae3e4.js";import{D as Be,u as Je,a as Re}from"./useDragDrop-b1afb085.js";import{Q as De,a as re,b as Y,c as Ge}from"./QTable-a1e2dd2b.js";import{J as He}from"./json-editor-3d24f516.js";import"./QSlideTransition-f76ca907.js";import"./_commonjsHelpers-45ea234c.js";import"./vue.runtime.esm-bundler-994971db.js";import"./QVirtualScroll-c32fcdc3.js";function We(e){const s=document.createElement("textarea");s.value=e,s.contentEditable="true",s.style.position="fixed",document.body.appendChild(s),s.focus(),s.select();const i=document.execCommand("copy");return s.remove(),i}function Ye(e){return navigator.clipboard!==void 0?navigator.clipboard.writeText(e):new Promise((s,i)=>{const r=We(e);r?s(!0):i(r)})}const Ze=H({name:"StateExplorer",props:["id","selected"],data(){return{filter:"",lastUpdate:ye(q.get("objectsUpdated"),"dd. MMMM yyyy, HH:mm:ss"),loading:!1,objectTree:{},instanceList:[],selectedItem:this.selected,expandedItems:[]}},methods:{expandNode(e){if(e in this.objects){const s=e.split(".");s.splice(0,2,s[0]+"."+s[1]);let i="";s.forEach(r=>{i+=i?"."+r:r,this.$refs.StateExplorer.setExpanded(i,!0)})}},onLazyLoad({key:e,done:s}){s(this.objectTree[e]&&this.objectTree[e].children||[])},onSelect(e){e=e||this.selectedItem,this.$refs.StateExplorer.isExpanded(e)?this.$refs.StateExplorer.setExpanded(e||this.selectedItem,!1):this.objectTree[e]&&this.objectTree[e].children&&this.$refs.StateExplorer.setExpanded(e,!0),this.selectedItem=e,this.$emit("onChange",{id:this.id||"StateExplorer",value:e||""})},filterMethod(e,s){console.warn(e._id,s);const i=this.objectTree[e._id]||null,r=e._id.indexOf(s)>-1;return i&&i.children&&i.children.forEach(u=>{console.log("->"+u._id)}),r},updateObjects(){this.loading=!0,ce.getObjects().then(()=>{this.lastUpdate=ye(q.get("objectsUpdated"),"dd. MMMM yyyy, HH:mm:ss"),this.objects=q.get("objects"),this.objectList=q.get("objectList"),this.getInstanceList(),this.loading=!1})},getInstanceList(){const e={},s=[];this.objectList.forEach(i=>{const r=this.objects[i];if(r){const u=r._id.substr(0,r._id.lastIndexOf(".")),b=r._id.substr(0,r._id.indexOf(".",r._id.indexOf(".")+1));b&&!s.find(l=>l._id===b)&&s.push({_id:b,label:b,lazy:!0}),e[u]=e[u]||{children:[]},e[u].children.findIndex(l=>l._id===r._id)===-1&&e[u].children.push(A(K({},r),{label:r._id.substr(r._id.lastIndexOf(".")+1),lazy:r.type!=="state",isState:r.type==="state"}));const f=r._id.split(".");f.length>2&&f.forEach((l,a)=>{const h=f.slice(0,a).join("."),p=h.substr(0,h.lastIndexOf("."));h&&p&&(e[p]=e[p]||{children:[]},e[p].children.findIndex(g=>g._id===h)===-1&&e[p].children.push({_id:h,label:h.substr(h.lastIndexOf(".")+1),lazy:!0,isState:!1}))})}});for(const i in e)e[i].children.sort((r,u)=>r.isState===!1&&u.isState===!0?-1:r.isState===!0&&u.isState===!1?1:r.label.toLowerCase()===u.label.toLowerCase()?0:r.label.toLowerCase()>u.label.toLowerCase()?1:-1);this.objectTree=e,this.instanceList=s.sort((i,r)=>i.label.toLowerCase()===r.label.toLowerCase()?0:i.label.toLowerCase()>r.label.toLowerCase()?1:-1)}},mounted(){this.selected&&(this.expandNode(this.selected),setTimeout(()=>{const e=document.querySelector(".q-tree__node--selected");e&&e.scrollIntoView(!1)},2e3))},created(){this.filterTimeout=null,this.objects=q.get("objects"),this.objectList=q.get("objectList"),this.getInstanceList()}}),Xe={style:{"padding-bottom":"16px"}},xe={class:"items-center justify-end row"},et={style:{"padding-right":"8px"}},tt={class:"overflow-dots",style:{width:"5%"}},st={class:"overflow-dots q-pr-xs",style:{width:"25%"}},nt={class:"overflow-dots q-pr-xs",style:{width:"45%"}},lt={class:"overflow-dots",style:{width:"10%"}},ot={class:"overflow-dots",style:{width:"15%"}};function at(e,s,i,r,u,b){const f=k("paper"),l=k("icon");return m(),w("div",Xe,[t(f,{class:"StateExplorerBar",style:{"min-height":"54px"}},{default:n(()=>[t(Z),o("div",xe,[o("span",et,v(e.$t("Last Update"))+": "+v(e.lastUpdate),1),t(y,{color:"primary",label:e.$t("Refresh"),icon:"refresh",onClick:e.updateObjects,loading:e.loading,disable:e.loading},null,8,["label","onClick","loading","disable"])])]),_:1}),t(f,{class:"q-pa-sm"},{default:n(()=>[t(qe,{ref:"StateExplorer",nodes:e.instanceList,"node-key":"_id","label-key":"label",onLazyLoad:e.onLazyLoad,"selected-color":"primary","onUpdate:selected":e.onSelect,selected:e.selectedItem},{"default-header":n(a=>[o("div",{class:N(["row full-width",{item:!a.node.children||a.node.children.length===0}])},[o("div",tt,[t(l,{color:e.selectedItem&&e.selectedItem===a.node._id?"accent":"primary",name:a.node.type==="state"?e.selectedItem&&e.selectedItem===a.node._id?"mdi-bookmark":"mdi-bookmark-outline":"folder"},null,8,["color","name"])]),o("div",st,v(a.node.label),1),o("div",nt,[a.node.common&&a.node.common.name&&a.node.common.name.length>50?(m(),D(he,{key:0},{default:n(()=>[S(v(a.node.common.name),1)]),_:2},1024)):O("",!0),S(" "+v(a.node.common&&a.node.common.name?a.node.common.name.length>50?a.node.common.name.substr(0,47)+"...":a.node.common.name:""),1)]),o("div",lt,v(a.node.type),1),o("div",ot,v(a.node.common&&a.node.common.role?a.node.common.role:""),1)],2)]),_:1},8,["nodes","onLazyLoad","onUpdate:selected","selected"])]),_:1})])}var it=W(Ze,[["render",at]]);const dt=H({name:"StateExplorerPopup",props:["open"],components:{StateExplorer:it},data(){return{state:""}},methods:{onClose(){this.$emit("onClose",{id:this.id||"StateExplorer",value:this.state})},onSave(){this.$emit("onSave",{id:this.id||"StateExplorer",value:this.state})},onChange({value:e}){this.state=e}}}),rt={class:"text-h6"};function ct(e,s,i,r,u,b){const f=k("state-explorer");return m(),D(me,{"model-value":e.open,persistent:""},{default:n(()=>[t(ve,{class:"column full-height",style:{width:"1000px","max-width":"80vw"}},{default:n(()=>[t(X,{class:"row items-center"},{default:n(()=>[o("div",rt,v(e.$t("State Explorer")),1),t(Z),t(y,{flat:"",round:"",color:"grey",icon:"close",onClick:e.onClose},null,8,["onClick"])]),_:1}),t(j),t(X,{class:"col q-pa-sm scroll body"},{default:n(()=>[t(f,Se({onOnChange:e.onChange},e.$attrs),null,16,["onOnChange"])]),_:1}),t(j),t(pe,{align:"right"},{default:n(()=>[t(y,{flat:"",label:e.$t("Cancel"),color:"negative",onClick:e.onClose},null,8,["label","onClick"]),t(y,{flat:"",label:e.$t("Apply"),color:"primary",onClick:e.onSave,disable:e.state===""},null,8,["label","onClick","disable"])]),_:1})]),_:1})]),_:1},8,["model-value"])}var ut=W(dt,[["render",ct]]);const pt=H({name:"DeviceState",emits:["onChange","setComponentProps"],props:["expanded","device","stateKey","stateList"],components:{StateExplorerPopup:ut},setup(e,{emit:s}){const i=ne(),r=V(!1),u=V(!1),b=V(e.expanded||!1);let f="";const l=()=>{s("onChange",{stateKey:e.stateKey,id:"state.newStateKey",value:f}),u.value=!u.value},a=()=>i.copyState({stateKey:e.stateKey}),h=()=>{f=e.stateKey,u.value=!u.value},p=()=>{b.value=!1,r.value=!0,i.removeState({stateKey:e.stateKey})},g=()=>{r.value=!1,i.restoreState({stateKey:e.stateKey})},I=V(null),Q=V(null),x=(d,P)=>{I.value=d,Q.value=P},C=()=>{I.value=null},T=({value:d})=>{M({id:I.value,stateKey:e.stateKey,value:d}),I.value=null},M=d=>{if(d._error)s("onChange",A(K({},d),{error:d._error,stateKey:e.stateKey,id:"state."+d.id}));else if(d.id==="stateKeyModified")f=d.value;else{let P=d.value;try{P=P&&d.json!==void 0&&d.value.indexOf("{")>-1&&d.value.indexOf("}")>-1?JSON.parse(d.value):d.value}catch(le){console.warn(d.value,le)}s("onChange",A(K({},d),{value:P,stateKey:e.stateKey,id:"state."+d.id}))}},U=E(()=>e.device.function==="other"?"_defaults":e.device.function),c=E(()=>{const d=i.device.states[e.stateKey],P=d.bodyElement||d.bodyElement!==null&&L.value.bodyElement||null,le=d.actionElement||d.actionElement!==null&&L.value.actionElement||null;return{state:d.state&&d.state.node!==void 0?d.state.node:d.state||null,action:d.action&&d.action.node!==void 0?d.action.node:d.action||null,properties:d.properties||"",bodyStyle:d.bodyStyle||"",stateStyle:d.stateStyle||"",display:d.display||"",label:d.label||"",unit:d.unit||"",icon:d.icon||"",iconStyle:d.iconStyle||"",showState:d.showState!==void 0?d.showState:!1,bodyElement:P,bodyElementComponentValues:d[P+"Config"]||{},actionElement:le,actionElementComponentValues:d[le+"Config"]||{},hide:d.hide!==void 0?d.hide:!1}}),L=E(()=>{const d=G.Configurations[U]&&G.Configurations[U][e.stateKey.toLowerCase()]||{};return{display:JSON.stringify(d.display),stateStyle:JSON.stringify(d.stateStyle),properties:JSON.stringify(d.properties),label:d.label||"",unit:JSON.stringify(d.unit),icon:JSON.stringify(d.icon),iconStyle:JSON.stringify(d.iconStyle),bodyElement:d.bodyElement||"",actionElement:d.actionElement||""}});return{FunctionsComponentsList:G.ComponentsListAsOptions,icon:we,isDeletedState:r,isEditingStateKey:u,isExpanded:b,onStateSave:l,onStateCopy:a,onStateEdit:h,onStateRemove:p,onStateRestore:g,onStateExplorerOpen:x,stateExplorer:I,stateExplorerSelected:Q,onStateExplorerSave:T,onStateExplorerClose:C,onChange:M,placeholders:L,deviceFunction:U,deviceStates:c}}}),vt={style:{margin:"auto 84px -1px auto"}},mt={class:"row items-center"},ht={class:"row",style:{padding:"0 8px"}},ft={class:"col"},gt={class:"col"},yt={class:"row",style:{padding:"0 8px"}},bt={class:"col"},Ct={class:"col"},Dt={class:"row",style:{padding:"0 8px"}},St={class:"col"},wt={class:"row",style:{padding:"0 8px"}},$t={class:"col"},Ot={class:"row",style:{padding:"0 8px"}},kt={class:"col"},Et={class:"row",style:{padding:"0 8px"}},Lt={class:"col"},It={class:"row",style:{padding:"0 8px"}},jt={class:"col"},_t={class:"col"},Kt={class:"row",style:{padding:"0 8px"}},Vt={class:"col"},Qt={class:"col-2"},Tt={class:"col"},At={class:"row",style:{padding:"0 8px"}},zt={class:"col-2"};function Mt(e,s,i,r,u,b){const f=k("state-explorer-popup"),l=k("inputs"),a=k("paper"),h=k("icon");return m(),w(F,null,[t(f,{open:e.stateExplorer!==null,selected:e.stateExplorerSelected,onOnClose:e.onStateExplorerClose,onOnSave:e.onStateExplorerSave},null,8,["open","selected","onOnClose","onOnSave"]),_(t(a,{class:"row",style:{margin:"-2px 0 0 0",padding:"0 0 10px 44px"}},{default:n(()=>[t(l,{onOnChange:e.onChange,id:"stateKeyModified",onClick:s[0]||(s[0]=z(()=>{},["stop"])),label:"",value:e.stateKey,"hide-bottom-space":"",dense:""},null,8,["onOnChange","value"]),o("div",vt,[t(y,{size:"sm",flat:"",round:"",onClick:e.onStateSave,icon:"mdi-check"},null,8,["onClick"]),t(y,{size:"sm",flat:"",round:"",onClick:e.onStateEdit,icon:"mdi-cancel"},null,8,["onClick"])])]),_:1},512),[[J,e.isEditingStateKey===!0]]),_(t(se,{modelValue:e.isExpanded,"onUpdate:modelValue":s[5]||(s[5]=p=>e.isExpanded=p),icon:"mdi-drag-horizontal",label:e.stateKey,class:N(["paper full-width",{rowDeleted:e.isDeletedState}]),disable:e.isDeletedState},{header:n(()=>[t($,{avatar:"",class:"dragndrop"},{default:n(()=>[t(h,{name:"mdi-drag-horizontal",class:"dragndrop"})]),_:1}),t($,{class:N({itemDeleted:e.isDeletedState})},{default:n(()=>[S(v(e.stateKey),1)]),_:1},8,["class"]),t($,{side:""},{default:n(()=>[o("div",mt,[_(o("div",null,[_(t(y,{size:"sm",flat:"",round:"",onClick:z(e.onStateEdit,["stop"]),icon:"mdi-pencil"},null,8,["onClick"]),[[J,e.isEditingStateKey===!1]]),t(y,{size:"sm",flat:"",round:"",onClick:z(e.onStateCopy,["stop"]),icon:"mdi-content-copy"},null,8,["onClick"]),t(y,{size:"sm",flat:"",round:"",onClick:z(e.onStateRemove,["stop"]),icon:"mdi-delete",color:"negative"},null,8,["onClick"])],512),[[J,e.isDeletedState!==!0]]),_(o("div",null,[t(y,{size:"sm",flat:"",round:"",onClick:z(e.onStateRestore,["stop"]),icon:"mdi-restore",color:"positive"},null,8,["onClick"])],512),[[J,e.isDeletedState===!0]])])]),_:1})]),default:n(()=>[o("div",ht,[o("div",ft,[t(l,{onOnChange:e.onChange,id:"state",label:"config#Devices#state#label",info:"config#Devices#state#info",value:e.deviceStates.state,options:e.stateList,clearable:""},{end:n(()=>[t(y,{round:"",dense:"",flat:"",icon:"mdi-database-search",color:"secondary",onClick:s[1]||(s[1]=z(p=>e.onStateExplorerOpen("state",e.deviceStates.state),["stop"])),style:{height:"33px",margin:"auto"}})]),_:1},8,["onOnChange","value","options"])]),o("div",gt,[t(l,{onOnChange:e.onChange,id:"action",label:"config#Devices#action#label",info:"config#Devices#action#info",placeholder:e.deviceStates.state,value:e.deviceStates.action,options:e.stateList,clearable:""},{end:n(()=>[t(y,{round:"",dense:"",flat:"",icon:"mdi-database-search",color:"secondary",onClick:s[2]||(s[2]=z(p=>e.onStateExplorerOpen("action",e.deviceStates.action||e.deviceStates.state),["stop"])),style:{height:"33px",margin:"auto"}})]),_:1},8,["onOnChange","placeholder","value","options"])])]),o("div",yt,[o("div",bt,[t(l,{onOnChange:e.onChange,id:"label",label:"config#Devices#label#label",value:e.deviceStates.label,json:"",placeholder:e.placeholders.label},null,8,["onOnChange","value","placeholder"])]),o("div",Ct,[t(l,{onOnChange:e.onChange,id:"unit",label:"config#Devices#unit#label",info:"config#Devices#unit#info",value:e.deviceStates.unit,json:"allowTextInput",placeholder:e.placeholders.unit},null,8,["onOnChange","value","placeholder"])])]),o("div",Dt,[o("div",St,[t(l,{onOnChange:e.onChange,id:"bodyStyle",label:"config#Devices#bodyStyle#label",info:"config#Devices#bodyStyle#info",value:e.deviceStates.bodyStyle,json:"",placeholder:e.placeholders.bodyStyle},null,8,["onOnChange","value","placeholder"])])]),o("div",wt,[o("div",$t,[t(l,{onOnChange:e.onChange,id:"stateStyle",label:"config#Devices#stateStyle#label",info:"config#Devices#stateStyle#label",value:e.deviceStates.stateStyle,json:"",placeholder:e.placeholders.stateStyle},null,8,["onOnChange","value","placeholder"])])]),o("div",Ot,[o("div",kt,[t(l,{onOnChange:e.onChange,id:"display",label:"config#Devices#display#label",info:"config#Devices#display#info",value:e.deviceStates.display,json:"",placeholder:e.placeholders.display},null,8,["onOnChange","value","placeholder"])])]),o("div",Et,[o("div",Lt,[t(l,{onOnChange:e.onChange,id:"properties",label:"config#Devices#properties#label",info:"config#Devices#properties#info",value:e.deviceStates.properties,json:"",placeholder:e.placeholders.properties},null,8,["onOnChange","value","placeholder"])])]),o("div",It,[o("div",jt,[t(l,{onOnChange:e.onChange,id:"icon",label:"config#Devices#icon#label",info:"config#Devices#icon#info",link:"https://icon-sets.iconify.design/",value:e.deviceStates.icon,json:"allowTextInput",placeholder:e.placeholders.icon,icon:e.icon(e.deviceStates.icon)},null,8,["onOnChange","value","placeholder","icon"])]),o("div",_t,[t(l,{onOnChange:e.onChange,id:"iconStyle",label:"config#Devices#iconStyle#label",info:"config#Devices#iconStyle#info",value:e.deviceStates.iconStyle,json:"",placeholder:e.placeholders.iconStyle},null,8,["onOnChange","value","placeholder"])])]),o("div",Kt,[o("div",Vt,[t(l,{onOnSelect:s[3]||(s[3]=p=>e.onChange(A(K({},p),{value:p.value||null}))),onOnOptions:e.onChange,id:"bodyElement",label:"config#Devices#bodyElement#label",value:e.deviceStates.bodyElement,type:"select.components",components:e.FunctionsComponentsList.bodyElements[e.deviceFunction],componentValues:e.deviceStates.bodyElementComponentValues,device:e.device},null,8,["onOnOptions","value","components","componentValues","device"])]),o("div",Qt,[t(l,{type:"Switch",onOnChange:e.onChange,id:"showState",label:"config#Devices#showState#label",value:e.deviceStates.showState},null,8,["onOnChange","value"])]),o("div",Tt,[t(l,{onOnSelect:s[4]||(s[4]=p=>e.onChange(A(K({},p),{value:p.value||null}))),onOnOptions:e.onChange,id:"actionElement",label:"config#Devices#actionElement#label",value:e.deviceStates.actionElement,type:"select.components",components:e.FunctionsComponentsList.actionElements[e.deviceFunction],componentValues:e.deviceStates.actionElementComponentValues,device:e.device},null,8,["onOnOptions","value","components","componentValues","device"])])]),o("div",At,[o("div",zt,[t(l,{type:"Switch",onOnChange:e.onChange,id:"hide",label:"config#Devices#hide#label",info:"config#Devices#hide#info",value:e.deviceStates.hide},null,8,["onOnChange","value"])])]),t(j,{style:{"margin-top":"16px"}})]),_:1},8,["modelValue","label","class","disable"]),[[J,e.isEditingStateKey===!1]])],64)}var Ut=W(pt,[["render",Mt]]);const Pt=H({name:"DevicePage",components:{DeviceState:Ut,Draggable:Be},setup(){const e=de(),s=ne(),i=(q.get("stateList")||[]).map(c=>({label:c,value:c})),r=Object.keys(G.Icons).map(c=>({label:e.t(c),icon:G.Icons[c]?"mdi-"+G.Icons[c].replace("mdi-",""):"",value:c})).sort((c,L)=>c.label.toLowerCase()===L.label.toLowerCase()?0:c.label.toLowerCase()>L.label.toLowerCase()?1:-1),u=V(""),b=V(null),f=E(()=>Object.keys(s.device.states||{})),l=E(()=>s.device.function==="_defaults"?[]:Object.keys(G.Configurations[s.device.function]||{})),a=E(()=>{const c=Object.keys(s.device.states||{});return l.value.every(L=>L==="_any"||c.indexOf(L)>-1)}),h=()=>{l.value.forEach(c=>c!=="_any"&&p(c))},p=c=>{c=typeof c=="string"?c:u.value,c?f.value.indexOf(c)>-1?b.value=e.t("State key already used"):(s.newState(c),u.value="",b.value=null):b.value=e.t("Type in a state key / identifier")},g=E({get(){return Object.values(s.device.states||{})},set(c){const L={};c.forEach(d=>{L[d.stateKey]=d}),s.set("device.states",L)}}),{errors:I,hasErrors:Q,addError:x,removeError:C}=Je(),T=()=>s.saveDevice(),M=()=>s.discardDevice(),U=c=>{if(c.error)x(c.id,c.error);else if(c.id.indexOf("device.")>-1)C(c.id),s.set({[c.id]:c.value});else if(c.id.indexOf("options.")>-1)C(c.id),s.set({"device.options":A(K({},s.device.options||{}),{[c.id.replace("options.","")]:c.value})});else if(c.id.indexOf("state.")>-1)if(C(c.id),c.id==="state.newStateKey")s.changeStateKey({stateKey:c.stateKey,stateKeyModified:c.value});else if(c.id==="state.componentOptions"){C(c.id);const L=s.device.states[c.stateKey][c.component+"Config"]||{};s.editState({deviceId:s.device.id,stateKey:c.stateKey,key:c.component+"Config",val:K(K({},L),c.value)})}else s.editState({deviceId:s.device.id,stateKey:c.stateKey,key:c.id.replace("state.",""),val:c.value});else c.id==="newStateKey"&&(u.value=c.value)};return A(K({icon:we},Re()),{errors:I,hasErrors:Q,stateList:i,functions:r,addStateKey:p,addDefaultStates:h,compareStatesToDefaults:a,device:E(()=>s.device),deviceStates:g,component:V(null),newStateKey:u,errorNewStateKey:b,onApply:T,onCancel:M,onChange:U})}}),Nt={class:"text-h6 row items-center"},Ft={class:"text-h6 text-header primary"},qt={class:"row"},Bt={class:"col-3"},Jt={class:"col-3"},Rt={class:"col-3"},Gt={class:"text-h6 text-header primary"},Ht={class:"row"},Wt={class:"col-3"},Yt={class:"text-h6 text-header primary"},Zt={class:"row",style:{"margin-bottom":"16px"}},Xt={class:"col"},xt={class:"col self-center"},es={class:"col self-center",style:{"text-align":"right"}},ts={class:"list-group-item"};function ss(e,s,i,r,u,b){const f=k("inputs"),l=k("device-state"),a=k("draggable");return m(),D(me,{"model-value":e.device!==null,"full-height":"",persistent:""},{default:n(()=>[e.device!==null?(m(),D(ve,{key:0,class:"column full-height",style:{width:"1000px","max-width":"80vw"}},{default:n(()=>[t(X,{class:"row items-center"},{default:n(()=>[o("div",Nt,[S(v(e.$t("Device"))+": ",1),t(f,{dense:"",onOnChange:e.onChange,id:"device.name",label:e.$t("Name"),value:e.device.name||"",required:"",autofocus:"",style:{width:"230px","margin-right":"16px"}},null,8,["onOnChange","label","value"]),S(" ("+v(e.$t("Device ID")+": "+e.device.id)+") ",1)]),t(Z),t(y,{flat:"",round:"",color:"grey",icon:"close",onClick:e.onCancel},null,8,["onClick"])]),_:1}),t(j),t(X,{class:"col defaultPadding-2 q-pt-none scroll body"},{default:n(()=>[o("div",Ft,v(e.$t("General")),1),t(j,{style:{margin:"0 -16px"}}),o("div",qt,[o("div",Bt,[t(f,{onOnChange:e.onChange,id:"device.label",label:e.$t("Label"),value:e.device.label||"",placeholder:e.device.name},null,8,["onOnChange","label","value","placeholder"])]),o("div",Jt,[t(f,{onOnSelect:e.onChange,id:"device.function",label:e.$t("Function"),value:e.device.function==="other"?"_defaults":e.device.function,type:"select",options:e.functions,"options-dense":"","use-input":""},null,8,["onOnSelect","label","value","options"])]),o("div",Rt,[t(f,{onOnChange:e.onChange,id:"device.icon",label:e.$t("Icon"),value:e.device.icon||"",icon:e.icon(e.device.icon)},null,8,["onOnChange","label","value","icon"])])]),o("div",Gt,v(e.$t("Options")),1),t(j,{style:{margin:"0 -16px"}}),o("div",Ht,[o("div",Wt,[t(f,{onOnChange:e.onChange,type:"switch",id:"options.suppressPopup",label:"Suppress Popup","indeterminate-value":"false",value:e.device.options.suppressPopup||!1},null,8,["onOnChange","value"])])]),o("div",Yt,v(e.$t("States")),1),t(j,{style:{margin:"0 -16px"}}),o("div",Zt,[o("div",Xt,[t(f,{onOnChange:e.onChange,id:"newStateKey",value:e.newStateKey,label:"new state key",icon:"mdi-plus",onKeydown:je(e.addStateKey,["enter"]),errorMessage:e.errorNewStateKey},null,8,["onOnChange","value","onKeydown","errorMessage"])]),o("div",xt,[t(y,{color:"primary",label:e.$t("add state"),icon:"mdi-plus-circle",onClick:e.addStateKey},null,8,["label","onClick"])]),o("div",es,[e.device.function!=="_defaults"?(m(),D(y,{key:0,color:"secondary",label:e.$t("add default states"),icon:e.compareStatesToDefaults?"check":"mdi-playlist-plus",onClick:e.addDefaultStates,disable:e.compareStatesToDefaults},null,8,["label","icon","onClick","disable"])):O("",!0)])]),t(a,Se({class:"list-group",tag:"ul","component-data":{tag:"ul",type:"transition",name:e.drag?null:"flip-list"},modelValue:e.deviceStates,"onUpdate:modelValue":s[1]||(s[1]=h=>e.deviceStates=h)},e.dragOptions,{onStart:s[2]||(s[2]=h=>e.drag=!0),onEnd:s[3]||(s[3]=h=>e.drag=!1),"item-key":"stateKey",handle:".dragndrop"}),{item:n(({element:h})=>[o("li",ts,[t(l,{onOnChange:e.onChange,onSetComponentProps:s[0]||(s[0]=p=>e.component=arguments[0]),expanded:!1,device:e.device,stateKey:h.stateKey,stateList:e.stateList},null,8,["onOnChange","device","stateKey","stateList"])])]),_:1},16,["component-data","modelValue"])]),_:1}),t(j),t(pe,{align:"right"},{default:n(()=>[t(y,{flat:"",label:e.$t("Cancel"),color:"negative",onClick:e.onCancel},null,8,["label","onClick"]),t(y,{flat:"",label:e.$t("Apply"),color:"primary",onClick:e.onApply,disable:e.hasErrors},null,8,["label","onClick","disable"])]),_:1})]),_:1})):O("",!0)]),_:1},8,["model-value"])}var ns=W(Pt,[["render",ss]]);const ls=H({name:"ImportDevices",props:["open"],emits:["onClose"],setup(){const e=de(),s=ne();return{i18n:e,editor:s}},data(){return this.ucFirst=_e,{selectedAdapters:[],adapterStructure:"all",adapterStructureOptions:[{label:this.i18n.t("Search adapter structure for all devices"),value:"all"},{label:this.i18n.t("Search only for devices added to enums"),value:"enums"}],categories:{new:"New Devices",existing:"Devices that have been added already",incorrect:"Devices with incorrect configuration (states not found)",ignored:"Devices marked as ignored"},expanded:{_adapterList:!0,new:!0},importedDevices:{all:{},new:{},existing:{},incorrect:{},ignored:{},manufacturer:{}},selectedDevices:{new:[],existing:[],ignored:[]},showImportDevices:!1,state:null}},methods:{importDevices(){this.state=null,this.onClose();const e={},s=[...this.selectedDevices.new,...this.selectedDevices.existing];for(const r of s)e[r]=this.importedDevices.all[r];const i=Object.keys(this.importedDevices.ignored);for(const r of i)e[r]=this.importedDevices.ignored[r],e[r].attributes=e[r].attributes||{},e[r].attributes.ignore=!0;this.editor.addDevices({devices:e})},onClose(){this.expanded._adapterList=!0,this.showImportDevices=!1,this.$emit("onClose",this.showImportDevices)},readAdapters(){this.state="loading",this.adapterStructure==="all"?ce.importDevices(this.selectedAdapters).then(this.setImportedDevices).catch(e=>{be._("ImportDevicesPage","IMPORT_DEVICES: "+e.message,"error")}):ce.importEnums("functions",this.selectedAdapters).then(this.setImportedDevices).catch(e=>{be._("ImportDevicesPage","IMPORT_ENUMS: "+e.message,"error")})},setImportedDevices(e){this.expanded._adapterList=!1,this.importedDevices={all:{},new:{},existing:{},incorrect:{},ignored:{},manufacturer:{}};const s=this.editor.devices||{};e.forEach((i,r)=>{const u=i.value||i.reason;u.attributes=u.attributes||{};let b="new";i.status==="fulfilled"&&i.value&&i.value.states&&Object.keys(i.value.states).length>0?s[u.id]!==void 0&&(b="existing",s[u.id].attributes&&s[u.id].attributes.ignore===!0&&(b="ignored")):(b="incorrect",u.states=null,u.attributes.note=u.attributes.note||i.reason&&i.reason.error&&i.reason.error.message||this.i18n.t("No correct defined states found. The device may be unknown. Please help the developer to add support for this device and report to Github.")),this.importedDevices[b][u.id]=u,this.importedDevices.all[u.id]=u,u.attributes.manufacturer&&u.attributes.manufacturer.namespace&&(this.importedDevices.manufacturer[u.attributes.manufacturer.namespace]=this.importedDevices.manufacturer[u.attributes.manufacturer.namespace]||[],this.importedDevices.manufacturer[u.attributes.manufacturer.namespace].push(u.id))}),this.selectedDevices.new=Object.keys(this.importedDevices.new),this.state="loaded"},toggleAllAdapterListItems(){this.selectedAdapters.length>0?this.selectedAdapters=[]:this.selectedAdapters=Object.keys(Ce)},toggleAllDevicesListItems(e){this.selectedDevices[e].length>0?this.selectedDevices[e]=[]:this.selectedDevices[e]=Object.keys(this.importedDevices[e])},ignoreDevice(e){this.importedDevices.ignored[e.id]=e,delete this.importedDevices.new[e.id],delete this.selectedDevices.new[this.selectedDevices.new.indexOf(e.id)]},restoreDevice(e){this.importedDevices.new[e.id]=e,this.selectedDevices.new.push(e.id),delete this.importedDevices.ignored[e.id]}},computed:{importDevicesLength(){return this.selectedDevices.new.length+this.selectedDevices.existing.length},importedDevicesLength(){return{all:Object.keys(this.importedDevices.all).length,new:Object.keys(this.importedDevices.new).length,existing:Object.keys(this.importedDevices.existing).length,incorrect:Object.keys(this.importedDevices.incorrect).length,ignored:Object.keys(this.importedDevices.ignored).length}},adapterList(){return Object.values(Ce).map(e=>A(K({},e),{devices:this.importedDevices.manufacturer[e.namespace]?this.importedDevices.manufacturer[e.namespace].length:0,name:e.default}))}},watch:{open(e){this.showImportDevices=e}},created(){this.toggleAllAdapterListItems()}}),os={class:"text-h6"},as={class:"text-h6 text-header primary"},is={key:0,style:{"margin-bottom":"16px"}},ds={class:"text-h6 text-header primary"},rs={class:"q-pa-sm"},cs={key:0},us={key:1,style:{width:"40px"}},ps={style:{"padding-left":"72px"}},vs={class:"stateList"};function ms(e,s,i,r,u,b){const f=k("icon");return m(),D(me,{modelValue:e.showImportDevices,"onUpdate:modelValue":s[3]||(s[3]=l=>e.showImportDevices=l),persistent:""},{default:n(()=>[t(ve,{class:"column full-height",style:{width:"1000px","max-width":"80vw"}},{default:n(()=>[t(X,{class:"row items-center"},{default:n(()=>[o("div",os,v(e.$t("Import Devices")),1),t(Z),t(y,{flat:"",round:"",color:"grey",icon:"close",onClick:e.onClose},null,8,["onClick"])]),_:1}),t(j),t(X,{class:"col q-pa-sm scroll body"},{default:n(()=>[o("div",as,v(e.$t("Adapter")),1),t(j,{style:{margin:"0 -16px"}}),t(Ke,{label:e.$t("Search the adapter structure for all devices or only devices added to enums"),"stack-label":"",borderless:"",class:"q-pa-sm"},{control:n(()=>[t(Ve,{modelValue:e.adapterStructure,"onUpdate:modelValue":s[0]||(s[0]=l=>e.adapterStructure=l),options:e.adapterStructureOptions,color:"primary",inline:""},null,8,["modelValue","options"])]),_:1},8,["label"]),t(se,{modelValue:e.expanded._adapterList,"onUpdate:modelValue":s[2]||(s[2]=l=>e.expanded._adapterList=l),class:"paper shadow-1 rounded-borders full-width"},{header:n(()=>[t($,null,{default:n(()=>[S(v(e.$t("Adapter List")),1)]),_:1}),e.state==="loaded"?(m(),D($,{key:0,side:""},{default:n(()=>[t(oe,{color:"secondary","text-color":"white"},{default:n(()=>[S(v(e.$t("Devices"))+": "+v(e.importedDevicesLength.all),1)]),_:1})]),_:1})):O("",!0)]),default:n(()=>[t(ue,{dense:"",style:{"margin-bottom":"16px"}},{default:n(()=>[_((m(),D(ee,{tag:"label",onClick:z(e.toggleAllAdapterListItems,["prevent"])},{default:n(()=>[t($,{side:""},{default:n(()=>[t(ie,{size:"xs","onUpdate:modelValue":e.toggleAllAdapterListItems,"false-value":0,"true-value":e.adapterList.length,"model-value":e.selectedAdapters.length},null,8,["onUpdate:modelValue","true-value","model-value"])]),_:1}),t($,null,{default:n(()=>[t(B,null,{default:n(()=>[o("em",null,v(e.$t("(Un)Select all adapters"))+" ("+v(e.selectedAdapters.length)+")",1)]),_:1})]),_:1})]),_:1},8,["onClick"])),[[ae]]),(m(!0),w(F,null,R(e.adapterList,l=>_((m(),D(ee,{tag:"label",key:l.namespace},{default:n(()=>[t($,{side:""},{default:n(()=>[t(ie,{size:"xs",modelValue:e.selectedAdapters,"onUpdate:modelValue":s[1]||(s[1]=a=>e.selectedAdapters=a),val:l.namespace},null,8,["modelValue","val"])]),_:2},1024),t($,null,{default:n(()=>[t(B,null,{default:n(()=>[S(v(l.name)+" ",1),t(f,{name:"information",color:"primary",class:"q-ma-xs",style:{"font-size":"1.2rem"}}),t(he,{"content-class":"bg-grey-8",offset:[4,4]},{default:n(()=>[S(v(e.$t("import#warning").replace("{deviceObjectType}",l.deviceObjectType||"device").replace("{devicePattern}",l.devicePattern)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),t($,{side:""},{default:n(()=>[t(B,null,{default:n(()=>[e.state==="loaded"&&e.selectedAdapters.indexOf(l.namespace)>-1?(m(),D(oe,{key:0,color:"primary","text-color":"white"},{default:n(()=>[S(v(e.$t("Devices"))+": "+v(l.devices),1)]),_:2},1024)):O("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)),[[ae]])),128))]),_:1})]),_:1},8,["modelValue"]),e.state!==null?(m(),w("div",is,[o("div",ds,v(e.$t("Devices")),1),t(j,{style:{margin:"0 -16px 16px -16px"}}),o("div",rs,[e.state==="loading"?(m(),D(Qe,{key:0,color:"primary",size:"md"})):O("",!0)]),e.state==="loaded"?(m(),w("div",cs,[(m(!0),w(F,null,R(e.categories,(l,a)=>(m(),D(se,{modelValue:e.expanded[a],"onUpdate:modelValue":h=>e.expanded[a]=h,class:"paper shadow-1 rounded-borders full-width",key:a,disable:e.importedDevicesLength[a]===0,style:{"margin-bottom":"8px"}},{header:n(()=>[t($,null,{default:n(()=>[S(v(e.$t(l)),1)]),_:2},1024),t($,{side:""},{default:n(()=>[t(oe,{color:"secondary","text-color":"white"},{default:n(()=>[S(v(e.importedDevicesLength[a]),1)]),_:2},1024)]),_:2},1024)]),default:n(()=>[e.importedDevicesLength[a]>0?(m(),D(ue,{key:0,dense:""},{default:n(()=>[a==="new"||a==="existing"?_((m(),D(ee,{key:0,tag:"label"},{default:n(()=>[t($,{side:""},{default:n(()=>[t(ie,{"model-value":e.selectedDevices[a].length!==0,onClick:z(h=>e.toggleAllDevicesListItems(a),["stop"])},null,8,["model-value","onClick"])]),_:2},1024),t($,null,{default:n(()=>[t(B,null,{default:n(()=>[o("em",null,v(e.$t("(Un)Select all devices"))+" ("+v(e.selectedDevices[a].length)+")",1)]),_:2},1024)]),_:2},1024)]),_:2},1024)),[[ae]]):O("",!0),(m(!0),w(F,null,R(e.importedDevices[a],h=>(m(),D(se,{"expand-icon-toggle":"","expand-separator":"",dense:"",class:"full-width",key:h.id},{header:n(()=>[_((m(),D(ee,{tag:"label",disable:a!=="new"&&a!=="existing",class:"full-width"},{default:n(()=>[t($,{side:""},{default:n(()=>[a==="new"||a==="existing"?(m(),D(ie,{key:0,modelValue:e.selectedDevices[a],"onUpdate:modelValue":p=>e.selectedDevices[a]=p,val:h.id},null,8,["modelValue","onUpdate:modelValue","val"])):(m(),w("div",us))]),_:2},1024),t($,null,{default:n(()=>[t(B,null,{default:n(()=>[S(v(h.name)+" ",1),h.attributes&&h.attributes.manufacturer?(m(),D(oe,{key:0,color:"accent","text-color":"white"},{default:n(()=>[S(v(h.attributes.manufacturer.name),1)]),_:2},1024)):O("",!0)]),_:2},1024)]),_:2},1024),t($,{side:""},{default:n(()=>[t(B,null,{default:n(()=>[a==="new"?(m(),D(y,{key:0,flat:"",label:e.$t("ignore"),color:"negative",onClick:p=>e.ignoreDevice(h)},null,8,["label","onClick"])):O("",!0),a==="ignored"?(m(),D(y,{key:1,flat:"",label:e.$t("restore"),color:"positive",onClick:p=>e.restoreDevice(h)},null,8,["label","onClick"])):O("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["disable"])),[[ae]])]),default:n(()=>[o("div",ps,[S(v(e.$t("Function"))+": "+v(e.$t(h.function))+" ",1),o("ul",vs,[(m(!0),w(F,null,R(h.states,(p,g)=>(m(),w("li",{key:g},[o("strong",null,v(g),1),(m(!0),w(F,null,R(p,(I,Q)=>(m(),w("ul",{class:"stateKeyList",key:Q},[o("li",null,[S(v(e.$t(e.ucFirst(Q)))+": ",1),o("code",null,v(I),1)])]))),128))]))),128))])])]),_:2},1024))),128))]),_:2},1024)):O("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue","disable"]))),128))])):O("",!0)])):O("",!0)]),_:1}),t(j),t(pe,{align:"right"},{default:n(()=>[t(y,{flat:"",label:e.$t("Cancel"),color:"negative",onClick:e.onClose},null,8,["label","onClick"]),t(y,{flat:"",label:e.$t("Read Adapters"),color:"secondary",onClick:e.readAdapters,loading:e.state==="loading",disable:e.selectedAdapters.length===0},null,8,["label","onClick","loading","disable"]),e.state==="loaded"?(m(),D(y,{key:0,flat:"",label:e.$t("Import selected devices")+" ("+e.importDevicesLength+")",color:"primary",onClick:e.importDevices,disable:e.importDevicesLength===0},null,8,["label","onClick","disable"])):O("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])}var hs=W(ls,[["render",ms]]);function fs(e,s){const i=Te();return{copyToClipboard:u=>{Ye(u).then(()=>i.notify(i18n.t(s||"ID copied"))).catch(()=>{})}}}const gs=H({name:"DevicesTable",props:["devices"],setup(){const e=de(),s=ne(),i={sortBy:"name",rowsPerPage:15},r=[{name:"name",label:e.t("Name")+" ("+e.t("ID")+")",field:"name",align:"left",sortable:!0,style:{width:"20%"}},{name:"function",label:e.t("Function"),field:"function",align:"left",sortable:!0,format:p=>e.t(p),style:{width:"10%"}},{name:"manufacturer",label:e.t("Manufacturer"),field:"manufacturer",align:"left",sortable:!0,format:(p,g)=>g.attributes&&g.attributes.manufacturer?g.attributes.manufacturer.name:"",style:{width:"10%"}},{name:"states",label:e.t("States"),field:"states",align:"left",sortable:!0,format:p=>(p=Object.keys(p||"{}").join(", "),p.length>130?p.substr(0,128)+" ...":p),style:{width:"60%"}}];return{pagination:i,columns:r,copyClipboard:p=>fs(),isDeleted:p=>p.attributes&&p.attributes.deleted===!0,onDeviceEdit:p=>s.editDevice(p),onDeviceCopy:p=>s.copyDevice(p),onDeviceRemove:p=>s.removeDevice(p),onDeviceRestore:p=>s.restoreDevice(p)}}}),ys={class:"q-pa-md"},bs={key:0},Cs=["onClick"],Ds={key:0};function Ss(e,s,i,r,u,b){const f=k("icon");return m(),w("div",ys,[t(Ge,{rows:e.devices,columns:e.columns,pagination:e.pagination,"rows-per-page-label":e.$t("Devices per page")},{header:n(l=>[t(De,{props:l},{default:n(()=>[t(re,{"auto-width":""}),(m(!0),w(F,null,R(l.cols,a=>(m(),D(re,{key:a.name,props:l},{default:n(()=>[S(v(a.label),1)]),_:2},1032,["props"]))),128)),t(re,{"auto-width":""})]),_:2},1032,["props"])]),body:n(l=>[t(De,{props:l,class:N({rowDeleted:e.isDeleted(l.row)})},{default:n(()=>[t(Y,{"auto-width":""},{default:n(()=>[e.isDeleted(l.row)!==!0?(m(),w("div",bs,[t(y,{size:"sm",flat:"",round:"",onClick:a=>e.onDeviceEdit(l.row),icon:"mdi-pencil"},null,8,["onClick"]),t(y,{size:"sm",flat:"",round:"",onClick:a=>e.onDeviceCopy(l.row),icon:"mdi-content-copy"},null,8,["onClick"])])):O("",!0)]),_:2},1024),t(Y,{style:te(l.cols[0].style||{})},{default:n(()=>[o("div",{class:N(["cursor-pointer",{itemDeleted:e.isDeleted(l.row)}]),onClick:a=>e.copyClipboard(l.row.id)},[t(he,null,{default:n(()=>[S(" ID: "+v(l.row.id)+" ("+v(e.$t("click to copy to clipboard"))+") ",1)]),_:2},1024),o("span",null,v(l.row.name),1),l.row.label?(m(),w("span",Ds," ("+v(l.row.label)+")",1)):O("",!0),t(f,{name:"clipboard-text-multiple-outline",size:"xs",style:{"margin-left":"4px"}})],10,Cs)]),_:2},1032,["style"]),t(Y,{style:te(l.cols[1].style||{})},{default:n(()=>[o("div",{class:N({itemDeleted:e.isDeleted(l.row)})},v(l.cols[1].value),3)]),_:2},1032,["style"]),t(Y,{style:te(l.cols[2].style||{})},{default:n(()=>[o("div",{class:N({itemDeleted:e.isDeleted(l.row)})},v(l.cols[2].value),3)]),_:2},1032,["style"]),t(Y,{style:te(l.cols[3].style||{})},{default:n(()=>[o("div",{class:N({itemDeleted:e.isDeleted(l.row)})},v(l.cols[3].value),3)]),_:2},1032,["style"]),t(Y,{"auto-width":""},{default:n(()=>[e.isDeleted(l.row)!==!0?(m(),D(y,{key:0,size:"sm",flat:"",round:"",onClick:a=>e.onDeviceRemove(l.row),icon:"mdi-delete",color:"negative"},null,8,["onClick"])):O("",!0),e.isDeleted(l.row)?(m(),D(y,{key:1,size:"sm",flat:"",round:"",onClick:a=>e.onDeviceRestore(l.row),icon:"mdi-restore",color:"positive"},null,8,["onClick"])):O("",!0)]),_:2},1024)]),_:2},1032,["props","class"])]),_:1},8,["rows","columns","pagination","rows-per-page-label"])])}var ws=W(gs,[["render",Ss]]);const $s=H({name:"DevicesPage",components:{DevicePage:ns,DevicesTable:ws,ImportDevices:hs,JsonEditor:He},setup(){const e=de(),s=ne(),i=Ae(),r=E(()=>s.getGroups(l.value.value,f.value)),u=[{label:e.t("Function"),value:"function"},{label:e.t("Manufacturer"),value:"manufacturer"}],b=E(()=>s.getDevicesWthoutDeletionsCount),f=E({get(){var C;return((C=s.settings)==null?void 0:C.configDevicesFilter)||""},set(C){s.set("settings.configDevicesFilter",C)}}),l=E({get(){var C;return((C=s.settings)==null?void 0:C.configDevicesGroupBy)&&u.find(T=>T.value===s.settings.configDevicesGroupBy)||u[0]},set({value:C}){s.set("settings.configDevicesGroupBy",C)}}),a=E(()=>i.pageHeight),h=E(()=>s.devices),p=E(()=>{var C;return(C=s.settings)==null?void 0:C.configExpertMode}),g=()=>s.actionSwapNameWithLabel(),I=()=>s.addDevice(),Q=C=>!C._error&&s.set({[C.id]:JSON.parse(C.value)}),x=({id:C,error:T,value:M})=>{if(T)s.addError({key:"settings-"+C,val:T.message||T});else if(M){s.removeError("settings-"+C);for(const U in M)s.set({["settings."+U]:M[U]})}};return{expanded:V({}),showImportDevices:V(!1),devicesCount:b,devicesFilter:f,devicesGroupBy:l,groups:r,groupByOptions:u,json:h,expertMode:p,pageHeight:a,actionSwapNameWithLabel:g,addDevice:I,onChange:x,onJsonEditor:Q}}}),Os={class:"full-height DevicesPage"},ks={class:"row no-wrap"},Es={class:"row items-center"},Ls={key:0},Is={key:1};function js(e,s,i,r,u,b){const f=k("device-page"),l=k("import-devices"),a=k("devices-table"),h=k("json-editor"),p=k("paper");return m(),w("div",Os,[o("div",ks,[t(Fe,{class:"paper",style:{"min-height":"56px"}},{default:n(()=>[t(Ie,{shrink:""},{default:n(()=>[S(v(e.$t("Devices List"))+" ("+v(e.devicesCount)+")",1)]),_:1}),t(ze,{dense:"",label:e.$t("Group by"),"stack-label":"",style:{width:"150px","margin-right":"8px"},modelValue:e.devicesGroupBy,"onUpdate:modelValue":s[0]||(s[0]=g=>e.devicesGroupBy=g),options:e.groupByOptions},null,8,["label","modelValue","options"]),t(Me,{dense:"",label:e.$t("Filter"),"stack-label":"",clearable:"",modelValue:e.devicesFilter,"onUpdate:modelValue":s[1]||(s[1]=g=>e.devicesFilter=g),style:{width:"250px"}},null,8,["label","modelValue"]),t(Z),t(Ne,{class:"q-mx-xs",icon:"mdi-hammer-screwdriver",color:"secondary",label:e.$t("Quick Actions")},{default:n(()=>[t(ue,null,{default:n(()=>[_((m(),D(ee,{clickable:"",onClick:e.actionSwapNameWithLabel},{default:n(()=>[t($,{avatar:""},{default:n(()=>[t(Pe,{name:"mdi-swap-horizontal"})]),_:1}),t($,null,{default:n(()=>[t(B,null,{default:n(()=>[S(v(e.$t("Swap Device Name and Label")),1)]),_:1})]),_:1})]),_:1},8,["onClick"])),[[Ue]])]),_:1})]),_:1},8,["label"]),t(y,{class:"q-mx-xs",color:"primary",icon:"mdi-cloud-download",label:e.$t("Import Devices"),onClick:s[2]||(s[2]=g=>e.showImportDevices=!0)},null,8,["label"]),t(y,{class:"q-mx-xs",color:"primary",icon:"mdi-plus-circle",label:e.$t("Add Device"),onClick:e.addDevice},null,8,["label","onClick"])]),_:1})]),t(f),t(l,{onOnClose:s[3]||(s[3]=g=>e.showImportDevices=!1),open:e.showImportDevices},null,8,["open"]),(m(!0),w(F,null,R(e.groups,g=>_((m(),w("div",{class:"row no-wrap paper",key:g.id},[t(se,{modelValue:e.expanded[g.id],"onUpdate:modelValue":I=>e.expanded[g.id]=I,icon:g.icon,label:(g.label||"(hi)")+" ("+g.devices.length+")",class:"full-width"},{header:n(()=>[o("div",Es,[g.label?(m(),w("span",Is,v(g.label),1)):(m(),w("em",Ls,"("+v(e.$t("without label"))+")",1)),S(" \xA0("+v(g.devices.length)+") ",1)]),t(Z)]),default:n(()=>[t(a,{devices:g.devices},null,8,["devices"])]),_:2},1032,["modelValue","onUpdate:modelValue","icon","label"])])),[[J,!e.expertMode&&g.devices.length>0]])),128)),_(t(p,{style:te({height:e.pageHeight-66-16+"px"})},{default:n(()=>[t(h,{id:"devices",json:e.json,onOnChange:e.onJsonEditor},null,8,["json","onOnChange"])]),_:1},8,["style"]),[[J,e.expertMode]])])}var Rs=W($s,[["render",js]]);export{Rs as default};
