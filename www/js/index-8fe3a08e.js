import{_ as H,q as J,W as q,de as V,a2 as m,cs as T,d4 as j,df as I,z as G,A as Y,cE as R,j as C,o as y,d as f,J as u,a1 as d,e as t,k as s,w as n,i as L,t as r,a5 as c,cM as F,a4 as A,N as Z,F as S,l as D,L as K,f as X,M as x,Z as z,a6 as v,db as W}from"./index-49754fed.js";import{m as ee}from"./marked.esm-9e29a1ec.js";const se=J({name:"AccountPage",setup(){const e=q(),B=V(),M=m(),_=m(!1),b=m(!1),w=T.get("sessionId")||j();T.set("sessionId",w);const k="Ad8Db5feNlBy6SdFa7O0fpJ2QYIcyFO9SGSg4tNpxOgOlLyWTkN6JmOFBV58ItTpdUwfBGW2L8WuoIAn",h=document.createElement("script");h.setAttribute("src","https://www.paypal.com/sdk/js?client-id="+k+"&components=buttons&currency=EUR&vault=true&intent=subscription"),h.setAttribute("data-namespace","paypal_sdk"),document.body.appendChild(h);const l=m(),N=m([]),O=m(),$=m([]);I.post("user/details",{action:"getLoginBySessionId",sessionId:w}).then(o=>{if(!o)throw new Error("User not signed in!");b.value=!0,l.value=o,T.set("userId",o),console.log("User signed-in: "+o),I.post("user/invoice",{action:"getInvoicesByUserId",userId:o}).then(a=>{$.value=a}).catch(a=>{console.warn(a.message)}),I.post("user/details",{action:"getInstallations",userId:o}).then(a=>{N.value=a.map(i=>{const p=JSON.parse(i.system),U={value:i.ioBrokerId,label:"System: "+p.hostname+" ("+p.platform+"), ID: "+i.ioBrokerId};return i.selected==="1"&&(O.value=U),U})}).catch(a=>{console.warn(a.message)})}).catch(o=>{console.warn(o.message),o.value=o.message,b.value=!1});let g=null;const E=()=>{window.paypal?window.paypal.use(["login"],o=>{const a=B.uuid,i=B.system,p=W._systemId;o.render({appid:"Ad8Db5feNlBy6SdFa7O0fpJ2QYIcyFO9SGSg4tNpxOgOlLyWTkN6JmOFBV58ItTpdUwfBGW2L8WuoIAn",scopes:"openid",containerid:"paypal-button-login",responseType:"code",locale:"de-de",buttonType:"LWP",buttonShape:"pill",buttonSize:"lg",fullPage:"true",state:btoa(w+"|"+a+"|"+p+"|"+JSON.stringify(i)+"|"+window.location.href),returnurl:"https://www.zefau.net/jarvis/user/paypal_login.php"})}):setTimeout(()=>E(),100)},Q=()=>{if(!window.paypal_sdk)setTimeout(()=>Q(),100);else{document.querySelector("#paypal-button-subscribe");const o={style:{shape:"rect",color:"blue",layout:"horizontal",label:"buynow",tagline:!1},createSubscription:(a,i)=>i.subscription.create({plan_id:"P-8EY03930L1769123MMEFPZPI"}),onApprove:(a,i)=>{_.value=!0,I.post("user/invoice",{action:"assignUserToInvoice",userId:l.value,subscriptionId:a.subscriptionID}).then(p=>W.setToken(p,a.subscriptionID,O.value.value)).catch(p=>console.error(p)).finally(()=>{_.value="done",window.location.reload()})}};g=window.paypal_sdk.Buttons(o),g.render("#paypal-button-subscribe")}};G(()=>{E(),Q()}),Y(()=>{g&&g.close&&g.close(),Object.keys(window).forEach(o=>{/paypal|zoid|post_robot/.test(o)&&delete window[o]})});const P={};return["SupportByBuying","Disclaimer"].forEach(o=>{let a="",i=0;for(P[o]=[];(a=e.t(o+"["+i+"]"))!==o+"["+i+"]";)i++,P[o].push(a)}),{format:R,marked:ee,now:Math.ceil(Date.now()/1e3),t:P,installations:N,invoices:$,userId:l,isLogin:b,isPaying:_,error:M}}}),te={class:"row q-px-sm"},oe={class:"col"},ne={class:"row q-pa-md"},ae={class:"col-5"},le={class:"text-h6"},ie=t("div",{class:"text-subtitle2"},null,-1),re={class:"text-center"},ue={class:"row"},de={class:"col-12"},ce={class:"text-center"},pe=t("div",{id:"paypal-button-login"},null,-1),me=[pe],ye={class:"text-h6"},fe=t("div",{class:"text-subtitle2"},null,-1),he={class:"col-2 items-center"},ge={class:"col-5"},ve={class:"text-h6"},_e=t("div",{class:"text-subtitle2"},null,-1),be=["innerHTML"],we=["innerHTML"],Ie=t("div",{id:"paypal-button-subscribe"},null,-1);function Le(e,B,M,_,b,w){const k=C("alert"),h=C("inputs");return y(),f("div",null,[u(t("div",te,[t("div",oe,[s(k,null,{default:n(()=>[L(r(e.error),1)]),_:1})])],512),[[d,e.error]]),t("div",ne,[t("div",ae,[s(A,null,{default:n(()=>[s(c,{class:"bg-primary text-white"},{default:n(()=>[t("div",le,r(e.isLogin===!0?e.$t("User")+" ID":e.$t("Sign In")),1),ie]),_:1}),s(c,null,{default:n(()=>[u(t("div",re,[s(F,{color:"primary",size:"3em"})],512),[[d,e.isLogin===null]]),u(t("div",null,[t("div",ue,[t("div",de,[s(h,{standout:"",value:e.userId,label:"User",disable:""},null,8,["value"])])])],512),[[d,e.isLogin===!0]]),u(t("div",ce,me,512),[[d,e.isLogin===!1]])]),_:1})]),_:1}),u(s(A,{class:"q-mt-md"},{default:n(()=>[s(c,{class:"bg-primary text-white"},{default:n(()=>[t("div",ye,r(e.$t("Bills")),1),fe]),_:1}),s(c,null,{default:n(()=>[s(Z,null,{default:n(()=>[(y(!0),f(S,null,D(e.invoices,l=>(y(),f(S,{key:"item-"+l.invoiceId},[s(K,{class:X({"bg-positive":l.expires>e.now})},{default:n(()=>[s(x,null,{default:n(()=>[s(z,null,{default:n(()=>[L(r(l.date)+", #"+r(l.invoiceId),1)]),_:2},1024),s(z,{caption:""},{default:n(()=>[L(r(e.$t("valid to"))+" "+r(e.format(l.expires*1e3,"dd. MMM yyyy, HH:mm")),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["class"]),s(v)],64))),128))]),_:1})]),_:1})]),_:1},512),[[d,e.invoices.length>0]])]),t("div",he,[s(v,{vertical:"",style:{margin:"auto",height:"100%"}})]),t("div",ge,[s(A,null,{default:n(()=>[s(c,{class:"bg-primary text-white"},{default:n(()=>[t("div",ve,r(e.$t("Buy"))+" & "+r(e.$t("Subscribe")),1),_e]),_:1}),s(c,null,{default:n(()=>[(y(!0),f(S,null,D(e.t.SupportByBuying,l=>(y(),f("p",{key:l},[t("span",{innerHTML:e.marked.parse(l)},null,8,be)]))),128))]),_:1}),s(v),s(c,null,{default:n(()=>[t("strong",null,r(e.$t("Legal Remarks")),1),(y(!0),f(S,null,D(e.t.Disclaimer,l=>(y(),f("p",{key:l},[t("span",{innerHTML:e.marked.parse(l)},null,8,we)]))),128))]),_:1}),s(v),u(s(c,{class:"text-center"},{default:n(()=>[L(r(e.$t("Login first to buy & subscribe"))+". ",1)]),_:1},512),[[d,e.isLogin===!1]]),u(s(c,{class:"text-center"},{default:n(()=>[u(t("div",null,[Ie,t("em",null,r(e.$t("buy now")),1),s(v,{class:"q-mt-sm"})],512),[[d,e.isPaying===!1]]),u(t("div",null,[s(F,{color:"primary",size:"3em"})],512),[[d,e.isPaying===!0]])]),_:1},512),[[d,e.isLogin===!0&&e.userId]])]),_:1})])])])}var ke=H(se,[["render",Le]]);export{ke as default};
