import{c as P,a4 as j,w as u,a6 as y,a7 as z}from"./vendor.quasar-78ba37d9.js";import{d as F,u as _,p as h,z as O,r as x,o as l,a as B,b as S,v as k,h as m,i as c,j as L,t as b,f as n,g as A,e as D,n as J,y as N}from"./vendor.vue-1bbf3cb4.js";import{M as I}from"./modules-9c8c454f.js";import{b as C}from"./stores-22cbae97.js";import{_ as V,f as E}from"./helpers-7b53fe93.js";import{L as Q,C as $}from"./controllers-596cf83c.js";import{v as H}from"./vendor.uuid-b6f2345c.js";var R={"AdapterLogs#description":"Zeigt den ioBroker.log an.","config#AdapterLogs#adapters#label":"Adapter","config#AdapterLogs#adapters#description":"","config#AdapterLogs#severity#label":"Kritikalit\xE4t","config#AdapterLogs#severity#description":"","config#AdapterLogs#message#label":"Nachrichtenfilter","config#AdapterLogs#message#description":"Nachricht mittels RegExp filtern","config#AdapterLogs#timeFormat#label":"Zeitformat","config#AdapterLogs#timeFormat#description":"","config#AdapterLogs#columns#label":"Spalten","config#AdapterLogs#columns#description":"Spalten die angezeigt werden sollen"},se=Object.freeze(Object.defineProperty({__proto__:null,default:R},Symbol.toStringTag,{value:"Module"})),Z={"AdapterLogs#description":"Displays the ioBroker.log.","config#AdapterLogs#adapters#label":"Adapters","config#AdapterLogs#adapters#description":"","config#AdapterLogs#severity#label":"Severity","config#AdapterLogs#severity#description":"","config#AdapterLogs#message#label":"Message Filter","config#AdapterLogs#message#description":"Filter the message text via RegExp","config#AdapterLogs#timeFormat#label":"Time Format","config#AdapterLogs#timeFormat#description":"","config#AdapterLogs#columns#label":"Columns","config#AdapterLogs#columns#description":"Select columns which shall be shown"},le=Object.freeze(Object.defineProperty({__proto__:null,default:Z},Symbol.toStringTag,{value:"Module"})),G={"AdapterLogs#description":"\u041E\u0442\u043E\u0431\u0440\u0430\u0436\u0430\u0442\u044C \u0436\u0443\u0440\u043D\u0430\u043B ioBroker","config#AdapterLogs#adapters#label":"","config#AdapterLogs#adapters#description":"","config#AdapterLogs#severity#label":"","config#AdapterLogs#severity#description":"","config#AdapterLogs#message#label":"","config#AdapterLogs#message#description":"","config#AdapterLogs#timeFormat#label":"","config#AdapterLogs#timeFormat#description":"","config#AdapterLogs#columns#label":"","config#AdapterLogs#columns#description":""},ie=Object.freeze(Object.defineProperty({__proto__:null,default:G},Symbol.toStringTag,{value:"Module"}));const K={addGroup:!1,addDivider:!1,addDevice:!1};var M=[{columns:2,parameter:"adapters",label:"config#AdapterLogs#adapters#label",info:"config#AdapterLogs#adapters#description",type:"Select",multiple:!0,"options-dense":!0,"display-value":":counter",value:()=>{const o=C();return o.instanceList&&o.instanceList.val&&o.instanceList.val.concat(["host"])||[]},options:()=>{const o=C(),i=o.instances,d=o.instanceList;if(i&&i.val&&d&&d.val){const g=d.val.map(t=>({icon:"img:"+i.val[t].extIcon,value:t,label:t}));return g.push({icon:"img:"+i.val["admin.0"].extIcon,value:"host",label:"js-controller"}),g.sort((t,f)=>t.label.toLowerCase()===f.label.toLowerCase()?0:t.label.toLowerCase()>f.label.toLowerCase()?1:-1)}return[]}},{columns:2,parameter:"severity",label:"config#AdapterLogs#severity#label",info:"config#AdapterLogs#severity#description",type:"Select",multiple:!0,value:["info","warn","error"],options:[{value:"silly",label:"silly"},{value:"debug",label:"debug"},{value:"info",label:"info"},{value:"warn",label:"warn"},{value:"error",label:"error"}]},{columns:8,parameter:"message",label:"config#AdapterLogs#message#label",info:"config#AdapterLogs#message#description"},{columns:2,parameter:"timeFormat",label:"config#AdapterLogs#timeFormat#label",info:"config#AdapterLogs#timeFormat#description",placeholder:"dd.MM.yyyy HH:mm:ss"},{columns:2,parameter:"columns",label:"config#AdapterLogs#columns#label",info:"config#AdapterLogs#columns#description",type:"Select",multiple:!0,value:["from","ts","severity","message"],options:[{value:"from",label:"Adapter"},{value:"ts",label:"Time"},{value:"severity",label:"Severity"},{value:"message",label:"Message"}]},{columns:2,parameter:"sortColumn",label:"config#JsonTable#sortColumn#label",info:"config#JsonTable#sortColumn#description",value:""},{columns:2,parameter:"sortDirection",label:"config#JsonTable#sortDirection#label",info:"config#JsonTable#sortDirection#description",type:"Switch",value:!1},{columns:2,parameter:"rowsPerPage",label:"config#JsonTable#rowsPerPage#label",info:"config#JsonTable#rowsPerPage#description",type:"Number",value:10,min:0},{columns:2,parameter:"dense",label:"config#JsonTable#dense#label",info:"config#JsonTable#dense#description",type:"Switch",value:!0}],ne=Object.freeze(Object.defineProperty({__proto__:null,Settings:K,default:M},Symbol.toStringTag,{value:"Module"}));const W=F({name:"ModuleAdapterLogs",props:["widget","_containerSize"],setup(o){const i=$.getConnection,d=C(),g=_(()=>o.widget.config),t=_(()=>({...I.joinConfig(g.value,M)})),f=[{name:"from",field:"from",label:"Adapter",align:"left",sortable:!0},{name:"ts",field:"ts",label:"Time",align:"left",sortable:!0},{name:"severity",field:"severity",label:"Severity",align:"left",sortable:!0},{name:"message",field:"message",label:"Message",align:"left",sortable:!1}],p=e=>!(!t.value.adapters.includes(e.from)||!t.value.severity.includes(e.severity)||t.value.message&&RegExp(t.value.message,"gi").test(e.message)),a=(e,r)=>(e.from.startsWith("host.")||e.from,e.raw=e.message,e._id=H(),e.ts=Number.isInteger(e.ts)?E(e.ts,t.value.timeFormat||"dd.MM.yyyy HH:mm:ss"):e.ts,e.icon=r[e.from]&&r[e.from].extIcon?"img:"+r[e.from].extIcon:"",e.message=e.message.replace(e.from,""),e.message=e.message.indexOf(") ")!==-1?e.message.substr(e.message.indexOf(") ")+2):e.message,t.value.columns.includes("from")||delete e.from,t.value.columns.includes("ts")||delete e.ts,t.value.columns.includes("severity")||delete e.severity,t.value.columns.includes("message")||delete e.message,e),T=h(!1),w=h(null),v=h();return O(()=>{const e=d.instances.val||{};i.getLogs().then(r=>{v.value=r.filter(s=>p(s)).map(s=>a(s,e)),Q.getInstance().on("message",s=>{p(s)&&v.value.unshift(a(s,e))}),i.on("_log",s=>{p(s)&&v.value.unshift(a(s,e))})}).catch(r=>{console.error(r),w.value=r.message||r}).finally(()=>{T.value=!0})},{flush:"post"}),{moduleConfig:t,columns:f,columnsVisible:t.value.columns,pagination:_(()=>({sortBy:t.value.sortColumn,descending:t.value.sortDirection,rowsPerPage:t.value.rowsPerPage})),loaded:T,error:w,logs:v}}});function q(o,i,d,g,t,f){const p=x("alert");return l(),B("div",{key:o.widget.revision,class:"jarvis-AdapterLogs",style:N({height:o._containerSize.height+"px"})},[S(m(P,{indeterminate:""},null,512),[[k,!o.loaded&&!o.error]]),S(m(p,null,{default:c(()=>[L(b(o.error),1)]),_:1},512),[[k,o.loaded&&o.error]]),S(m(z,{rows:o.logs,flat:"",dense:o.moduleConfig.dense,pagination:o.pagination,"binary-state-sort":"",columns:o.columns,"row-key":"_id","visible-columns":o.columnsVisible,class:"sticky-table-header full-height"},{body:c(({row:a})=>[m(j,null,{default:c(()=>[a.from!==void 0?(l(),n(y,{key:0},{default:c(()=>[m(u,{name:a.icon},null,8,["name"]),L(" \xA0"+b(a.from),1)]),_:2},1024)):A("",!0),a.ts!==void 0?(l(),n(y,{key:1},{default:c(()=>[L(b(a.ts),1)]),_:2},1024)):A("",!0),a.severity!==void 0?(l(),n(y,{key:2},{default:c(()=>[a.severity==="info"?(l(),n(u,{key:0,size:"xs",name:"mdi-information",color:"blue"})):a.severity==="warn"?(l(),n(u,{key:1,size:"xs",name:"mdi-alert-box",color:"warning"})):a.severity==="error"?(l(),n(u,{key:2,size:"xs",name:"mdi-close-box",color:"negative"})):(l(),n(u,{key:3,size:"xs",name:"mdi-bug",color:"grey"})),D("span",{style:{"margin-left":"4px"},class:J("text-"+(a.severity==="info"?"primary":a.severity==="warn"?"warning":a.severity==="error"?"negative":"grey"))},b(a.severity),3)]),_:2},1024)):A("",!0),a.message!==void 0?(l(),n(y,{key:3},{default:c(()=>[L(b(typeof a.message=="object"?JSON.stringify(a.message):a.message),1)]),_:2},1024)):A("",!0)]),_:2},1024)]),_:1},8,["rows","dense","pagination","columns","visible-columns"]),[[k,o.loaded&&!o.error]])],4)}var U=V(W,[["render",q]]),ce=Object.freeze(Object.defineProperty({__proto__:null,default:U},Symbol.toStringTag,{value:"Module"}));export{ce as A,se as _,le as a,ie as b,ne as c};
