import{ae as C,c as v}from"./vendor.quasar-78ba37d9.js";import{d as f,u as c,r as u,o as h,a as g,h as r,f as y,g as S,b as w,v as _,e as x,y as V,B as k}from"./vendor.vue-1bbf3cb4.js";import{d as O}from"./vendor.deepmerge-ts-439b8b51.js";import"./vendor.echarts-c3f5bfdf.js";import{M as z}from"./modules-9c8c454f.js";import{d as L}from"./stores-22cbae97.js";import{_ as p}from"./helpers-7b53fe93.js";import{D as d}from"./controllers-596cf83c.js";var j={"Chart#description":"Stellt Datenpunkte-Werte in einem Chart mittels Echarts dar.","config#Chart#type#label":"Typ des Charts","config#Chart#type#info":"","config#Chart#barStack#label":"Stack Bars","config#Chart#barStack#info":"S\xE4ulen des Bar-Chart aufeinander (true) oder nebeneinander (false) zeigen.","config#Chart#pieRadius#label":"Doughnut Variante","config#Chart#pieRadius#info":"Pie-Chart voll ausf\xFCllen (true) oder als Doughnut (false) darstellen.","config#Chart#maxValue#label":"Maximaler Achsen-Wert","config#Chart#maxValue#info":"","config#Chart#minValue#label":"Minimaler Achsen-Wert","config#Chart#minValue#info":"","config#Chart#radius#label":"Radius","config#Chart#legend#label":"Legende","config#Chart#legend#options#top":"oben","config#Chart#legend#options#bottom":"unten","config#Chart#legend#options#off":"aus","config#Chart#label#label":"Werte-Label verstecken"},Q=Object.freeze(Object.defineProperty({__proto__:null,default:j},Symbol.toStringTag,{value:"Module"})),$={"Chart#description":"Displays a chart based on state values using Echarts.","config#Chart#type#label":"Type of Chart","config#Chart#type#info":"","config#Chart#barStack#label":"Stack Bars","config#Chart#barStack#info":"Whether to stack bars in a Bar Chart instead of showing them separately.","config#Chart#pieRadius#label":"Doughnut Variant","config#Chart#pieRadius#info":"Fill in pie chart (true) or show as doughnut (false).","config#Chart#maxValue#label":"Maximum Axis Value","config#Chart#maxValue#info":"","config#Chart#minValue#label":"Minimum Axis value","config#Chart#minValue#info":"","config#Chart#radius#label":"Radius","config#Chart#legend#label":"Legend","config#Chart#legend#options#top":"top","config#Chart#legend#options#bottom":"bottom","config#Chart#legend#options#off":"off","config#Chart#label#label":"Hide Value Label"},U=Object.freeze(Object.defineProperty({__proto__:null,default:$},Symbol.toStringTag,{value:"Module"})),M={"Chart#description":"\u041E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 \u0434\u0438\u0430\u0433\u0440\u0430\u043C \u043D\u0430 \u043E\u0441\u043D\u043E\u0432\u0430\u043D\u0438\u0438 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0439 \u0441\u0442\u0430\u0442\u0443\u0441\u0430 \u0441 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u043D\u0438\u0435\u043C  Echarts","config#Chart#type#label":"\u0422\u0438\u043F \u0434\u0438\u0430\u0433\u0440\u0430\u043C\u044B","config#Chart#type#info":"","config#Chart#barStack#label":"\u0421\u0442\u043E\u043B\u0431\u0447\u0430\u0442\u0430\u044F \u0434\u0438\u0430\u0433\u0440\u0430\u043C\u0430","config#Chart#barStack#info":"\u041E\u0431\u044A\u0435\u0434\u0438\u043D\u044F\u0442\u044C \u0441\u0442\u043E\u043B\u0431\u0446\u044B \u0434\u0438\u0430\u0433\u0440\u0430\u043C\u044B \u0432\u043C\u0435\u0441\u0442\u043E \u0442\u043E\u0433\u043E, \u0447\u0442\u043E\u0431\u044B\u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0430\u0442\u044C \u0438\u0445 \u043E\u0442\u0434\u0435\u043B\u044C\u043D\u043E","config#Chart#pieRadius#label":"\u041A\u043E\u043B\u044C\u0446\u0435\u0432\u0430\u044F \u0434\u0438\u0430\u0433\u0440\u0430\u043C\u0430","config#Chart#pieRadius#info":"\u041A\u0440\u0443\u0433\u043E\u0432\u0430\u044F (true) \u0438\u043B\u0438 \u043A\u043E\u043B\u044C\u0446\u0435\u0432\u0430\u044F (false) \u0434\u0438\u0430\u0433\u0440\u0430\u043C\u0430","config#Chart#maxValue#label":"\u041C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u043E\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435 \u043E\u0441\u0438","config#Chart#maxValue#info":"","config#Chart#minValue#label":"\u041C\u0438\u043D\u0438\u043C\u0430\u043B\u044C\u043D\u043E\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435 \u043E\u0441\u0438","config#Chart#minValue#info":"","config#Chart#radius#label":"\u0420\u0430\u0434\u0438\u0443\u0441","config#Chart#legend#label":"\u041B\u0435\u0433\u0435\u043D\u0434\u0430","config#Chart#legend#options#top":"\u0441\u0432\u0435\u0440\u0445\u0443","config#Chart#legend#options#bottom":"\u0441\u043D\u0438\u0437\u0443","config#Chart#legend#options#off":"\u043E\u0442\u043A\u043B\u044E\u0447\u0435\u043D\u043E","config#Chart#label#label":"\u0421\u043A\u0440\u0432\u0442\u044C \u043F\u043E\u0434\u043F\u0438\u0441\u0438 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0439"},J=Object.freeze(Object.defineProperty({__proto__:null,default:M},Symbol.toStringTag,{value:"Module"}));const A=f({name:"ModuleChartCustomConfiguration",props:["item"],emits:["onChange"],setup(t,{emit:e}){const i=L(),a=c(()=>i.devices||{}),n=c(()=>t.item.label||a.value&&a.value[t.item.deviceId]&&(a.value[t.item.deviceId].label||a.value[t.item.deviceId].name)||""),o=c(()=>!a.value||!a.value[t.item.deviceId]||!a.value[t.item.deviceId].states?[]:Object.keys(a.value[t.item.deviceId].states).map(s=>({label:s,value:s})));return{deviceLabel:n,deviceStatesOptions:o,onChange:s=>e("onChange",s)}}}),R={class:"row nowrap items-center"};function T(t,e,i,a,n,o){const l=u("inputs");return h(),g("div",R,[r(l,{dense:"",style:{width:"130px"},onOnSelect:t.onChange,label:"Action State",itemId:t.item.id,id:"primaryStateKey",value:t.item.primaryStateKey,type:"select",options:t.deviceStatesOptions},null,8,["onOnSelect","itemId","value","options"]),r(l,{dense:"",style:{width:"170px"},onOnChange:t.onChange,label:"Label",itemId:t.item.id,id:"label",value:t.deviceLabel},null,8,["onOnChange","itemId","value"]),r(l,{dense:"",type:"color",onOnChange:t.onChange,label:"Chart Line Color",itemId:t.item.id,id:"moduleConfig.color",value:t.item.moduleConfig&&t.item.moduleConfig.color||""},null,8,["onOnChange","itemId","value"])])}var m=p(A,[["render",T]]),X=Object.freeze(Object.defineProperty({__proto__:null,default:m},Symbol.toStringTag,{value:"Module"}));const P={addGroup:!1,addDivider:!1,addDevice:{fields:["label"]},customActionSection:m};var b=[{columns:2,parameter:"type",label:"config#Chart#type#label",info:"config#Chart#type#info",type:"Select",options:[{value:"bar",label:"Bar-Chart"},{value:"pie",label:"Pie-Chart"},{value:"circle",label:"Circle-Chart"}],value:"bar"},{columns:2,type:"Placeholder",dependencies:{type:"circle"}},{columns:2,parameter:"barStack",label:"config#Chart#barStack#label",info:"config#Chart#barStack#info",type:"Switch",value:!1,dependencies:{type:"bar"}},{columns:2,parameter:"pieRadius",label:"config#Chart#pieRadius#label",info:"config#Chart#pieRadius#info",type:"Switch",value:!0,dependencies:{type:"pie"}},{columns:2,type:"Placeholder",dependencies:{type:["pie"]}},{columns:2,parameter:"minValue",label:"config#Chart#minValue#label",info:"config#Chart#minValue#info",type:"Number",placeholder:"auto",dependencies:{type:["bar"]}},{columns:2,type:"Placeholder",dependencies:{type:["pie"]}},{columns:2,parameter:"radius",label:"config#Chart#radius#label",type:"Number",placeholder:"70",min:0,max:100,dependencies:{type:["circle"]}},{columns:2,parameter:"maxValue",label:"config#Chart#maxValue#label",info:"config#Chart#maxValue#info",type:"Number",placeholder:"auto",dependencies:{type:["bar","circle"]}},{columns:2,parameter:"legend",label:"config#Chart#legend#label",type:"Select",options:[{value:"top",translate:"config#Chart#legend#options#top"},{value:"bottom",translate:"config#Chart#legend#options#bottom"},{value:"off",translate:"config#Chart#legend#options#off"}],value:"top"},{columns:2,parameter:"label",label:"config#Chart#label#label",type:"Switch",value:!1}],Y=Object.freeze(Object.defineProperty({__proto__:null,Settings:P,default:b},Symbol.toStringTag,{value:"Module"}));const B=f({name:"ModuleChart",props:["_containerSize","_widgetSize","widget"],data(){return this.devices={},{widgetSize:this._widgetSize,states:{},stateLabels:{},stateValues:{},error:null,loaded:!1}},methods:{zIndex(t){const e=document.querySelector(".jarvis-widget-"+this.widget.id);e&&(e.style.zIndex=t)},fitChart(){this.loaded&&this.vchart&&this.vchart.resize({width:"auto",height:"auto"})},gotState(t,e,i,a){if(t){this.error=t,this.loaded=!0;return}const{item:n}=this.devices[e.id+"#"+i];this.states[e.id+"#"+i]=a,this.stateLabels[e.id+"#"+i]=n.label||a.label||e.name,this.stateValues[e.id+"#"+i]=parseFloat(a.value),this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.setChartOptions()},500)},setChartOptions(){let t={};!this.config.type||this.config.type==="bar"?t={xAxis:[{type:"category",axisTick:{alignWithLabel:!0},axisLabel:{show:!1}}],yAxis:[{type:"value",max:this.config.barStack===!0?Math.round(Object.values(this.stateValues).reduce((e,i)=>e+i)/100)*100:this.config.maxValue,min:this.config.minValue}]}:this.config.type==="pie"?t={series:[{type:"pie",radius:this.config.pieRadius===!0?["40%","80%"]:["80%","0%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:this.$q.dark.isActive?"#333":"#fff",borderWidth:2},label:{formatter:"{c}",position:"inside"},emphasis:{label:{show:!0}},labelLine:{show:!1},data:Object.keys(this.stateLabels).map(e=>{const i=this.states[e]&&this.states[e].unit||"";return{value:this.stateValues[e],name:e+":"+this.stateLabels[e],label:{formatter:this.config.label===!0?"":this.stateValues[e]+" "+i},unit:i,itemStyle:{color:this.devices[e].item.moduleConfig&&this.devices[e].item.moduleConfig.color}}})}]}:this.config.type==="circle"&&(t={angleAxis:{max:this.config.maxValue&&parseInt(this.config.maxValue)||void 0},radiusAxis:{type:"category",axisLabel:{show:!1}},polar:{radius:this.config.radius?["10%",this.config.radius+"%"]:this.widget.title?["10%","60%"]:["10%","70%"],center:this.config.legend==="bottom"?["50%","45%"]:["50%","50%"]}}),t=O(t,{legend:{show:this.config.legend!=="off",bottom:this.config.legend==="bottom"?0:"auto",padding:[10,10,5,10],textStyle:{color:this.$q.dark.isActive?"#fff":"#666"},tooltip:{show:!0,position:"bottom",borderWidth:1,borderColor:"#ccc",formatter:e=>{const[i,a]=e.name.split(":"),n=this.stateValues[i],o=this.devices[i].item.moduleConfig&&this.devices[i].item.moduleConfig.color;return'<span style="display:inline-block;margin-right:4px;border-radius:10px;width:10px;height:10px;background-color:'+o+';"></span><span style="font-size:14px;color:#666;font-weight:400;margin-left:2px">'+a+'</span><span style="float:right;margin-left:20px;font-size:14px;color:#666;font-weight:900">'+(typeof n=="number"?n.toFixed(2):"-")+(this.states[i]&&this.states[i].unit?" "+this.states[i].unit:"")+"</span>"}},formatter:e=>{const[,i]=e.split(":");return i},data:Object.keys(this.stateLabels).map(e=>({name:e+":"+this.stateLabels[e],itemStyle:{color:this.devices[e].item.moduleConfig&&this.devices[e].item.moduleConfig.color}}))},grid:{top:"15%",left:"1%",right:"2%",bottom:"12%",containLabel:!0},label:{color:this.$q.dark.isActive?"#fff":"#333",fontWeight:"bold"},tooltip:{position:"top",formatter:e=>{const{marker:i,seriesName:a,name:n,data:o}=e,[,l]=(this.config.type==="bar"||this.config.type==="circle"?a:n).split(":");return""+i+'<span style="font-size:14px;color:#666;font-weight:400;margin-left:2px">'+l+'</span><span style="float:right;margin-left:20px;font-size:14px;color:#666;font-weight:900">'+(typeof o.value=="number"?o.value.toFixed(2):"-")+(o&&o.unit?" "+o.unit:"")+"</span>"}},series:this.config.type==="pie"?[]:Object.keys(this.stateLabels).map(e=>{const i=this.states[e]&&this.states[e].unit||"",a={name:e+":"+this.stateLabels[e],type:"bar",showBackground:!0,stack:!this.config.type||this.config.type==="bar"?this.config.barStack:!1,emphasis:{focus:"series"},label:{show:!0,position:"insideTop"},data:[{value:this.stateValues[e],label:{formatter:this.config.label===!0?"":this.stateValues[e]+" "+i},unit:i,itemStyle:{color:this.devices[e].item.moduleConfig&&this.devices[e].item.moduleConfig.color}}]};return this.config.type==="circle"&&(a.coordinateSystem="polar",a.label={show:!0,fontWeight:"bold",color:this.$q.dark.isActive?"#fff":"#000",position:"start",offset:[2,2]}),a})}),this.vchart&&this.vchart.setOption(t,!0),this.loaded=!0}},computed:{config(){return z.joinConfig(this.widget.config,b)}},watch:{_widgetSize(t){this.widgetSize!==t&&(this.widgetSize=t)}},mounted(){this.vchart=this.$refs.vchart,this.widget.items&&this.revision!==this.widget.revision&&(this.revision=this.widget.revision,this.widget.items.forEach(t=>{if(t.type==="device"){const e=d.get(t.deviceId||null);t.moduleConfig&&t.moduleConfig.color&&C("chart--"+e.name.toLowerCase().replace(/ /g,"-").replace(/\./g,"-"),t.moduleConfig.color),e?(this.stateLabels[e.id+"#"+t.primaryStateKey]=e.name,this.devices[e.id+"#"+t.primaryStateKey]={item:t,device:e},d.listen(e.id,t.primaryStateKey,this.gotState)):console.error(this.$i18n.t("No device specified"))}})),window.addEventListener("orientationchange",()=>{this.fitChart()})},beforeUnmount(){for(const t in this.devices)this.devices[t]}});function W(t,e,i,a,n,o){const l=u("v-chart");return h(),g("div",{onTouchstart:e[0]||(e[0]=k(()=>{},["stop"])),onMouseover:e[1]||(e[1]=s=>t.zIndex(99)),onMouseout:e[2]||(e[2]=s=>t.zIndex("initial")),style:{"min-width":"1px","min-height":"1px"}},[t.loaded?S("",!0):(h(),y(v,{key:0,indeterminate:""})),w(x("div",{style:V({"min-width":"100%","min-height":"100%",width:t.widgetSize.width+"px",height:t._containerSize.height+"px"})},[r(l,{autoresize:"",ref:"vchart"},null,512)],4),[[_,t.loaded&&!t.error]])],32)}var D=p(B,[["render",W]]),Z=Object.freeze(Object.defineProperty({__proto__:null,default:D},Symbol.toStringTag,{value:"Module"}));export{X as C,Q as _,U as a,J as b,Y as c,Z as d};
