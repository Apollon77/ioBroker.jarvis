var q=Object.defineProperty,D=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var R=(e,o,d)=>o in e?q(e,o,{enumerable:!0,configurable:!0,writable:!0,value:d}):e[o]=d,C=(e,o)=>{for(var d in o||(o={}))H.call(o,d)&&R(e,d,o[d]);if(B)for(var d of B(o))O.call(o,d)&&R(e,d,o[d]);return e},A=(e,o)=>D(e,F(o));import{Q as $}from"./QTooltip-d983bb75.js";import{_ as z,q as E,H as G,dg as J,X as K,aA as P,d7 as X,dy as W,c as Q,a3 as S,j as Y,bE as Z,dp as x,k as l,w as t,J as b,a2 as k,L as w,o as m,a as v,i as p,t as i,g,M as u,$ as L,d as I,l as ee,e as h,cO as ae,I as le,N as T,f as te,Q as oe,F as de,K as se}from"./index-e79b9e6f.js";import{Q as re}from"./QBadge-50ad8e5e.js";const ie=E({name:"ModuleAdapterStatus",props:["widget"],setup(e){const o=x.getConnection;G();const d=J(),M=K(),j=P(e.widget,"config"),n=X.joinConfig(j.value,W);n.list=n.list?n.list.replace(/, /g,",").toLowerCase().split(","):null,n.blacklist=n.blacklist?n.blacklist.replace(/, /g,",").toLowerCase().split(","):null;const f=Q(()=>{let s=d.instances;if(s=s&&s.val&&!s.val.error?C({},s.val):{},n.list)for(const r in s){const c=r.substr(0,r.indexOf("."));!n.list.includes(r)&&!n.list.includes(c)&&delete s[r]}else if(n.blacklist)for(const r in s){const c=r.substr(0,r.indexOf("."));(n.blacklist.includes(r)||n.blacklist.includes(c))&&delete s[r]}return s}),a=S([]),_=S([]);o.subscribeState("admin.0.info.updatesList",({err:s,state:r})=>{if(r){const c=r&&r.val?r.val.replace("js-controller,","").replace("js-controller",""):"";a.value=c?c.split(","):[],_.value=a.value.map(y=>f.value[y+".0"]?f.value[y+".0"].title+" ("+f.value[y+".0"].name+")":y).join(", ")}});const U=S({}),N=(s,r)=>{U.value[s]=!0,o.setAdapter(s,r).then(()=>{d.join("instances",{val:A(C({},d.instances.val),{[s]:A(C({},d.instances.val[s]),{enabled:r})}),ts:Date.now()})}).catch(c=>{console.error(c)}).finally(()=>{U.value[s]=!1})},V=Q(()=>M.locale.substr(0,2));return{activeRepo:Q(()=>d.meta.activeRepo),adapterUpdates:a,adapterUpdateList:_,instances:f,language:V,loading:U,moduleConfig:n,onSet:N}}}),ne=h("br",null,null,-1),ue=p(", "),pe={class:"UpdateAvailable"},fe={key:1},me={key:2};function ce(e,o,d,M,j,n){const f=Y("icon");return Z([e.widget.revision],()=>l(T,null,{default:t(()=>[b(l(w,{class:"UpdateAvailableListItem",style:{"background-color":"var(--q-accent)"}},{default:t(()=>[e.adapterUpdateList.length>60?(m(),v($,{key:0},{default:t(()=>[p(i(e.adapterUpdateList),1)]),_:1})):g("",!0),l(u,{avatar:""},{default:t(()=>[l(f,{name:"refresh"})]),_:1}),l(u,null,{default:t(()=>[l(L,null,{default:t(()=>[p(i(e.adapterUpdateList.length>60?e.adapterUpdateList.substr(0,58)+"...":e.adapterUpdateList),1)]),_:1}),l(L,{caption:"",style:{color:"#fff"}},{default:t(()=>[p(i(e.adapterUpdates.length)+" "+i(e.$t("Updates available")),1),ne,p(" "+i(e.$t("Repository")+": "+e.activeRepo),1)]),_:1})]),_:1}),l(u,{side:""},{default:t(()=>[l(re,{rounded:"",color:"white",style:{color:"var(--q-accent)"},label:e.adapterUpdates.length},null,8,["label"])]),_:1})]),_:1},512),[[k,e.moduleConfig.updates&&e.adapterUpdates.length>0]]),(m(!0),I(de,null,ee(e.instances,a=>(m(),v(w,{key:a.id,clickable:e.moduleConfig.switch&&a.mode!=="none"&&a.mode!=="once"&&e.loading[a.id]!==!0,"v-ripple":e.moduleConfig.switch&&a.mode!=="none"&&a.mode!=="once"&&e.loading[a.id]!==!0},{default:t(()=>[l(u,{avatar:""},{default:t(()=>[l(f,{name:"img:"+a.extIcon},null,8,["name"])]),_:2},1024),l(u,null,{default:t(()=>[l(L,null,{default:t(()=>[p(i(a.titleLang&&(a.titleLang[e.language]||a.titleLang.en||a.titleLang.de)||a.titleLang||a.title),1)]),_:2},1024),l(L,{caption:""},{default:t(()=>[h("span",null,i(a.id)+", v"+i(a.version),1),b(h("span",null,[ue,h("span",pe,i(e.$t("Update available")+" v"+a.update),1)],512),[[k,a.update]]),b(h("span",null,", "+i(e.$t("Compact Mode"))+" "+i(e.$t("on"))+" ("+i(e.$t("Group")+" "+a.compactGroup)+")",513),[[k,a.runAsCompactMode]])]),_:2},1024)]),_:2},1024),a.mode!=="none"&&a.mode!=="once"?b((m(),v(u,{key:0,side:""},{default:t(()=>[e.loading[a.id]===!0?(m(),v(ae,{key:0,color:"primary",size:"21px"})):g("",!0),e.loading[a.id]!==!0&&a.alive!==!1&&a.connectedToHost!==!1&&a.connectedToInstance!==!1?(m(),I("div",fe,[l(f,{color:"positive",name:"mdi-check-circle"}),l($,null,{default:t(()=>[p(i(e.$t("Adapter")+" "+e.$t("alive")),1)]),_:1})])):g("",!0),e.loading[a.id]!==!0&&a.alive===!1||a.connectedToHost===!1||a.connectedToInstance===!1?(m(),I("div",me,[l(f,{color:"warning",name:"mdi-alert"}),l($,null,{default:t(()=>[p(i(e.$t("Adapter")+" "+e.$t("not alive")),1)]),_:1})])):g("",!0)]),_:2},1536)),[[k,a.enabled===!0]]):g("",!0),a.mode!=="none"&&a.mode!=="once"?b((m(),v(u,{key:1,side:""},{default:t(()=>[l(f,{name:"mdi-close"}),l($,null,{default:t(()=>[p(i(e.$t("Adapter")+" "+e.$t("disabled")),1)]),_:1})]),_:2},1536)),[[k,a.enabled===!1]]):g("",!0),e.moduleConfig.switch&&a.mode!=="none"&&a.mode!=="once"&&e.loading[a.id]!==!0?(m(),v(le,{key:2,ref_for:!0,ref:"menu","touch-position":""},{default:t(()=>[l(T,{style:{"min-width":"120px","man-width":"150px"},class:"body"},{default:t(()=>[l(w,{class:te("text-white bg-"+(a.enabled?"positive":"negative"))},{default:t(()=>[l(u,{avatar:""}),l(u,null,{default:t(()=>[p(i(e.$t(a.enabled?"Currently running":"Currently stopped")),1)]),_:2},1024),l(u,{side:""})]),_:2},1032,["class"]),b((m(),v(w,{clickable:"",onClick:_=>e.onSet(a.id,!a.enabled)},{default:t(()=>[l(u,{avatar:""},{default:t(()=>[l(oe,{color:a.enabled?"negative":"positive",name:a.enabled?"mdi-pause":"mdi-play"},null,8,["color","name"])]),_:2},1024),l(u,null,{default:t(()=>[p(i(e.$t(a.enabled?"Stop":"Start")+" "+e.$t("Adapter")),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[se]])]),_:2},1024)]),_:2},1536)):g("",!0)]),_:2},1032,["clickable","v-ripple"]))),128))]),_:1}),o,0)}var ye=z(ie,[["render",ce]]);export{ye as default};
