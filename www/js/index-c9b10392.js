import{bt as F,a4 as W,bM as z,bN as J,cI as w,d6 as Q,as as $,k as m,di as v,aw as G,cH as V,aG as q,ay as r,W as c,b3 as g,bn as y,X as t,a2 as n,b1 as l,a1 as Y,D as d,bT as p,I,aE as P,bU as S,cP as E,bS as H,df as C}from"./index-6ec15ddc.js";import{m as j}from"./marked.esm-5c8832de.js";const R=W({name:"AccountPage",setup(){console.log("AccountPage","setup()");const s=z(),L=J(),b=w.get("sessionId")||Q();w.set("sessionId",b);const k="Ad8Db5feNlBy6SdFa7O0fpJ2QYIcyFO9SGSg4tNpxOgOlLyWTkN6JmOFBV58ItTpdUwfBGW2L8WuoIAn";$(()=>{const e=document.createElement("script");e.setAttribute("src","https://www.paypal.com/sdk/js?client-id="+k+"&components=buttons&currency=EUR&vault=true&intent=subscription"),e.setAttribute("data-namespace","paypal_sdk"),document.body.appendChild(e)});const B=m(),_=m(!1),h=m(w.get("userId")!==null),a=m(w.get("userId")),A=m([]),N=m(),D=m([]);v.post("user/details",{action:"getLoginBySessionId",sessionId:b}).then(e=>{if(!e)throw new Error("User not signed in!");console.log("AccountPage","UserDetails",e),h.value=!0,a.value=e,w.set("userId",e),console.log("AccountPage","User signed-in: "+e),v.post("user/invoice",{action:"getInvoicesByUserId",userId:e}).then(o=>{D.value=o}).catch(o=>{console.warn("AccountPage",o.message)}),v.post("user/details",{action:"getInstallations",userId:e}).then(o=>{A.value=o.map(i=>{const u=JSON.parse(i.system),O={value:i.ioBrokerId,label:"System: "+u.hostname+" ("+u.platform+"), ID: "+i.ioBrokerId};return i.selected==="1"&&(N.value=O),O})}).catch(o=>{console.warn("AccountPage",b,o.message)})}).catch(e=>{console.warn("AccountPage",b,e.message),e.value=e.message,h.value=!1});let f=null;const U=()=>{window.paypal?window.paypal.use(["login"],e=>{const o=L.meta.uuid,i=L.meta.system,u=C.getSystemId(i);e.render({appid:"Ad8Db5feNlBy6SdFa7O0fpJ2QYIcyFO9SGSg4tNpxOgOlLyWTkN6JmOFBV58ItTpdUwfBGW2L8WuoIAn",scopes:"openid",containerid:"paypal-button-login",responseType:"code",locale:"de-de",buttonType:"LWP",buttonShape:"pill",buttonSize:"lg",fullPage:"true",state:btoa(b+"|"+o+"|"+u+"|"+JSON.stringify(i)+"|"+window.location.href),returnurl:"https://www.zefau.net/jarvis/user/paypal_login.php"})}):setTimeout(()=>U(),100)},M=()=>{if(!window.paypal_sdk)setTimeout(()=>M(),100);else{document.querySelector("#paypal-button-subscribe");const e={style:{shape:"rect",color:"blue",layout:"horizontal",label:"buynow",tagline:!1},createSubscription:(o,i)=>i.subscription.create({plan_id:"P-8EY03930L1769123MMEFPZPI"}),onApprove:(o,i)=>{_.value=!0,v.post("user/invoice",{action:"assignUserToInvoice",userId:a.value,subscriptionId:o.subscriptionID}).then(u=>C.setToken(u,o.subscriptionID,N.value.value)).catch(u=>console.error(u)).finally(()=>{_.value="done",window.location.reload()})}};f=window.paypal_sdk.Buttons(e),f.render("#paypal-button-subscribe")}};$(()=>{U(),M()}),G(()=>{f&&f.close&&f.close(),Object.keys(window).forEach(e=>{/paypal|zoid|post_robot/.test(e)&&delete window[e]})});const T={};return["SupportByBuying","UsageNotice","Termination","Disclaimer"].forEach(e=>{let o="",i=0;for(T[e]=[];(o=s.t(e+"["+i+"]"))!==e+"["+i+"]";)i++,T[e].push(o)}),{format:V,marked:j,now:Math.ceil(Date.now()/1e3),t:T,installations:A,invoices:D,userId:a,isLogin:h,isPaying:_,error:B}}}),K={class:"q-ma-sm"},X={class:"row"},Z={class:"col"},x={class:"row no-wrap q-col-gutter-sm"},ee={class:"col-8"},se={class:"text-h6"},te=t("div",{class:"text-subtitle2"},null,-1),ne=["innerHTML"],oe=["innerHTML"],ae=["innerHTML"],ie={class:"text-center"},le={class:"text-center"},re=t("div",{id:"paypal-button-login"},null,-1),ce=[re],ue=t("div",{id:"paypal-button-subscribe"},null,-1),de={class:"col-4"},pe={class:"text-h6"},me=t("div",{class:"text-subtitle2"},null,-1),ge=["innerHTML"];function ye(s,L,b,k,B,_){const h=q("alert");return r(),c("div",K,[g(t("div",X,[t("div",Z,[n(h,null,{default:l(()=>[Y(d(s.error),1)]),_:1})])],512),[[y,s.error]]),t("div",x,[t("div",ee,[n(H,null,{default:l(()=>[n(p,{class:"bg-primary text-white"},{default:l(()=>[t("div",se,d(s.$t("Buy"))+" & "+d(s.$t("Subscribe")),1),te]),_:1}),n(p,null,{default:l(()=>[(r(!0),c(I,null,P(s.t.SupportByBuying,a=>(r(),c("p",{key:a},[t("span",{innerHTML:s.marked.parse(a)},null,8,ne)]))),128))]),_:1}),n(S),n(p,null,{default:l(()=>[t("strong",null,d(s.$t("Usage Notice")),1),(r(!0),c(I,null,P(s.t.UsageNotice,a=>(r(),c("p",{key:a},[t("span",{innerHTML:s.marked.parse(a)},null,8,oe)]))),128))]),_:1}),n(S),n(p,null,{default:l(()=>[t("strong",null,d(s.$t("Legal Remarks")),1),(r(!0),c(I,null,P(s.t.Disclaimer,a=>(r(),c("p",{key:a},[t("span",{innerHTML:s.marked.parse(a)},null,8,ae)]))),128))]),_:1}),n(S),g(n(p,null,{default:l(()=>[g(t("div",ie,[n(E,{color:"primary",size:"3em"})],512),[[y,s.isLogin===null]]),g(t("div",le,ce,512),[[y,s.isLogin===!1]])]),_:1},512),[[y,s.isLogin!==!0]]),g(n(p,{class:"text-center"},{default:l(()=>[g(t("div",null,[ue,t("em",null,d(s.$t("buy now")),1),n(S,{class:"q-mt-sm"})],512),[[y,s.isPaying===!1]]),g(t("div",null,[n(E,{color:"primary",size:"3em"})],512),[[y,s.isPaying===!0]])]),_:1},512),[[y,s.isLogin===!0&&s.userId]])]),_:1})]),t("div",de,[n(H,null,{default:l(()=>[n(p,{class:"bg-primary text-white"},{default:l(()=>[t("div",pe,d(s.$t("Unsubscribe"))+" / "+d(s.$t("Terminate")),1),me]),_:1}),n(p,null,{default:l(()=>[(r(!0),c(I,null,P(s.t.Termination,a=>(r(),c("p",{key:a},[t("span",{innerHTML:s.marked.parse(a)},null,8,ge)]))),128))]),_:1})]),_:1})])])])}var fe=F(R,[["render",ye]]);export{fe as default};
