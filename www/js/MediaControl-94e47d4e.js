import{bt as K,a4 as _,Q as g,da as x,eb as ee,k as h,r as ae,an as oe,ao as se,ec as N,aG as te,ay as S,W as $,X as n,C as j,a1 as I,D as v,b3 as i,bn as d,a2 as c,b1 as Q,U as A,V as w,bB as E,cS as re,I as H,bs as ne,b$ as O,cI as U,ds as X}from"./index-2f9ee6b2.js";import{Q as le}from"./QTooltip-4ce3b55a.js";const{getPaletteColor:ie,changeAlpha:de}=ne,q={"./adapters/alexa2.js":()=>O(()=>import("./alexa2-c38401fd.js"),["js/alexa2-c38401fd.js","js/index-2f9ee6b2.js","css/index-3ff7d3de.css"]),"./adapters/musiccast.js":()=>O(()=>import("./musiccast-5119f2bf.js"),["js/musiccast-5119f2bf.js","js/index-2f9ee6b2.js","css/index-3ff7d3de.css"]),"./adapters/plex.js":()=>O(()=>import("./plex-b21e87b1.js"),["js/plex-b21e87b1.js","js/index-2f9ee6b2.js","css/index-3ff7d3de.css"]),"./adapters/spotify-premium.js":()=>O(()=>import("./spotify-premium-21265831.js"),["js/spotify-premium-21265831.js","js/index-2f9ee6b2.js","css/index-3ff7d3de.css"]),"./adapters/yamaha.js":()=>O(()=>import("./yamaha-bfdee317.js"),["js/yamaha-bfdee317.js","js/index-2f9ee6b2.js","css/index-3ff7d3de.css"])},ue=_({name:"ModuleMediaControl",props:["widget","_containerSize","_widgetSize"],setup(e){const o=g(()=>e.widget.config),f=g(()=>({...x.joinConfig(o.value,ee)})),l=g(()=>f.value.adapter.substr(0,f.value.adapter.indexOf("."))),T=h([]),k=h(null),p=g(()=>T.value.find(t=>t.id===k.value)||{}),s=ae({}),F=g(()=>({height:e._containerSize.height-50+"px","background-image":s.cover?"url('"+f.value.coverUrl+s.cover+"')":"none","background-size":f.value.coverMode?"auto 100%":"100% auto",paddingTop:e._containerSize.height-50-50-6+"px"})),G=g(()=>({background:de(ie("primary"),.8)})),W=g(()=>({width:(Math.floor(s.progress/s.duration*e._widgetSize.width)||0)+"px"})),M=h(0),R=h(0),Y=a=>z("progress",Math.round(a.layerX/e._widgetSize.width*s.duration)),J=a=>{M.value=Math.round(a.layerX/e._widgetSize.width*100),R.value=N(M.value/100*s.duration)},P=h({}),m=h({}),C=(a="",t=null)=>(t=t||k.value||"",t?(f.value.adapter+m.value[l.value]._namespace+a).replace("{PLAYER}",t||""):null),V=({val:a})=>{P.value[l.value]&&P.value[l.value].setPlayer&&P.value[l.value].setPlayer(t=>C(t,a),t=>C(t)),k.value=a,U.set("MediaControl.player."+e.widget.id,a)},z=(a,t=!0)=>{if(a==="play"&&p.value?(s.play=!0,V({val:p.value.id})):a==="pause"&&(s.play=!1),m.value[l.value][a]&&m.value[l.value][a].action){const u=C(m.value[l.value][a].action);u&&X.getConnection.setState(u,m.value[l.value][a].setter?m.value[l.value][a].setter(t,C):t).catch(b=>{console.error(b)})}},B=h([]),Z=a=>{if(!B.value.includes(a)){B.value.push(a);const t=X.getConnection;for(const u in m.value[l.value]){let r=m.value[l.value][u];r=typeof r=="string"?{state:r}:r,r&&r.state&&(r.stateKey=u,t.subscribeState(C(r.state),({err:b,state:y})=>{!b&&y&&y.val!==void 0&&(y.val=r.display&&r.display[y.val]||y.val,s[u]=r.convert?r.convert(y.val):y.val)}))}}},L=()=>{P.value[l.value]&&P.value[l.value].getPlayers(f.value.adapter).then(a=>{if(a.length>0){T.value=a;const t=U.get("MediaControl.player."+e.widget.id)||a[0].id,u=t&&a[a.findIndex(r=>r.id===t)];k.value=u?u.id:a[0].id,Z(k.value)}})};let D=null;return oe(()=>{const a=[];for(const t in q){const u=q[t]().then(r=>{const b=t.substr(t.lastIndexOf("/")+1).replace(".js","");return P.value[b]=r,m.value[b]=r.default,!0});a.push(u)}Promise.allSettled(a).then(()=>{L(),D=setInterval(()=>{L()},60*1e3)})}),se(()=>D&&clearInterval(D)),{secondsToHoursMinutesSeconds:N,media:s,cover:F,trackInformation:G,trackProgress:W,updateProgressSetter:J,setProgress:Y,setProgressToTime:R,setProgressToPercent:M,selectPlayer:V,players:T,player:p,set:z,adapterStates:m}}}),pe={class:"full-height"},me={class:"row"},ve={class:"col nowrap ellipsis"},ce={class:"row"},fe={class:"col-grow",style:{overflow:"hidden"}},ye={class:"col-shrink",style:{"text-align":"right"}},ge={class:"track-duration disabled"},he={class:"controls q-pa-sm"},ke={class:"controlsLeft"},Pe={class:"controlsCenter"},be={class:"controlsRight"};function Se(e,o,f,l,T,k){const p=te("inputs");return S(),$("div",pe,[n("div",{class:"cover",style:j(e.cover)},[n("div",{class:"track-information q-pa-sm",style:j(e.trackInformation)},[n("div",me,[n("div",ve,[I(v((e.media.artist||"")+(e.media.album?" - "+e.media.album:""))+" ",1),i(n("span",null,"("+v(e.media.year)+")",513),[[d,e.media.align==="top"&&e.media.year]])])]),n("div",ce,[n("div",fe,[I(v(e.media.track)+" ",1),i(n("span",null,"("+v(e.media.year)+")",513),[[d,e.media.align==="bottom"&&e.media.year]])]),i(n("div",ye,[I(v(e.secondsToHoursMinutesSeconds(e.media.progress))+" ",1),i(n("span",null,"/ "+v(e.secondsToHoursMinutesSeconds(e.media.duration)),513),[[d,e.media.progress&&e.media.duration]])],512),[[d,e.media.progress||e.media.duration]])])],4),i(n("div",{class:"track-duration",onMousemove:o[1]||(o[1]=(...s)=>e.updateProgressSetter&&e.updateProgressSetter(...s)),onClick:o[2]||(o[2]=(...s)=>e.setProgress&&e.setProgress(...s))},[c(le,{anchor:"top middle"},{default:Q(()=>[I(v(e.setProgressToTime)+" ("+v(e.setProgressToPercent)+"%)",1)]),_:1}),n("div",{class:"track-progress",style:j(e.trackProgress),onClick:o[0]||(o[0]=(...s)=>e.setProgress&&e.setProgress(...s))},null,4)],544),[[d,e.media.progress]]),i(n("div",ge,null,512),[[d,!e.media.progress]])],4),n("div",he,[n("div",ke,[e.media.type!=="RADIO"?(S(),A(p,{key:0,type:"button",color:"accent",icon:"mdi-monitor-cellphone-star",tooltip:e.player.name,items:e.players,onOnSelect:e.selectPlayer,selected:e.player.id},null,8,["tooltip","items","onOnSelect","selected"])):w("",!0)]),n("div",Pe,[c(re,null,{default:Q(()=>[e.adapterStates.previous&&e.adapterStates.previous.action?i((S(),A(E,{key:0,color:"primary",onClick:o[3]||(o[3]=s=>e.set("previous")),icon:"mdi-skip-previous"},null,512)),[[d,e.media.type!=="RADIO"]]):w("",!0),c(E,{color:"primary",onClick:o[4]||(o[4]=s=>e.set(e.media.play?"pause":"play")),icon:e.media.play?"mdi-pause":"mdi-play"},null,8,["icon"]),e.adapterStates.next&&e.adapterStates.next.action?i((S(),A(E,{key:1,color:"primary",onClick:o[5]||(o[5]=s=>e.set("next")),icon:"mdi-skip-next"},null,512)),[[d,e.media.type!=="RADIO"]]):w("",!0)]),_:1})]),n("div",be,[e.media.type!=="RADIO"?(S(),$(H,{key:0},[i(c(p,{round:"",onOnClick:o[6]||(o[6]=s=>e.set("shuffle","on")),type:"button",color:"secondary",icon:"mdi-shuffle-disabled",tooltip:"shuffle is off"},null,512),[[d,e.adapterStates.shuffle&&e.media.shuffle==="off"]]),i(c(p,{round:"",onOnClick:o[7]||(o[7]=s=>e.set("shuffle","off")),type:"button",color:"secondary",icon:"mdi-shuffle-variant",tooltip:"shuffle is on"},null,512),[[d,e.adapterStates.shuffle&&e.media.shuffle==="on"]])],64)):w("",!0),e.media.type!=="RADIO"?(S(),$(H,{key:1},[i(c(p,{round:"",onOnClick:o[8]||(o[8]=s=>e.set("repeat","once")),type:"button",color:"secondary",icon:"mdi-repeat-off",tooltip:"repeat off"},null,512),[[d,e.adapterStates.repeat&&e.media.repeat==="off"]]),i(c(p,{round:"",onOnClick:o[9]||(o[9]=s=>e.set("repeat","all")),type:"button",color:"secondary",icon:"mdi-repeat-once",tooltip:"repeat once"},null,512),[[d,e.adapterStates.repeat&&e.media.repeat==="once"]]),i(c(p,{round:"",onOnClick:o[10]||(o[10]=s=>e.set("repeat","off")),type:"button",color:"secondary",icon:"mdi-repeat",tooltip:"repeat all"},null,512),[[d,e.adapterStates.repeat&&e.media.repeat==="all"]])],64)):w("",!0)])])])}var Oe=K(ue,[["render",Se]]);export{Oe as default};
