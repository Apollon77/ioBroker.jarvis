import{dA as E,dB as X,dC as O,bX as Z,cR as ee,b_ as ae,cS as te,c4 as re,c as w,h as j,T as oe,x as ne,cN as T,Y as ce,_ as ie,q as le,cj as ve,aC as se,d8 as de,dD as pe,a4 as y,dE as ge,b7 as ue,B as fe,j as A,o as _,d as P,K as B,a2 as N,k as s,d0 as me,e as u,a as be,w as f,a7 as R,t as C,ad as he,P as ye,a8 as we,a6 as xe,aa as ke,g as Ce,F as De,l as ze,dF as Se,i as je,n as _e,G as Me,dq as Ye}from"./index-5bac7b1d.js";import qe from"./EventList-c48bc37f.js";import{n as Ae}from"./index-79a4e076.js";import{s as Q}from"./index-9730cf52.js";import"./QTooltip-910efa9e.js";import"./___vite-browser-external_commonjs-proxy-0107ae2e.js";import"./_commonjsHelpers-45ea234c.js";function U(e,o){E(2,arguments);var l=X(e),p=O(o);return isNaN(p)?new Date(NaN):(p&&l.setDate(l.getDate()+p),l)}function Pe(e,o){E(2,arguments);var l=O(o);return U(e,-l)}var Be=Z({name:"QInnerLoading",props:{...ee,...ae,showing:Boolean,color:String,size:{type:[String,Number],default:42},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(e,{slots:o}){const l=ne(),p=te(e,l.proxy.$q),{transition:D,transitionStyle:c}=re(e,w(()=>e.showing)),x=w(()=>"q-inner-loading absolute-full column flex-center"+(p.value===!0?" q-inner-loading--dark":"")),m=w(()=>"q-inner-loading__label"+(e.labelClass!==void 0?` ${e.labelClass}`:""));function d(){const g=[j(T,{size:e.size,color:e.color})];return e.label!==void 0&&g.push(j("div",{class:m.value,style:e.labelStyle},[e.label])),g}function r(){return e.showing===!0?j("div",{class:x.value,style:c.value},o.default!==void 0?o.default():d()):null}return()=>j(oe,{name:D.value,appear:!0},r)}});function Ne(e=!1){const o=ce(),l=o.locale.value||o.locale;return e?l.substr(0,2):l}const Qe=le({name:"ModuleCalendar",props:["_size","widget"],components:{EventList:qe},setup(e){const o=Ye.getConnection,l=ve(),p=Ne(!0),D=se(e.widget,"config"),c=de.joinConfig(D.value,pe);c.timezone=c.timezone||"Europe/Amsterdam",c.calendars=c.calendars||[];const x=w(()=>l.dark.isActive),m=y(!1),d=y(new Date);Ae.scheduleJob("0 0 0 * * *",()=>{d.value=new Date});const r=y({year:d.value.getFullYear(),month:d.value.getMonth()+1}),g=({year:a,month:t})=>{(r.value.month!==t||r.value.year!==a)&&(r.value.year=a,r.value.month=t,m.value=F[a+"-"+t]||!1,S(a,t).then(()=>{z()}))},b=Q(Pe(d.value,c.daysReview)),V=Q(U(d.value,c.daysPreview)),h=y([b,V]),W=({date:a})=>{c.calendarAgenda===!1||c.calendarAgenda!==!1&&h.value.length===2?h.value=[a]:a<h.value[0]?h.value.unshift(a):h.value.push(a),z()},H=w(()=>{let[a,t]=h.value;return t=Q(t?a.getMonth()!==t.getMonth()?ge(a):t:a),d.value.getFullYear()!==r.value.year||d.value.getMonth()+1!==r.value.month?[]:[{key:"selectedEnd",highlight:{contentStyle:{backgroundColor:"var(--q-accent)",opacity:1,color:"#fff"}},dates:t,order:102},{key:"selectedStart",highlight:{contentStyle:{backgroundColor:"var(--q-accent)",opacity:1,color:"#fff"}},dates:a,order:101},{key:"selected",highlight:{style:{backgroundColor:"var(--q-accent)",opacity:.3},contentStyle:{color:"var(--q-accent)"}},dates:{start:a,end:t},order:99},{key:"today",highlight:{style:{backgroundColor:"var(--q-primary)"},contentStyle:{color:"#fff",fontWeight:"bold"}},dates:d.value,order:200}]}),$=y([]),I=(a,t)=>{const i=[];L.value.forEach(n=>{!i.some(q=>q.uid===n.uid)&&(n&&n.start>=a&&n.start<=t||n&&n.start<=a&&n.end>=a)&&i.push(n)}),$.value=i},z=()=>{let[a,t]=h.value;if(t=Se(t||a),a.getMonth()===t.getMonth())I(a,t);else{let i=r.value.month+1;const n=i>12?r.value.year+1:r.value.year;i=i>12?1:i,S(n,i).then(()=>{I(a,t)})}},F=y({}),M=y({}),L=w(()=>Object.values(M.value).flat()),G=(a,t,i)=>new Promise((n,q)=>{o.getSpecial("Calendar",{calendar:a,year:t,month:i,options:{...c,language:p}},k=>{if(k.error)return console.warn("Calendar-a99xoa47",e.widget.id,k.error),q(k.error);if(k.events&&Array.isArray(k.events)){const K=k.events.map((v,Oe)=>(v.start=new Date(v.start),v.end=new Date(v.end),{calendar:a,...v,key:v.uid,dot:{style:{backgroundColor:a.color||Me.getPaletteColor("primary")}},popover:{label:v.summary},dates:v.duration<=0?v.start:{start:v.start,end:v.end},customData:{calendar:a,summary:v.summary,time:v.time}}));F[t+"-"+i]=!0,M.value[a.id+":"+t+"-"+i]=K,n(M.value[a.id])}})}),S=(a,t)=>{const i=c.calendars.map(n=>G(n,a,t));return Promise.allSettled(i).then(n=>(m.value=!0,n))};let Y=null;ue(()=>{S(r.value.year,r.value.month).then(()=>{z()}),Y=setInterval(()=>{console.debug("Calendar-d53dca17",e.widget.id,"Refreshing ical data..."),S(r.value.year,r.value.month).then(()=>{z()})},c.refresh*60*1e3)}),fe(()=>Y&&clearInterval(Y));const J=w(()=>[...L.value,...H.value]);return{loaded:m,language:p,isDarkMode:x,moduleConfig:c,setDate:g,setRange:W,attributes:J,agenda:$}}}),$e={style:{position:"relative"}},Ie={class:"text-h6"},Fe=je(' /* :timezone="moduleConfig.timezone" trim-weeks: By default, calendar panes always displays the maximum number of weeks in a month, even if the max week does not contain any days in the current month displayed. */ '),Le={class:"text-xs text-gray-300 font-semibold"},Re={class:"Calendar-Popover-List"};function Ee(e,o,l,p,D,c){const x=A("event-list"),m=A("icon"),d=A("v-calendar");return _(),P("div",null,[B(s(me,{indeterminate:""},null,512),[[N,!e.loaded]]),u("div",$e,[e.moduleConfig.calendarAgenda===!1?(_(),be(ke,{key:0,"model-value":e.popup,onHide:o[1]||(o[1]=r=>e.popup=!1)},{default:f(()=>[s(xe,{style:{width:"800px","max-width":"80vw"}},{default:f(()=>[s(R,{class:"row items-center"},{default:f(()=>[u("div",Ie,C(e.$t("Calendar Details")),1),s(he),s(ye,{flat:"",round:"",color:"grey",icon:"close",onClick:o[0]||(o[0]=r=>e.popup=!1)})]),_:1}),s(we),s(R,{class:"col q-pa-none scroll body"},{default:f(()=>[s(x,{agenda:e.agenda},null,8,["agenda"])]),_:1})]),_:1})]),_:1},8,["model-value"])):Ce("",!0),B(u("div",null,[s(d,{"onUpdate:toPage":e.setDate,onDayclick:e.setRange,class:"Calendar",attributes:e.attributes,"is-dark":e.isDarkMode,locale:e.language,masks:{dayPopover:"WWW, D. MMMM YYYY"},"trim-weeks":"","show-iso-weeknumbers":"","disable-page-swipe":""},{"header-title":f(({monthLabel:r,year:g})=>[u("div",null,C(r+" "+g),1),s(m,{name:"mdi-calendar-cursor",size:"xs",class:"q-ml-xs"})]),"day-popover":f(({dayTitle:r,attributes:g})=>[u("div",null,[u("strong",Le,C(r),1),u("ul",Re,[(_(!0),P(De,null,ze(g,b=>(_(),P("li",{key:b.key+"-"+(b.customData.calendar.color||""),style:_e({color:b.customData.calendar.color||"var(--q-primary)"})},[u("span",null,C(b.customData.time)+", "+C(b.customData.summary),1)],4))),128))])])]),default:f(()=>[Fe]),_:1},8,["onUpdate:toPage","onDayclick","attributes","is-dark","locale","masks"]),s(Be,{showing:!e.loaded},{default:f(()=>[s(T,{size:"50px",color:"primary"})]),_:1},8,["showing"])],512),[[N,e.moduleConfig.calendarPreview!==!1]]),B(s(x,{agenda:e.agenda},null,8,["agenda"]),[[N,e.moduleConfig.calendarAgenda!==!1]])])])}var Ke=ie(Qe,[["render",Ee]]);export{Ke as default};
