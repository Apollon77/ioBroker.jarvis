import{bt as V,a4 as Y,bN as $,Q as C,dc as R,dM as W,k as p,aY as G,am as Z,aq as q,aZ as X,aG as J,ay as u,W as v,X as f,V as m,a2 as j,U as H,cQ as S,D as y,a1 as K,cI as T,dN as x,du as b}from"./index-7061e6d4.js";var L={};Object.defineProperty(L,"__esModule",{value:!0});const B=90.8333,E=360/24,ee=60*60*1e3;function te(e){return Math.ceil((e.getTime()-new Date(e.getFullYear(),0,1).getTime())/864e5)}function O(e){return Math.sin(e*2*Math.PI/360)}function z(e){return Math.acos(e)*360/(2*Math.PI)}function ae(e){return Math.asin(e)*360/(2*Math.PI)}function se(e){return Math.tan(e*2*Math.PI/360)}function P(e){return Math.cos(e*2*Math.PI/360)}function A(e,n){const o=e%n;return o<0?o+n:o}function F(e,n,o,a,i){const d=te(i),c=n/E,h=o?d+(6-c)/24:d+(18-c)/24,D=.9856*h-3.289,g=A(D+1.916*O(D)+.02*O(2*D)+282.634,360),N=.91764*se(g);let r;r=360/(2*Math.PI)*Math.atan(N),r=A(r,360);const k=Math.floor(g/90)*90,I=Math.floor(r/90)*90;r=r+(k-I),r/=E;const l=.39782*O(g),M=P(ae(l)),_=(P(a)-l*O(e))/(M*P(e)),s=(o?360-z(_):z(_))/E+r-.06571*h-6.622,Q=A(s-n/E,24),U=Date.UTC(i.getFullYear(),i.getMonth(),i.getDate());return new Date(U+Q*ee)}function ne(e,n,o=new Date){return F(e,n,!0,B,o)}function oe(e,n,o=new Date){return F(e,n,!1,B,o)}var ie=L.getSunrise=ne,re=L.getSunset=oe;const le=Y({name:"ModuleDateTime",props:["widget","_containerSize","_widgetSize"],setup(e){const n=$(),o=C(()=>e.widget.config),a=C(()=>{const t=R.joinConfig(o.value,W);return{...t,refresh:t.formatDate.indexOf("s")>-1||t.formatTime.indexOf("s")>-1?1:t.formatDate.indexOf("m")>-1||t.formatTime.indexOf("m")>-1?10:60}});let i=0;const d=p(null),c=p(null),h=p(null),D=p(null),g=p(null),N=C(()=>n.meta.city),r=C(()=>{const{latitude:t,longitude:s}=n.meta;return!t||!s?null:[t,s]}),k=t=>{if(a.value.sun!==!1&&r.value!==null)try{const s=new Date(t);h.value=T(ie(...r.value,s),"HH:mm"),D.value=T(re(...r.value,s),"HH:mm")}catch(s){console.warn("DateTime",s.message||s)}},I=t=>{try{const s=new Date(t);d.value=a.value.formatDate?T(s,a.value.formatDate.replace(/(?:\r|\n|\r\n)/g,"'<br />'")):null,c.value=a.value.formatTime?T(s,a.value.formatTime.replace(/(?:\r|\n|\r\n)/g,"'<br />'")):null,g.value=x(s)}catch(s){console.log("DateTime",s.message||s),d.value=a.value._defaults.formatDate?T(new Date,a.value._defaults.formatDate):null,c.value=a.value._defaults.formatTime?T(new Date,a.value._defaults.formatTime):null}};G(r,()=>k(i));let l=null;const M=()=>{a.value.refresh&&a.value.refresh>0&&(l&&clearInterval(l),l=setInterval(()=>{i=i+a.value.refresh*1e3,I(i)},a.value.refresh*1e3))};Z(()=>{!l&&M(),b.getConnection.send("getTime",null,w)}),q(()=>{l&&clearInterval(l),l=null});let _=null;const w=t=>{i=parseInt(t),I(i),k(i),l&&clearInterval(l),M()};return X(()=>{if(e.widget.revision!==_){_=e.widget.revision;const t=b.getConnection;t.send("getTime",null,w),t.on("_timestamp",w)}}),{moduleConfig:a,date:d,time:c,sunrise:h,sunset:D,week:g,city:N}}}),ce={class:"jarvis-DateTime-Clock"},ue=["innerHTML"],me=["innerHTML"],de={class:"row jarvis-DateTime-Details"},ve={key:0,class:"jarvis-DateTime-Details-Item"},fe={class:"jarvis-DateTime-Details-Item-City"},De={key:1,class:"jarvis-DateTime-Details-Item"},ge={class:"jarvis-DateTime-Details-Item-Sunrise"},Te={key:2,class:"jarvis-DateTime-Details-Item"},he={class:"jarvis-DateTime-Details-Item-Sunset"},_e={key:3,class:"jarvis-DateTime-Details-Item"},pe={class:"jarvis-DateTime-Details-Item-Week"};function ye(e,n,o,a,i,d){const c=J("icon");return u(),v("div",{key:e.widget.revision,class:"jarvis-DateTime-Container"},[f("div",ce,[e.date?(u(),v("span",{key:0,class:"jarvis-DateTime-Clock-Date",innerHTML:e.date},null,8,ue)):m("",!0),e.time?(u(),v("span",{key:1,class:"jarvis-DateTime-Clock-Time",innerHTML:e.time},null,8,me)):m("",!0)]),f("div",de,[e.moduleConfig.city!==!1?(u(),v("div",ve,[j(c,{size:"xs",name:"mdi-city-variant-outline",class:"jarvis-DateTime-Details-Icon"}),e.city?m("",!0):(u(),H(S,{key:0,color:"primary"})),f("span",fe,y(e.city),1)])):m("",!0),e.moduleConfig.sun!==!1?(u(),v("div",De,[j(c,{size:"xs",name:"mdi-weather-sunset-up",class:"jarvis-DateTime-Details-Icon"}),e.sunrise?m("",!0):(u(),H(S,{key:0,color:"primary"})),f("span",ge,y(e.sunrise),1)])):m("",!0),e.moduleConfig.sun!==!1?(u(),v("div",Te,[j(c,{size:"xs",name:"mdi-weather-sunset-down",class:"jarvis-DateTime-Details-Icon"}),e.sunset?m("",!0):(u(),H(S,{key:0,color:"primary"})),f("span",he,y(e.sunset),1)])):m("",!0),e.moduleConfig.calendarweek!==!1?(u(),v("div",_e,[j(c,{size:"xs",name:"mdi-calendar-week",class:"jarvis-DateTime-Details-Icon"}),e.week?m("",!0):(u(),H(S,{key:0,color:"primary"})),f("span",pe,[f("span",null,y(e.$t("CW")),1),K(" "+y(e.week),1)])])):m("",!0)])])}var Ie=V(le,[["render",ye]]);export{Ie as default};
