var ve=Object.defineProperty,pe=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var ee=(e,i,C)=>i in e?ve(e,i,{enumerable:!0,configurable:!0,writable:!0,value:C}):e[i]=C,D=(e,i)=>{for(var C in i||(i={}))he.call(i,C)&&ee(e,C,i[C]);if(x)for(var C of x(i))me.call(i,C)&&ee(e,C,i[C]);return e},G=(e,i)=>pe(e,ge(i));import{Q as ye}from"./QSpace-72ed55b6.js";import{x as le,ab as fe,cB as ae,a as F,de as Q,a0 as W,cJ as Y,ai as Ce,_ as se,df as Se,dd as be,m as j,o as l,f as b,g as a,N as g,ah as f,q as t,w as y,F as q,s as ie,b as m,R as B,ag as we,j as de,t as O,k as p,O as ne,cX as Oe,ad as oe,U as N,c5 as Ie,v as Z,u as X,aq as _,l as z,al as V,S as $e,C as ke,aj as De,ak as te,am as Ke,a8 as Le}from"./index-0a47fe55.js";import{Q as Ee}from"./QExpansionItem-45cacdb1.js";import{D as Me,a as Be,u as Ve}from"./useDragDrop-e9c8bf55.js";const Ae=le({name:"WidgetDevicesSection",props:["module","itemList"],emits:["onChange"],components:{Draggable:Me},setup(e,{emit:i}){const C=fe(),L=ae(),I=F(()=>Q.Settings[e.module]||{}),$=F(()=>L.devices),d=o=>$.value[o],K=o=>$.value[o.deviceId].function==="other"?"_defaults":$.value[o.deviceId].function,s=o=>Object.keys($.value[o].states)||[],n=o=>s(o).map(c=>({label:c,value:c})),r=o=>E[o].devices.length!==0,E=L.getGroups("function"),P=W(Object.values(E)),H=o=>!I.value.addDevice||I.value.addDevice&&(!I.value.addDevice.fields||I.value.addDevice.fields&&I.value.addDevice.fields.includes(o)),T=(o,c)=>{const S=Object.values(o?L.getGroups("function",o):E);c(()=>{P.value=S})},U=(o,c,S)=>{const M=$.value[o.deviceId]&&$.value[o.deviceId].states[o[S+"StateKey"]]||{},A=o[c+"Element"];return Se(M[A+"Config"]||{},o[A+"Config"]&&o[A+"Config"][S]||{})},v=W(Y(e.itemList)),u=(o,c=null)=>{const S=be(),M=G(D({},o),{id:S});if(c===null){if(o.type==="device"){const A=s(o.deviceId)[0]||null;M.primaryStateKey=A,M.bodyStateKey=A,M.bodyElement="LastChangeBody"}v.value.push(M)}else v.value.splice(c,0,M);i("onChange",{id:"items",value:v.value})},h=o=>{const c=Y(v.value.find(S=>S.id===o));u(c,v.value.findIndex(S=>S.id===c.id)+1)},w=o=>{confirm(C.t("Really delete item?"))&&(delete v.value[v.value.findIndex(S=>S.id===o)],i("onChange",{id:"items",value:v.value}))},k=W(),R=o=>{(!o.attributes||o.attributes&&o.attributes.deleted!==!0)&&(u({type:"device",deviceId:o.id}),I.value.addDevice&&I.value.addDevice.max!==void 0&&I.value.addDevice.max<=v.value.length&&k.value.hidePopup())},J=W({}),ue=()=>{u({type:"group",name:J.value}),J.value={}},re=()=>u({type:"divider"}),ce=o=>{if(o.id&&o.itemId){const c=v.value.findIndex(S=>S.id===o.itemId);if(c>-1){if(o.id.indexOf("moduleConfig.")>-1)v.value[c].moduleConfig=G(D({},v.value[c].moduleConfig||{}),{[o.id.replace("moduleConfig.","")]:o.value});else if(o.id==="componentOptions"){const S=o.stateKey||v.value[c].primaryStateKey;v.value[c][o.component+"Config"]=G(D({},v.value[c][o.component+"Config"]||{}),{[S]:D(D({},v.value[c][o.component+"Config"]&&v.value[c][o.component+"Config"][S]||{}),o.value)})}else v.value[c][o.id]=o.value;i("onChange",{id:"items",value:v.value})}}};return G(D({},Be()),{FunctionsComponentsList:Ce.ComponentsListAsOptions,ModuleSettings:I,onFilter:T,shallBeShown:H,deviceList:$,getDevice:d,getDeviceFunction:K,getDeviceStates:s,getDeviceStatesOptions:n,hasDevices:r,onChange:ce,isInGroup:!1,group:J,addGroup:ue,addDivider:re,addDevice:R,items:v,addItem:u,copyItem:h,deleteItem:w,componentValues:U,addDeviceElement:k,optionsAddDevice:E,optionGroupsAddDevice:P})}}),Ge={class:"full-width"},Qe={class:"row sticky body"},We={class:"col-4"},Fe=z("\xA0"),je={key:0},qe={class:"col-3"},Ne={"slot:end":""},Pe={class:"col-3",style:{"line-height":"70px"}},Te={class:"row"},Ue=["set"],ze={class:"row items-center"},He={key:0},Re={key:1},Je={key:2},Xe={key:3,class:"row nowrap"},Ye={key:0,class:"row nowrap"},Ze={key:1,class:"row nowrap"},_e={key:2,class:"row nowrap"};function xe(e,i,C,L,I,$){const d=j("inputs"),K=j("icon"),s=j("draggable");return l(),b("div",Ge,[a("div",Qe,[a("div",We,[g(t(oe,{onFilter:e.onFilter,ref:"addDeviceElement",label:e.$t("Add Device"),options:e.optionGroupsAddDevice,"model-value":"","use-input":"","stack-label":"",style:{margin:"0 8px"}},{option:y(n=>[t(Ee,{"expand-separator":"","header-class":"text-weight-bold",label:n.opt.label,icon:n.opt.icon},{default:y(()=>[(l(!0),b(q,null,ie(n.opt.devices,r=>g((l(),m(ne,{key:r.id,clickable:"",onClick:E=>e.addDevice(r)},{default:y(()=>[t(B,null,{default:y(()=>[t(we,{class:"q-ml-md"},{default:y(()=>[a("span",{class:de({"text-strike":r.attributes&&r.attributes.deleted===!0})},O(r.label?r.label+" ("+r.name+")":r.name),3),Fe,r.attributes&&r.attributes.deleted===!0?(l(),b("em",je,"[ "+O(e.$t("deleted"))+" ]",1)):p("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[Oe]])),128))]),_:2},1032,["label","icon"])]),_:1},8,["onFilter","label","options"]),[[f,e.ModuleSettings.addDevice!==!1&&(!e.ModuleSettings.addDevice||e.ModuleSettings.addDevice&&(e.ModuleSettings.addDevice.max===void 0||e.ModuleSettings.addDevice.max>e.items.length))]])]),g(a("div",{class:"col-1",style:{"text-align":"center","line-height":"70px"}},O(e.$t("or")),513),[[f,e.ModuleSettings.addGroup!==!1]]),g(a("div",qe,[t(d,{label:"Add Group",onOnChange:i[0]||(i[0]=n=>e.group=arguments[0]),onKeyup:Ie(e.addGroup,["enter"]),value:e.group.value||""},{default:y(()=>[a("template",Ne,[g(t(N,{flat:"",size:"sm",dense:"",icon:"mdi-check",label:e.$t("add group"),style:{height:"32px","min-width":"100px","margin-top":"16px"},onClick:e.addGroup},null,8,["label","onClick"]),[[f,e.group.value]])])]),_:1},8,["onKeyup","value"])],512),[[f,e.ModuleSettings.addGroup!==!1]]),g(a("div",{class:"col-1",style:{"text-align":"center","line-height":"70px"}},O(e.$t("or")),513),[[f,e.ModuleSettings.addDivider!==!1]]),g(a("div",Pe,[t(N,{icon:"mdi-minus",label:e.$t("Add Divider"),color:"primary",onClick:e.addDivider},null,8,["label","onClick"])],512),[[f,e.ModuleSettings.addDivider!==!1]])]),a("div",Te,[t($e,{ref:"deviceListElement",class:"full-width",style:{"margin-top":"16px"}},{default:y(()=>[t(s,Z({class:"list-group",tag:"transition-group","component-data":{tag:"div",type:"transition",name:e.drag?null:"flip-list"},modelValue:e.items,"onUpdate:modelValue":i[1]||(i[1]=n=>e.items=n)},e.dragOptions,{onStart:i[2]||(i[2]=n=>e.drag=!0),onEnd:i[3]||(i[3]=n=>e.drag=!1),"item-key":"id",handle:".dragndrop"}),{item:y(({element:n})=>[(l(),b("div",{key:n.id,set:e.isInGroup=n.type==="device"?e.isInGroup:n.type==="divider"?!1:n.type==="group"},[t(ne,null,{default:y(()=>[t(B,{avatar:""},{default:y(()=>[a("div",ze,[g(t(K,{name:"mdi-drag-horizontal",class:"dragndrop",style:{"padding-right":"16px"}},null,512),[[f,e.items.length>1]]),t(d,{type:"button",dense:"",icon:"mdi-content-copy",tooltip:e.$t("copy"),onClick:X(r=>e.copyItem(n.id),["stop"])},null,8,["tooltip","onClick"]),g(t(d,{type:"button",dense:"",icon:"mdi-delete",tooltip:e.$t("delete"),color:"negative",onClick:X(r=>e.deleteItem(n.id),["stop"])},null,8,["tooltip","onClick"]),[[f,n._deleted!==!0]]),g(t(d,{type:"button",dense:"",icon:"mdi-restore",tooltip:e.$t("restore"),color:"positive",onClick:X(r=>e.restoreItem(n.id),["stop"]),class:"restore"},null,8,["tooltip","onClick"]),[[f,n._deleted===!0]])])]),_:2},1024),n.type!=="device"||n.type==="device"&&e.deviceList[n.deviceId]!==void 0?(l(),b(q,{key:0},[e.ModuleSettings.customBodySection?(l(),m(B,{key:0},{default:y(()=>[(l(),m(_(e.ModuleSettings.customBodySection),Z(D(D({},e.$props),e.$attrs),{onOnChange:e.onChange,item:n,device:e.deviceList[n.deviceId]}),null,16,["onOnChange","item","device"]))]),_:2},1024)):(l(),m(B,{key:1},{default:y(()=>[n.type==="divider"?(l(),b("span",He,[a("em",null,O("("+e.$t("divider")+")"),1)])):p("",!0),n.type==="group"?(l(),b("span",Re,[a("strong",null,O(n.name),1)])):p("",!0),n.type==="device"?(l(),b("span",Je,[a("strong",null,O(e.deviceList[n.deviceId].name),1),z(" ("+O(e.deviceList[n.deviceId].function+", #"+n.deviceId)+")",1)])):p("",!0),n.type==="device"?(l(),b("div",Xe,[e.shallBeShown("label")?(l(),m(d,{key:0,dense:"",onOnChange:e.onChange,label:"Label",itemId:n.id,id:"label",json:"",value:n.label||"",placeholder:e.deviceList[n.deviceId].states[n.bodyStateKey]&&e.deviceList[n.deviceId].states[n.bodyStateKey].label?JSON.stringify(e.deviceList[n.deviceId].states[n.bodyStateKey].label):e.deviceList[n.deviceId].name},null,8,["onOnChange","itemId","value","placeholder"])):p("",!0),e.shallBeShown("bodyStateKey")?(l(),m(d,{key:1,dense:"",style:{width:"130px"},onOnSelect:e.onChange,label:"Body State",itemId:n.id,id:"bodyStateKey",value:n.bodyStateKey,type:"select",options:e.getDeviceStatesOptions(n.deviceId)},null,8,["onOnSelect","itemId","value","options"])):p("",!0),e.shallBeShown("bodyElement")?g((l(),m(d,{key:2,dense:"",style:{width:"230px"},onOnSelect:e.onChange,onOnOptions:e.onChange,id:"bodyElement",label:"Body Element",state:e.deviceList[n.deviceId].states[n.bodyStateKey],stateKey:n.bodyStateKey,itemId:n.id,value:n.bodyElement,type:"select.components",components:e.FunctionsComponentsList.bodyElements[e.getDeviceFunction(n)],componentValues:e.componentValues(n,"body",n.bodyStateKey)},null,8,["onOnSelect","onOnOptions","state","stateKey","itemId","value","components","componentValues"])),[[f,n.bodyStateKey]]):p("",!0)])):p("",!0)]),_:2},1024)),e.ModuleSettings.customActionSection?(l(),m(B,{key:2,side:""},{default:y(()=>[(l(),m(_(e.ModuleSettings.customActionSection),{onOnChange:e.onChange,item:n,device:e.deviceList[n.deviceId]},null,8,["onOnChange","item","device"]))]),_:2},1024)):(l(),m(B,{key:3,side:""},{default:y(()=>[n.type==="group"?(l(),b("div",Ye,[t(d,{dense:"",style:{width:"100px"},onOnChange:e.onChange,label:e.$t("Group Actions"),itemId:n.id,id:"actions",value:n.actions||!1,type:"switch"},null,8,["onOnChange","label","itemId","value"]),e.shallBeShown("groupElement")?g((l(),m(d,{key:0,dense:"",style:{width:"200px"},onOnSelect:e.onChange,onOnOptions:e.onChange,id:"groupElement",label:"Group Element",stateKey:"group",itemId:n.id,value:n.groupElement,type:"select.components",components:e.FunctionsComponentsList.actionElements._defaults.filter(r=>r.value!=="InputAction"&&r.value!=="DropdownAction"),componentValues:e.componentValues(n,"group","group")},null,8,["onOnSelect","onOnOptions","itemId","value","components","componentValues"])),[[f,n.actions===!0]]):p("",!0)])):p("",!0),n.type==="device"?(l(),b("div",Ze,[e.shallBeShown("primaryStateKey")?(l(),m(d,{key:0,dense:"",style:{width:"130px"},onOnSelect:e.onChange,label:"Action State",itemId:n.id,id:"primaryStateKey",value:n.primaryStateKey,type:"select",options:e.getDeviceStatesOptions(n.deviceId)},null,8,["onOnSelect","itemId","value","options"])):p("",!0),e.shallBeShown("showState")?g((l(),m(d,{key:1,dense:"",style:{width:"100px"},onOnChange:e.onChange,label:"Show State",itemId:n.id,id:"showState",value:n.showState!==void 0?n.showState:!0,type:"switch"},null,8,["onOnChange","itemId","value"])),[[f,n.primaryStateKey]]):p("",!0),e.shallBeShown("showGroupAction")?g((l(),m(d,{key:2,dense:"",style:{width:"100px"},onOnChange:e.onChange,label:"Use in Actions",itemId:n.id,id:"useInGroup",value:n.useInGroup!==void 0?n.useInGroup:!0,type:"switch"},null,8,["onOnChange","itemId","value"])),[[f,n.primaryStateKey&&e.isInGroup===!0]]):p("",!0),e.shallBeShown("actionElement")?g((l(),m(d,{key:3,dense:"",style:{width:"200px"},onOnSelect:e.onChange,onOnOptions:e.onChange,id:"actionElement",label:"Action Element",state:e.deviceList[n.deviceId].states[n.primaryStateKey],stateKey:n.primaryStateKey,itemId:n.id,value:n.actionElement,type:"select.components",components:e.FunctionsComponentsList.actionElements[e.getDeviceFunction(n)],componentValues:e.componentValues(n,"action",n.primaryStateKey)},null,8,["onOnSelect","onOnOptions","state","stateKey","itemId","value","components","componentValues"])),[[f,n.primaryStateKey]]):p("",!0)])):p("",!0),n.type==="device"?(l(),b("div",_e,[e.shallBeShown("secondaryStatesKeys")?(l(),m(oe,{key:0,"stack-label":"",dense:"",style:{width:"430px"},"onUpdate:modelValue":r=>e.onChangeSecondaryStatesKeys(n.id,arguments[0]),label:e.$t("Secondary State"),"model-value":n.secondaryStatesKeys,options:e.getDeviceStatesOptions(n.deviceId),"use-chips":"",multiple:""},null,8,["onUpdate:modelValue","label","model-value","options"])):p("",!0)])):p("",!0)]),_:2},1024))],64)):(l(),m(B,{key:1},{default:y(()=>[z(O(e.$t("Device not found")+" ("+e.$t("Device ID")+": "+n.deviceId+")"),1)]),_:2},1024))]),_:2},1024),t(V)],8,Ue))]),_:1},16,["component-data","modelValue"])]),_:1},512)])])}var en=se(Ae,[["render",xe],["__scopeId","data-v-20ff9d78"]]);const nn=le({name:"WidgetPage",props:["widgetId"],emits:["onClose"],components:{WidgetDevicesSection:en},setup(e,{emit:i}){const C=ae(),{errors:L,hasErrors:I,addError:$,removeError:d,resetErrors:K}=Ve({module:"Empty"}),s=W(null);ke(()=>e.widgetId,u=>{u?(s.value=C.widgets[u]?Y(C.widgets[u]):{id:u,config:{}},s.value.module&&d("module")):s.value=null});const n=Q.ModuleList.map(u=>({label:u,value:u})),r=F(()=>Q.Configurations[s.value.module]&&Q.Configurations[s.value.module].default||[]),E=F(()=>Q.Settings[s.value.module]||{}),P=F(()=>{const u={};return r.value.forEach(h=>{if(s.value.config[h.parameter]===void 0){const w=typeof h.value=="function"?h.value(s.value):h.value;T({id:"config."+h.parameter,value:w}),u[h.parameter]=w}else u[h.parameter]=s.value.config[h.parameter]}),u}),H=u=>u?Object.keys(u).some(h=>{const w=Array.isArray(u[h])?u[h]:[u[h]],k=s.value.config[h]===void 0?r.value.find(R=>R.parameter===h).value:s.value.config[h];return w.includes(k)}):!0,T=u=>{const{_error:h,id:w,value:k}=u;h?$(w,h):w!==void 0&&k!==void 0&&w.indexOf("config.")!==-1?(s.value.config[w.replace("config.","")]=k,d(w)):w!==void 0&&k!==void 0&&(s.value[w]=k,d(w),w==="module"&&(K(),s.value.config={}))},U=(u=null)=>{i("onClose",u),s.value=null,K()};return{ModuleList:n,ModuleConfigurations:r,ModuleSettings:E,ModuleConfigValues:P,errors:L,hasErrors:I,dependencies:H,widget:s,onChange:T,onCancel:U,onSave:()=>{C.addWidget({widget:s.value}),U(s.value)}}}}),on={class:"text-h6 row items-center"},tn={class:"text-h6 primary q-ma-sm"},ln={class:"row"},an={class:"col"},sn={class:"col"},dn={class:"col"},un={class:"col-2"},rn={class:"col-1"},cn={class:"text-h6 primary q-ma-sm"},vn={class:"row"},pn={class:"col-3"},gn={class:"col-9"},hn={class:"text-h7 primary q-ma-sm"},mn={class:"row"},yn={class:"row"},fn={class:"q-pa-sm"},Cn={key:0,class:"row"},Sn={class:"text-h7 primary q-ma-sm"},bn={class:"row"};function wn(e,i,C,L,I,$){const d=j("inputs"),K=j("widget-devices-section");return l(),m(Le,{"model-value":e.widget!==null,"full-height":"",persistent:""},{default:y(()=>[e.widget!==null?(l(),m(De,{key:0,class:"column full-height",style:{width:"1400px","max-width":"90vw"}},{default:y(()=>[t(te,{class:"row items-center"},{default:y(()=>[a("div",on,[z(O(e.$t("Widget"))+": ",1),t(d,{dense:"",onOnChange:e.onChange,id:"title",label:e.$t("Name"),value:e.widget.title||"",autofocus:"",style:{width:"230px"}},null,8,["onOnChange","label","value"])]),t(ye),t(N,{flat:"",round:"",color:"grey",icon:"close",onClick:e.onCancel},null,8,["onClick"])]),_:1}),t(V),t(te,{id:"WidgetDialogBody",class:"col scroll body"},{default:y(()=>[a("div",tn,O(e.$t("Widget-Box")),1),t(V,{style:{margin:"0 -16px"}}),a("div",ln,[a("div",an,[t(d,{onOnChange:e.onChange,id:"icon",label:e.$t("Widget")+" "+e.$t("Icon"),value:e.widget.icon||e.ModuleSettings.icon||"",icon:e.widget.icon},null,8,["onOnChange","label","value","icon"])]),a("div",sn,[t(d,{onOnChange:e.onChange,id:"label",label:e.$t("Widget")+" "+e.$t("Label"),value:e.widget.label||"",placeholder:e.widget.title},null,8,["onOnChange","label","value","placeholder"])]),a("div",dn,[t(d,{onOnChange:e.onChange,id:"link",label:e.$t("Widget")+" "+e.$t("Link"),value:e.widget.link||"",info:"config#HomeKitTile#jumper#info"},null,8,["onOnChange","label","value"])]),a("div",un,[t(d,{type:"switch",onOnChange:e.onChange,id:"hideTitle",label:e.$t("Hide Widget Label and Icon"),value:e.widget.hideTitle||!1},null,8,["onOnChange","label","value"])]),a("div",rn,[g(t(d,{type:"switch",onOnChange:e.onChange,id:"hideSeparator",label:e.$t("Hide Separator"),value:e.widget.hideSeparator||!1},null,8,["onOnChange","label","value"]),[[f,e.widget.hideTitle!==!0]])])]),a("div",cn,O(e.$t("Module")),1),t(V,{style:{margin:"0 -16px"}}),a("div",vn,[a("div",pn,[t(d,{onOnSelect:e.onChange,id:"module",label:e.$t("Module"),type:"select",options:e.ModuleList,value:e.widget.module,"options-dense":"","use-input":"",required:"",error:e.errors.module!==void 0,"error-message":e.errors.module},null,8,["onOnSelect","label","options","value","error","error-message"])]),a("div",gn,[g(a("div",{class:"centered"},O(e.$t(e.widget.module+"#description")),513),[[f,e.widget.module]])])]),g(a("div",null,[a("div",hn,O(e.$t("Module Configuration")),1),t(V,{style:{margin:"0 0 8px 0"}}),g(a("div",mn,[(l(!0),b(q,null,ie(e.ModuleConfigurations,s=>(l(),b(q,null,[s.hide!==!0?g((l(),b("div",{class:de("col-"+(s.columns||4)),key:s.parameter},[t(d,Z(s,{onOnChange:e.onChange,onOnSelect:e.onChange,id:"config."+s.parameter,value:e.ModuleConfigValues[s.parameter]}),null,16,["onOnChange","onOnSelect","id","value"])],2)),[[f,e.dependencies(s.dependencies)]]):p("",!0)],64))),256))],512),[[f,e.ModuleConfigurations.length>0]]),g(a("div",yn,[a("p",fn,O(e.$t("No configuration options for this module")),1)],512),[[f,e.ModuleConfigurations.length===0]]),e.ModuleSettings&&e.ModuleSettings.customConfiguration?(l(),b("div",Cn,[(l(),m(_(e.ModuleSettings.customConfiguration),{config:e.widget.config,onOnChange:e.onChange},null,8,["config","onOnChange"]))])):p("",!0),e.ModuleSettings.addDevice!==!1?(l(),b(q,{key:1},[a("div",Sn,O(e.$t("Module Devices")),1),t(V,{style:{margin:"0 -0 8px 0"}}),a("div",bn,[t(K,{onOnChange:e.onChange,ModuleConfigValues:e.ModuleConfigValues,itemList:e.widget.items||[],module:e.widget.module},null,8,["onOnChange","ModuleConfigValues","itemList","module"])])],64)):p("",!0)],512),[[f,e.widget.module]])]),_:1}),t(V),t(Ke,{align:"right"},{default:y(()=>[t(N,{flat:"",label:e.$t("Cancel"),color:"negative",onClick:e.onCancel},null,8,["label","onClick"]),t(N,{flat:"",label:e.$t("Apply"),color:"primary",onClick:e.onSave,disable:e.hasErrors},null,8,["label","onClick","disable"])]),_:1})]),_:1})):p("",!0)]),_:1},8,["model-value"])}var Kn=se(nn,[["render",wn],["__scopeId","data-v-4d6e9b86"]]);export{Kn as W};
