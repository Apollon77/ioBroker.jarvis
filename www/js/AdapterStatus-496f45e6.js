import{Q as L}from"./QTooltip-d5ee9f2c.js";import{_ as T,q as N,dl as R,H as D,de as V,W as q,c as k,a2 as S,j as F,bD as H,k as a,w as t,J as b,a1 as h,L as $,o as u,a as v,i,t as s,g as m,M as r,Z as _,d as A,l as z,e as C,cM as G,I as J,N as I,f as O,Q as E,F as K,d5 as P,dw as W,K as Z}from"./index-bdb9984b.js";import{Q as X}from"./QBadge-4bab2fc4.js";const Y=N({name:"ModuleAdapterStatus",props:["widget"],setup(l){const y=R.getConnection;D();const c=V(),M=q(),g=k(()=>l.widget.config),p=k(()=>({...P.joinConfig(g.value,W),list:g.value.list?g.value.list.replace(/, /g,",").toLowerCase().split(","):null,blacklist:g.value.blacklist?g.value.blacklist.replace(/, /g,",").toLowerCase().split(","):null})),n=k(()=>{let d=c.instances;if(d=d&&d.val&&!d.val.error?{...d.val}:{},p.value.list)for(const o in d){const f=o.substr(0,o.indexOf("."));!p.value.list.includes(o)&&!p.value.list.includes(f)&&delete d[o]}else if(p.value.blacklist)for(const o in d){const f=o.substr(0,o.indexOf("."));(p.value.blacklist.includes(o)||p.value.blacklist.includes(f))&&delete d[o]}return d}),e=S([]),U=S([]);y.subscribeState("admin.0.info.updatesList",({err:d,state:o})=>{if(console.debug("admin.0.info.updatesList",o),o){const f=o&&o.val?o.val.replace("js-controller,","").replace("js-controller",""):"";e.value=f?f.split(","):[],U.value=e.value.map(w=>n.value[w+".0"]?n.value[w+".0"].title+" ("+n.value[w+".0"].name+")":w).join(", ")}});const Q=S({}),j=(d,o)=>{Q.value[d]=!0,y.setAdapter(d,o).then(()=>{c.join("instances",{val:{...c.instances.val,[d]:{...c.instances.val[d],enabled:o}},ts:Date.now()})}).catch(f=>{console.error(f)}).finally(()=>{Q.value[d]=!1})},B=k(()=>M.locale.substr(0,2));return{activeRepo:k(()=>c.meta.activeRepo),adapterUpdates:e,adapterUpdateList:U,instances:n,language:B,loading:Q,moduleConfig:p,onSet:j}}}),x=C("br",null,null,-1),ee=i(", "),le={class:"UpdateAvailable"},ae={key:1},te={key:2};function oe(l,y,c,M,g,p){const n=F("icon");return H([l.widget.revision],()=>a(I,null,{default:t(()=>[b(a($,{class:"UpdateAvailableListItem",style:{"background-color":"var(--q-accent)"}},{default:t(()=>[l.adapterUpdateList.length>60?(u(),v(L,{key:0},{default:t(()=>[i(s(l.adapterUpdateList),1)]),_:1})):m("",!0),a(r,{avatar:""},{default:t(()=>[a(n,{name:"refresh"})]),_:1}),a(r,null,{default:t(()=>[a(_,null,{default:t(()=>[i(s(l.adapterUpdateList.length>60?l.adapterUpdateList.substr(0,58)+"...":l.adapterUpdateList),1)]),_:1}),a(_,{caption:"",style:{color:"#fff"}},{default:t(()=>[i(s(l.adapterUpdates.length)+" "+s(l.$t("Updates available")),1),x,i(" "+s(l.$t("Repository")+": "+l.activeRepo),1)]),_:1})]),_:1}),a(r,{side:""},{default:t(()=>[a(X,{rounded:"",color:"white",style:{color:"var(--q-accent)"},label:l.adapterUpdates.length},null,8,["label"])]),_:1})]),_:1},512),[[h,l.moduleConfig.updates&&l.adapterUpdates.length>0]]),(u(!0),A(K,null,z(l.instances,e=>(u(),v($,{key:e.id,clickable:l.moduleConfig.switch&&e.mode!=="none"&&e.mode!=="once"&&l.loading[e.id]!==!0,"v-ripple":l.moduleConfig.switch&&e.mode!=="none"&&e.mode!=="once"&&l.loading[e.id]!==!0},{default:t(()=>[a(r,{avatar:""},{default:t(()=>[a(n,{name:"img:"+e.extIcon},null,8,["name"])]),_:2},1024),a(r,null,{default:t(()=>[a(_,null,{default:t(()=>[i(s(e.titleLang&&(e.titleLang[l.language]||e.titleLang.en||e.titleLang.de)||e.titleLang||e.title),1)]),_:2},1024),a(_,{caption:""},{default:t(()=>[C("span",null,s(e.id)+", v"+s(e.version),1),b(C("span",null,[ee,C("span",le,s(l.$t("Update available")+" v"+e.update),1)],512),[[h,e.update]]),b(C("span",null,", "+s(l.$t("Compact Mode"))+" "+s(l.$t("on"))+" ("+s(l.$t("Group")+" "+e.compactGroup)+")",513),[[h,e.runAsCompactMode]])]),_:2},1024)]),_:2},1024),e.mode!=="none"&&e.mode!=="once"?b((u(),v(r,{key:0,side:""},{default:t(()=>[l.loading[e.id]===!0?(u(),v(G,{key:0,color:"primary",size:"21px"})):m("",!0),l.loading[e.id]!==!0&&e.alive!==!1&&e.connectedToHost!==!1&&e.connectedToInstance!==!1?(u(),A("div",ae,[a(n,{color:"positive",name:"mdi-check-circle"}),a(L,null,{default:t(()=>[i(s(l.$t("Adapter")+" "+l.$t("alive")),1)]),_:1})])):m("",!0),l.loading[e.id]!==!0&&e.alive===!1||e.connectedToHost===!1||e.connectedToInstance===!1?(u(),A("div",te,[a(n,{color:"warning",name:"mdi-alert"}),a(L,null,{default:t(()=>[i(s(l.$t("Adapter")+" "+l.$t("not alive")),1)]),_:1})])):m("",!0)]),_:2},1536)),[[h,e.enabled===!0]]):m("",!0),e.mode!=="none"&&e.mode!=="once"?b((u(),v(r,{key:1,side:""},{default:t(()=>[a(n,{name:"mdi-close"}),a(L,null,{default:t(()=>[i(s(l.$t("Adapter")+" "+l.$t("disabled")),1)]),_:1})]),_:2},1536)),[[h,e.enabled===!1]]):m("",!0),l.moduleConfig.switch&&e.mode!=="none"&&e.mode!=="once"&&l.loading[e.id]!==!0?(u(),v(J,{key:2,ref_for:!0,ref:"menu","touch-position":""},{default:t(()=>[a(I,{style:{"min-width":"120px","man-width":"150px"},class:"body"},{default:t(()=>[a($,{class:O("text-white bg-"+(e.enabled?"positive":"negative"))},{default:t(()=>[a(r,{avatar:""}),a(r,null,{default:t(()=>[i(s(l.$t(e.enabled?"Currently running":"Currently stopped")),1)]),_:2},1024),a(r,{side:""})]),_:2},1032,["class"]),b((u(),v($,{clickable:"",onClick:U=>l.onSet(e.id,!e.enabled)},{default:t(()=>[a(r,{avatar:""},{default:t(()=>[a(E,{color:e.enabled?"negative":"positive",name:e.enabled?"mdi-pause":"mdi-play"},null,8,["color","name"])]),_:2},1024),a(r,null,{default:t(()=>[i(s(l.$t(e.enabled?"Stop":"Start")+" "+l.$t("Adapter")),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[Z]])]),_:2},1024)]),_:2},1536)):m("",!0)]),_:2},1032,["clickable","v-ripple"]))),128))]),_:1}),y,0)}var ne=T(Y,[["render",oe]]);export{ne as default};
