import{_ as S,x as w,dn as B,aM as D,a as Q,de as M,dD as T,a0 as b,D as A,m as I,o as i,f as N,N as h,ah as _,q as r,d8 as P,w as l,n as V,l as c,t as f,Q as d,b as m,g as j,j as $,cT as E,dv as F,dd as O,cR as R}from"./index-0a47fe55.js";import{c as H,Q as q,b as g}from"./QTable-b968d2e9.js";import"./QVirtualScroll-0ac95a23.js";const J=w({name:"AdapterLogs",props:["widget","_containerSize"],setup(s){const v=F.getConnection,k=B(),C=D(s.widget,"config"),t=Q(()=>M.joinConfig(C.value,T)),x=[{name:"from",field:"from",label:"Adapter",align:"left",sortable:!0},{name:"ts",field:"ts",label:"Time",align:"left",sortable:!0},{name:"severity",field:"severity",label:"Severity",align:"left",sortable:!0},{name:"message",field:"message",label:"Message",align:"left",sortable:!1}],p=Q(()=>({sortBy:t.value.sortColumn||"",descending:t.value.sortDirection!==void 0?t.value.sortDirection:!1,rowsPerPage:t.value.rowsPerPage||10})),a=e=>!(!t.value.adapters.includes(e.from)||!t.value.severity.includes(e.severity)||t.value.message&&RegExp(t.value.message,"gi").test(e.message)),y=(e,n)=>(e.from.startsWith("host.")||e.from,e.raw=e.message,e._id=O(),e.ts=R(e.ts,t.value.timeFormat||"dd.MM.yyyy HH:mm:ss"),e.icon=n[e.from]&&n[e.from].extIcon?"img:"+n[e.from].extIcon:"",e.message=e.message.replace(e.from,""),e.message=e.message.indexOf(") ")!==-1?e.message.substr(e.message.indexOf(") ")+2):e.message,e),z=b(!1),L=b(null),u=b();return A(()=>{const e=k.instances.val||{};v.getLogs("current").then(n=>{u.value=n.filter(o=>a(o)).map(o=>y(o,e)),E.getInstance().on("message",o=>{a(o)&&u.value.unshift(y(o,e))}),v.on("_log",o=>{a(o)&&u.value.unshift(y(o,e))})}).catch(n=>{console.error(n),L.value=n.message||n}).finally(()=>{z.value=!0})}),{moduleConfig:t,columns:x,columnsVisible:["from","ts","severity","message"],pagination:p,loaded:z,error:L,logs:u}}});function W(s,v,k,C,t,x){const p=I("alert");return i(),N("div",{key:s.widget.revision,class:"jarvis-AdapterLogs",style:V({height:s._containerSize.height+"px"})},[h(r(P,{indeterminate:""},null,512),[[_,!s.loaded&&!s.error]]),h(r(p,null,{default:l(()=>[c(f(s.error),1)]),_:1},512),[[_,s.loaded&&s.error]]),h(r(H,{rows:s.logs,flat:"",dense:s.moduleConfig.dense,pagination:s.pagination,"binary-state-sort":"",columns:s.columns,"row-key":"_id","visible-columns":s.columnsVisible,class:"sticky-table-header full-height"},{body:l(({row:a})=>[r(q,null,{default:l(()=>[r(g,null,{default:l(()=>[r(d,{name:a.icon},null,8,["name"]),c(" \xA0"+f(a.from),1)]),_:2},1024),r(g,null,{default:l(()=>[c(f(a.ts),1)]),_:2},1024),r(g,null,{default:l(()=>[a.severity==="info"?(i(),m(d,{key:0,size:"xs",name:"mdi-information",color:"blue"})):a.severity==="warn"?(i(),m(d,{key:1,size:"xs",name:"mdi-alert-box",color:"warning"})):a.severity==="error"?(i(),m(d,{key:2,size:"xs",name:"mdi-close-box",color:"negative"})):(i(),m(d,{key:3,size:"xs",name:"mdi-bug",color:"grey"})),j("span",{style:{"margin-left":"4px"},class:$("text-"+(a.severity==="info"?"primary":a.severity==="warn"?"warning":a.severity==="error"?"negative":"grey"))},f(a.severity),3)]),_:2},1024),r(g,null,{default:l(()=>[c(f(typeof a.message=="object"?JSON.stringify(a.message):a.message),1)]),_:2},1024)]),_:2},1024)]),_:1},8,["rows","dense","pagination","columns","visible-columns"]),[[_,s.loaded&&!s.error]])],4)}var X=S(J,[["render",W]]);export{X as default};
