var V=Object.defineProperty,q=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var R=(e,d,s)=>d in e?V(e,d,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[d]=s,y=(e,d)=>{for(var s in d||(d={}))F.call(d,s)&&R(e,s,d[s]);if(B)for(var s of B(d))H.call(d,s)&&R(e,s,d[s]);return e},S=(e,d)=>q(e,z(d));import{Q as w}from"./QTooltip-dac6fb9d.js";import{_ as G,q as J,H as O,de as E,W as K,az as P,d5 as W,dw as Z,c as A,a2 as Q,j as X,bD as Y,dm as x,k as l,w as t,J as b,a1 as k,L,o as m,a as v,i as p,t as i,g,M as u,Z as $,d as M,l as ee,e as h,cM as ae,I as le,N as T,f as te,Q as oe,F as de,K as se}from"./index-b70c0daf.js";import{Q as re}from"./QBadge-19104280.js";const ie=J({name:"ModuleAdapterStatus",props:["widget"],setup(e){console.debug("ModuleAdapterStatus");const d=x.getConnection;O();const s=E(),I=K(),j=P(e.widget,"config"),n=W.joinConfig(j.value,Z);n.list=n.list?n.list.replace(/, /g,",").toLowerCase().split(","):null,n.blacklist=n.blacklist?n.blacklist.replace(/, /g,",").toLowerCase().split(","):null;const f=A(()=>{let r=s.instances;if(r=r&&r.val&&!r.val.error?y({},r.val):{},n.list)for(const o in r){const c=o.substr(0,o.indexOf("."));!n.list.includes(o)&&!n.list.includes(c)&&delete r[o]}else if(n.blacklist)for(const o in r){const c=o.substr(0,o.indexOf("."));(n.blacklist.includes(o)||n.blacklist.includes(c))&&delete r[o]}return r}),a=Q([]),_=Q([]);d.subscribeState("admin.0.info.updatesList",({err:r,state:o})=>{if(console.debug("admin.0.info.updatesList",o),o){const c=o&&o.val?o.val.replace("js-controller,","").replace("js-controller",""):"";a.value=c?c.split(","):[],_.value=a.value.map(C=>f.value[C+".0"]?f.value[C+".0"].title+" ("+f.value[C+".0"].name+")":C).join(", ")}});const U=Q({}),N=(r,o)=>{U.value[r]=!0,d.setAdapter(r,o).then(()=>{s.join("instances",{val:S(y({},s.instances.val),{[r]:S(y({},s.instances.val[r]),{enabled:o})}),ts:Date.now()})}).catch(c=>{console.error(c)}).finally(()=>{U.value[r]=!1})},D=A(()=>I.locale.substr(0,2));return{activeRepo:A(()=>s.meta.activeRepo),adapterUpdates:a,adapterUpdateList:_,instances:f,language:D,loading:U,moduleConfig:n,onSet:N}}}),ne=h("br",null,null,-1),ue=p(", "),pe={class:"UpdateAvailable"},fe={key:1},me={key:2};function ce(e,d,s,I,j,n){const f=X("icon");return Y([e.widget.revision],()=>l(T,null,{default:t(()=>[b(l(L,{class:"UpdateAvailableListItem",style:{"background-color":"var(--q-accent)"}},{default:t(()=>[e.adapterUpdateList.length>60?(m(),v(w,{key:0},{default:t(()=>[p(i(e.adapterUpdateList),1)]),_:1})):g("",!0),l(u,{avatar:""},{default:t(()=>[l(f,{name:"refresh"})]),_:1}),l(u,null,{default:t(()=>[l($,null,{default:t(()=>[p(i(e.adapterUpdateList.length>60?e.adapterUpdateList.substr(0,58)+"...":e.adapterUpdateList),1)]),_:1}),l($,{caption:"",style:{color:"#fff"}},{default:t(()=>[p(i(e.adapterUpdates.length)+" "+i(e.$t("Updates available")),1),ne,p(" "+i(e.$t("Repository")+": "+e.activeRepo),1)]),_:1})]),_:1}),l(u,{side:""},{default:t(()=>[l(re,{rounded:"",color:"white",style:{color:"var(--q-accent)"},label:e.adapterUpdates.length},null,8,["label"])]),_:1})]),_:1},512),[[k,e.moduleConfig.updates&&e.adapterUpdates.length>0]]),(m(!0),M(de,null,ee(e.instances,a=>(m(),v(L,{key:a.id,clickable:e.moduleConfig.switch&&a.mode!=="none"&&a.mode!=="once"&&e.loading[a.id]!==!0,"v-ripple":e.moduleConfig.switch&&a.mode!=="none"&&a.mode!=="once"&&e.loading[a.id]!==!0},{default:t(()=>[l(u,{avatar:""},{default:t(()=>[l(f,{name:"img:"+a.extIcon},null,8,["name"])]),_:2},1024),l(u,null,{default:t(()=>[l($,null,{default:t(()=>[p(i(a.titleLang&&(a.titleLang[e.language]||a.titleLang.en||a.titleLang.de)||a.titleLang||a.title),1)]),_:2},1024),l($,{caption:""},{default:t(()=>[h("span",null,i(a.id)+", v"+i(a.version),1),b(h("span",null,[ue,h("span",pe,i(e.$t("Update available")+" v"+a.update),1)],512),[[k,a.update]]),b(h("span",null,", "+i(e.$t("Compact Mode"))+" "+i(e.$t("on"))+" ("+i(e.$t("Group")+" "+a.compactGroup)+")",513),[[k,a.runAsCompactMode]])]),_:2},1024)]),_:2},1024),a.mode!=="none"&&a.mode!=="once"?b((m(),v(u,{key:0,side:""},{default:t(()=>[e.loading[a.id]===!0?(m(),v(ae,{key:0,color:"primary",size:"21px"})):g("",!0),e.loading[a.id]!==!0&&a.alive!==!1&&a.connectedToHost!==!1&&a.connectedToInstance!==!1?(m(),M("div",fe,[l(f,{color:"positive",name:"mdi-check-circle"}),l(w,null,{default:t(()=>[p(i(e.$t("Adapter")+" "+e.$t("alive")),1)]),_:1})])):g("",!0),e.loading[a.id]!==!0&&a.alive===!1||a.connectedToHost===!1||a.connectedToInstance===!1?(m(),M("div",me,[l(f,{color:"warning",name:"mdi-alert"}),l(w,null,{default:t(()=>[p(i(e.$t("Adapter")+" "+e.$t("not alive")),1)]),_:1})])):g("",!0)]),_:2},1536)),[[k,a.enabled===!0]]):g("",!0),a.mode!=="none"&&a.mode!=="once"?b((m(),v(u,{key:1,side:""},{default:t(()=>[l(f,{name:"mdi-close"}),l(w,null,{default:t(()=>[p(i(e.$t("Adapter")+" "+e.$t("disabled")),1)]),_:1})]),_:2},1536)),[[k,a.enabled===!1]]):g("",!0),e.moduleConfig.switch&&a.mode!=="none"&&a.mode!=="once"&&e.loading[a.id]!==!0?(m(),v(le,{key:2,ref_for:!0,ref:"menu","touch-position":""},{default:t(()=>[l(T,{style:{"min-width":"120px","man-width":"150px"},class:"body"},{default:t(()=>[l(L,{class:te("text-white bg-"+(a.enabled?"positive":"negative"))},{default:t(()=>[l(u,{avatar:""}),l(u,null,{default:t(()=>[p(i(e.$t(a.enabled?"Currently running":"Currently stopped")),1)]),_:2},1024),l(u,{side:""})]),_:2},1032,["class"]),b((m(),v(L,{clickable:"",onClick:_=>e.onSet(a.id,!a.enabled)},{default:t(()=>[l(u,{avatar:""},{default:t(()=>[l(oe,{color:a.enabled?"negative":"positive",name:a.enabled?"mdi-pause":"mdi-play"},null,8,["color","name"])]),_:2},1024),l(u,null,{default:t(()=>[p(i(e.$t(a.enabled?"Stop":"Start")+" "+e.$t("Adapter")),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[se]])]),_:2},1024)]),_:2},1536)):g("",!0)]),_:2},1032,["clickable","v-ripple"]))),128))]),_:1}),d,0)}var Ce=G(ie,[["render",ce]]);export{Ce as default};
