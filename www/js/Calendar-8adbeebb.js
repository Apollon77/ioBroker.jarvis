import{dA as T,dB as K,dC as F,bx as Z,cT as ee,c2 as ae,cU as te,c8 as ne,Q as g,ac as q,b6 as se,a9 as oe,cP as O,bL as le,bt as re,a4 as ie,cn as de,d9 as ue,dD as ce,k as C,dE as ve,an as ge,aw as me,aG as z,ay as A,W as $,b3 as I,bn as L,a2 as d,d1 as fe,X as f,U as ye,b1 as y,bS as R,D as S,bY as he,bB as pe,bT as be,bR as Ce,bV as we,V as ke,I as De,aE as Se,dF as _e,a1 as Me,C as qe,dG as Ae,bs as Pe,dq as Be}from"./index-67bd4720.js";import Qe from"./EventList-b66ca51b.js";import{n as ze}from"./index-cc9f6b5e.js";import{s as N}from"./index-f3677039.js";import"./QTooltip-c5dd166d.js";import"./___vite-browser-external_commonjs-proxy-afe9cd7a.js";import"./_commonjsHelpers-55d1ff45.js";function U(e,s){T(2,arguments);var r=K(e),v=F(s);return isNaN(v)?new Date(NaN):(v&&r.setDate(r.getDate()+v),r)}function $e(e,s){T(2,arguments);var r=F(s);return U(e,-r)}var Ie=Z({name:"QInnerLoading",props:{...ee,...ae,showing:Boolean,color:String,size:{type:[String,Number],default:42},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(e,{slots:s}){const r=oe(),v=te(e,r.proxy.$q),{transition:w,transitionStyle:c}=ne(e,g(()=>e.showing)),k=g(()=>"q-inner-loading absolute-full column flex-center"+(v.value===!0?" q-inner-loading--dark":"")),h=g(()=>"q-inner-loading__label"+(e.labelClass!==void 0?` ${e.labelClass}`:""));function u(){const m=[q(O,{size:e.size,color:e.color})];return e.label!==void 0&&m.push(q("div",{class:h.value,style:e.labelStyle},[e.label])),m}function n(){return e.showing===!0?q("div",{class:k.value,style:c.value},s.default!==void 0?s.default():u()):null}return()=>q(se,{name:w.value,appear:!0},n)}});function Le(e=!1){const s=le(),r=s.locale.value||s.locale;return e?r.substr(0,2):r}const Ne=ie({name:"ModuleCalendar",props:["_size","widget"],components:{EventList:Qe},setup(e){const s=Be.getConnection,r=de(),v=Le(!0),w=g(()=>e.widget.config),c=g(()=>({...ue.joinConfig(w.value,ce),timezone:w.value.timezone||"Europe/Amsterdam",calendars:w.value.calendars||[]})),k=g(()=>r.dark.isActive),h=C(!1),u=C(new Date);ze.scheduleJob("0 0 0 * * *",()=>{u.value=new Date});const n=C({year:u.value.getFullYear(),month:u.value.getMonth()+1}),m=({year:a,month:t})=>{(n.value.month!==t||n.value.year!==a)&&(n.value.year=a,n.value.month=t,h.value=x[a+"-"+t]||!1,M(a,t).then(()=>{_()}))},p=N($e(u.value,c.value.daysReview)),W=N(U(u.value,c.value.daysPreview)),b=C([p,W]),j=({date:a})=>{c.value.calendarAgenda===!1||c.value.calendarAgenda!==!1&&b.value.length===2?b.value=[a]:a<b.value[0]?b.value.unshift(a):b.value.push(a),_()},G=g(()=>{let[a,t]=b.value;return t=N(t?a.getMonth()!==t.getMonth()?ve(a):t:a),u.value.getFullYear()!==n.value.year||u.value.getMonth()+1!==n.value.month?[]:[{key:"selectedEnd",highlight:{contentStyle:{backgroundColor:"var(--q-accent)",opacity:1,color:"#fff"}},dates:t,order:102},{key:"selectedStart",highlight:{contentStyle:{backgroundColor:"var(--q-accent)",opacity:1,color:"#fff"}},dates:a,order:101},{key:"selected",highlight:{style:{backgroundColor:"var(--q-accent)",opacity:.3},contentStyle:{color:"var(--q-accent)"}},dates:{start:a,end:t},order:99},{key:"today",highlight:{style:{backgroundColor:"var(--q-primary)"},contentStyle:{color:"#fff",fontWeight:"bold"}},dates:u.value,order:200}]}),E=C([]),Y=(a,t)=>{const l=[];V.value.forEach(o=>{!l.some(Q=>Q.uid===o.uid)&&(o&&o.start>=a&&o.start<=t||o&&o.start<=a&&o.end>=a)&&l.push(o)}),E.value=l},_=()=>{let[a,t]=b.value;if(t=_e(t||a),a.getMonth()===t.getMonth())Y(a,t);else{let l=n.value.month+1;const o=l>12?n.value.year+1:n.value.year;l=l>12?1:l,M(o,l).then(()=>{Y(a,t)})}},x=C({}),P=C({}),V=g(()=>Object.values(P.value).flat()),H=(a,t,l)=>(a.color&&Ae("calendar--"+a.name.toLowerCase().replace(/ /g,"-").replace(/\./g,"-"),a.color),new Promise((o,Q)=>{s.getSpecial("Calendar",{calendar:a,year:t,month:l,options:{...c.value,language:v}},D=>{if(D.error)return console.warn("Calendar-a99xoa47",e.widget.id,D.error),Q(D.error);if(D.events&&Array.isArray(D.events)){const X=D.events.map((i,Fe)=>(i.start=new Date(i.start),i.end=new Date(i.end),{calendar:a,...i,key:i.uid,dot:{style:{backgroundColor:a.color||Pe.getPaletteColor("primary")}},popover:{label:i.summary},dates:i.duration<=0?i.start:{start:i.start,end:i.end},customData:{calendar:a,summary:i.summary,time:i.time}}));x[t+"-"+l]=!0,P.value[a.id+":"+t+"-"+l]=X,o(P.value[a.id])}})})),M=(a,t)=>{const l=c.value.calendars.map(o=>H(o,a,t));return Promise.allSettled(l).then(o=>(h.value=!0,o))};let B=null;ge(()=>{M(n.value.year,n.value.month).then(()=>{_()}),B=setInterval(()=>{console.debug("Calendar-d53dca17",e.widget.id,"Refreshing ical data..."),M(n.value.year,n.value.month).then(()=>{_()})},c.value.refresh*60*1e3)}),me(()=>B&&clearInterval(B));const J=g(()=>[...V.value,...G.value]);return{loaded:h,language:v,isDarkMode:k,moduleConfig:c,setDate:m,setRange:j,attributes:J,agenda:E}}}),Ee={style:{position:"relative"}},Ye={class:"text-h6"},xe=Me(' /* :timezone="moduleConfig.timezone" trim-weeks: By default, calendar panes always displays the maximum number of weeks in a month, even if the max week does not contain any days in the current month displayed. */ '),Ve={class:"text-xs text-gray-300 font-semibold"},Re={class:"Calendar-Popover-List"};function Te(e,s,r,v,w,c){const k=z("event-list"),h=z("icon"),u=z("v-calendar");return A(),$("div",null,[I(d(fe,{indeterminate:""},null,512),[[L,!e.loaded]]),f("div",Ee,[e.moduleConfig.calendarAgenda===!1?(A(),ye(we,{key:0,"model-value":e.popup,onHide:s[1]||(s[1]=n=>e.popup=!1)},{default:y(()=>[d(Ce,{style:{width:"800px","max-width":"80vw"}},{default:y(()=>[d(R,{class:"row items-center"},{default:y(()=>[f("div",Ye,S(e.$t("Calendar Details")),1),d(he),d(pe,{flat:"",round:"",color:"grey",icon:"close",onClick:s[0]||(s[0]=n=>e.popup=!1)})]),_:1}),d(be),d(R,{class:"col q-pa-none scroll body"},{default:y(()=>[d(k,{agenda:e.agenda},null,8,["agenda"])]),_:1})]),_:1})]),_:1},8,["model-value"])):ke("",!0),I(f("div",null,[d(u,{"onUpdate:toPage":e.setDate,onDayclick:e.setRange,class:"Calendar",attributes:e.attributes,"is-dark":e.isDarkMode,locale:e.language,masks:{dayPopover:"WWW, D. MMMM YYYY"},"trim-weeks":"","show-iso-weeknumbers":"","disable-page-swipe":""},{"header-title":y(({monthLabel:n,year:m})=>[f("div",null,S(n+" "+m),1),d(h,{name:"mdi-calendar-cursor",size:"xs",class:"q-ml-xs"})]),"day-popover":y(({dayTitle:n,attributes:m})=>[f("div",null,[f("strong",Ve,S(n),1),f("ul",Re,[(A(!0),$(De,null,Se(m,p=>(A(),$("li",{key:p.key+"-"+(p.customData.calendar.color||""),style:qe({color:p.customData.calendar.color||"var(--q-primary)"})},[f("span",null,S(p.customData.time)+", "+S(p.customData.summary),1)],4))),128))])])]),default:y(()=>[xe]),_:1},8,["onUpdate:toPage","onDayclick","attributes","is-dark","locale","masks"]),d(Ie,{showing:!e.loaded},{default:y(()=>[d(O,{size:"50px",color:"primary"})]),_:1},8,["showing"])],512),[[L,e.moduleConfig.calendarPreview!==!1]]),I(d(k,{agenda:e.agenda},null,8,["agenda"]),[[L,e.moduleConfig.calendarAgenda!==!1]])])])}var Xe=re(Ne,[["render",Te]]);export{Xe as default};
