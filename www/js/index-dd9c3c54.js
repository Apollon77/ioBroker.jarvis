import{Q as L}from"./QToolbarTitle-0874c3d5.js";import{Q as F}from"./QSpace-72ed55b6.js";import{x as O,ab as A,cD as G,cB as S,a0 as I,D as K,_ as M,m as y,o as s,f as r,q as o,w as n,F as j,s as P,N as V,ah as z,b as $,l as C,t as g,j as W,U as k,k as _,g as B,cW as X,L as Y,a as b,n as Z,dd as x}from"./index-0a47fe55.js";import{Q as ee}from"./QToolbar-b7d7dc3b.js";import{Q as te}from"./QExpansionItem-45cacdb1.js";import{J as oe}from"./json-editor-bb2c941a.js";import{Q as N,a as E,b as v,c as ie}from"./QTable-b968d2e9.js";import{Q as se}from"./QTooltip-94e00f66.js";import{W as ne}from"./WidgetPage-7b94bd51.js";import"./QSlideTransition-f1a38934.js";import"./_commonjsHelpers-45ea234c.js";import"./QVirtualScroll-0ac95a23.js";import"./useDragDrop-e9c8bf55.js";import"./vue.runtime.esm-bundler-2c277d7b.js";const le=O({name:"WidgetsTable",props:["widgets"],emits:["onEditWidget"],setup(e,{emit:u}){const c=A(),f=G(),m=S(),h={sortBy:"title",rowsPerPage:15},p=[{name:"id",label:c.t("ID"),field:"id",align:"left",sortable:!0},{name:"title",label:c.t("Title")+" ("+c.t("ID")+")",field:"title",align:"left",sortable:!0,style:{width:"20%"}},{name:"module",label:c.t("Module"),field:"module",align:"left",sortable:!0,style:{width:"15%"}},{name:"usage",label:c.t("Usage")+" [ #: "+c.t("Tab")+" ("+c.t("Page")+") ]",field:"usage",align:"left",sortable:!0,style:{width:"65%"}}],t=I({});return K(()=>{const i={};for(const D of m.layout){const R=D.tabs||[];for(const Q of R){const q=[...Q.widgetsDesktop||[],...Q.widgetsSmartphone||[]];for(const J of q){const H=J.items||[];for(const T of H)i[T]=i[T]||[],i[T].push({widget:J,tab:Q,page:D})}}}t.value=i}),{pagination:h,columns:p,usage:t,copyClipboard:i=>useCopyToClipboard(i),goTo:(i,D,R)=>{m.set({selectedPage:i,selectedTab:D}),f.push({name:"LayoutPage"})},isDeleted:i=>i._deleted===!0,onWidgetEdit:i=>u("onEditWidget",i),onWidgetCopy:i=>m.copyWidget({widget:i}),onWidgetRemove:i=>m.removeWidget({widget:i}),onWidgetRestore:i=>m.restoreWidget({widget:i})}}}),ae={class:"q-pa-md"},de={key:0},re=["onClick"],ue={key:0},ce={key:1},ge={key:2};function me(e,u,c,f,m,h){const p=y("icon");return s(),r("div",ae,[o(ie,{rows:e.widgets,columns:e.columns,pagination:e.pagination,"rows-per-page-label":e.$t("Widgets per page")},{header:n(t=>[o(N,{props:t},{default:n(()=>[o(E,{"auto-width":""}),(s(!0),r(j,null,P(t.cols,l=>V((s(),$(E,{key:l.name,props:t},{default:n(()=>[C(g(l.label),1)]),_:2},1032,["props"])),[[z,l.field!=="id"]])),128)),o(E,{"auto-width":""})]),_:2},1032,["props"])]),body:n(t=>[o(N,{props:t,class:W({rowDeleted:e.isDeleted(t.row)})},{default:n(()=>[o(v,{"auto-width":""},{default:n(()=>[e.isDeleted(t.row)!==!0?(s(),r("div",de,[o(k,{size:"sm",flat:"",round:"",onClick:l=>e.onWidgetEdit(t.row),icon:"mdi-pencil"},null,8,["onClick"]),o(k,{size:"sm",flat:"",round:"",onClick:l=>e.onWidgetCopy(t.row),icon:"mdi-content-copy"},null,8,["onClick"])])):_("",!0)]),_:2},1024),o(v,null,{default:n(()=>[B("div",{class:W({itemDeleted:e.isDeleted(t.row)}),onClick:l=>e.copyClipboard(t.cols[0].value)},[o(se,null,{default:n(()=>[C(" ID: "+g(t.cols[0].value)+" ("+g(e.$t("click to copy to clipboard"))+") ",1)]),_:2},1024),t.cols[1].value?(s(),r("span",ue,g(t.cols[1].value),1)):(s(),r("em",ce,"("+g(e.$t("no title"))+")",1)),t.row.label?(s(),r("span",ge," ("+g(t.row.label)+")",1)):_("",!0),o(p,{name:"clipboard-text-multiple-outline",size:"xs",style:{"margin-left":"4px"}})],10,re)]),_:2},1024),o(v,null,{default:n(()=>[B("div",{class:W({itemDeleted:e.isDeleted(t.row)})},g(t.cols[2].value),3)]),_:2},1024),o(v,null,{default:n(()=>[e.usage[t.row.id]?(s(),r("div",{key:1,class:W({itemDeleted:e.isDeleted(t.row)})},[C(g(e.usage[t.row.id].length)+": ",1),(s(!0),r(j,null,P(e.usage[t.row.id],({widget:l,tab:w,page:a},d)=>(s(),$(X,{key:t.row.id+"-"+d,square:"",color:"primary","text-color":"white",onClick:U=>e.goTo(a,w,l),clickable:""},{default:n(()=>[C(g(w.title+" ("+a.title+")"),1)]),_:2},1032,["onClick"]))),128))],2)):(s(),r("div",{key:0,class:W({itemDeleted:e.isDeleted(t.row)})},null,2))]),_:2},1024),o(v,{"auto-width":""},{default:n(()=>[e.isDeleted(t.row)!==!0?(s(),$(k,{key:0,size:"sm",flat:"",round:"",onClick:l=>e.onWidgetRemove(t.row),icon:"mdi-delete",color:"negative"},null,8,["onClick"])):_("",!0),e.isDeleted(t.row)?(s(),$(k,{key:1,size:"sm",flat:"",round:"",onClick:l=>e.onWidgetRestore(t.row),icon:"mdi-restore",color:"positive"},null,8,["onClick"])):_("",!0)]),_:2},1024)]),_:2},1032,["props","class"])]),_:1},8,["rows","columns","pagination","rows-per-page-label"])])}var pe=M(le,[["render",me]]);const we=O({name:"WidgetsPage",components:{JsonEditor:oe,WidgetsTable:pe,WidgetPage:ne},setup(){const e=Y(),u=S(),c=b(()=>e.pageHeight),f=b(()=>u.getGroupedWidgets),m=b(()=>u.getWidgetsWthoutDeletionsCount),h=b(()=>u.widgets),p=b(()=>{var d;return(d=u.settings)==null?void 0:d.configExpertMode}),t=I(),l=()=>{t.value=x()},w=d=>{t.value=d.id},a=d=>!d._error&&u.set({[d.id]:JSON.parse(d.value)});return{expanded:I({}),pageHeight:c,groups:f,json:h,expertMode:p,widgetsCount:m,selectedWidgetId:t,addWidget:l,editWidget:w,onJsonEditor:a}}}),fe={class:"full-height WidgetsPage"},he={class:"row no-wrap"};function We(e,u,c,f,m,h){const p=y("widget-page"),t=y("widgets-table"),l=y("json-editor"),w=y("paper");return s(),r("div",fe,[B("div",he,[o(ee,{class:"paper",style:{"min-height":"56px"}},{default:n(()=>[o(L,{shrink:""},{default:n(()=>[C(g(e.$t("Widgets"))+" ("+g(e.widgetsCount)+")",1)]),_:1}),o(F),o(k,{color:"primary",icon:"mdi-plus-circle",label:e.$t("Add Widget"),onClick:e.addWidget},null,8,["label","onClick"])]),_:1})]),o(p,{onOnClose:u[0]||(u[0]=a=>e.selectedWidgetId=null),widgetId:e.selectedWidgetId},null,8,["widgetId"]),(s(!0),r(j,null,P(e.groups,a=>V((s(),r("div",{class:"row no-wrap paper",key:a.id},[o(te,{modelValue:e.expanded[a.id],"onUpdate:modelValue":d=>e.expanded[a.id]=d,icon:a.icon,label:a.label+" ("+a.widgets.length+")",class:"full-width"},{default:n(()=>[o(t,{onOnEditWidget:e.editWidget,widgets:a.widgets},null,8,["onOnEditWidget","widgets"])]),_:2},1032,["modelValue","onUpdate:modelValue","icon","label"])])),[[z,!e.expertMode&&a.widgets.length>0]])),128)),V(o(w,{style:Z({height:e.pageHeight-66-16+"px"})},{default:n(()=>[o(l,{id:"widgets",json:e.json,onOnChange:e.onJsonEditor},null,8,["json","onOnChange"])]),_:1},8,["style"]),[[z,e.expertMode]])])}var Be=M(we,[["render",We]]);export{Be as default};
