import{a4 as N,cj as P,dk as L,Q as C,k as z,aY as J,cs as F,bt as Q,dp as G,aG as w,ay as o,W as g,aE as V,a2 as a,b1 as i,bM as Y,A as H,U as d,X as y,a1 as $,D as h,V as k,bN as R,c$ as Z,b3 as A,bn as E,bP as x,bC as _,by as S,bT as K,bQ as ee,I as M,bO as I,cK as se,bA as T,bJ as U,bp as b,bz as te,bB as q,bw as ae}from"./index-377e822f.js";import{Q as ie}from"./QToolbar-162a4e1d.js";import{Q as oe}from"./QHeader-28668fa4.js";import{Q as re}from"./QDrawer-cb7ad843.js";import{Q as B}from"./QVirtualScroll-96f8358f.js";import{Q as D}from"./QTooltip-568e728a.js";const ne=N({name:"NotificationEventPopup",setup(e){const r=G.getConnection,p=P(),v=L(),f=C(()=>p.dark.isActive),m=z({}),l=z(0),t={},s=(u,n=50)=>{setTimeout(()=>{t[u.id]=Math.max(0,t[u.id]-n),l.value=Date.now(),t[u.id]>0?s(u):m.value[u.id]=!1},n)},c=u=>v.set({notificationId:u.id,props:{state:"read"}}),j=u=>v.set({notificationId:u.id,props:{state:"archived"}}),W=u=>v.del({notificationId:u.id});J(()=>v.new,u=>X(u.notifications));const O=z([]),X=u=>{u=F(u),u.forEach(n=>{n.devices=!n.devices||Array.isArray(n.devices)?n.devices:n.devices.indexOf(",")>-1?n.devices.split(","):[n.devices],n.display==="popup"&&(!n.devices||n.devices.includes(r.client.id))&&((n.timeout||n.autoHideDuration||n.progress)&&(n.progress=!0,n.timeout=n.timeout||n.autoHideDuration||5e3,t[n.id]=n.timeout,s(n,500)),m.value[n.id]=!0,O.value.push(n))})};return{isDark:f,notificationList:O,dialogs:m,markAsArchived:j,markAsRead:c,remove:W}}}),le={class:"text-h6"},de={key:0,class:"text-caption"},ce=["innerHTML"];function ue(e,r,p,v,f,m){const l=w("icon");return o(!0),g(M,null,V(e.notificationList,t=>(o(),g("div",{key:t.id},[a(ee,{"model-value":e.dialogs[t.id],onHide:s=>e.dialogs[t.id]=!1,"transition-show":"scale","transition-hide":"scale"},{default:i(()=>[a(Y,{class:H({"jarvis-notification-event-popup":!0,[t.category]:t.category!==void 0,["bg-"+(t.color||t.type||t.criticality||"primary")]:!0,["text-"+(t.textColor||"white")]:!0}),style:{width:"550px","max-width":"95vw"}},{default:i(()=>[t.title||t.caption?(o(),d(R,{key:0,class:"jarvis-notification-event-popup-title"},{default:i(()=>[y("div",le,[a(l,{name:t.icon,color:t.iconColor||"primary"},null,8,["name","color"]),$(" "+h(t.title),1)]),t.caption?(o(),g("div",de,h(t.caption),1)):k("",!0)]),_:2},1024)):k("",!0),t.message?(o(),d(R,{key:1,class:"q-pt-none jarvis-notification-event-popup-message"},{default:i(()=>[y("div",{innerHTML:t.message},null,8,ce)]),_:2},1024)):k("",!0),t.progress?(o(),d(R,{key:2,class:H(["q-pa-none",{["updated-"+e.refresh]:!0,["text-"+(t.textColor||t.type||t.criticality||"primary")]:!0,["bg-"+(t.color||"white")]:!0}])},{default:i(()=>[a(Z,{value:e.timers[t.id]?e.timers[t.id]/t.timeout:0,class:"q-mt-md",color:t.color||t.type||t.criticality||"accent"},null,8,["value","color"])]),_:2},1032,["class"])):k("",!0),A(a(x,{class:H(["jarvis-notification-event-popup-actions nowrap",{["bg-"+(t.textColor||t.type||t.criticality||(e.isDark?"grey-10":"white"))]:!0,["text-"+(t.color||"primary")]:!0}])},{default:i(()=>[A(a(_,{dense:"",flat:"",label:e.$t("Delete"),icon:"mdi-delete",color:t.type==="negative"||t.criticality==="negative"?"yellow":"negative",onClick:s=>e.remove(t)},null,8,["label","color","onClick"]),[[S]]),a(K),A(a(_,{dense:"",flat:"",label:e.$t("Archive"),icon:"mdi-package-down",onClick:s=>e.markAsArchived(t)},null,8,["label","onClick"]),[[S]]),A(a(_,{dense:"",flat:"",label:e.$t("Mark as Read"),icon:"mdi-check",onClick:s=>e.markAsRead(t)},null,8,["label","onClick"]),[[S]])]),_:2},1032,["class"]),[[E,t.state!=="delete"]])]),_:2},1032,["class"])]),_:2},1032,["model-value","onHide"])]))),128)}var pe=Q(ne,[["render",ue]]);const ve=N({name:"NotificationEventSnackbar",setup(){const e=P(),r=G.getConnection,p=L(),v=s=>p.set({notificationId:s.id,props:{state:"read"}}),f=s=>p.set({notificationId:s.id,props:{state:"archived"}}),m=s=>p.del({notificationId:s.id}),l=(s={})=>{!s.type&&s.criticality&&(s.type=s.criticality==="error"?"negative":s.criticality==="success"?"positive":s.criticality),!s.position&&s.snackbarOrigin&&(s.position=[],s.snackbarOrigin.horizontal&&s.position.push(s.snackbarOrigin.horizontal),s.snackbarOrigin.vertical&&s.position.push(s.snackbarOrigin.vertical),s.position=s.position.join(s.position.length===2?"-":""));const c={badgeStyle:"display: none",html:!0,position:"bottom-right",progress:!0,progressClass:"jarvis-notification-event-snackbar-progress",classes:"jarvis-notification-event-snackbar "+(s.category||""),actions:s.state!=="delete"&&[{icon:"mdi-circle-slice-8",size:"sm",color:s.textColor||"white",handler:()=>v(s)},{icon:"mdi-package-down",size:"sm",color:s.textColor||"white",handler:()=>f(s)},{icon:"mdi-delete",size:"sm",color:s.type==="negative"||s.criticality==="negative"?"yellow":"negative",handler:()=>m(s)}],...s,color:s.type||s.criticality||s.color||"primary",textColor:"white",type:s.type||s.criticality||void 0,timeout:s.timeout||s.autoHideDuration||5e3,message:s.title||s.message,group:s.id};e.notify(c)};J(()=>p.new,s=>t(s.notifications));const t=s=>{s=F(s),s.forEach(c=>{c.devices=!c.devices||Array.isArray(c.devices)?c.devices:c.devices.indexOf(",")>-1?c.devices.split(","):[c.devices],c.display==="snackbar"&&(!c.devices||c.devices.includes(r.client.id))&&l(c)})};return{}}});function me(e,r,p,v,f,m){return o(),g("div")}var he=Q(ve,[["render",me]]);const fe=N({name:"Divider",props:["label"]}),ke={class:"row full-width"},ge={class:"col",style:{margin:"auto 0"}},ye={style:{"text-align":"center"}},_e=$(" \xA0\xA0"),$e=$("\xA0\xA0 "),we={class:"col",style:{margin:"auto 0"}};function Ae(e,r,p,v,f,m){return o(),g("div",ke,[y("div",ge,[a(I)]),y("div",ye,[_e,y("em",null,h(e.label),1),$e]),y("div",we,[a(I)])])}var be=Q(fe,[["render",Ae]]);const Ce=N({name:"NotificationListItem",props:["notification"],setup(e){const r=L();return{show:()=>{r.setNew({notifications:[{...e.notification,progress:!1,autoHideDuration:null,timeout:null}]})},markAsRead:()=>r.set({notificationId:e.notification.id,props:{state:"read"}}),markAsUnread:()=>r.set({notificationId:e.notification.id,props:{state:"unread"}}),markAsArchived:()=>r.set({notificationId:e.notification.id,props:{state:"archived"}}),remove:()=>r.del({notificationId:e.notification.id})}}}),Ne={class:"text-weight-medium"},Qe=["innerHTML"],De={class:"text-grey-8 q-gutter-xs"};function Ie(e,r,p,v,f,m){const l=w("icon");return o(),g("div",null,[A((o(),d(te,{clickable:"",class:H(["jarvis-notifications-item",{[e.notification.state||"unread"]:!0,[e.notification.category]:e.notification.category!==void 0}]),onClick:b(e.show,["stop"]),id:"notification-"+e.notification.id},{default:i(()=>[a(T,{avatar:""},{default:i(()=>[a(l,{name:e.notification.icon||"mdi-comment",color:e.notification.iconColor||"primary",size:"sm"},null,8,["name","color"])]),_:1}),a(T,null,{default:i(()=>[a(U,{lines:"1"},{default:i(()=>[y("span",Ne,h(e.notification.title),1),A(y("span",null," - "+h(e.notification.caption),513),[[E,e.notification.caption]])]),_:1}),e.notification.message?(o(),d(U,{key:0,caption:"",lines:"1",style:{"max-height":"200px"}},{default:i(()=>[y("div",{innerHTML:e.notification.message,class:"overflow-dots"},null,8,Qe)]),_:1})):k("",!0)]),_:1}),a(T,{side:""},{default:i(()=>[y("div",De,[e.notification.state==="read"?(o(),d(_,{key:0,onClick:b(e.markAsUnread,["stop"]),class:"gt-xs",size:"12px",flat:"",dense:"",round:"",icon:"mdi-check"},{default:i(()=>[a(D,null,{default:i(()=>[$(h(e.$t("Mark as Unread")),1)]),_:1})]),_:1},8,["onClick"])):k("",!0),e.notification.state!=="read"&&e.notification.state!=="archived"?(o(),d(_,{key:1,onClick:b(e.markAsRead,["stop"]),class:"gt-xs",size:"12px",flat:"",dense:"",round:"",icon:"mdi-circle-outline"},{default:i(()=>[a(D,null,{default:i(()=>[$(h(e.$t("Mark as Read")),1)]),_:1})]),_:1},8,["onClick"])):k("",!0),e.notification.state!=="archived"?(o(),d(_,{key:2,onClick:b(e.markAsArchived,["stop"]),class:"gt-xs",size:"12px",flat:"",dense:"",round:"",icon:"mdi-package-down"},{default:i(()=>[a(D,null,{default:i(()=>[$(h(e.$t("Archive")),1)]),_:1})]),_:1},8,["onClick"])):k("",!0),e.notification.state==="archived"?(o(),d(_,{key:3,onClick:b(e.markAsUnread,["stop"]),class:"gt-xs",size:"12px",flat:"",dense:"",round:"",icon:"mdi-package-up"},{default:i(()=>[a(D,null,{default:i(()=>[$(h(e.$t("Restore from Archive")),1)]),_:1})]),_:1},8,["onClick"])):k("",!0),e.notification.state==="archived"?(o(),d(_,{key:4,onClick:b(e.remove,["stop"]),color:"negative",class:"gt-xs",size:"12px",flat:"",dense:"",round:"",icon:"delete"},{default:i(()=>[a(D,null,{default:i(()=>[$(h(e.$t("Delete")),1)]),_:1})]),_:1},8,["onClick"])):k("",!0)])]),_:1})]),_:1},8,["class","onClick","id"])),[[se]]),a(I)])}var Le=Q(Ce,[["render",Ie]]);const je=N({name:"NotificationList",components:{NotificationItem:Le,Divider:be},setup(){const e=L();return{showArchived:z(!1),notificationsActive:C(()=>e.getActive),notificationsArchived:C(()=>e.getArchived)}}}),ze={class:"q-mt-xs jarvis-notifications-items"},He={key:2};function Me(e,r,p,v,f,m){const l=w("notification-item"),t=w("divider");return o(),g("div",ze,[a(I),e.notificationsActive.length<200?(o(),d(q,{key:0},{default:i(()=>[(o(!0),g(M,null,V(e.notificationsActive,s=>(o(),d(l,{key:s.id,notification:s},null,8,["notification"]))),128))]),_:1})):(o(),d(B,{key:1,items:e.notificationsActive},{default:i(({item:s})=>[a(l,{notification:s},null,8,["notification"])]),_:1},8,["items"])),A(a(_,{flat:"",class:"full-width",onClick:r[0]||(r[0]=s=>e.showArchived=!e.showArchived)},{default:i(()=>[e.showArchived?(o(),d(t,{key:0,label:e.$t("hide archived notifications")},null,8,["label"])):(o(),d(t,{key:1,label:e.$t("show archived notifications")},null,8,["label"]))]),_:1},512),[[E,e.notificationsArchived&&e.notificationsArchived.length>0]]),e.showArchived?(o(),g("div",He,[a(I),e.notificationsArchived.length<200?(o(),d(q,{key:0},{default:i(()=>[(o(!0),g(M,null,V(e.notificationsArchived,s=>(o(),d(l,{key:s.id,notification:s},null,8,["notification"]))),128))]),_:1})):(o(),d(B,{key:1,items:e.notificationsArchived},{default:i(({item:s})=>[a(l,{notification:s},null,8,["notification"])]),_:1},8,["items"]))])):k("",!0)])}var Re=Q(je,[["render",Me]]);const Se=N({name:"NotificationDrawer",components:{NotificationEventPopup:pe,NotificationEventSnackbar:he,NotificationList:Re},setup(){const e=ae(),r=L(),p=l=>e.set("drawerNotifications",l),v=C({get(){return e.drawerNotifications},set(l){p(l)}}),f=C(()=>r.getUnread.length),m=C(()=>r.getActive.length+r.getArchived.length);return{toggleNotifications:p,drawerNotifications:v,unread:f,all:m}}});function Te(e,r,p,v,f,m){const l=w("notification-event-popup"),t=w("notification-event-snackbar"),s=w("icon"),c=w("notification-list");return o(),g(M,null,[a(l),a(t),a(re,{modelValue:e.drawerNotifications,"onUpdate:modelValue":r[1]||(r[1]=j=>e.drawerNotifications=j),side:"right",behavior:"mobile",width:500,overlay:"",bordered:"","content-class":"jarvis-notifications body",class:"jarvis-notifications-container"},{default:i(()=>[a(oe,{style:{position:"relative",left:"0"}},{default:i(()=>[a(ie,null,{default:i(()=>[y("h6",null,[a(s,{name:"mdi-bell"}),$(" "+h(e.$t("Notifications"))+" ("+h(e.unread)+" / "+h(e.all)+") ",1)]),a(K),a(_,{flat:"",dense:"",round:"",icon:"mdi-chevron-right","aria-label":"Menu",onClick:r[0]||(r[0]=j=>e.toggleNotifications(!1))})]),_:1})]),_:1}),e.drawerNotifications?(o(),d(c,{key:0})):k("",!0)]),_:1},8,["modelValue"])],64)}var Pe=Q(Se,[["render",Te]]);export{Pe as default};
