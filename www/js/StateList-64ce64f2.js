import{a4 as k,Q as g,d9 as L,dr as b,k as y,aZ as D,ds as p,cp as h,ao as w,bt as K,aG as S,ay as n,U as u,b1 as I,W as m,aE as B,I as C,V as _,bT as E,A as F,bG as P}from"./index-67bd4720.js";import $ from"./StateListGroup-1cbf5dd3.js";import j from"./StateListItem-531a8fd1.js";const z=k({name:"ModuleStateList",props:["widget","isPopup","openDeviceDetails"],components:{StateListGroup:$,StateListItem:j},setup(i){const v=g(()=>i.widget.config),f=g(()=>({...L.joinConfig(v.value,b)})),l=y({}),r=(e,s,o)=>{if(e||!s)return console.warn("StateList",i.widget.id,e&&e.message,e),e&&e.message||e;l.value[o.id+":"+s.key]=s};let c=y([]),a=null,d={},t=[];return D(()=>{c.value=[],a=null,d={},i.widget.items.forEach(e=>{if(e.type==="group"&&(a=e.id,d[a]={}),e.type==="divider"&&(a=null),e.type==="device"){const s=p.get(e.deviceId);if(!s)h.warn("StateList","Device with ID "+e.deviceId+" not found!");else{c.value.push({item:e,device:s});const o=e;a!==null&&d[a]!==void 0&&(d[a][s.id+"#"+e.primaryStateKey]={item:e,device:s}),l.value[s.id+":"+o.primaryStateKey]={},o.primaryStateKey&&(t=t.concat(p.listen(s.id,o.primaryStateKey,r))),l.value[s.id+":"+o.bodyStateKey]={},o.bodyStateKey&&(t=t.concat(p.listen(s.id,o.bodyStateKey,r)))}}else c.value.push({item:e})})}),w(()=>p.unlisten(t)),{entries:c,groups:d,moduleConfig:f,states:l}}}),G={key:0};function Q(i,v,f,l,r,c){const a=S("state-list-group"),d=S("state-list-item");return n(),u(P,{key:i.widget.revision,dense:i.moduleConfig.dense,class:F(["jarvis-StateList",{horizontal:i.moduleConfig.horizontal,stacked:i.moduleConfig.stacked}])},{default:I(()=>[(n(!0),m(C,null,B(i.entries,(t,e)=>(n(),m(C,{key:"item-"+t.item.id},[t.item.type==="group"?(n(),m("div",G)):_("",!0),t.item.type==="group"?(n(),u(a,{key:1,devices:i.groups[t.item.id],deviceConfig:t.item,moduleConfig:i.moduleConfig},null,8,["devices","deviceConfig","moduleConfig"])):t.item.type==="device"?(n(),u(d,{key:"state-list-item-"+t.item.id,isFirstItem:e===0,device:t.device,deviceConfig:t.item,primaryState:i.states[t.device.id+":"+t.item.primaryStateKey],bodyState:i.states[t.device.id+":"+t.item.bodyStateKey],isPopup:i.isPopup,openDeviceDetails:i.openDeviceDetails},null,8,["isFirstItem","device","deviceConfig","primaryState","bodyState","isPopup","openDeviceDetails"])):t.item.type==="divider"?(n(),u(E,{key:3,class:"jarvis-StateListSeparator"})):_("",!0)],64))),128))]),_:1},8,["dense","class"])}var A=K(z,[["render",Q],["__scopeId","data-v-4288a51c"]]);export{A as default};
