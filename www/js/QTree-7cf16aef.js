import{bx as se,cT as fe,cU as he,k as P,ap as ve,Q as k,aY as R,ac as s,a9 as ke,al as ye,d5 as be,cP as ge,bu as V,cO as xe,cm as H,b3 as _e,bn as Se,bz as Y}from"./index-988ebe8f.js";import{Q as Ke}from"./QSlideTransition-69ee8af7.js";const Te=["none","strict","leaf","leaf-filtered"];var Ae=se({name:"QTree",props:{...fe,nodes:{type:Array,required:!0},nodeKey:{type:String,required:!0},labelKey:{type:String,default:"label"},childrenKey:{type:String,default:"children"},dense:Boolean,color:String,controlColor:String,textColor:String,selectedColor:String,icon:String,tickStrategy:{type:String,default:"none",validator:l=>Te.includes(l)},ticked:Array,expanded:Array,selected:{},noSelectionUnset:Boolean,defaultExpandAll:Boolean,accordion:Boolean,filter:String,filterMethod:Function,duration:Number,noConnectors:Boolean,noNodesLabel:String,noResultsLabel:String},emits:["update:expanded","update:ticked","update:selected","lazy-load","after-show","after-hide"],setup(l,{slots:y,emit:h}){const{proxy:C}=ke(),{$q:S}=C,A=he(l,S),g=P({}),x=P(l.ticked||[]),v=P(l.expanded||[]);let E={};ve(()=>{E={}});const G=k(()=>`q-tree q-tree--${l.dense===!0?"dense":"standard"}`+(l.noConnectors===!0?" q-tree--no-connectors":"")+(A.value===!0?" q-tree--dark":"")+(l.color!==void 0?` text-${l.color}`:"")),$=k(()=>l.selected!==void 0),J=k(()=>l.icon||S.iconSet.tree.icon),Q=k(()=>l.controlColor||l.color),m=k(()=>l.textColor!==void 0?` text-${l.textColor}`:""),W=k(()=>{const e=l.selectedColor||l.color;return e?` text-${e}`:""}),X=k(()=>l.filterMethod!==void 0?l.filterMethod:(e,i)=>{const t=i.toLowerCase();return e[l.labelKey]&&e[l.labelKey].toLowerCase().indexOf(t)>-1}),f=k(()=>{const e={},i=(t,n)=>{const r=t.tickStrategy||(n?n.tickStrategy:l.tickStrategy),c=t[l.nodeKey],d=t[l.childrenKey]&&t[l.childrenKey].length>0,_=d!==!0,o=t.disabled!==!0&&$.value===!0&&t.selectable!==!1,D=t.disabled!==!0&&t.expandable!==!1,ue=r!=="none",q=r==="strict",I=r==="leaf-filtered",F=r==="leaf"||r==="leaf-filtered";let N=t.disabled!==!0&&t.tickable!==!1;F===!0&&N===!0&&n&&n.tickable!==!0&&(N=!1);let b=t.lazy;b===!0&&g.value[c]!==void 0&&Array.isArray(t[l.childrenKey])===!0&&(b=g.value[c]);const a={key:c,parent:n,isParent:d,isLeaf:_,lazy:b,disabled:t.disabled,link:t.disabled!==!0&&(o===!0||D===!0&&(d===!0||b===!0)),children:[],matchesFilter:l.filter?X.value(t,l.filter):!0,selected:c===l.selected&&o===!0,selectable:o,expanded:d===!0?v.value.includes(c):!1,expandable:D,noTick:t.noTick===!0||q!==!0&&b&&b!=="loaded",tickable:N,tickStrategy:r,hasTicking:ue,strictTicking:q,leafFilteredTicking:I,leafTicking:F,ticked:q===!0||_===!0?x.value.includes(c):!1};if(e[c]=a,d===!0&&(a.children=t[l.childrenKey].map(u=>i(u,a)),l.filter&&(a.matchesFilter!==!0?a.matchesFilter=a.children.some(u=>u.matchesFilter):a.noTick!==!0&&a.disabled!==!0&&a.tickable===!0&&I===!0&&a.children.every(u=>u.matchesFilter!==!0||u.noTick===!0||u.tickable!==!0)===!0&&(a.tickable=!1)),a.matchesFilter===!0&&(a.noTick!==!0&&q!==!0&&a.children.every(u=>u.noTick)===!0&&(a.noTick=!0),F))){if(a.ticked=!1,a.indeterminate=a.children.some(u=>u.indeterminate===!0),a.tickable=a.tickable===!0&&a.children.some(u=>u.tickable),a.indeterminate!==!0){const u=a.children.reduce((j,oe)=>oe.ticked===!0?j+1:j,0);u===a.children.length?a.ticked=!0:u>0&&(a.indeterminate=!0)}a.indeterminate===!0&&(a.indeterminateNextState=a.children.every(u=>u.tickable!==!0||u.ticked!==!0))}return a};return l.nodes.forEach(t=>i(t,null)),e});R(()=>l.ticked,e=>{x.value=e}),R(()=>l.expanded,e=>{v.value=e});function K(e){const i=[].reduce,t=(n,r)=>{if(n||!r)return n;if(Array.isArray(r)===!0)return i.call(Object(r),t,n);if(r[l.nodeKey]===e)return r;if(r[l.childrenKey])return t(null,r[l.childrenKey])};return t(null,l.nodes)}function Z(){return x.value.map(e=>K(e))}function p(){return v.value.map(e=>K(e))}function ee(e){return e&&f.value[e]?f.value[e].expanded:!1}function te(){l.expanded!==void 0?h("update:expanded",[]):v.value=[]}function L(){const e=v.value,i=t=>{t[l.childrenKey]&&t[l.childrenKey].length>0&&t.expandable!==!1&&t.disabled!==!0&&(e.push(t[l.nodeKey]),t[l.childrenKey].forEach(i))};l.nodes.forEach(i),l.expanded!==void 0?h("update:expanded",e):v.value=e}function w(e,i,t=K(e),n=f.value[e]){if(n.lazy&&n.lazy!=="loaded"){if(n.lazy==="loading")return;g.value[e]="loading",Array.isArray(t[l.childrenKey])!==!0&&(t[l.childrenKey]=[]),h("lazy-load",{node:t,key:e,done:r=>{g.value[e]="loaded",t[l.childrenKey]=Array.isArray(r)===!0?r:[],ye(()=>{const c=f.value[e];c&&c.isParent===!0&&B(e,!0)})},fail:()=>{delete g.value[e],t[l.childrenKey].length===0&&delete t[l.childrenKey]}})}else n.isParent===!0&&n.expandable===!0&&B(e,i)}function B(e,i){let t=v.value;const n=l.expanded!==void 0;if(n===!0&&(t=t.slice()),i){if(l.accordion&&f.value[e]){const r=[];f.value[e].parent?f.value[e].parent.children.forEach(c=>{c.key!==e&&c.expandable===!0&&r.push(c.key)}):l.nodes.forEach(c=>{const d=c[l.nodeKey];d!==e&&r.push(d)}),r.length>0&&(t=t.filter(c=>r.includes(c)===!1))}t=t.concat([e]).filter((r,c,d)=>d.indexOf(r)===c)}else t=t.filter(r=>r!==e);n===!0?h("update:expanded",t):v.value=t}function le(e){return e&&f.value[e]?f.value[e].ticked:!1}function T(e,i){let t=x.value;const n=l.ticked!==void 0;n===!0&&(t=t.slice()),i?t=t.concat(e).filter((r,c,d)=>d.indexOf(r)===c):t=t.filter(r=>e.includes(r)===!1),n===!0&&h("update:ticked",t)}function ie(e,i,t){const n={tree:C,node:e,key:t,color:l.color,dark:A.value};return Y(n,"expanded",()=>i.expanded,r=>{r!==i.expanded&&w(t,r)}),Y(n,"ticked",()=>i.ticked,r=>{r!==i.ticked&&T([t],r)}),n}function O(e){return(l.filter?e.filter(i=>f.value[i[l.nodeKey]].matchesFilter):e).map(i=>ce(i))}function re(e){if(e.icon!==void 0)return s(V,{class:"q-tree__icon q-mr-sm",name:e.icon,color:e.iconColor});const i=e.img||e.avatar;if(i)return s("img",{class:`q-tree__${e.img?"img":"avatar"} q-mr-sm`,src:i})}function ne(){h("after-show")}function ae(){h("after-hide")}function ce(e){const i=e[l.nodeKey],t=f.value[i],n=e.header&&y[`header-${e.header}`]||y["default-header"],r=t.isParent===!0?O(e[l.childrenKey]):[],c=r.length>0||t.lazy&&t.lazy!=="loaded";let d=e.body&&y[`body-${e.body}`]||y["default-body"];const _=n!==void 0||d!==void 0?ie(e,t,i):null;return d!==void 0&&(d=s("div",{class:"q-tree__node-body relative-position"},[s("div",{class:m.value},[d(_)])])),s("div",{key:i,class:`q-tree__node relative-position q-tree__node--${c===!0?"parent":"child"}`},[s("div",{class:"q-tree__node-header relative-position row no-wrap items-center"+(t.link===!0?" q-tree__node--link q-hoverable q-focusable":"")+(t.selected===!0?" q-tree__node--selected":"")+(t.disabled===!0?" q-tree__node--disabled":""),tabindex:t.link===!0?0:-1,onClick:o=>{U(e,t,o)},onKeypress(o){be(o)!==!0&&(o.keyCode===13?U(e,t,o,!0):o.keyCode===32&&z(e,t,o,!0))}},[s("div",{class:"q-focus-helper",tabindex:-1,ref:o=>{E[t.key]=o}}),t.lazy==="loading"?s(ge,{class:"q-tree__spinner",color:Q.value}):c===!0?s(V,{class:"q-tree__arrow"+(t.expanded===!0?" q-tree__arrow--rotate":""),name:J.value,onClick(o){z(e,t,o)}}):null,t.hasTicking===!0&&t.noTick!==!0?s(xe,{class:"q-tree__tickbox",modelValue:t.indeterminate===!0?null:t.ticked,color:Q.value,dark:A.value,dense:!0,keepColor:!0,disable:t.tickable!==!0,onKeydown:H,"onUpdate:modelValue":o=>{de(t,o)}}):null,s("div",{class:"q-tree__node-header-content col row no-wrap items-center"+(t.selected===!0?W.value:m.value)},[n?n(_):[re(e),s("div",e[l.labelKey])]])]),c===!0?s(Ke,{duration:l.duration,onShow:ne,onHide:ae},()=>_e(s("div",{class:"q-tree__node-collapsible"+m.value,key:`${i}__q`},[d,s("div",{class:"q-tree__children"+(t.disabled===!0?" q-tree__node--disabled":"")},r)]),[[Se,t.expanded]])):d])}function M(e){const i=E[e];i&&i.focus()}function U(e,i,t,n){n!==!0&&M(i.key),$.value&&i.selectable?l.noSelectionUnset===!1?h("update:selected",i.key!==l.selected?i.key:null):i.key!==l.selected&&h("update:selected",i.key||null):z(e,i,t,n),typeof e.handler=="function"&&e.handler(e)}function z(e,i,t,n){t!==void 0&&H(t),n!==!0&&M(i.key),w(i.key,!i.expanded,e,i)}function de(e,i){if(e.indeterminate===!0&&(i=e.indeterminateNextState),e.strictTicking)T([e.key],i);else if(e.leafTicking){const t=[],n=r=>{r.isParent?(i!==!0&&r.noTick!==!0&&r.tickable===!0&&t.push(r.key),r.leafTicking===!0&&r.children.forEach(n)):r.noTick!==!0&&r.tickable===!0&&(r.leafFilteredTicking!==!0||r.matchesFilter===!0)&&t.push(r.key)};n(e),T(t,i)}}return Object.assign(C,{getNodeByKey:K,getTickedNodes:Z,getExpandedNodes:p,isExpanded:ee,collapseAll:te,expandAll:L,setExpanded:w,isTicked:le,setTicked:T}),l.defaultExpandAll===!0&&L(),()=>{const e=O(l.nodes);return s("div",{class:G.value},e.length===0?l.filter?l.noResultsLabel||S.lang.tree.noResults:l.noNodesLabel||S.lang.tree.noNodes:e)}}});export{Ae as Q};
