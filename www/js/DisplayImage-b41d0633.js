import{_ as g,q as m,d8 as f,dK as u,ds as h,j as v,o as t,d as s,K as a,a2 as r,k as l,d0 as c,w as p,i as I,t as y,n,f as o}from"./index-2b0597a6.js";const w=m({name:"ModuleDisplayImage",props:["widget","_containerSize","_widgetSize","_alignment"],data(){return{size:{width:this._widgetSize.width,height:this._containerSize.height},url:null,state:{},loaded:!1,error:!1}},computed:{config(){return f.joinConfig(this.widget.config,u)},deviceConfig(){return this.widget.items&&this.widget.items[0]||{}},style(){return{width:this.config.size==="fit"||this.config.size==="cover"?this.size.width+"px":"auto",height:this.config.size==="fit"||this.config.size==="contain"?this.size.height+"px":"auto"}}},methods:{gotState(e,i){if(this.loaded=!0,e){this.error=e.message||e;return}this.url!==i.val&&this.setUrl(i.val||"")},runInterval(){this.config.refresh&&this.config.refresh>0&&(this.setRefreshInterval&&clearInterval(this.setRefreshInterval),this.setRefreshInterval=setInterval(()=>{if(this.url&&this.url.startsWith("data:image")&&clearInterval(this.setRefreshInterval),this.url&&!this.url.startsWith("data:image")&&this.config.refreshMethod==="random"){const e=this.url.indexOf("?")!==-1?this.url.substr(this.url.indexOf("?")).replace("?","&").replace(/&_r=[0-9]*/,""):"";this.setUrl(this.url.substr(0,this.url.indexOf("?")>-1?this.url.indexOf("?"):this.url.length)+"?_r="+Date.now()+e)}else this.url&&!this.url.startsWith("data:image")&&this.config.refreshMethod==="whitespace"&&this.setUrl((this.url+" ").replace(/ {2}/g,""))},this.config.refresh*1e3))},setUrl(e){e=e.toString().trim(),e&&e.indexOf("<svg")!==-1&&(e=e.replace("<svg ",'<svg width="100%" height="100%" ')),e&&!e.startsWith("data:image")&&e.indexOf("/")===-1&&(e="data:image;base64,"+e),this.url=e,this.revision=Date.now().toString()}},watch:{_widgetSize(e){this.size.width=e.width},_containerSize(e){this.size.height=e.height},deviceConfig:{immediate:!0,handler:function(e){this.revision=this.widget.revision,this.widget.config.url?(this.setUrl(this.widget.config.url),this.loaded=!0):(this.device=h.get(e.deviceId),this.device?e.primaryStateKey&&h.listen(this.device.id,e.primaryStateKey,this.gotState):(this.error="DisplayImage: "+this.$i18n.t("Device {deviceId} not found").replace("{deviceId}",e.deviceId),console.warn(this.error),this.loaded=!0))}}},mounted(){this.runInterval()},beforeUnmount(){this.setRefreshInterval&&clearInterval(this.setRefreshInterval),this.device}}),z=["innerHTML"],D=["src"];function _(e,i,S,j,b,M){const d=v("alert");return t(),s("div",{class:o(["jarvis-DisplayImage",{[e._alignment.h]:!0,[e._alignment.v]:!0}]),style:n({width:e.size.width+"px",height:e.size.height+"px"})},[a(l(c,{indeterminate:""},null,512),[[r,!e.loaded&&!e.error]]),a(l(d,null,{default:p(()=>[I(y(e.error),1)]),_:1},512),[[r,e.loaded&&e.error]]),e.url&&e.url.startsWith("<svg")?(t(),s("div",{key:0,style:n(e.style),innerHTML:e.url},null,12,z)):a((t(),s("img",{key:1,class:o(["jarvis-DisplayImage-Image",{[e._alignment.h]:!0,[e._alignment.v]:!0}]),src:e.url,style:n(e.style)},null,14,D)),[[r,e.loaded&&!e.error]])],6)}var R=g(w,[["render",_]]);export{R as default};
