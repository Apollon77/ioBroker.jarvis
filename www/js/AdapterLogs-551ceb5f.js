import{bt as N,a4 as Q,bN as S,Q as b,da as V,dA as B,k as h,aZ as I,cq as M,aG as P,ay as r,W as T,b3 as k,bn as _,a2 as d,d1 as D,b1 as l,a1 as v,D as f,U as i,bu as c,V as g,X as $,A as j,C as E,ds as F,d6 as H,cH as O}from"./index-32e2b91d.js";import{Q as W,b as y,c as q}from"./QTable-a7d0b3af.js";import"./QVirtualScroll-1adb73be.js";const w=Q({name:"ModuleAdapterLogs",props:["widget","_containerSize"],setup(t){const p=F.getConnection,C=S(),x=b(()=>t.widget.config),a=b(()=>({...V.joinConfig(x.value,B)})),z=[{name:"from",field:"from",label:"Adapter",align:"left",sortable:!0},{name:"ts",field:"ts",label:"Time",align:"left",sortable:!0},{name:"severity",field:"severity",label:"Severity",align:"left",sortable:!0},{name:"message",field:"message",label:"Message",align:"left",sortable:!1}],u=e=>!(!a.value.adapters.includes(e.from)||!a.value.severity.includes(e.severity)||a.value.message&&RegExp(a.value.message,"gi").test(e.message)),s=(e,n)=>(e.from.startsWith("host.")||e.from,e.raw=e.message,e._id=H(),e.ts=Number.isInteger(e.ts)?O(e.ts,a.value.timeFormat||"dd.MM.yyyy HH:mm:ss"):e.ts,e.icon=n[e.from]&&n[e.from].extIcon?"img:"+n[e.from].extIcon:"",e.message=e.message.replace(e.from,""),e.message=e.message.indexOf(") ")!==-1?e.message.substr(e.message.indexOf(") ")+2):e.message,a.value.columns.includes("from")||delete e.from,a.value.columns.includes("ts")||delete e.ts,a.value.columns.includes("severity")||delete e.severity,a.value.columns.includes("message")||delete e.message,e),A=h(!1),L=h(null),m=h();return I(()=>{const e=C.instances.val||{};p.getLogs("current").then(n=>{m.value=n.filter(o=>u(o)).map(o=>s(o,e)),M.getInstance().on("message",o=>{u(o)&&m.value.unshift(s(o,e))}),p.on("_log",o=>{u(o)&&m.value.unshift(s(o,e))})}).catch(n=>{console.error(n),L.value=n.message||n}).finally(()=>{A.value=!0})},{flush:"post"}),{moduleConfig:a,columns:z,columnsVisible:a.value.columns,pagination:b(()=>({sortBy:a.value.sortColumn,descending:a.value.sortDirection,rowsPerPage:a.value.rowsPerPage})),loaded:A,error:L,logs:m}}});function G(t,p,C,x,a,z){const u=P("alert");return r(),T("div",{key:t.widget.revision,class:"jarvis-AdapterLogs",style:E({height:t._containerSize.height+"px"})},[k(d(D,{indeterminate:""},null,512),[[_,!t.loaded&&!t.error]]),k(d(u,null,{default:l(()=>[v(f(t.error),1)]),_:1},512),[[_,t.loaded&&t.error]]),k(d(q,{rows:t.logs,flat:"",dense:t.moduleConfig.dense,pagination:t.pagination,"binary-state-sort":"",columns:t.columns,"row-key":"_id","visible-columns":t.columnsVisible,class:"sticky-table-header full-height"},{body:l(({row:s})=>[d(W,null,{default:l(()=>[s.from!==void 0?(r(),i(y,{key:0},{default:l(()=>[d(c,{name:s.icon},null,8,["name"]),v(" \xA0"+f(s.from),1)]),_:2},1024)):g("",!0),s.ts!==void 0?(r(),i(y,{key:1},{default:l(()=>[v(f(s.ts),1)]),_:2},1024)):g("",!0),s.severity!==void 0?(r(),i(y,{key:2},{default:l(()=>[s.severity==="info"?(r(),i(c,{key:0,size:"xs",name:"mdi-information",color:"blue"})):s.severity==="warn"?(r(),i(c,{key:1,size:"xs",name:"mdi-alert-box",color:"warning"})):s.severity==="error"?(r(),i(c,{key:2,size:"xs",name:"mdi-close-box",color:"negative"})):(r(),i(c,{key:3,size:"xs",name:"mdi-bug",color:"grey"})),$("span",{style:{"margin-left":"4px"},class:j("text-"+(s.severity==="info"?"primary":s.severity==="warn"?"warning":s.severity==="error"?"negative":"grey"))},f(s.severity),3)]),_:2},1024)):g("",!0),s.message!==void 0?(r(),i(y,{key:3},{default:l(()=>[v(f(typeof s.message=="object"?JSON.stringify(s.message):s.message),1)]),_:2},1024)):g("",!0)]),_:2},1024)]),_:1},8,["rows","dense","pagination","columns","visible-columns"]),[[_,t.loaded&&!t.error]])],4)}var X=N(w,[["render",G]]);export{X as default};
