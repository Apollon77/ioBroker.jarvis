import{Q as L}from"./QToolbarTitle-1033c81a.js";import{a4 as M,cq as T,bM as A,cs as F,cn as N,k as I,aZ as X,bt as O,aG as y,ay as l,W as u,a2 as o,b1 as a,I as P,aE as V,b3 as j,U as E,a1 as C,D as g,bn as U,A as v,bB as k,V as $,X as z,cN as Z,bw as K,Q as h,bD as Y,C as x,d8 as ee}from"./index-e8eb9d18.js";import{Q as te}from"./QToolbar-d83ff262.js";import{Q as oe}from"./QExpansionItem-8a2be7fc.js";import{J as ie}from"./json-editor-4a37dc13.js";import{Q as G,a as B,b as W,c as se}from"./QTable-54ec5cab.js";import{Q as ne}from"./QTooltip-3f844f9d.js";import{u as le}from"./useCopyToClipboard-e234cd8b.js";import{W as ae}from"./WidgetPage-7574d10e.js";import"./QSlideTransition-d3bd6239.js";import"./_commonjsHelpers-55d1ff45.js";import"./QVirtualScroll-3ca05b59.js";import"./useDragDrop-973174b7.js";const de=M({name:"WidgetsTable",props:["widgets"],emits:["onEditWidget"],setup(e,{emit:r}){T.dev("DEBUG","WidgetsTable","setup()",e.widgets);const c=A(),p=F(),m=N(),b={sortBy:"title",rowsPerPage:15},w=[{name:"id",label:c.t("ID"),field:"id",align:"left",sortable:!0},{name:"title",label:c.t("Title")+" ("+c.t("ID")+")",field:"title",align:"left",sortable:!0,style:{width:"20%"}},{name:"module",label:c.t("Module"),field:"module",align:"left",sortable:!0,style:{width:"15%"}},{name:"usage",label:c.t("Usage")+" [ #: "+c.t("Tab")+" ("+c.t("Page")+") ]",field:"usage",align:"left",sortable:!0,style:{width:"65%"}}],t=I({});X(()=>{T.dev("DEBUG","WidgetsTable","watchEffect");const n={};for(const D of m.layout){const J=D.tabs||[];for(const _ of J){const q=[..._.widgetsDesktop||[],..._.widgetsSmartphone||[]];for(const R of q){const H=R.items||[];for(const Q of H)n[Q]=n[Q]||[],n[Q].push({widget:R,tab:_,page:D})}}}t.value=n});const{copyToClipboard:s}=le();return{pagination:b,columns:w,usage:t,copyClipboard:s,goTo:(n,D,J)=>{T.dev("DEBUG","WidgetsTable","goTo"),m.set({selectedPage:n,selectedTab:D}),p.push({name:"LayoutPage"})},isDeleted:n=>n._deleted===!0,onWidgetEdit:n=>r("onEditWidget",n),onWidgetCopy:n=>m.copyWidget({widget:n}),onWidgetRemove:n=>m.removeWidget({widget:n}),onWidgetRestore:n=>m.restoreWidget({widget:n})}}}),re={class:"q-pa-md"},ue={key:0},ce=["onClick"],ge={key:0},me={key:1},we={key:2};function fe(e,r,c,p,m,b){const w=y("icon");return l(),u("div",re,[o(se,{rows:e.widgets,columns:e.columns,pagination:e.pagination,"rows-per-page-label":e.$t("Widgets per page")},{header:a(t=>[o(G,{props:t},{default:a(()=>[o(B,{"auto-width":""}),(l(!0),u(P,null,V(t.cols,s=>j((l(),E(B,{key:s.name,props:t},{default:a(()=>[C(g(s.label),1)]),_:2},1032,["props"])),[[U,s.field!=="id"]])),128)),o(B,{"auto-width":""})]),_:2},1032,["props"])]),body:a(t=>[o(G,{props:t,class:v({rowDeleted:e.isDeleted(t.row)})},{default:a(()=>[o(W,{"auto-width":""},{default:a(()=>[e.isDeleted(t.row)!==!0?(l(),u("div",ue,[o(k,{size:"sm",flat:"",round:"",onClick:s=>e.onWidgetEdit(t.row),icon:"mdi-pencil"},null,8,["onClick"]),o(k,{size:"sm",flat:"",round:"",onClick:s=>e.onWidgetCopy(t.row),icon:"mdi-content-copy"},null,8,["onClick"])])):$("",!0)]),_:2},1024),o(W,null,{default:a(()=>[z("div",{class:v({itemDeleted:e.isDeleted(t.row)}),onClick:s=>e.copyClipboard(t.cols[0].value)},[o(ne,null,{default:a(()=>[C(" ID: "+g(t.cols[0].value)+" ("+g(e.$t("click to copy to clipboard"))+") ",1)]),_:2},1024),t.cols[1].value?(l(),u("span",ge,g(t.cols[1].value),1)):(l(),u("em",me,"("+g(e.$t("no title"))+")",1)),t.row.label?(l(),u("span",we," ("+g(t.row.label)+")",1)):$("",!0),o(w,{name:"clipboard-text-multiple-outline",size:"xs",style:{"margin-left":"4px"}})],10,ce)]),_:2},1024),o(W,null,{default:a(()=>[z("div",{class:v({itemDeleted:e.isDeleted(t.row)})},g(t.cols[2].value),3)]),_:2},1024),o(W,null,{default:a(()=>[e.usage[t.row.id]?(l(),u("div",{key:1,class:v({itemDeleted:e.isDeleted(t.row)})},[C(g(e.usage[t.row.id].length)+": ",1),(l(!0),u(P,null,V(e.usage[t.row.id],({widget:s,tab:f,page:d},i)=>(l(),E(Z,{key:t.row.id+"-"+i,square:"",color:"primary","text-color":"white",onClick:S=>e.goTo(d,f,s),clickable:""},{default:a(()=>[C(g(f.title+" ("+d.title+")"),1)]),_:2},1032,["onClick"]))),128))],2)):(l(),u("div",{key:0,class:v({itemDeleted:e.isDeleted(t.row)})},null,2))]),_:2},1024),o(W,{"auto-width":""},{default:a(()=>[e.isDeleted(t.row)!==!0?(l(),E(k,{key:0,size:"sm",flat:"",round:"",onClick:s=>e.onWidgetRemove(t.row),icon:"mdi-delete",color:"negative"},null,8,["onClick"])):$("",!0),e.isDeleted(t.row)?(l(),E(k,{key:1,size:"sm",flat:"",round:"",onClick:s=>e.onWidgetRestore(t.row),icon:"mdi-restore",color:"positive"},null,8,["onClick"])):$("",!0)]),_:2},1024)]),_:2},1032,["props","class"])]),_:1},8,["rows","columns","pagination","rows-per-page-label"])])}var pe=O(de,[["render",fe]]);const be=M({name:"WidgetsPage",components:{JsonEditor:ie,WidgetsTable:pe,WidgetPage:ae},setup(){T.dev("DEBUG","WidgetsPage","setup()");const e=K(),r=N(),c=h(()=>e.pageHeight),p=h(()=>r.getGroupedWidgets),m=h(()=>r.getWidgetsWthoutDeletionsCount),b=h(()=>r.widgets),w=h(()=>{var i;return(i=r.settings)==null?void 0:i.configExpertMode}),t=I(),s=()=>{t.value=ee()},f=i=>{t.value=i.id},d=i=>{if(i._error){r.addError(i.id,i._error);return}r.removeError(i.id),i.value&&r.set({tmpJsonEditor:{key:i.id,json:JSON.parse(i.value)}})};return{expanded:I({}),pageHeight:c,groups:p,json:b,expertMode:w,widgetsCount:m,selectedWidgetId:t,addWidget:s,editWidget:f,onJsonEditor:d}}}),ve={class:"full-height WidgetsPage"},he={class:"row no-wrap"};function We(e,r,c,p,m,b){const w=y("widget-page"),t=y("widgets-table"),s=y("json-editor"),f=y("paper");return l(),u("div",ve,[z("div",he,[o(te,{class:"paper",style:{"min-height":"56px"}},{default:a(()=>[o(L,{shrink:""},{default:a(()=>[C(g(e.$t("Widgets"))+" ("+g(e.widgetsCount)+")",1)]),_:1}),o(Y),o(k,{color:"primary",icon:"mdi-plus-circle",label:e.$t("Add Widget"),onClick:e.addWidget},null,8,["label","onClick"])]),_:1})]),o(w,{onOnClose:r[0]||(r[0]=d=>e.selectedWidgetId=null),widgetId:e.selectedWidgetId},null,8,["widgetId"]),(l(!0),u(P,null,V(e.groups,d=>j((l(),u("div",{class:"row no-wrap paper",key:d.id},[o(oe,{modelValue:e.expanded[d.id],"onUpdate:modelValue":i=>e.expanded[d.id]=i,icon:d.icon,label:d.label+" ("+d.widgets.length+")",class:"full-width"},{default:a(()=>[o(t,{onOnEditWidget:e.editWidget,widgets:d.widgets},null,8,["onOnEditWidget","widgets"])]),_:2},1032,["modelValue","onUpdate:modelValue","icon","label"])])),[[U,!e.expertMode&&d.widgets.length>0]])),128)),j(o(f,{style:x({height:e.pageHeight-66-16+"px"})},{default:a(()=>[o(s,{id:"widgets",json:e.json,onOnChange:e.onJsonEditor},null,8,["json","onOnChange"])]),_:1},8,["style"]),[[U,e.expertMode]])])}var ze=O(be,[["render",We]]);export{ze as default};
