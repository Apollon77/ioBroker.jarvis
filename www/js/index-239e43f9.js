import{Q as W}from"./QToolbarTitle-d52378e6.js";import{Q as I}from"./QTooltip-d5ee9f2c.js";import{bW as j,u as A,cj as U,a2 as V,ck as K,c as g,x as S,b6 as Y,cl as G,h as J,cm as X,aY as Z,_,q as x,cn as ee,co as te,H as ie,cp as se,cq as oe,cr as ne,cs as ae,j as H,o as y,a as k,w as f,k as l,i as q,t as L,O as N,d as D,l as re,F as B,ct as le,cu as ue,g as T,ab as de,cv as ce,cw as M}from"./index-bdb9984b.js";import{Q as P}from"./QToolbar-403aec80.js";import{Q as fe,a as ge,b as ve}from"./QPageContainer-646c4d44.js";import{Q as me}from"./QHeader-70f6c0c7.js";var pe=j({name:"QFooter",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(e,{slots:s,emit:w}){const{proxy:{$q:h}}=Z(),n=A(U,()=>{console.error("QFooter needs to be child of QLayout")}),m=V(parseInt(e.heightHint,10)),d=V(!0),C=V(K.value===!0||n.isContainer.value===!0?0:window.innerHeight),b=g(()=>e.reveal===!0||n.view.value.indexOf("F")>-1||h.platform.is.ios&&n.isContainer.value===!0),a=g(()=>n.isContainer.value===!0?n.containerHeight.value:C.value),Q=g(()=>{if(e.modelValue!==!0)return 0;if(b.value===!0)return d.value===!0?m.value:0;const i=n.scroll.value.position+a.value+m.value-n.height.value;return i>0?i:0}),$=g(()=>e.modelValue!==!0||b.value===!0&&d.value!==!0),O=g(()=>e.modelValue===!0&&$.value===!0&&e.reveal===!0),F=g(()=>"q-footer q-layout__section--marginal "+(b.value===!0?"fixed":"absolute")+"-bottom"+(e.bordered===!0?" q-footer--bordered":"")+($.value===!0?" q-footer--hidden":"")+(e.modelValue!==!0?" q-layout--prevent-focus"+(b.value!==!0?" hidden":""):"")),E=g(()=>{const i=n.rows.value.bottom,c={};return i[0]==="l"&&n.left.space===!0&&(c[h.lang.rtl===!0?"right":"left"]=`${n.left.size}px`),i[2]==="r"&&n.right.space===!0&&(c[h.lang.rtl===!0?"left":"right"]=`${n.right.size}px`),c});function o(i,c){n.update("footer",i,c)}function t(i,c){i.value!==c&&(i.value=c)}function p({height:i}){t(m,i),o("size",i)}function v(){if(e.reveal!==!0)return;const{direction:i,position:c,inflectionPoint:R}=n.scroll.value;t(d,i==="up"||c-R<100||n.height.value-a.value-c-m.value<300)}function r(i){O.value===!0&&t(d,!0),w("focusin",i)}S(()=>e.modelValue,i=>{o("space",i),t(d,!0),n.animate()}),S(Q,i=>{o("offset",i)}),S(()=>e.reveal,i=>{i===!1&&t(d,e.modelValue)}),S(d,i=>{n.animate(),w("reveal",i)}),S([m,n.scroll,n.height],v),S(()=>h.screen.height,i=>{n.isContainer.value!==!0&&t(C,i)});const u={};return n.instances.footer=u,e.modelValue===!0&&o("size",m.value),o("space",e.modelValue),o("offset",Q.value),Y(()=>{n.instances.footer===u&&(n.instances.footer=void 0,o("size",0),o("offset",0),o("space",!1))}),()=>{const i=G(s.default,[J(X,{debounce:0,onResize:p})]);return e.elevated===!0&&i.push(J("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),J("footer",{class:F.value,style:E.value,onFocusin:r},i)}}});const z=[{id:"devices",title:"Devices",icon:"mdi-devices"},{id:"widgets",title:"Widgets",icon:"mdi-view-grid"},{id:"layout",title:"Layout",icon:"mdi-file"},{id:"styles",title:"Styles",icon:"mdi-code-tags",pro:!0},{id:"scripts",title:"scripts",icon:"mdi-language-javascript",pro:!0},{id:"settings",title:"Settings",icon:"mdi-cog"},{id:"account",title:"Pro-Account",icon:"mdi-star"},{id:"help",title:"Help",icon:"mdi-help-box"}],ye=x({name:"ConfigurationLayout",components:{Login:ee},setup(){var E;const e=te(),s=ie(),w=se(),h=oe();if(e.init({devices:s.devices,layout:Array.isArray(s.layout)&&s.layout.length>0?s.layout:[{id:"2bbbe067-7506-4fac-8a1f-bfbf9f48a9e7",type:"page",icon:"mdi-view-dashboard-variant",title:"Overview",tabs:[{icon:"mdi-desktop-mac-dashboard",title:"Dashboard",id:"674d30a6-83d8-4876-9135-55791d7dfec9",widgetsDesktop:[],widgetsSmartphone:[]}]}],styles:s.styles,scripts:s.scripts,settings:s.settings,widgets:s.widgets}),w.name==="Configuration"){const o=ne(((E=e.settings)==null?void 0:E.configTab)||z[0].id)+"Page";setTimeout(()=>{h.replace({name:o,params:w.params}).catch(t=>console.error(t))},500)}const n=V(ae.get("secureConfiguration")),m=g(()=>s.settings),d=g(()=>e.hasErrors),C=g({get(){var o;return(o=e.settings)==null?void 0:o.configExpertMode},set(o){e.set("settings.configExpertMode",o)}}),b=g({get(){var o;return(o=e.settings)==null?void 0:o.configTab},set(o){o&&e.set("settings.configTab",o)}}),a=window.open,Q=o=>window.location.href.endsWith("configuration")||window.location.href.endsWith("configuration/")?"/configuration/"+o:o,$=(o,t)=>(s.set("pageHeight",t-o),{"min-height":t-o+"px"}),O=()=>{s.set("drawerSidebar",!1),h.push({name:"home",params:{...w.params,tabId:s.getSelectedTabId}}).catch(()=>{})};return{hasErrors:d,settings:m,login:n,version:"3.1.0-alpha.21",configTab:b,expertMode:C,tabs:z,setPageContainer:$,to:Q,onOpen:a,onCancel:O,onSave:o=>{const t={devices:e.devices,widgets:M(e.widgets),layout:M(e.getLayoutWithoutDeletions)||[],styles:e.styles,scripts:e.scripts,settings:e.settings};for(const v in t.widgets)t.widgets[v].items=t.widgets[v].items||[],t.widgets[v].items=t.widgets[v].items.filter(r=>t.devices[r.deviceId]&&(!t.devices[r.deviceId].attributes||t.devices[r.deviceId].attributes&&t.devices[r.deviceId].attributes.deleted!==!0));t.layout.forEach(v=>{v.tabs=v.tabs||[],v.tabs.forEach(r=>{delete r.widgets,r.widgetsDesktop=r.widgetsDesktop||[],r.widgetsDesktop.forEach(u=>{u.items=u.items||[],u.items=u.items.filter(i=>t.widgets[i]&&t.widgets[i]._deleted!==!0)}),r.widgetsSmartphone=r.widgetsSmartphone||[],r.widgetsSmartphone.forEach(u=>{u.items=u.items||[],u.items=u.items.filter(i=>t.widgets[i]&&t.widgets[i]._deleted!==!0)})})}),t.devices=e.getDevicesWithoutDeletions,t.widgets=e.getWidgetsWithoutDeletions;const p={};JSON.stringify(s.widgets)!==JSON.stringify(t.widgets)&&(p.widgets=t.widgets),JSON.stringify(s.devices)!==JSON.stringify(t.devices)&&(p.devices=t.devices),JSON.stringify(s.layout)!==JSON.stringify(t.layout)&&(p.layout=t.layout),JSON.stringify(s.settings)!==JSON.stringify(t.settings)&&(p.settings=t.settings),JSON.stringify(s.styles)!==JSON.stringify(t.styles)&&(p.styles=t.styles),JSON.stringify(s.scripts)!==JSON.stringify(t.scripts)&&(p.scripts=t.scripts),e.save(p),o?O():e.init(t)}}}}),he={key:1};function be(e,s,w,h,n,m){const d=H("icon"),C=H("Login"),b=H("router-view");return y(),k(ce,{view:"hHh lpR fFf"},{default:f(()=>[!e.settings.secureConfiguration||e.settings.secureConfiguration&&e.login?(y(),k(me,{key:0},{default:f(()=>[l(P,null,{default:f(()=>[l(W,null,{default:f(()=>[l(d,{name:"mdi-cog",vAlign:"middle"}),q(" "+L(e.$t("Configuration"))+" (v"+L(e.version)+") ",1)]),_:1}),l(N,{flat:"",dense:"",round:"",icon:e.expertMode?"mdi-code-tags-check":"mdi-code-tags","aria-label":"$t('Expert Mode')",onClick:s[0]||(s[0]=a=>e.expertMode=!e.expertMode)},{default:f(()=>[l(I,null,{default:f(()=>[q(L(e.$t("Expert Mode")),1)]),_:1})]),_:1},8,["icon"])]),_:1}),l(ue,{modelValue:e.configTab,"onUpdate:modelValue":s[1]||(s[1]=a=>e.configTab=a),"inline-label":"",dense:"","outside-arrows":"","mobile-arrows":"",align:"left"},{default:f(()=>[(y(!0),D(B,null,re(e.tabs,a=>(y(),D(B,null,[a.link?(y(),k(le,{key:a.id,name:a.id,label:e.$t(a.title),icon:a.icon,onClick:Q=>e.onOpen(a.link,"_blank")},null,8,["name","label","icon","onClick"])):(y(),k(fe,{key:a.id,name:a.id,label:e.$t(a.title),icon:a.icon,to:e.to(a.id)},null,8,["name","label","icon","to"]))],64))),256))]),_:1},8,["modelValue"])]),_:1})):T("",!0),l(ve,{class:"ConfigurationPage body"},{default:f(()=>[l(ge,{"style-fn":e.setPageContainer},{default:f(()=>[e.settings.secureConfiguration!==void 0&&e.settings.secureConfiguration!==!1&&!e.login?(y(),k(C,{key:0,ns:"secureConfiguration",code:e.settings.secureConfiguration,onOnSuccess:s[2]||(s[2]=a=>e.login=!0)},null,8,["code"])):T("",!0),!e.settings.secureConfiguration||e.settings.secureConfiguration&&e.login?(y(),D("div",he,[l(b)])):T("",!0)]),_:1},8,["style-fn"])]),_:1}),!e.settings.secureConfiguration||e.settings.secureConfiguration&&e.login?(y(),k(pe,{key:1},{default:f(()=>[l(P,null,{default:f(()=>[l(N,{flat:"",icon:"mdi-window-close","aria-label":"Cancel",label:e.$t("Cancel"),class:"text-red",onClick:e.onCancel},null,8,["label","onClick"]),l(de),l(N,{disable:e.hasErrors,icon:"mdi-content-save","aria-label":"Save",label:e.$t("Save"),flat:"",color:"primary",onClick:s[3]||(s[3]=a=>e.onSave(!1)),style:{"margin-right":"8px"}},null,8,["disable","label"]),l(N,{disable:e.hasErrors,icon:"mdi-content-save","aria-label":"Save & Exit",label:e.$t("Save")+" & "+e.$t("Exit"),color:"primary",onClick:s[4]||(s[4]=a=>e.onSave(!0))},null,8,["disable","label"])]),_:1})]),_:1})):T("",!0)]),_:1})}var Oe=_(ye,[["render",be]]);export{Oe as default};
