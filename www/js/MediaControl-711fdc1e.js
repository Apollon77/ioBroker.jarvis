import{bt as Z,a4 as K,Q as g,d8 as _,e8 as x,k as P,r as ee,an as ae,ao as oe,e9 as N,aG as se,ay as S,W as j,X as n,C as A,a1 as M,D as c,b3 as d,bn as u,a2 as f,b1 as Q,U as E,V as w,bC as R,cP as te,I as G,bs as re,cG as H,bY as O,dp as U}from"./index-e89a99fa.js";import{Q as ne}from"./QTooltip-b754651d.js";const{getPaletteColor:le,changeAlpha:ie}=re,de=K({name:"ModuleMediaControl",props:["widget","_containerSize","_widgetSize"],setup(e){const o=g(()=>e.widget.config),y=g(()=>({..._.joinConfig(o.value,x)})),l=g(()=>y.value.adapter.substr(0,y.value.adapter.indexOf("."))),T=P([]),h=P(null),p=g(()=>T.value.find(t=>t.id===h.value)||{}),s=ee({}),X=g(()=>({height:e._containerSize.height-50+"px","background-image":s.cover?"url('"+y.value.coverUrl+s.cover+"')":"none","background-size":y.value.coverMode?"auto 100%":"100% auto",paddingTop:e._containerSize.height-50-50-6+"px"})),q=g(()=>({background:ie(le("primary"),.8)})),F=g(()=>({width:(Math.floor(s.progress/s.duration*e._widgetSize.width)||0)+"px"})),I=P(0),$=P(0),Y=a=>z("progress",Math.round(a.layerX/e._widgetSize.width*s.duration)),W=a=>{I.value=Math.round(a.layerX/e._widgetSize.width*100),$.value=N(I.value/100*s.duration)},k=P({}),m=P({}),C=(a="",t=null)=>(t=t||h.value||"",t?(y.value.adapter+m.value[l.value]._namespace+a).replace("{PLAYER}",t||""):null),V=({val:a})=>{k.value[l.value]&&k.value[l.value].setPlayer&&k.value[l.value].setPlayer(t=>C(t,a),t=>C(t)),h.value=a,H.set("MediaControl.player."+e.widget.id,a)},z=(a,t=!0)=>{if(a==="play"&&p.value?(s.play=!0,V({val:p.value.id})):a==="pause"&&(s.play=!1),m.value[l.value][a]&&m.value[l.value][a].action){const i=C(m.value[l.value][a].action);i&&U.getConnection.setState(i,m.value[l.value][a].setter?m.value[l.value][a].setter(t,C):t).catch(b=>{console.error(b)})}},B=P([]),J=a=>{if(!B.value.includes(a)){B.value.push(a);const t=U.getConnection;for(const i in m.value[l.value]){let r=m.value[l.value][i];r=typeof r=="string"?{state:r}:r,r&&r.state&&(r.stateKey=i,t.subscribeState(C(r.state),({err:b,state:v})=>{!b&&v&&v.val!==void 0&&(v.val=r.display&&r.display[v.val]||v.val,s[i]=r.convert?r.convert(v.val):v.val)}))}}},L=()=>{k.value[l.value]&&k.value[l.value].getPlayers(y.value.adapter).then(a=>{if(a.length>0){T.value=a;const t=H.get("MediaControl.player."+e.widget.id)||a[0].id,i=t&&a[a.findIndex(r=>r.id===t)];h.value=i?i.id:a[0].id,J(h.value)}})};let D=null;return ae(()=>{const a={"./adapters/alexa2.js":()=>O(()=>import("./alexa2-7b18cccc.js"),["js/alexa2-7b18cccc.js","js/index-e89a99fa.js","css/index-c1909253.css"]),"./adapters/musiccast.js":()=>O(()=>import("./musiccast-5292e307.js"),["js/musiccast-5292e307.js","js/index-e89a99fa.js","css/index-c1909253.css"]),"./adapters/plex.js":()=>O(()=>import("./plex-bac56386.js"),["js/plex-bac56386.js","js/index-e89a99fa.js","css/index-c1909253.css"]),"./adapters/spotify-premium.js":()=>O(()=>import("./spotify-premium-f02f3ffe.js"),["js/spotify-premium-f02f3ffe.js","js/index-e89a99fa.js","css/index-c1909253.css"]),"./adapters/yamaha.js":()=>O(()=>import("./yamaha-1e75e474.js"),["js/yamaha-1e75e474.js","js/index-e89a99fa.js","css/index-c1909253.css"])},t=[];for(const i in a){const r=a[i]().then(b=>{const v=i.substr(i.lastIndexOf("/")+1).replace(".js","");return k.value[v]=b,m.value[v]=b.default,!0});t.push(r)}Promise.allSettled(t).then(()=>{L(),D=setInterval(()=>{L()},60*1e3)})}),oe(()=>D&&clearInterval(D)),{secondsToHoursMinutesSeconds:N,media:s,cover:X,trackInformation:q,trackProgress:F,updateProgressSetter:W,setProgress:Y,setProgressToTime:$,setProgressToPercent:I,selectPlayer:V,players:T,player:p,set:z,adapterStates:m}}}),ue={class:"full-height"},pe={class:"row"},me={class:"col nowrap ellipsis"},ve={class:"row"},ce={class:"col-grow",style:{overflow:"hidden"}},fe={class:"col-shrink",style:{"text-align":"right"}},ye={class:"track-duration disabled"},ge={class:"controls q-pa-sm"},Pe={class:"controlsLeft"},he={class:"controlsCenter"},ke={class:"controlsRight"};function be(e,o,y,l,T,h){const p=se("inputs");return S(),j("div",ue,[n("div",{class:"cover",style:A(e.cover)},[n("div",{class:"track-information q-pa-sm",style:A(e.trackInformation)},[n("div",pe,[n("div",me,[M(c((e.media.artist||"")+(e.media.album?" - "+e.media.album:""))+" ",1),d(n("span",null,"("+c(e.media.year)+")",513),[[u,e.media.align==="top"&&e.media.year]])])]),n("div",ve,[n("div",ce,[M(c(e.media.track)+" ",1),d(n("span",null,"("+c(e.media.year)+")",513),[[u,e.media.align==="bottom"&&e.media.year]])]),d(n("div",fe,[M(c(e.secondsToHoursMinutesSeconds(e.media.progress))+" ",1),d(n("span",null,"/ "+c(e.secondsToHoursMinutesSeconds(e.media.duration)),513),[[u,e.media.progress&&e.media.duration]])],512),[[u,e.media.progress||e.media.duration]])])],4),d(n("div",{class:"track-duration",onMousemove:o[1]||(o[1]=(...s)=>e.updateProgressSetter&&e.updateProgressSetter(...s)),onClick:o[2]||(o[2]=(...s)=>e.setProgress&&e.setProgress(...s))},[f(ne,{anchor:"top middle"},{default:Q(()=>[M(c(e.setProgressToTime)+" ("+c(e.setProgressToPercent)+"%)",1)]),_:1}),n("div",{class:"track-progress",style:A(e.trackProgress),onClick:o[0]||(o[0]=(...s)=>e.setProgress&&e.setProgress(...s))},null,4)],544),[[u,e.media.progress]]),d(n("div",ye,null,512),[[u,!e.media.progress]])],4),n("div",ge,[n("div",Pe,[e.media.type!=="RADIO"?(S(),E(p,{key:0,type:"button",color:"accent",icon:"mdi-monitor-cellphone-star",tooltip:e.player.name,items:e.players,onOnSelect:e.selectPlayer,selected:e.player.id},null,8,["tooltip","items","onOnSelect","selected"])):w("",!0)]),n("div",he,[f(te,null,{default:Q(()=>[e.adapterStates.previous&&e.adapterStates.previous.action?d((S(),E(R,{key:0,color:"primary",onClick:o[3]||(o[3]=s=>e.set("previous")),icon:"mdi-skip-previous"},null,512)),[[u,e.media.type!=="RADIO"]]):w("",!0),f(R,{color:"primary",onClick:o[4]||(o[4]=s=>e.set(e.media.play?"pause":"play")),icon:e.media.play?"mdi-pause":"mdi-play"},null,8,["icon"]),e.adapterStates.next&&e.adapterStates.next.action?d((S(),E(R,{key:1,color:"primary",onClick:o[5]||(o[5]=s=>e.set("next")),icon:"mdi-skip-next"},null,512)),[[u,e.media.type!=="RADIO"]]):w("",!0)]),_:1})]),n("div",ke,[e.media.type!=="RADIO"?(S(),j(G,{key:0},[d(f(p,{round:"",onOnClick:o[6]||(o[6]=s=>e.set("shuffle","on")),type:"button",color:"secondary",icon:"mdi-shuffle-disabled",tooltip:"shuffle is off"},null,512),[[u,e.adapterStates.shuffle&&e.media.shuffle==="off"]]),d(f(p,{round:"",onOnClick:o[7]||(o[7]=s=>e.set("shuffle","off")),type:"button",color:"secondary",icon:"mdi-shuffle-variant",tooltip:"shuffle is on"},null,512),[[u,e.adapterStates.shuffle&&e.media.shuffle==="on"]])],64)):w("",!0),e.media.type!=="RADIO"?(S(),j(G,{key:1},[d(f(p,{round:"",onOnClick:o[8]||(o[8]=s=>e.set("repeat","once")),type:"button",color:"secondary",icon:"mdi-repeat-off",tooltip:"repeat off"},null,512),[[u,e.adapterStates.repeat&&e.media.repeat==="off"]]),d(f(p,{round:"",onOnClick:o[9]||(o[9]=s=>e.set("repeat","all")),type:"button",color:"secondary",icon:"mdi-repeat-once",tooltip:"repeat once"},null,512),[[u,e.adapterStates.repeat&&e.media.repeat==="once"]]),d(f(p,{round:"",onOnClick:o[10]||(o[10]=s=>e.set("repeat","off")),type:"button",color:"secondary",icon:"mdi-repeat",tooltip:"repeat all"},null,512),[[u,e.adapterStates.repeat&&e.media.repeat==="all"]])],64)):w("",!0)])])])}var we=Z(de,[["render",be]]);export{we as default};
