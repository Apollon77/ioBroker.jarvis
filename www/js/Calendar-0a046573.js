import{dz as W,dA as K,dB as F,bW as X,cQ as ee,bZ as ae,cR as te,c3 as ne,c as b,h as q,T as oe,aY as se,cM as T,W as le,_ as re,q as ie,dn as de,ci as ue,az as ce,d7 as ve,dC as ge,a2 as C,b5 as me,A as fe,j as B,o as A,d as $,J as N,a1 as E,k as u,e as m,a as ye,w as f,a8 as he,g as pe,dD as Ce,E as be,c$ as ke,a5 as O,t as D,ab as we,O as De,a6 as Se,a4 as _e,F as Me,l as qe,n as Ae,dE as ze,i as Pe}from"./index-80522cd8.js";import Qe from"./EventList-c95993de.js";import{n as Be}from"./index-e8ee05ed.js";import{s as I}from"./index-f6a75a40.js";import"./QTooltip-839cbf20.js";import"./___vite-browser-external_commonjs-proxy-0107ae2e.js";import"./_commonjsHelpers-45ea234c.js";function j(e,o){W(2,arguments);var i=K(e),v=F(o);return isNaN(v)?new Date(NaN):(v&&i.setDate(i.getDate()+v),i)}function $e(e,o){W(2,arguments);var i=F(o);return j(e,-i)}var Ne=X({name:"QInnerLoading",props:{...ee,...ae,showing:Boolean,color:String,size:{type:[String,Number],default:42},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(e,{slots:o}){const i=se(),v=te(e,i.proxy.$q),{transition:S,transitionStyle:l}=ne(e,b(()=>e.showing)),k=b(()=>"q-inner-loading absolute-full column flex-center"+(v.value===!0?" q-inner-loading--dark":"")),y=b(()=>"q-inner-loading__label"+(e.labelClass!==void 0?` ${e.labelClass}`:""));function c(){const g=[q(T,{size:e.size,color:e.color})];return e.label!==void 0&&g.push(q("div",{class:y.value,style:e.labelStyle},[e.label])),g}function n(){return e.showing===!0?q("div",{class:k.value,style:l.value},o.default!==void 0?o.default():c()):null}return()=>q(oe,{name:S.value,appear:!0},n)}});function Ee(e=!1){const o=le(),i=o.locale.value||o.locale;return e?i.substr(0,2):i}const Ie=ie({name:"ModuleCalendar",props:["_size","widget"],components:{EventList:Qe},setup(e){const o=de.getConnection,i=ue(),v=Ee(!0),S=ce(e.widget,"config"),l=ve.joinConfig(S.value,ge);l.timezone=l.timezone||"Europe/Amsterdam",l.calendars=l.calendars||[];const k=b(()=>i.dark.isActive),y=C(!1),c=C(new Date);Be.scheduleJob("0 0 0 * * *",()=>{c.value=new Date});const n=C({year:c.value.getFullYear(),month:c.value.getMonth()+1}),g=({year:a,month:t})=>{(n.value.month!==t||n.value.year!==a)&&(n.value.year=a,n.value.month=t,y.value=R[a+"-"+t]||!1,M(a,t).then(()=>{_()}))},h=I($e(c.value,l.daysReview)),V=I(j(c.value,l.daysPreview)),p=C([h,V]),U=({date:a})=>{l.calendarAgenda===!1||l.calendarAgenda!==!1&&p.value.length===2?p.value=[a]:a<p.value[0]?p.value.unshift(a):p.value.push(a),_()},J=b(()=>{let[a,t]=p.value;return t=I(t?a.getMonth()!==t.getMonth()?ze(a):t:a),c.value.getFullYear()!==n.value.year||c.value.getMonth()+1!==n.value.month?[]:[{key:"selectedEnd",highlight:{contentStyle:{backgroundColor:"var(--q-accent)",opacity:1,color:"#fff"}},dates:t,order:102},{key:"selectedStart",highlight:{contentStyle:{backgroundColor:"var(--q-accent)",opacity:1,color:"#fff"}},dates:a,order:101},{key:"selected",highlight:{style:{backgroundColor:"var(--q-accent)",opacity:.3},contentStyle:{color:"var(--q-accent)"}},dates:{start:a,end:t},order:99},{key:"today",highlight:{style:{backgroundColor:"var(--q-primary)"},contentStyle:{color:"#fff",fontWeight:"bold"}},dates:c.value,order:200}]}),Y=C([]),L=(a,t)=>{const r=[];x.value.forEach(s=>{!r.some(Q=>Q.uid===s.uid)&&(s&&s.start>=a&&s.start<=t||s&&s.start<=a&&s.end>=a)&&r.push(s)}),Y.value=r},_=()=>{let[a,t]=p.value;if(t=Ce(t||a),a.getMonth()===t.getMonth())L(a,t);else{let r=n.value.month+1;const s=r>12?n.value.year+1:n.value.year;r=r>12?1:r,M(s,r).then(()=>{L(a,t)})}},R=C({}),z=C({}),x=b(()=>Object.values(z.value).flat()),H=(a,t,r)=>new Promise((s,Q)=>{o.getSpecial("Calendar",{calendar:a,year:t,month:r,options:{...l,language:v}},w=>{if(w.error)return console.warn("Calendar-a99xoa47",e.widget.id,w.error),Q(w.error);if(w.events&&Array.isArray(w.events)){const G=w.events.map((d,Fe)=>(d.start=new Date(d.start),d.end=new Date(d.end),{calendar:a,...d,key:d.uid,dot:{style:{backgroundColor:a.color||be.getPaletteColor("primary")}},popover:{label:d.summary},dates:d.duration<=0?d.start:{start:d.start,end:d.end},customData:{calendar:a,summary:d.summary,time:d.time}}));R[t+"-"+r]=!0,z.value[a.id+":"+t+"-"+r]=G,s(z.value[a.id])}})}),M=(a,t)=>{const r=l.calendars.map(s=>H(s,a,t));return Promise.allSettled(r).then(s=>(y.value=!0,s))};let P=null;me(()=>{M(n.value.year,n.value.month).then(()=>{_()}),P=setInterval(()=>{console.debug("Calendar-d53dca17",e.widget.id,"Refreshing ical data..."),M(n.value.year,n.value.month).then(()=>{_()})},l.refresh*60*1e3)}),fe(()=>P&&clearInterval(P));const Z=b(()=>[...x.value,...J.value]);return{loaded:y,language:v,isDarkMode:k,moduleConfig:l,setDate:g,setRange:U,attributes:Z,agenda:Y}}}),Ye={style:{position:"relative"}},Le={class:"text-h6"},Re=Pe(' /* :timezone="moduleConfig.timezone" trim-weeks: By default, calendar panes always displays the maximum number of weeks in a month, even if the max week does not contain any days in the current month displayed. */ '),xe={class:"text-xs text-gray-300 font-semibold"},Oe={class:"Calendar-Popover-List"};function We(e,o,i,v,S,l){const k=B("event-list"),y=B("icon"),c=B("v-calendar");return A(),$("div",null,[N(u(ke,{indeterminate:""},null,512),[[E,!e.loaded]]),m("div",Ye,[e.moduleConfig.calendarAgenda===!1?(A(),ye(he,{key:0,"model-value":e.popup,onHide:o[1]||(o[1]=n=>e.popup=!1)},{default:f(()=>[u(_e,{style:{width:"800px","max-width":"80vw"}},{default:f(()=>[u(O,{class:"row items-center"},{default:f(()=>[m("div",Le,D(e.$t("Calendar Details")),1),u(we),u(De,{flat:"",round:"",color:"grey",icon:"close",onClick:o[0]||(o[0]=n=>e.popup=!1)})]),_:1}),u(Se),u(O,{class:"col q-pa-none scroll body"},{default:f(()=>[u(k,{agenda:e.agenda},null,8,["agenda"])]),_:1})]),_:1})]),_:1},8,["model-value"])):pe("",!0),N(m("div",null,[u(c,{"onUpdate:toPage":e.setDate,onDayclick:e.setRange,class:"Calendar",attributes:e.attributes,"is-dark":e.isDarkMode,locale:e.language,masks:{dayPopover:"WWW, D. MMMM YYYY"},"trim-weeks":"","show-iso-weeknumbers":"","disable-page-swipe":""},{"header-title":f(({monthLabel:n,year:g})=>[m("div",null,D(n+" "+g),1),u(y,{name:"mdi-calendar-cursor",size:"xs",class:"q-ml-xs"})]),"day-popover":f(({dayTitle:n,attributes:g})=>[m("div",null,[m("strong",xe,D(n),1),m("ul",Oe,[(A(!0),$(Me,null,qe(g,h=>(A(),$("li",{key:h.key+"-"+(h.customData.calendar.color||""),style:Ae({color:h.customData.calendar.color||"var(--q-primary)"})},[m("span",null,D(h.customData.time)+", "+D(h.customData.summary),1)],4))),128))])])]),default:f(()=>[Re]),_:1},8,["onUpdate:toPage","onDayclick","attributes","is-dark","locale","masks"]),u(Ne,{showing:!e.loaded},{default:f(()=>[u(T,{size:"50px",color:"primary"})]),_:1},8,["showing"])],512),[[E,e.moduleConfig.calendarPreview!==!1]]),N(u(k,{agenda:e.agenda},null,8,["agenda"]),[[E,e.moduleConfig.calendarAgenda!==!1]])])])}var Ge=re(Ie,[["render",We]]);export{Ge as default};
