import{p as $,a3 as H,al as L}from"./vendor.quasar-78ba37d9.js";import{d as x,p as O,u as w,q as A,w as T,J,r as Q,o as d,a as S,b as R,v as V,e as _,t as E,F as K,k as q,y as W,B as X,f as j,g as h,i as Y}from"./vendor.vue-1bbf3cb4.js";import{M as ee}from"./modules-9c8c454f.js";import{d as oe,b as te}from"./stores-22cbae97.js";import{L as k}from"./vendor.leaflet-26bc8f17.js";import{L as M,D as z}from"./controllers-596cf83c.js";import{_ as ie,i as ne}from"./helpers-7b53fe93.js";import{u as ae}from"./vendor.vue-i18n-e0977824.js";var re={"Map#description":"Zeigt eine Karte von OpenStreetMap und visualisiert darauf Datenpunkte mit Koordinaten.","config#Map#defaultZoom#label":"initialer Zoom der Karte","config#Map#defaultPosition#label":"initiale Koordinaten auf der Karte","config#Map#defaultPosition#description":"Latitude und Longitude mit Komma separiert (z. B. 53.550383, 9.992376)","config#Map#followDevice#label":"Ger\xE4t folgen","config#Map#followDevice#description":"Folgt dem ausgew\xE4hlten Ger\xE4t, wenn sich die Koordinaten ver\xE4ndern","config#Map#tooltipDirection#label":"Richtung in die der Tooltip \xF6ffnet","config#Map#tooltipDirection#description":"m\xF6gliche Werte: dynamisch erkennen, zentriert, oben, links, rechts or unten","config#Map#tooltipDirection#selection#auto":"dynamisch erkennen","config#Map#tooltipDirection#selection#center":"zentriert","config#Map#tooltipDirection#selection#top":"oben","config#Map#tooltipDirection#selection#left":"links","config#Map#tooltipDirection#selection#right":"rechts","config#Map#tooltipDirection#selection#bottom":"unten","config#Map#tooltipPermanent#label":"Permanenter Tooltip","config#Map#tooltipPermanent#description":"Angabe ob der Tooltip permanent ist (true) oder nur beim r\xFCberfahren mit der Maus gezeigt wird (false)","config#Map#height#label":"H\xF6he der Karte","config#Map#height#description":"H\xF6he der Karte in Pixeln (wird im Vollbildmodus ignoriert)","Jump to":"springen zu"},Pe=Object.freeze(Object.defineProperty({__proto__:null,default:re},Symbol.toStringTag,{value:"Module"})),le={"Map#description":"Displays a OpenStreetMap and visualizes states with coordinates on it.","config#Map#defaultZoom#label":"initial map zoom","config#Map#defaultPosition#label":"initial map coordinates","config#Map#defaultPosition#description":"Separate latitude and longitude via comma (e.g. 53.550383, 9.992376)","config#Map#followDevice#label":"Follow Device","config#Map#followDevice#description":"Follows the device when the coordinates change","config#Map#tooltipDirection#label":"Direction tooltip will open","config#Map#tooltipDirection#description":"possible directions to open: detect dynamically, center, top, left, right or bottom","config#Map#tooltipDirection#selection#auto":"detect dynamically","config#Map#tooltipDirection#selection#center":"center","config#Map#tooltipDirection#selection#top":"top","config#Map#tooltipDirection#selection#left":"left","config#Map#tooltipDirection#selection#right":"right","config#Map#tooltipDirection#selection#bottom":"bottom","config#Map#tooltipPermanent#label":"permanent tooltip","config#Map#tooltipPermanent#description":"Option to keep tooltip permanently open (true) or only open on mouse-over (false)","config#Map#height#label":"Height of the Map","config#Map#height#description":"Height of the Map in Pixels (will be ignored in fullscreen mode)"},Oe=Object.freeze(Object.defineProperty({__proto__:null,default:le},Symbol.toStringTag,{value:"Module"})),ce={"Map#description":"\u041E\u0442\u043E\u0431\u0440\u0430\u0436\u0430\u0435\u0442 \u043A\u0430\u0440\u0442\u0443 OpenStreetMap \u0438 \u043E\u0431\u044A\u0435\u043A\u0442\u044B \u043D\u0430 \u043D\u0435\u0439 \u043F\u043E \u043A\u043E\u043E\u0440\u0434\u0438\u043D\u0430\u0442\u0430\u043C","config#Map#defaultZoom#label":"\u041D\u0430\u0447\u0430\u043B\u044C\u043D\u044B\u0439 \u043C\u0430\u0441\u0448\u0442\u0430\u0431 \u043A\u0430\u0440\u0442\u044B","config#Map#defaultPosition#label":"\u041D\u0430\u0447\u0430\u043B\u044C\u043D\u044B\u0435 \u043A\u043E\u043E\u0440\u0434\u0438\u043D\u0430\u0442\u044B","config#Map#defaultPosition#description":"\u0420\u0430\u0437\u0434\u0435\u043B\u0438\u0442\u0435 \u0448\u0438\u0440\u043E\u0442\u0443 \u0438 \u0434\u043E\u043B\u0433\u043E\u0442\u0443 \u0437\u0430\u043F\u044F\u0442\u043E\u0439 (\u043D\u0430\u043F\u0440\u0438\u043C\u0435\u0440: 53.550383, 9.992376)","config#Map#followDevice#label":"","config#Map#followDevice#description":"","config#Map#tooltipDirection#label":"\u041E\u0442\u043A\u0440\u043E\u0435\u0442\u0441\u044F tooltip \u043D\u0430\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u044F","config#Map#tooltipDirection#description":"\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u044B\u0435 \u043D\u0430\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u044F \u0434\u043B\u044F \u043E\u0442\u043A\u0440\u044B\u0442\u0438\u044F","config#Map#tooltipDirection#selection#auto":"\u043E\u043F\u0440\u0435\u0434\u0435\u043B\u044F\u0442\u044C \u0430\u0432\u0442\u043E\u043C\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u0438","config#Map#tooltipDirection#selection#center":"\u0446\u0435\u043D\u0442\u0435\u0440","config#Map#tooltipDirection#selection#top":"\u0432\u0435\u0440\u0445","config#Map#tooltipDirection#selection#left":"\u043B\u0435\u0432\u043E","config#Map#tooltipDirection#selection#right":"\u043F\u0440\u0430\u0432\u043E","config#Map#tooltipDirection#selection#bottom":"\u043D\u0438\u0437","config#Map#tooltipPermanent#label":"\u043F\u043E\u0441\u0442\u043E\u044F\u043D\u043D\u044B\u0439 tooltip","config#Map#tooltipPermanent#description":"\u0421\u043E\u0445\u0440\u0430\u043D\u044F\u0442\u044C tooltip \u0432\u0441\u0435\u0433\u0434\u0430 \u043E\u0442\u043A\u0440\u044B\u0442\u044B\u043C (true) \u0438\u043B\u0438 \u043E\u0442\u043A\u0440\u044B\u0432\u0430\u0442\u044C \u043F\u0440\u0438 \u0434\u0432\u0438\u0436\u0435\u043D\u0438\u0438 \u043C\u044B\u0448\u043A\u0438","config#Map#height#label":"\u0412\u044B\u0441\u043E\u0442\u0430 \u043A\u0430\u0440\u0442\u044B","config#Map#height#description":"\u0412\u044B\u0441\u043E\u0442\u0430 \u043A\u0430\u0440\u0442\u044B \u0432 \u043F\u0438\u043A\u0441\u0435\u043B\u0430\u0445 (\u0431\u0443\u0434\u0435\u0442 \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u043E\u0432\u0430\u0442\u044C\u0441\u044F \u0432 \u043F\u043E\u043B\u043D\u043E\u044D\u043A\u0440\u0430\u043D\u043D\u043E\u043C \u0440\u0435\u0436\u0438\u043C\u0435)","Jump to":"\u041F\u0435\u0440\u0435\u0439\u0442\u0438 \u043A"},Te=Object.freeze(Object.defineProperty({__proto__:null,default:ce},Symbol.toStringTag,{value:"Module"}));const se={addGroup:!1,addDivider:!0,addDevice:{fields:["primaryStateKey"]}};var Z=[{columns:2,parameter:"defaultZoom",label:"config#Map#defaultZoom#label",type:"Number",value:10,min:0},{columns:5,parameter:"defaultPosition",label:"config#Map#defaultPosition#label",info:"config#Map#defaultPosition#description",value:""},{columns:3,parameter:"followDevice",label:"config#Map#followDevice#label",info:"config#Map#followDevice#description",type:"Select",options:i=>{const m=oe();return i.map(v=>({label:m.devices[v.deviceId].name,value:v.deviceId}))},value:null},{columns:2,parameter:"tooltipPermanent",label:"config#Map#tooltipPermanent#label",info:"config#Map#tooltipPermanent#description",type:"Switch",value:!0}],ze=Object.freeze(Object.defineProperty({__proto__:null,Settings:se,default:Z},Symbol.toStringTag,{value:"Module"}));const pe=x({name:"ModuleMap",props:["widget","_containerSize","_fullscreen"],setup(i){M.dev("DEBUG","ModuleMap","setup()");const m=ae(),v=te(),l=O({}),y=w(()=>i.widget.config),s=w(()=>({...ee.joinConfig(y.value,Z),tooltipPermanent:y.value.tooltipPermanent!==void 0?y.value.tooltipPermanent:!0}));let a=null;A(()=>{M.dev("DEBUG","ModuleMap","onMounted()"),a=k.map("jarvis-map",{center:p.value,zoom:u.value}),k.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"\xA9 OpenStreetMap"}).addTo(a)});const u=w(()=>parseInt(s.value.defaultZoom)||4),p=w(()=>{const{latitude:e,longitude:o}=v;let t=s.value.defaultPosition&&s.value.defaultPosition.split(",")||e&&o&&[e,o]||null;return Array.isArray(t)&&t[0]&&t[1]&&(t[0]=parseFloat(t[0])||null,t[1]=parseFloat(t[1])||null),(t===null||Number.isNaN(t)||!t[0]||!t[1]||Number.isNaN(t[0])||Number.isNaN(t[1]))&&(console.warn("Map","Coordinates invalid!",s.value.defaultPosition,[e,o]),t=[53.550745,9.992992]),t});T(u,e=>u.value&&a.setZoom(u.value)),T(p,e=>p.value&&a.flyTo(p.value));const r=(e,o)=>G(e,o),c=e=>{if(M.dev("DEBUG","ModuleMap","convert",e),e&&typeof e=="string"&&e.indexOf("{")>-1)try{e=JSON.parse(e)}catch(o){console.error("Map",o)}else if(e&&typeof e=="string"&&e.indexOf(",")>-1)return e.split(",");return e&&typeof e=="object"&&e.lat&&(e.lng||e.lon)?[e.lat,e.lng||e.lon]:e},f=O({}),I=O(),C=(e,o,t,n)=>{if(M.dev("DEBUG","ModuleMap","gotState",e,n,o),n&&(f.value[o.id+"#"+t]=!0),e||!n){console.warn("Map",e),I.value=e||"No valid State";return}n.coordinates=c(n.val),n.icon=ne(n.configUser&&n.configUser.icon||o.icon||n.icon),l.value[o.id+"#"+t]={...l.value[o.id+"#"+t],marker:{...n},device:o},o.id===s.value.followDevice&&a.flyTo(n.coordinates)},b={};let F={};const G=(e,o)=>{const t=l.value[e].marker;if(b[e]&&b[e].remove(),a&&t.coordinates&&o&&!o.isEqualNode(F[e])){M.dev("DEBUG","ModuleMap","addMarker",e);const n={riseOnHover:!0,icon:k.divIcon({html:o.innerHTML,iconSize:[48,48],iconAnchor:[24,24],className:"jarvis-map-marker "+(t.icon&&t.icon.indexOf("data:image/")>-1?"jarvis-map-marker-avatar":"jarvis-map-marker-icon")})},g=k.marker(t.coordinates,n);b[e]=g,g.addTo(a),g.on("mouseover",P),g.on("mouseout",N),g.bindTooltip(t.label||l.value[e].device.label||l.value[e].device.name,{offset:[0,28],direction:"bottom",permanent:s.value.tooltipPermanent}),P({target:g})}};let D=null;const P=e=>{const o=typeof e=="string"?b[e]||null:e.target;D&&(D.setZIndexOffset(201),D._tooltip._container.style.zIndex=200),o&&o.openTooltip(),o.setZIndexOffset(100000001),o._tooltip._container.style.zIndex=1e8,D=o},N=e=>{const o=typeof e=="string"?b[e]||null:e.target;o&&!s.value.tooltipPermanent&&o.closeTooltip()},U=e=>e&&a&&a.flyTo(e);let B=[];return T(i.widget.items,()=>{M.dev("DEBUG","ModuleMap","watch"),i.widget.items&&i.widget.items.forEach(e=>{if(e&&e.type==="device"){const o=z.get(e.deviceId||null);o&&e.primaryStateKey?(l.value[o.id+"#"+e.primaryStateKey]={item:e,device:o,marker:{}},B=z.listen(o.id,e.primaryStateKey,C)):console.error("Map",m.t("No device or state key specified"))}else e&&e.id&&(l.value[e.id]={item:e,device:{},marker:{}})})},{immediate:!0}),J(()=>z.unlisten(B)),{bodyHeight:window.screen.height,setRef:r,bringMarkerToFront:P,bringMarkerToBack:N,jumpToMarker:U,markers:l,loaded:f}}}),de={class:"jarvis-map-jumper-container"},ue={class:"jarvis-map-jumper-label"},fe=["onMouseover","onMouseout","onClick"],me=["src"],ge={class:"jarvis-map-marker-caption"},Me=_("div",{id:"jarvis-map",style:{height:"100%"}},null,-1);function ve(i,m,v,l,y,s){const a=Q("icon");return d(),S("div",{style:W({height:Math.max(1,i._fullscreen?i.bodyHeight:i._containerSize.height)+"px"}),onTouchstart:m[0]||(m[0]=X(()=>{},["stop"]))},[R(_("div",de,[_("div",ue,E(i.$t("Jump to"))+":",1),(d(!0),S(K,null,q(i.markers,({device:u,item:p,marker:r},c)=>(d(),S(K,null,[p.type==="divider"?(d(),j($,{class:"jarvis-map-jumper-separator",key:"separator-"+p.id,vertical:"",inset:""})):h("",!0),p.type==="device"?(d(),S("div",{key:"jumper-"+c,class:"jarvis-map-jumper",onMouseover:f=>i.bringMarkerToFront(c),onMouseout:f=>i.bringMarkerToBack(c),onClick:f=>i.jumpToMarker(r.coordinates),ref_for:!0,ref:f=>i.setRef(c,f),style:{margin:"0 8px"}},[i.loaded[c]===void 0?(d(),j(H,{key:0,class:"jarvis-map-marker"})):h("",!0),i.loaded[c]===!0&&r.icon&&r.icon.indexOf("data:image/")!==-1?(d(),j(L,{key:1,class:"jarvis-map-marker jarvis-map-marker-avatar",round:""},{default:Y(()=>[_("img",{src:r.icon.replace("img:","")},null,8,me)]),_:2},1024)):h("",!0),i.loaded[c]===!0&&r.icon&&r.icon.indexOf("data:image/")===-1?(d(),j(a,{key:2,styles:{fontSize:"2rem"},class:"jarvis-map-marker jarvis-map-marker-icon",color:"primary",name:r.icon},null,8,["name"])):h("",!0),_("div",ge,E(r.label||u.label||u.name),1)],40,fe)):h("",!0)],64))),256))],512),[[V,Object.keys(i.markers).length>0]]),Me],36)}var be=ie(pe,[["render",ve]]),Ne=Object.freeze(Object.defineProperty({__proto__:null,default:be},Symbol.toStringTag,{value:"Module"}));export{Ne as M,Pe as _,Oe as a,Te as b,ze as c};
