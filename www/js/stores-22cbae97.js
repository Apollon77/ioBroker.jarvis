import{d as v,c as x}from"./vendor.pinia-de474293.js";import{v as u}from"./vendor.uuid-b6f2345c.js";import{K as _,ar as B}from"./vendor.quasar-78ba37d9.js";import{C as S,L as r}from"./controllers-596cf83c.js";import{G as U}from"./configuration-f4a0a9e1.js";import{_ as h}from"./vendor.rfdc-06a2e69e.js";import{n as w,h as p}from"./helpers-7b53fe93.js";import{c as b}from"./config-f4693115.js";import{i as m}from"./boot-d33196cc.js";const Y=v("logs",{state:()=>({byTime:[],byCategory:{}}),getters:{},actions:{push(e){e.id=u(),this.byTime.push(e),this.byCategory[e.category]=this.byCategory[e.category]||[],this.byCategory[e.category].push(e)}}}),I={};U.forEach(e=>{e.settings.forEach(t=>{t.id&&(I[t.id]=t.value!==void 0?t.value:"")})});const q=v("jarvis",{state:()=>({pro:!1,devices:{},layout:[],settings:{tourIntroduction:!1,tourInterface:!0,tourConfiguration:!1,configExpertMode:!1,configTab:null,configDevicesFilter:null,configDevicesGroupBy:null,...I},styles:"",scripts:"",widgets:{},headerVisible:!0,drawerSidebar:!1,drawerNotifications:!1,pageHeight:0,selectedPageId:null,selectedTabId:null,selectedTabReady:!1,selectedDeviceId:null}),getters:{drawerMiniMode(e){const t=_();return t.screen.width>t.screen.sizes.md&&!t.platform.is.mobile&&e.settings&&e.settings.drawerMiniMode!==void 0?e.settings.drawerMiniMode:!1},selectedDevice(e){return e.selectedDeviceId&&e.devices[e.selectedDeviceId]||{}},getDevicesCount(){return Object.keys(this.devices).length},getPages(){return this.layout.filter(e=>!e.type||e.type==="page").map(e=>({...e,color:"primary",label:e.title||""}))},getPagesWithTabs(){const e=[];return this.layout.forEach(t=>{t.tabs=t.tabs||[],t.tabs.forEach(o=>{e.push({...o,value:o.id,label:t.title+" - "+o.title})})}),e},getTabs(){return e=>e.tabs.map(t=>({...t,color:"primary",label:t.title||""}))},getWidgets(e){return t=>t.map(o=>{const i=o.items[0];return o={...o,...e.widgets[i]},{...o,label:o.label||o.module||"",color:"primary"}})},getSelectedPage(){let e=null;if(this.selectedTabId!==null){for(const t of this.layout)if((t.tabs||[]).find(s=>s.id===this.selectedTabId)){e=t;break}}return this.selectedTabId===null&&!e&&(e=this.layout.find(t=>t.type==="page")),e||{}},getSelectedPageId(){return this.getSelectedPage.id||null},getSelectedTab(){var t;let e=null;if(this.selectedTabId!==null){for(const o of this.layout)if(e=(o.tabs||[]).find(s=>s.id===this.selectedTabId),e)break}return this.selectedTabId===null&&!e&&(e=(t=this.getSelectedPage.tabs)==null?void 0:t[0]),e||{}},getSelectedTabId(){return this.getSelectedTab.id||null}},actions:{subscribe(e){const{key:t,stateId:o,json:i,cb:s}=e,a=S.getConnection;return new Promise((c,n)=>{a.subscribeState(o,({err:d,state:l})=>{if(d||!l)return n(d||"No State received");if(l&&l.val!==void 0)try{l=s?s(l):l,l.val=i&&l.val&&typeof l.val=="string"?JSON.parse(l.val):l.val,this.set({[t]:l.val})}catch(g){return console.error(g),n(g)}return c(e)})})},set(e,t){const o=typeof e!="string"?e:{[e]:t};let i="";for(let s in o){const a=o[s];[i,s]=s.indexOf(".")>-1?s.split("."):[null,s],i===null&&this[s]!==void 0?this[s]!==a&&(this[s]=a):this[i]&&this[i][s]!==void 0?this[i][s]!==a&&(this[i][s]=a):console.error("UNKNOWN STATE",i,this[i],s,this[s],a)}}}}),z=v("ioBroker",{state:()=>({users:{},groups:{},meta:{},scripts:{},scriptList:{},instances:{},instanceList:{}}),getters:{},actions:{join(e,t){this[e]={...this[e],...t}},set(e,t){typeof e!="string"&&t===void 0&&(t=Object.values(e)[0],e=Object.keys(e)[0]),this[e]=t}}}),y={getDevicesWthoutDeletionsCount(e){return r.dev("DEBUG","Editor","getDevicesWthoutDeletionsCount"),Object.keys(y.getDevicesWithoutDeletions(e)).length},getDevicesWithoutDeletions(e){r.dev("DEBUG","Editor","getDevicesWithoutDeletions");const t={};for(const o in e.devices){const i=e.devices[o];(!i.attributes||i.attributes&&i.attributes._deleted!==!0&&i.attributes.deleted!==!0)&&(t[o]=i)}return t},getGroupsByFunction(e){return r.dev("DEBUG","Editor","getGroupsByFunction"),getGroups(e)("function")},getGroupsByManufacturer(e){return r.dev("DEBUG","Editor","getGroupsByManufacturer"),getGroups(e)("manufacturer")},getGroups(e){r.dev("DEBUG","Editor","getGroups");const t=e.devices;return(o,i="")=>{const s={};if(!t)return s;const a=i.toLowerCase(),c=a.match(/-(id|name|function|stateId|stateLabel|state|action|manufacturer):[^\\-]*/g),n=[],d={};c&&c.forEach(f=>{const[D,G]=f.substr(1).split(":");n.push(D.trim()),d[D.trim()]=G.trim().toLowerCase()});let l="",g="";return Object.values(t).forEach(f=>{g=m.global.t(o==="function"?f.function||"":f.attributes&&f.attributes.manufacturer?f.attributes.manufacturer.name:""),l=g.toLowerCase().replace(/ /g,""),(!f.attributes||f.attributes&&f.attributes.ignore!==!0)&&(!i||i&&y.filter(f,{val:a,labels:n,values:d}))&&(s[g]=s[g]||{id:l,icon:"",label:g,devices:[]},s[g].devices.push(f))}),w(s)}},filter(e,t){r.dev("DEBUG","Editor","filter");const{val:o,labels:i,values:s}=t,a=Object.values(i).length===0;if(!o||(a||i.indexOf("id")>-1)&&e.id&&e.id.toLowerCase().indexOf(s.id||o)>-1||(a||i.indexOf("name")>-1)&&e.name&&e.name.toLowerCase().indexOf(s.name||o)>-1||(a||i.indexOf("label")>-1)&&e.label&&e.label.toLowerCase().indexOf(s.label||o)>-1||(a||i.indexOf("function")>-1)&&e.function&&e.function.toLowerCase().indexOf(s.function||o)>-1||(a||i.indexOf("function")>-1)&&e.function&&m.global.t(e.function).toLowerCase().indexOf(s.function||o)>-1||(a||i.indexOf("manufacturer")>-1)&&e.attributes&&e.attributes.manufacturer&&e.attributes.manufacturer.name.toLowerCase().indexOf(s.manufacturer||o)>-1)return!0;e.states=e.states||{};for(const c in e.states){const n=e.states[c];let d=n.label||"";if(d=typeof d=="object"?Object.values(d).join(" "):d,(a||i.indexOf("stateId")>-1)&&c&&c.toLowerCase().indexOf(s.stateId||o)>-1||(a||i.indexOf("stateLabel")>-1)&&d&&d.toLowerCase().indexOf(s.stateLabel||o)>-1||(a||i.indexOf("state")>-1)&&n.state&&typeof n.state!="object"&&n.state.toLowerCase().indexOf(s.state||o)>-1||(a||i.indexOf("action")>-1)&&n.action&&typeof n.action!="object"&&n.action.toLowerCase().indexOf(s.action||o)>-1||(a||i.indexOf("state")>-1)&&n.state&&typeof n.state=="object"&&n.state.node.toLowerCase().indexOf(s.state||o)>-1||(a||i.indexOf("action")>-1)&&n.action&&typeof n.action=="object"&&n.action.node.toLowerCase().indexOf(s.action||o)>-1)return!0}return!1}};var O={getLayout(e){return r.dev("DEBUG","Editor","getLayout"),e.layout||[]},getLayoutWithoutDeletions(e){r.dev("DEBUG","Editor","getLayoutWithoutDeletions");const t=e.layout||[],o=[];return t.forEach(i=>{i._deleted!==!0&&(!i.type||i.type==="page"?o.push({...i,type:"page",tabs:i.tabs.filter(s=>s._deleted!==!0)}):o.push(i))}),o},getPagesWithoutDeletions(e){return r.dev("DEBUG","Editor","getPagesWithoutDeletions"),e.layout.filter(t=>(!t.type||t.type==="page")&&t._deleted!==!0)},getSelectedPage(e){return r.dev("DEBUG","Editor","getSelectedPage"),e.layout.filter(t=>t.id===e.selectedPageId)}},W={getWidgetsWthoutDeletionsCount(e){return r.dev("DEBUG","Editor","getWidgetsWthoutDeletionsCount"),Object.keys(this.getWidgetsWithoutDeletions).length},getWidgetsWithoutDeletions(e){r.dev("DEBUG","Editor","getWidgetsWithoutDeletions");const t={};for(const o in e.widgets){const i=e.widgets[o];i._deleted!==!0&&(t[o]=i)}return t},getGroupedWidgets(e){r.dev("DEBUG","Editor","getGroupedWidgets");const t=e.widgets||{},o={};return Object.values(t).forEach(i=>{const s=i.module||"",a=s.toLowerCase();o[s]=o[s]||{id:a,icon:"",label:s,widgets:[]},o[s].widgets.push(i)}),w(o)}},T={actionSwapNameWithLabel(){r.dev("DEBUG","Editor","actionSwapNameWithLabel");for(const e in this.devices){const t=this.devices[e];if(t.label){const o=t.label;t.label=t.name,t.name=o}}},addDevices({devices:e}){r.dev("DEBUG","Editor","addDevices"),this.devices={...this.devices,...e}},addDevice(){r.dev("DEBUG","Editor","addDevice"),this.device={id:u(),name:"",icon:"",label:"",function:"_defaults",states:{},options:{},attributes:{_created:Date.now()}}},editDevice(e){r.dev("DEBUG","Editor","editDevice");let t=h(e);t={name:"",icon:"",label:"",function:"_defaults",states:{},options:{},...t,attributes:{_created:Date.now(),...t.attributes||{},_updated:Date.now()}},t.states=t.states||{};for(const o in t.states)t.states[o].stateKey=o;this.device=t},copyDevice(e){r.dev("DEBUG","Editor","copyDevice");const t=u(),o=e.id+"_"+t.substr(0,5),i=h(e);i.id=o,i.name=i.name+" (copy)",i.attributes=i.attributes||{},i.attributes._copied=Date.now(),this.devices[o]=i},removeDevice(e){r.dev("DEBUG","Editor","removeDevice"),this.devices[e.id]={...e,attributes:{...e.attributes,deleted:!0}}},restoreDevice(e){r.dev("DEBUG","Editor","restoreDevice"),this.devices[e.id]={...e,attributes:{...e.attributes,deleted:!1}}},saveDevice(){r.dev("DEBUG","Editor","saveDevice");const e=this.device;if(e.revision=u().substr(0,5),e.states&&this.widgets){for(const t in e.states)if(e.states[t]&&(e.states[t]._deleted===!0||e.states[t]._renamed===!0)){for(const o in this.widgets)if(this.widgets[o].items)for(const i of this.widgets[o].items)i.deviceId===e.id&&(e.states[t]._renamed===!0&&i.primaryStateKey===e.states[t]._prevStateKey&&(console.debug("Rename "+e.states[t]._prevStateKey+" to "+t+" (device "+e.id+") from primaryStateKey in widget "+o),i.primaryStateKey=t),e.states[t]._renamed===!0&&i.bodyStateKey===e.states[t]._prevStateKey&&(console.debug("Rename "+e.states[t]._prevStateKey+" to "+t+" (device "+e.id+") from bodyStateKey in widget "+o),i.bodyStateKey=t),e.states[t]._renamed===!0&&i.secondaryStatesKeys&&i.secondaryStatesKeys.includes(e.states[t]._prevStateKey)&&(console.debug("Rename "+e.states[t]._prevStateKey+" to "+t+" (device "+e.id+") from secondaryStatesKeys in widget "+o),i.secondaryStatesKeys=i.secondaryStatesKeys.map(s=>s===e.states[t]._prevStateKey?t:s)),e.states[t]._deleted===!0&&i.primaryStateKey===t&&(console.debug("Removed "+t+" (device "+e.id+") from primaryStateKey in widget "+o),i.primaryStateKey=null),e.states[t]._deleted===!0&&i.bodyStateKey===t&&(console.debug("Removed "+t+" (device "+e.id+") from bodyStateKey in widget "+o),i.bodyStateKey=null),e.states[t]._deleted===!0&&i.secondaryStatesKeys&&i.secondaryStatesKeys.includes(t)&&(console.debug("Removed "+t+" (device "+e.id+") from secondaryStatesKeys in widget "+o),i.secondaryStatesKeys=i.secondaryStatesKeys.filter(s=>s!==t)));delete e.states[t]._renamed,delete e.states[t]._prevStateKey,e.states[t]._deleted===!0?delete e.states[t]:delete e.states[t]._deleted}}this.devices[e.id]=e,this.device=null},discardDevice(){r.dev("DEBUG","Editor","discardDevice"),this.device=null}},L={newState(e){r.dev("DEBUG","Editor","newState"),this.device.states={[e]:{_created:Date.now(),stateKey:e,showState:!0},...this.device.states}},changeStateKey({stateKey:e,stateKeyModified:t}){r.dev("DEBUG","Editor","changeStateKey");const o=Object.keys(this.device.states),i=o.indexOf(e);o.splice(i,1,t);const s={};for(const a of o)s[a]=this.device.states[a===t?e:a];s[t].stateKey=t,s[t]._renamed=!0,s[t]._prevStateKey=e,this.device.states=s},editState({stateKey:e,key:t,val:o}){r.dev("DEBUG","Editor","editState"),(t==="state"||t==="action")&&this.device.states[e]&&this.device.states[e][t]&&this.device.states[e][t].node!==void 0&&(o={node:o}),this.device.states[e]={...this.device.states[e],[t]:o,_updated:Date.now()}},copyState({stateKey:e}){r.dev("DEBUG","Editor","copyState");const t=e+"_"+u().substr(0,5),o=h(this.device.states[e]);o.stateKey=t,o._copied=Date.now(),this.device.states={[t]:o,...this.device.states}},removeState({stateKey:e}){r.dev("DEBUG","Editor","removeState"),this.device.states[e]._deleted=!0},restoreState({stateKey:e}){r.dev("DEBUG","Editor","restoreState"),this.device.states[e]._deleted=!1}},C={setLayout(e){r.dev("DEBUG","Editor","setLayout"),this.layout=e},changeDrawerItemId(e,t){r.dev("DEBUG","Editor","changeDrawerItemId");const o=this.layout.findIndex(i=>i.id===e);o>-1&&(this.layout[o]={...this.layout[o],id:t})},addDrawerItem(e){r.dev("DEBUG","Editor","addDrawerItem"),e.id=u(),e.revision=u().substr(0,5),e._created=Date.now(),this.layout.push(e)},editDrawerItem({itemId:e,key:t,val:o}){r.dev("DEBUG","Editor","editDrawerItem");const i=this.layout.findIndex(s=>s.id===e);i>-1&&(this.layout[i]={...this.layout[i],[t]:o,revision:u().substr(0,5),_updated:Date.now()})},copyDrawerItem({itemId:e,copyWidgets:t}){r.dev("DEBUG","Editor","copyDrawerItem");const o=h(this.layout.find(i=>i.id===e));o.tabs=o.tabs||[],o.tabs=o.tabs.map(i=>(i.id=u(),i.widgetsDesktop=i.widgetsDesktop||[],i.widgetsDesktop=i.widgetsDesktop.map(s=>(s.i=u(),t&&(s.items=s.items||[],s.items=s.items.map(a=>{const c=this.getWidget({widgetId:a}),n=u();return this.copyWidget({id:n,widget:c}),n})),s)),i.widgetsSmartphone=i.widgetsSmartphone||[],i.widgetsSmartphone=i.widgetsSmartphone.map(s=>(s.i=u(),t&&(s.items=s.items||[],s.items=s.items.map(a=>{const c=this.getWidget({widgetId:a}),n=u();return this.copyWidget({id:n,widget:c}),n})),s)),i)),this.layout.push({...o,id:u(),_copied:Date.now()})},deleteDrawerItem({itemId:e}){r.dev("DEBUG","Editor","deleteDrawerItem");const t=this.layout.findIndex(o=>o.id===e);t>-1&&(this.layout[t]._deleted=!0)},restoreDrawerItem({itemId:e}){r.dev("DEBUG","Editor","restoreDrawerItem");const t=this.layout.findIndex(o=>o.id===e);t>-1&&(this.layout[t]._deleted=!1)}},K={setTabs({pageId:e,tabs:t}){r.dev("DEBUG","Editor","setTabs");const o=this.layout.findIndex(i=>i.id===e);if(o>-1){const i=h(this.layout[o]);i.tabs=t,this.layout[o]=i}},addTab({pageId:e,tabId:t,tab:o,duplicate:i,copyWidgets:s}){r.dev("DEBUG","Editor","addTab");const a=this.layout.findIndex(c=>c.id===e);if(a>-1){const c=this.layout[a].tabs||[];let n={_created:Date.now(),icon:"mdi-tab",title:m.global.t("New Tab"),widgets:[],...o||{}};t&&(n={_copied:Date.now(),...n,...h(c.find(d=>d.id===t))},n.widgetsDesktop=n.widgetsDesktop||[],n.widgetsDesktop=n.widgetsDesktop.map(d=>(d.i=u(),s&&(d.items=d.items||[],d.items=d.items.map(l=>{const g=this.getWidget({widgetId:l}),f=u();return this.copyWidget({id:f,widget:g}),f})),d)),n.widgetsSmartphone=n.widgetsSmartphone||[],n.widgetsSmartphone=n.widgetsSmartphone.map(d=>(d.i=u(),s&&(d.items=d.items||[],d.items=d.items.map(l=>{const g=this.getWidget({widgetId:l}),f=u();return this.copyWidget({id:f,widget:g}),f})),d))),n.id=i?n.id:u(),n.revision=u().substr(0,5),this.layout[a].tabs=[...c,n]}},editTab({pageId:e,tabId:t,key:o,val:i}){r.dev("DEBUG","Editor","editTab");const s=this.layout.findIndex(a=>a.id===e);if(s>-1){const a=this.layout[s].tabs.findIndex(c=>c.id===t);if(a>-1){const c=h(this.layout[s].tabs);c.splice(a,1,{...this.layout[s].tabs[a],[o]:i,revision:u().substr(0,5),_updated:Date.now()}),this.layout[s].tabs=c}}},moveTab({pageId:e,tabId:t,destinationPageId:o}){r.dev("DEBUG","Editor","moveTab");const i=this.layout.findIndex(s=>s.id===e);if(i>-1){const s=this.layout[i].tabs.findIndex(c=>c.id===t),a=this.layout[i].tabs[s];this.addTab({pageId:o,tab:h(a),duplicate:!0}),this.layout[i].tabs.splice(s,1)}},deleteTab(e){return r.dev("DEBUG","Editor","deleteTab"),this.editTab({...e,key:"_deleted",val:!0})},restoreTab(e){return r.dev("DEBUG","Editor","restoreTab"),this.editTab({...e,key:"_deleted",val:!1})}};function E(e,t,o){const i=e.findIndex(s=>s.id===t);if(i>-1){const s=e[i].tabs.findIndex(a=>a.id===o);if(s>-1)return{pageIndex:i,tabIndex:s}}return null}var j={setWidgets({pageId:e,tabId:t,key:o,val:i}){r.dev("DEBUG","Editor","setWidgets");const s=E(this.layout,e,t),a=s&&this.layout[s.pageIndex].tabs[s.tabIndex][o];s!==null&&JSON.stringify(i)!==JSON.stringify(a)&&(this.layout[s.pageIndex].tabs[s.tabIndex]={...this.layout[s.pageIndex].tabs[s.tabIndex],[o]:h(i),revision:u().substr(0,5),_updated:Date.now()})},setWidgetConfig({pageId:e,tabId:t,key:o,val:i}){r.dev("DEBUG","Editor","setWidgetConfig");const s=E(this.layout,e,t);s!==null&&(this.layout[s.pageIndex].tabs[s.tabIndex]={...this.layout[s.pageIndex].tabs[s.tabIndex],widgetConfig:{...this.layout[s.pageIndex].tabs[s.tabIndex].widgetConfig,[o]:i},revision:u().substr(0,5),_updated:Date.now()})},getWidget({widgetId:e}){return r.dev("DEBUG","Editor","getWidget"),this.widgets[e]},hasWidget({widgetId:e}){r.dev("DEBUG","Editor","hasWidget");let t=0;return this.layout.forEach(o=>{(o.tabs||[]).forEach(s=>{(s.widgetsDesktop||[]).forEach(n=>{t=n.items&&n.items.includes(e)?t+1:t}),(s.widgetsSmartphone||[]).forEach(n=>{t=n.items&&n.items.includes(e)?t+1:t})})}),t},addWidget({widget:e}){r.dev("DEBUG","Editor","addWidget"),e._updated=e.revision?Date.now():void 0,e.revision=u().substr(0,5),this.widgets[e.id]=e},copyWidget({id:e,widget:t}){r.dev("DEBUG","Editor","copyWidget");const o=h(t);o.id=e||u(),o.title=(o.title||"")+" (copy)",o._copied=Date.now(),this.widgets={[o.id]:o,...this.widgets}},removeWidget({widget:e}){r.dev("DEBUG","Editor","removeWidget"),this.widgets[e.id]._deleted=!0},restoreWidget({widget:e}){r.dev("DEBUG","Editor","restoreWidget"),this.widgets[e.id]._deleted=!1}};const H=v("editor",{state:()=>({errors:{},device:null,devices:null,layout:null,settings:null,styles:null,scripts:null,widgets:null,tmpJsonEditor:null,selectedPage:null,selectedTab:null}),getters:{...y,...O,...W,hasErrors(e){return Object.keys(e.errors).length>0}},actions:{...T,...L,...C,...K,...j,addError(e,t){r.dev("DEBUG","Editor","addError"),e&&t&&(this.errors[e]=t)},removeError(e){r.dev("DEBUG","Editor","removeError");const t=e.key||e;t&&this.errors[t]!==void 0&&delete this.errors[t]},init(e){r.dev("DEBUG","Editor","init");for(const t in e)this[t]=typeof e[t]=="object"?h(e[t]):e[t]},set(e,t){const o=typeof e!="string"?e:{[e]:t};r.dev("DEBUG","Editor","set",o);let i="";for(let s in o){const a=o[s];[i,s]=s.indexOf(".")>-1?s.split("."):[null,s],i===null&&this[s]!==void 0?this[s]!==a&&(this[s]=a):this[i]&&this[i][s]!==void 0?this[i][s]!==a&&(this[i][s]=a):console.error("UNKNOWN STATE",i,this[i],s,this[s],a)}},save(e){r.dev("DEBUG","Editor","save");const t={devices:{node:b.get("NODE_DEVICES"),json:!0,cb:s=>({version:3,signature:p(s),devices:s})},layout:{node:b.get("NODE_LAYOUT"),json:!0,cb:s=>({version:3,signature:p(s),layout:s})},widgets:{node:b.get("NODE_WIDGETS"),json:!0,cb:s=>({version:3,signature:p(s),widgets:s})},styles:{node:b.get("NODE_STYLES")},scripts:{node:b.get("NODE_SCRIPTS")},settings:{node:b.get("NODE_SETTINGS"),json:!0}},o=S.getConnection,i=Object.keys(e).map(s=>{const a=t[s];return new Promise((c,n)=>{const d=a.json?JSON.stringify(a.cb?a.cb(e[s]):e[s]):e[s];o.setState(a.node,d,!0,({err:l})=>l?n(l):c())})});return Promise.allSettled(i)},commitJson(){this.tmpJsonEditor&&this.set({[this.tmpJsonEditor.key]:this.tmpJsonEditor.json,tmpJsonEditor:null})}}});var Q=B(()=>x());export{Y as a,z as b,Q as c,H as d,q as u};
