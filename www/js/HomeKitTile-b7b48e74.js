import{_ as A,q as J,W as L,cm as Q,H as R,c as m,a2 as h,y as U,b6 as W,dq as S,a3 as K,j as D,o as r,d as v,g as d,J as E,a1 as k,k as H,w as G,F as O,l as q,f as I,n as X,c$ as Y,i as Z,t as _,a as c,ad as b,dM as x,d7 as ee,dN as te}from"./index-5ed861c6.js";const{capitalize:ae}=x,ne=J({name:"ModuleHomeKitTile",props:["_containerSize","widget"],setup(e){const w=L(),j=Q(),z=R(),F=m(()=>e.widget.config),l=m(()=>({...ee.joinConfig(F.value,te)})),t=m(()=>e.widget.items&&e.widget.items[0]||{}),u=m(()=>S.get(t.value.deviceId)),a=h({}),n=h({}),f=m(()=>({on:"true",off:"false",...a.value&&a.value.properties||{}})),T=m(()=>a.value&&a.value.val!==void 0&&a.value.val.toString()===f.value.on.toString()),$=(i,o)=>{if(y.value=!0,i){p.value=i;return}a.value=o},N=(i,o)=>{if(y.value=!0,i){p.value=i;return}n.value=o},y=h(!1),p=h();let g=[];U(()=>{u.value?t.value.bodyStateKey||t.value.primaryStateKey?(t.value.primaryStateKey&&(g=g.concat(S.listen(u.value.id,t.value.primaryStateKey,$))),t.value.bodyStateKey&&(g=g.concat(S.listen(u.value.id,t.value.bodyStateKey,N)))):y.value=!0:(p.value="HomeKitTile: "+w.t("Device {deviceId} not found").replace("{deviceId}",t.value.deviceId),console.warn(p.value),y.value=!0)}),W(()=>S.unlisten(g));const B=(i,o,s)=>{if(Array.isArray(s))return s.some(P=>B(i,o,P));const C=l.value[i+ae(o)];return s==="secondaryStates"?C===s&&t.value.secondaryStatesKeys:s==="state"?C===s&&t.value.primaryStateKey:s==="bodyElement"?C===s&&t.value.bodyStateKey&&t.value.bodyElement:s==="actionElement"?C===s&&t.value.primaryStateKey&&t.value.actionElement:C===s},V=(i,o="action",s="State")=>K.Components[i]&&K.Components[i][o][s]||K.Components._defaults&&K.Components._defaults[o][s]||null,M=()=>{if(l.value.action==="website"&&(l.value.website.indexOf("http")>-1||l.value.website.indexOf("www")>-1))window.open((l.value.website.indexOf("http")===-1?"http://":"")+l.value.website,"_blank");else if(l.value.action==="page"&&l.value.jumper)j.push({params:{tabId:l.value.jumper}}).catch(i=>console.warn(i));else if(l.value.action==="popup"&&u.value)z.set({selectedDeviceId:u.value.id});else if(u.value&&l.value.action==="trigger"&&t.value.primaryStateKey){const i=T.value?f.value.setOff:f.value.setOn;let o=T.value?f.value.off:f.value.on;o=typeof o=="string"&&(o==="true"||o==="false")?o==="true":o,S.set(u.value.id,t.value.primaryStateKey,i!==void 0?i:o)}};return{FunctionsComponents:K.Components,horizontal:["left","center","right"],vertical:["top","middle","bottom"],moduleConfig:l,loaded:y,error:p,device:u,deviceConfig:t,primaryState:a,bodyState:n,getComponent:V,hasElement:B,jump:M}}}),oe=["v-ripple"],ie={key:0,class:"q-focus-helper"},se={key:1,class:"q-pa-sm full-height"};function le(e,w,j,z,F,l){const t=D("alert"),u=D("icon");return r(),v("div",{class:I(["HomeKitTile grid",{"cursor-pointer":e.moduleConfig.action&&e.moduleConfig.action!=="none","q-hoverable":e.moduleConfig.action&&e.moduleConfig.action!=="none"}]),style:X({height:e._containerSize.height+"px",width:e._containerSize.width+"px"}),onClick:w[0]||(w[0]=(...a)=>e.jump&&e.jump(...a)),"v-ripple":e.moduleConfig.action&&e.moduleConfig.action!=="none"},[e.moduleConfig.action&&e.moduleConfig.action!=="none"?(r(),v("span",ie)):d("",!0),E(H(Y,{indeterminate:""},null,512),[[k,!e.loaded&&!e.error]]),E(H(t,null,{default:G(()=>[Z(_(e.error),1)]),_:1},512),[[k,e.loaded&&e.error]]),e.device?E((r(),v("div",se,[(r(!0),v(O,null,q(e.vertical,a=>(r(),v("div",{key:a,class:I([a,"item row nowrap"])},[(r(!0),v(O,null,q(e.horizontal,n=>(r(),v("div",{key:n,class:I(["col-grow",n])},[e.hasElement(a,n,"icon")?(r(),c(u,{key:0,alignment:n,styles:e.primaryState.iconStyle||{},loading:!e.loaded,name:e.primaryState.icon,color:"primary",IconButton:""},null,8,["alignment","styles","loading","name"])):d("",!0),e.hasElement(a,n,"label")?(r(),c(b(e.FunctionsComponents._defaults.components.Title),{key:1,alignment:n,device:e.device,state:e.bodyState,stateKey:e.deviceConfig.bodyStateKey,deviceConfig:e.deviceConfig},null,8,["alignment","device","state","stateKey","deviceConfig"])):d("",!0),e.hasElement(a,n,"secondaryStates")?(r(),c(b(e.FunctionsComponents._defaults.components.SecondaryStates),{key:2,alignment:n,device:e.device,state:e.primaryState,stateKey:e.deviceConfig.primaryStateKey,deviceConfig:e.deviceConfig},null,8,["alignment","device","state","stateKey","deviceConfig"])):d("",!0),e.hasElement(a,n,"state")?(r(),c(b(e.FunctionsComponents._defaults.components.State),{key:3,alignment:n,device:e.device,state:e.primaryState,stateKey:e.deviceConfig.primaryStateKey,deviceConfig:e.deviceConfig},null,8,["alignment","device","state","stateKey","deviceConfig"])):d("",!0),e.hasElement(a,n,"bodyElement")?(r(),c(b(e.getComponent(e.device.function,"body",e.deviceConfig.bodyElement)),{key:4,alignment:n,device:e.device,state:e.bodyState,stateKey:e.deviceConfig.bodyStateKey,deviceConfig:e.deviceConfig},null,8,["alignment","device","state","stateKey","deviceConfig"])):d("",!0),e.hasElement(a,n,"actionElement")?(r(),c(b(e.getComponent(e.device.function,"action",e.deviceConfig.actionElement)),{key:5,alignment:n,device:e.device,state:e.primaryState,stateKey:e.deviceConfig.primaryStateKey,deviceConfig:e.deviceConfig},null,8,["alignment","device","state","stateKey","deviceConfig"])):d("",!0)],2))),128))],2))),128))],512)),[[k,e.loaded&&!e.error]]):d("",!0)],14,oe)}var ue=A(ne,[["render",le],["__scopeId","data-v-9a4f7e1c"]]);export{ue as default};
