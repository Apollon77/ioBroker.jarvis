import{Q as y}from"./QTooltip-bde234ea.js";import{_ as R,q as T,dl as N,H as D,de as V,W as q,az as z,d5 as F,dw as H,c as U,a2 as S,j as G,bD as J,k as a,w as t,J as g,a1 as b,L as w,o as p,a as m,i as n,t as s,g as c,M as i,Z as L,d as A,l as O,e as k,cM as E,I as K,N as I,f as P,Q as W,F as Z,K as X}from"./index-7dce1004.js";import{Q as Y}from"./QBadge-12d902f9.js";const x=T({name:"ModuleAdapterStatus",props:["widget"],setup(l){console.debug("ModuleAdapterStatus");const h=N.getConnection;D();const v=V(),Q=q(),M=z(l.widget,"config"),r=F.joinConfig(M.value,H);r.list=r.list?r.list.replace(/, /g,",").toLowerCase().split(","):null,r.blacklist=r.blacklist?r.blacklist.replace(/, /g,",").toLowerCase().split(","):null;const u=U(()=>{let d=v.instances;if(d=d&&d.val&&!d.val.error?{...d.val}:{},r.list)for(const o in d){const f=o.substr(0,o.indexOf("."));!r.list.includes(o)&&!r.list.includes(f)&&delete d[o]}else if(r.blacklist)for(const o in d){const f=o.substr(0,o.indexOf("."));(r.blacklist.includes(o)||r.blacklist.includes(f))&&delete d[o]}return d}),e=S([]),$=S([]);h.subscribeState("admin.0.info.updatesList",({err:d,state:o})=>{if(console.debug("admin.0.info.updatesList",o),o){const f=o&&o.val?o.val.replace("js-controller,","").replace("js-controller",""):"";e.value=f?f.split(","):[],$.value=e.value.map(C=>u.value[C+".0"]?u.value[C+".0"].title+" ("+u.value[C+".0"].name+")":C).join(", ")}});const _=S({}),j=(d,o)=>{_.value[d]=!0,h.setAdapter(d,o).then(()=>{v.join("instances",{val:{...v.instances.val,[d]:{...v.instances.val[d],enabled:o}},ts:Date.now()})}).catch(f=>{console.error(f)}).finally(()=>{_.value[d]=!1})},B=U(()=>Q.locale.substr(0,2));return{activeRepo:U(()=>v.meta.activeRepo),adapterUpdates:e,adapterUpdateList:$,instances:u,language:B,loading:_,moduleConfig:r,onSet:j}}}),ee=k("br",null,null,-1),le=n(", "),ae={class:"UpdateAvailable"},te={key:1},oe={key:2};function de(l,h,v,Q,M,r){const u=G("icon");return J([l.widget.revision],()=>a(I,null,{default:t(()=>[g(a(w,{class:"UpdateAvailableListItem",style:{"background-color":"var(--q-accent)"}},{default:t(()=>[l.adapterUpdateList.length>60?(p(),m(y,{key:0},{default:t(()=>[n(s(l.adapterUpdateList),1)]),_:1})):c("",!0),a(i,{avatar:""},{default:t(()=>[a(u,{name:"refresh"})]),_:1}),a(i,null,{default:t(()=>[a(L,null,{default:t(()=>[n(s(l.adapterUpdateList.length>60?l.adapterUpdateList.substr(0,58)+"...":l.adapterUpdateList),1)]),_:1}),a(L,{caption:"",style:{color:"#fff"}},{default:t(()=>[n(s(l.adapterUpdates.length)+" "+s(l.$t("Updates available")),1),ee,n(" "+s(l.$t("Repository")+": "+l.activeRepo),1)]),_:1})]),_:1}),a(i,{side:""},{default:t(()=>[a(Y,{rounded:"",color:"white",style:{color:"var(--q-accent)"},label:l.adapterUpdates.length},null,8,["label"])]),_:1})]),_:1},512),[[b,l.moduleConfig.updates&&l.adapterUpdates.length>0]]),(p(!0),A(Z,null,O(l.instances,e=>(p(),m(w,{key:e.id,clickable:l.moduleConfig.switch&&e.mode!=="none"&&e.mode!=="once"&&l.loading[e.id]!==!0,"v-ripple":l.moduleConfig.switch&&e.mode!=="none"&&e.mode!=="once"&&l.loading[e.id]!==!0},{default:t(()=>[a(i,{avatar:""},{default:t(()=>[a(u,{name:"img:"+e.extIcon},null,8,["name"])]),_:2},1024),a(i,null,{default:t(()=>[a(L,null,{default:t(()=>[n(s(e.titleLang&&(e.titleLang[l.language]||e.titleLang.en||e.titleLang.de)||e.titleLang||e.title),1)]),_:2},1024),a(L,{caption:""},{default:t(()=>[k("span",null,s(e.id)+", v"+s(e.version),1),g(k("span",null,[le,k("span",ae,s(l.$t("Update available")+" v"+e.update),1)],512),[[b,e.update]]),g(k("span",null,", "+s(l.$t("Compact Mode"))+" "+s(l.$t("on"))+" ("+s(l.$t("Group")+" "+e.compactGroup)+")",513),[[b,e.runAsCompactMode]])]),_:2},1024)]),_:2},1024),e.mode!=="none"&&e.mode!=="once"?g((p(),m(i,{key:0,side:""},{default:t(()=>[l.loading[e.id]===!0?(p(),m(E,{key:0,color:"primary",size:"21px"})):c("",!0),l.loading[e.id]!==!0&&e.alive!==!1&&e.connectedToHost!==!1&&e.connectedToInstance!==!1?(p(),A("div",te,[a(u,{color:"positive",name:"mdi-check-circle"}),a(y,null,{default:t(()=>[n(s(l.$t("Adapter")+" "+l.$t("alive")),1)]),_:1})])):c("",!0),l.loading[e.id]!==!0&&e.alive===!1||e.connectedToHost===!1||e.connectedToInstance===!1?(p(),A("div",oe,[a(u,{color:"warning",name:"mdi-alert"}),a(y,null,{default:t(()=>[n(s(l.$t("Adapter")+" "+l.$t("not alive")),1)]),_:1})])):c("",!0)]),_:2},1536)),[[b,e.enabled===!0]]):c("",!0),e.mode!=="none"&&e.mode!=="once"?g((p(),m(i,{key:1,side:""},{default:t(()=>[a(u,{name:"mdi-close"}),a(y,null,{default:t(()=>[n(s(l.$t("Adapter")+" "+l.$t("disabled")),1)]),_:1})]),_:2},1536)),[[b,e.enabled===!1]]):c("",!0),l.moduleConfig.switch&&e.mode!=="none"&&e.mode!=="once"&&l.loading[e.id]!==!0?(p(),m(K,{key:2,ref_for:!0,ref:"menu","touch-position":""},{default:t(()=>[a(I,{style:{"min-width":"120px","man-width":"150px"},class:"body"},{default:t(()=>[a(w,{class:P("text-white bg-"+(e.enabled?"positive":"negative"))},{default:t(()=>[a(i,{avatar:""}),a(i,null,{default:t(()=>[n(s(l.$t(e.enabled?"Currently running":"Currently stopped")),1)]),_:2},1024),a(i,{side:""})]),_:2},1032,["class"]),g((p(),m(w,{clickable:"",onClick:$=>l.onSet(e.id,!e.enabled)},{default:t(()=>[a(i,{avatar:""},{default:t(()=>[a(W,{color:e.enabled?"negative":"positive",name:e.enabled?"mdi-pause":"mdi-play"},null,8,["color","name"])]),_:2},1024),a(i,null,{default:t(()=>[n(s(l.$t(e.enabled?"Stop":"Start")+" "+l.$t("Adapter")),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[X]])]),_:2},1024)]),_:2},1536)):c("",!0)]),_:2},1032,["clickable","v-ripple"]))),128))]),_:1}),h,0)}var ue=R(x,[["render",de]]);export{ue as default};
