import{bt as U,a4 as V,bN as Y,Q as w,dc as $,dN as R,k as p,aY as W,am as G,aq as Z,aZ as q,aG as X,ay as u,W as v,X as f,V as m,a2 as C,U as j,cQ as H,D as y,a1 as J,cI as T,du as K,dO as x}from"./index-e4fcd5f5.js";var L={};Object.defineProperty(L,"__esModule",{value:!0});const z=90.8333,S=360/24,ee=60*60*1e3;function te(e){return Math.ceil((e.getTime()-new Date(e.getFullYear(),0,1).getTime())/864e5)}function O(e){return Math.sin(e*2*Math.PI/360)}function b(e){return Math.acos(e)*360/(2*Math.PI)}function ae(e){return Math.asin(e)*360/(2*Math.PI)}function se(e){return Math.tan(e*2*Math.PI/360)}function P(e){return Math.cos(e*2*Math.PI/360)}function A(e,n){const o=e%n;return o<0?o+n:o}function B(e,n,o,a,i){const d=te(i),c=n/S,h=o?d+(6-c)/24:d+(18-c)/24,D=.9856*h-3.289,g=A(D+1.916*O(D)+.02*O(2*D)+282.634,360),E=.91764*se(g);let r;r=360/(2*Math.PI)*Math.atan(E),r=A(r,360);const I=Math.floor(g/90)*90,k=Math.floor(r/90)*90;r=r+(I-k),r/=S;const l=.39782*O(g),M=P(ae(l)),_=(P(a)-l*O(e))/(M*P(e)),s=(o?360-b(_):b(_))/S+r-.06571*h-6.622,F=A(s-n/S,24),Q=Date.UTC(i.getFullYear(),i.getMonth(),i.getDate());return new Date(Q+F*ee)}function ne(e,n,o=new Date){return B(e,n,!0,z,o)}function oe(e,n,o=new Date){return B(e,n,!1,z,o)}var ie=L.getSunrise=ne,re=L.getSunset=oe;const le=V({name:"ModuleDateTime",props:["widget","_containerSize","_widgetSize"],setup(e){const n=Y(),o=w(()=>e.widget.config),a=w(()=>{const t=$.joinConfig(o.value,R);return{...t,refresh:t.formatDate.indexOf("s")>-1||t.formatTime.indexOf("s")>-1?1:t.formatDate.indexOf("m")>-1||t.formatTime.indexOf("m")>-1?10:60}});let i=0;const d=p(null),c=p(null),h=p(null),D=p(null),g=p(null),E=w(()=>n.meta.city),r=w(()=>{const{latitude:t,longitude:s}=n.meta;return!t||!s?null:[t,s]}),I=t=>{if(a.value.sun!==!1&&r.value!==null)try{const s=new Date(t);h.value=T(ie(...r.value,s),"HH:mm"),D.value=T(re(...r.value,s),"HH:mm")}catch(s){console.warn("DateTime",s.message||s)}},k=t=>{try{const s=new Date(t);d.value=a.value.formatDate?T(s,a.value.formatDate.replace(/(?:\r|\n|\r\n)/g,"'<br />'")):null,c.value=a.value.formatTime?T(s,a.value.formatTime.replace(/(?:\r|\n|\r\n)/g,"'<br />'")):null,g.value=x(s)}catch(s){console.log("DateTime",s.message||s),d.value=a.value._defaults.formatDate?T(new Date,a.value._defaults.formatDate):null,c.value=a.value._defaults.formatTime?T(new Date,a.value._defaults.formatTime):null}};W(r,()=>I(i));let l=null;const M=()=>{a.value.refresh&&a.value.refresh>0&&(l&&clearInterval(l),l=setInterval(()=>{i=i+a.value.refresh*1e3,k(i)},a.value.refresh*1e3))};G(()=>{!l&&M()}),Z(()=>{l&&clearInterval(l),l=null});let _=null;const N=t=>{i=parseInt(t),k(i),I(i),l&&clearInterval(l),M()};return q(()=>{if(e.widget.revision!==_){_=e.widget.revision;const t=K.getConnection;t.send("getTime",null,N),t.on("_timestamp",N)}}),{moduleConfig:a,date:d,time:c,sunrise:h,sunset:D,week:g,city:E}}}),ce={class:"jarvis-DateTime-Clock"},ue=["innerHTML"],me=["innerHTML"],de={class:"row jarvis-DateTime-Details"},ve={key:0,class:"jarvis-DateTime-Details-Item"},fe={class:"jarvis-DateTime-Details-Item-City"},De={key:1,class:"jarvis-DateTime-Details-Item"},ge={class:"jarvis-DateTime-Details-Item-Sunrise"},Te={key:2,class:"jarvis-DateTime-Details-Item"},he={class:"jarvis-DateTime-Details-Item-Sunset"},_e={key:3,class:"jarvis-DateTime-Details-Item"},pe={class:"jarvis-DateTime-Details-Item-Week"};function ye(e,n,o,a,i,d){const c=X("icon");return u(),v("div",{key:e.widget.revision,class:"jarvis-DateTime-Container"},[f("div",ce,[e.date?(u(),v("span",{key:0,class:"jarvis-DateTime-Clock-Date",innerHTML:e.date},null,8,ue)):m("",!0),e.time?(u(),v("span",{key:1,class:"jarvis-DateTime-Clock-Time",innerHTML:e.time},null,8,me)):m("",!0)]),f("div",de,[e.moduleConfig.city!==!1?(u(),v("div",ve,[C(c,{size:"xs",name:"mdi-city-variant-outline",class:"jarvis-DateTime-Details-Icon"}),e.city?m("",!0):(u(),j(H,{key:0,color:"primary"})),f("span",fe,y(e.city),1)])):m("",!0),e.moduleConfig.sun!==!1?(u(),v("div",De,[C(c,{size:"xs",name:"mdi-weather-sunset-up",class:"jarvis-DateTime-Details-Icon"}),e.sunrise?m("",!0):(u(),j(H,{key:0,color:"primary"})),f("span",ge,y(e.sunrise),1)])):m("",!0),e.moduleConfig.sun!==!1?(u(),v("div",Te,[C(c,{size:"xs",name:"mdi-weather-sunset-down",class:"jarvis-DateTime-Details-Icon"}),e.sunset?m("",!0):(u(),j(H,{key:0,color:"primary"})),f("span",he,y(e.sunset),1)])):m("",!0),e.moduleConfig.calendarweek!==!1?(u(),v("div",_e,[C(c,{size:"xs",name:"mdi-calendar-week",class:"jarvis-DateTime-Details-Icon"}),e.week?m("",!0):(u(),j(H,{key:0,color:"primary"})),f("span",pe,[f("span",null,y(e.$t("CW")),1),J(" "+y(e.week),1)])])):m("",!0)])])}var ke=U(le,[["render",ye]]);export{ke as default};
