import{p as N,c as x,k as ee,a as ue,d as ce,e as Z,m as ge,f as K,K as ve,o as G,j as me,n as fe,t as pe,a3 as he,aj as ye,ae as Ce,v as be}from"./vendor.quasar-78ba37d9.js";import{d as B,p as w,r as A,o as b,a as k,e as y,t as _,h as l,b as I,v as P,F as T,k as F,f as R,i as g,n as we,y as ae,j as L,u as O,L as _e,s as Se,g as ke}from"./vendor.vue-1bbf3cb4.js";import{_ as De}from"./vendor.rfdc-06a2e69e.js";import{e as $e}from"./composables-a7e68882.js";/* empty css                    */import{M as Me}from"./modules-9c8c454f.js";import{a as Oe,C as ne}from"./controllers-596cf83c.js";import{j as Ae,_ as J}from"./helpers-7b53fe93.js";import{b as Ie}from"./stores-22cbae97.js";import{v as H}from"./vendor.uuid-b6f2345c.js";import{n as Pe}from"./vendor.node-schedule-71e14ef3.js";import{s as X,h as ze,i as je,j as Le}from"./vendor.date-fns-448d10fa.js";var Te={"Calendar#description":"Zeigt ical / ics Inhalte in einem Kalender an.","config#Calendar#calendarPreview#label":"Zeige die Kalender-Vorschau","config#Calendar#calendarAgenda#label":"Zeige die Agenda","config#Calendar#calendarView#label":"W\xE4hle die Art der Anzeige von Ereignissen","config#Calendar#refresh#label":"Aktualisierung (in Minuten)","config#Calendar#daysReview#label":"Zeigt vergangene Ereignisse (in Tagen)","config#Calendar#daysPreview#label":"Zeigt zuk\xFCnftige Ereignisse (in Tagen)",January:"Januar",February:"Februar",March:"M\xE4rz",April:"April",May:"Mai",June:"Juni",July:"Juli",August:"August",September:"September",October:"Oktober",November:"November",December:"Dezember",Mon:"Mo",Tue:"Di",Wed:"Mi",Thu:"Do",Fri:"Fr",Sat:"Sa",Son:"So","all day":"ganzt\xE4gig","several days":"mehrt\xE4gig","No events":"keine Termine","Calendar Details":"Kalender Details"},ga=Object.freeze(Object.defineProperty({__proto__:null,default:Te},Symbol.toStringTag,{value:"Module"})),Qe={"Calendar#description":"Displays ical / ics contents in a calendar.","config#Calendar#calendarPreview#label":"Show the calendar","config#Calendar#calendarAgenda#label":"Show the Agenda","config#Calendar#calendarView#label":"Choose the way events are displayed","config#Calendar#refresh#label":"Refresh intervall (in minutes)","config#Calendar#daysReview#label":"Show past events (in days)","config#Calendar#daysPreview#label":"Show future events (in days)"},va=Object.freeze(Object.defineProperty({__proto__:null,default:Qe},Symbol.toStringTag,{value:"Module"})),qe={"Calendar#description":"\u041E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u0437 ical / ics \u0432 \u043A\u0430\u043B\u0435\u043D\u0434\u0430\u0440\u0435","config#Calendar#calendarPreview#label":"\u041E\u0442\u043E\u0431\u0440\u0430\u0436\u0430\u0442\u044C \u043A\u0430\u043B\u0435\u043D\u0434\u0430\u0440\u044C","config#Calendar#calendarAgenda#label":"\u041E\u0442\u043E\u0431\u0440\u0430\u0436\u0430\u0442\u044C \u0441\u043F\u0438\u0441\u043E\u043A \u0441\u043E\u0431\u044B\u0442\u0438\u0439","config#Calendar#calendarView#label":"\u0412\u044B\u0431\u0440\u0430\u0442\u044C \u0441\u043F\u043E\u0441\u043E\u0431 \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F \u0441\u043E\u0431\u044B\u0442\u0438\u0439","config#Calendar#refresh#label":"\u0418\u043D\u0442\u0435\u0440\u0432\u0430\u043B \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u044F (\u0432 \u043C\u0438\u043D\u0443\u0442\u0430\u0445)","config#Calendar#daysReview#label":"\u041E\u0442\u043E\u0431\u0440\u0430\u0436\u0430\u0442\u044C \u043F\u0440\u043E\u0448\u0435\u0434\u0448\u0438\u0435 \u0441\u043E\u0431\u044B\u0442\u0438\u044F (\u0432 \u0434\u043D\u044F\u0445)","config#Calendar#daysPreview#label":"\u041E\u0442\u043E\u0431\u0440\u0430\u0436\u0430\u0442\u044C \u0431\u0443\u0434\u0443\u0449\u0438\u0435 \u0441\u043E\u0431\u044B\u0442\u0438\u044F (\u0432 \u0434\u043D\u044F\u0445)",January:"\u042F\u043D\u0432\u0430\u0440\u044C",February:"\u0424\u0435\u0432\u0440\u0430\u043B\u044C",March:"\u041C\u0430\u0440\u0442",April:"\u0410\u043F\u0440\u0435\u043B\u044C",May:"\u041C\u0430\u0439",June:"\u0418\u044E\u043D\u044C",July:"\u0418\u044E\u043B\u044C",August:"\u0410\u0432\u0433\u0443\u0441\u0442",September:"\u0421\u0435\u043D\u0442\u044F\u0431\u0440\u044C",October:"\u041E\u043A\u0442\u044F\u0431\u0440\u044C",November:"\u041D\u043E\u044F\u0431\u0440\u044C",December:"\u0414\u0435\u043A\u0430\u0431\u0440\u044C",Mon:"\u041F\u043D",Tue:"\u0412\u0442",Wed:"\u0421\u0440",Thu:"\u0427\u0442",Fri:"\u041F\u0442",Sat:"\u0421\u0431",Son:"\u0412\u0441","all day":"\u0432\u0435\u0441\u044C \u0434\u0435\u043D\u044C","several days":"","No events":"\u041D\u0435\u0442 \u0441\u043E\u0431\u044B\u0442\u0438\u0439","Calendar Details":"\u041F\u043E\u0434\u0440\u043E\u0431\u043D\u043E\u0441\u0442\u0438"},ma=Object.freeze(Object.defineProperty({__proto__:null,default:qe},Symbol.toStringTag,{value:"Module"}));const Ee=B({name:"ModuleCalendarCustomConfiguration",props:["config"],emits:["onChange"],setup(e,{emit:m}){const D=ne.getConnection,S=Ie(),C=w(!1),f=t=>t&&t.substr(t.indexOf(":")+1)!=="",u=()=>{D.getObject("system.adapter.ical.0",({err:t,object:p})=>{C.value=!0,!t&&p&&p.native&&p.native.calendars&&Array.isArray(p.native.calendars)&&(s.value=p.native.calendars.map(d=>({...d,id:H()})),o({id:"config.calendars",value:s.value}))})},n=()=>{s.value.push({id:H()}),m("onChange",{id:"config.calendars",value:s.value})},v=(t,p)=>{const d=s.value.findIndex(Q=>Q.id===p);d>-1&&(s.value.splice(d,1),m("onChange",{id:"config.calendars",value:s.value}))},o=t=>{const p=s.value.findIndex(d=>d.id===t.calendarId);p>-1&&(Oe.remove("calendar-"+t.calendarId),t.id==="pass"?Ae({[t.id]:t.value},S.meta.secret).then(d=>{s.value[p][t.id]=d[t.id],m("onChange",{id:"config.calendars",value:s.value})}).catch(d=>{console.warn("Calendar-Configuration",d.message,d)}):(s.value[p][t.id]=t.value,m("onChange",{id:"config.calendars",value:s.value})))},s=w([]);return!e.config.calendars||!Array.isArray(e.config.calendars)||e.config.calendars.length===0?u():(s.value=De(e.config.calendars),C.value=!0),{loaded:C,calendars:s,addCalendar:n,deleteCalendar:v,onChange:o,hasPasswordSet:f}}}),Ne={class:"full-width"},Re={class:"text-h7 primary q-ma-sm"},Be={class:"row nowrap q-mt-md"};function Fe(e,m,D,S,C,f){const u=A("inputs");return b(),k("div",Ne,[y("div",Re,_(e.$t("Module Configuration - Calendars")),1),l(N,{style:{margin:"0 -0 8px 0"}}),I(y("div",null,[l(x,{indeterminate:""})],512),[[P,!e.loaded]]),I(y("div",null,[l(ee,{color:"secondary",icon:"mdi-plus-circle",label:e.$t("Add Calendar"),onClick:e.addCalendar},null,8,["label","onClick"]),(b(!0),k(T,null,F(e.calendars,n=>(b(),k(T,{key:"item-"+n.id},[y("div",Be,[l(u,{class:"q-mt-sm",type:"button",icon:"mdi-delete",tooltip:e.$t("delete"),color:"negative",onClick:v=>e.deleteCalendar(v,n.id)},null,8,["tooltip","onClick"]),l(u,{style:{width:"150px"},dense:"",onOnChange:e.onChange,label:e.$t("Label"),calendarId:n.id,id:"name",value:n.name},null,8,["onOnChange","label","calendarId","value"]),l(u,{style:{width:"150px"},dense:"",type:"color",onOnChange:e.onChange,id:"color",label:e.$t("Color"),calendarId:n.id,value:n.color||""},null,8,["onOnChange","label","calendarId","value"]),l(u,{style:{width:"450px"},dense:"",onOnChange:e.onChange,label:e.$t("URL"),calendarId:n.id,id:"url",value:n.url},null,8,["onOnChange","label","calendarId","value"]),l(u,{style:{width:"120px"},dense:"",onOnChange:e.onChange,label:e.$t("User"),calendarId:n.id,id:"user",value:n.user},null,8,["onOnChange","label","calendarId","value"]),l(u,{style:{width:"180px"},type:"password",dense:"",onOnChange:e.onChange,label:e.$t("Password"),calendarId:n.id,id:"pass",placeholder:"("+(e.hasPasswordSet(n.pass)?e.$t("unchanged"):e.$t("no password set"))+")"},null,8,["onOnChange","label","calendarId","placeholder"]),l(u,{style:{width:"100px"},type:"switch",dense:"",onOnChange:e.onChange,label:e.$t("Ignore SSL errors"),calendarId:n.id,id:"sslignore",value:n.sslignore!==void 0?n.sslignore:!1},null,8,["onOnChange","label","calendarId","value"])]),l(N)],64))),128))],512),[[P,e.loaded]])])}var le=J(Ee,[["render",Fe]]),fa=Object.freeze(Object.defineProperty({__proto__:null,default:le},Symbol.toStringTag,{value:"Module"}));const Je={addGroup:!1,addDivider:!1,addDevice:!1,customConfiguration:le};var te=[{parameter:"calendars",hide:!0},{columns:2,parameter:"calendarPreview",label:"config#Calendar#calendarPreview#label",type:"Switch",value:!0},{columns:2,parameter:"calendarAgenda",label:"config#Calendar#calendarAgenda#label",type:"Switch",value:!0},{columns:2,parameter:"refresh",label:"config#Calendar#refresh#label",type:"Number",value:5,min:0},{columns:3,parameter:"daysReview",label:"config#Calendar#daysReview#label",type:"Number",value:0,min:0},{columns:3,parameter:"daysPreview",label:"config#Calendar#daysPreview#label",type:"Number",value:7,min:0}],pa=Object.freeze(Object.defineProperty({__proto__:null,Settings:Je,default:te},Symbol.toStringTag,{value:"Module"}));const Ve=B({name:"ModuleCalendarEventList",props:["agenda"]});function We(e,m,D,S,C,f){const u=A("icon");return b(),R(ue,null,{default:g(()=>[(b(!0),k(T,null,F(e.agenda,(n,v)=>(b(),R(ce,{key:"item-"+n.key,class:we({"jarvis-StateListItem-Separator":v>0})},{default:g(()=>[l(Z,{avatar:"",class:"items-center"},{default:g(()=>[l(u,{name:"mdi-circle-medium",style:ae({color:n.calendar.color||"var(--q-primary)"})},null,8,["style"]),l(ge,null,{default:g(()=>[L(_(n.calendar.name),1)]),_:2},1024)]),_:2},1024),l(Z,null,{default:g(()=>[l(K,null,{default:g(()=>[L(_(e.$t(n.time)+", "+n.summary),1)]),_:2},1024),l(K,{caption:""},{default:g(()=>[L(_(n.caption),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})}var re=J(Ve,[["render",We]]),ha=Object.freeze(Object.defineProperty({__proto__:null,default:re},Symbol.toStringTag,{value:"Module"}));const Ye=B({name:"ModuleCalendar",props:["_size","widget"],components:{EventList:re},setup(e){const m=ne.getConnection,D=ve(),S=$e(!0),C=O(()=>e.widget.config),f=O(()=>({...Me.joinConfig(C.value,te),timezone:C.value.timezone||"Europe/Amsterdam",calendars:C.value.calendars||[]})),u=O(()=>D.dark.isActive),n=w(!1),v=w(new Date);Pe.scheduleJob("0 0 0 * * *",()=>{v.value=new Date});const o=w({year:v.value.getFullYear(),month:v.value.getMonth()+1}),s=({year:a,month:r})=>{(o.value.month!==r||o.value.year!==a)&&(o.value.year=a,o.value.month=r,n.value=Y[a+"-"+r]||!1,j(a,r).then(()=>{z()}))},t=X(ze(v.value,f.value.daysReview)),p=X(je(v.value,f.value.daysPreview)),d=w([t,p]),Q=({date:a})=>{f.value.calendarAgenda===!1||f.value.calendarAgenda!==!1&&d.value.length===2?d.value=[a]:a<d.value[0]?d.value.unshift(a):d.value.push(a),z()},oe=O(()=>{let[a,r]=d.value;return[{key:"selectedEnd",highlight:{contentStyle:{backgroundColor:"var(--q-accent)",opacity:1,color:"#fff"}},dates:r,order:102},{key:"selectedStart",highlight:{contentStyle:{backgroundColor:"var(--q-accent)",opacity:1,color:"#fff"}},dates:a,order:101},{key:"selected",highlight:{style:{backgroundColor:"var(--q-accent)",opacity:.3},contentStyle:{color:"var(--q-accent)"}},dates:{start:a,end:r},order:99},{key:"today",highlight:{style:{backgroundColor:"var(--q-primary)"},contentStyle:{color:"#fff",fontWeight:"bold"}},dates:v.value,order:200}]}),V=w([]),W=(a,r)=>{const c=[];U.value.forEach(i=>{!c.some($=>$.uid===i.uid)&&(i&&i.start>=a&&i.start<=r||i&&i.start<=a&&i.end>=a)&&c.push(i)}),V.value=c.sort((i,$)=>i.start===$.start?0:i.start>$.start?1:-1)},z=()=>{let[a,r]=d.value;if(r=Le(r||a),a.getMonth()===r.getMonth())W(a,r);else{let c=o.value.month+1;const i=c>12?o.value.year+1:o.value.year;c=c>12?1:c,j(i,c).then(()=>{W(a,r)})}},Y=w({}),q=w({}),U=O(()=>Object.values(q.value).flat()),se=(a,r,c)=>(a.color&&Ce("calendar--"+a.name.toLowerCase().replace(/ /g,"-").replace(/\./g,"-"),a.color),new Promise((i,$)=>{m.getSpecial("Calendar",{calendar:a,year:r,month:c,options:{...f.value,language:S}},M=>{if(M.error)return console.warn("Calendar-a99xoa47",e.widget.id,M.error),$(M.error);if(M.events&&Array.isArray(M.events)){const ie=M.events.map((h,xe)=>(h.start=new Date(h.start),h.end=new Date(h.end),{calendar:a,...h,key:h.uid,dot:{style:{backgroundColor:a.color||be.getPaletteColor("primary")}},popover:{label:h.summary},dates:h.duration<=0?h.start:{start:h.start,end:h.end},customData:{calendar:a,summary:h.summary,time:h.time}}));Y[r+"-"+c]=!0,q.value[a.id+":"+r+"-"+c]=ie,i(q.value[a.id])}})})),j=(a,r)=>{const c=f.value.calendars.map(i=>se(i,a,r));return Promise.allSettled(c).then(i=>(n.value=!0,i))};let E=null;_e(()=>{j(o.value.year,o.value.month).then(()=>{z()}),E=setInterval(()=>{console.debug("Calendar-d53dca17",e.widget.id,"Refreshing ical data..."),j(o.value.year,o.value.month).then(()=>{z()})},f.value.refresh*60*1e3)}),Se(()=>E&&clearInterval(E));const de=O(()=>[...U.value,...oe.value]);return{loaded:n,language:S,isDarkMode:u,moduleConfig:f,setDate:s,setRange:Q,attributes:de,agenda:V}}}),Ue={style:{position:"relative"}},Ze={class:"text-h6"},Ke={class:"text-xs text-gray-300 font-semibold"},Ge={class:"Calendar-Popover-List"};function He(e,m,D,S,C,f){const u=A("event-list"),n=A("icon"),v=A("v-calendar");return b(),k("div",null,[I(l(x,{indeterminate:""},null,512),[[P,!e.loaded]]),y("div",Ue,[e.moduleConfig.calendarAgenda===!1?(b(),R(pe,{key:0,"model-value":e.popup,onHide:m[1]||(m[1]=o=>e.popup=!1)},{default:g(()=>[l(fe,{style:{width:"800px","max-width":"80vw"}},{default:g(()=>[l(G,{class:"row items-center"},{default:g(()=>[y("div",Ze,_(e.$t("Calendar Details")),1),l(me),l(ee,{flat:"",round:"",color:"grey",icon:"close",onClick:m[0]||(m[0]=o=>e.popup=!1)})]),_:1}),l(N),l(G,{class:"col q-pa-none scroll body"},{default:g(()=>[l(u,{agenda:e.agenda},null,8,["agenda"])]),_:1})]),_:1})]),_:1},8,["model-value"])):ke("",!0),I(y("div",null,[l(v,{"onUpdate:toPage":e.setDate,onDayclick:e.setRange,class:"Calendar",attributes:e.attributes,"is-dark":e.isDarkMode,locale:e.language,masks:{dayPopover:"WWW, D. MMMM YYYY"},"trim-weeks":"","show-iso-weeknumbers":"","disable-page-swipe":""},{"header-title":g(({monthLabel:o,year:s})=>[y("div",null,_(o+" "+s),1),l(n,{name:"mdi-calendar-cursor",size:"xs",class:"q-ml-xs"})]),"day-popover":g(({dayTitle:o,attributes:s})=>[y("div",null,[y("strong",Ke,_(o),1),y("ul",Ge,[(b(!0),k(T,null,F(s,t=>(b(),k("li",{key:t.key+"-"+(t.customData.calendar.color||""),style:ae({color:t.customData.calendar.color||"var(--q-primary)"})},[y("span",null,_(t.customData.time)+", "+_(t.customData.summary),1)],4))),128))])])]),default:g(()=>[L(' /* :timezone="moduleConfig.timezone" trim-weeks: By default, calendar panes always displays the maximum number of weeks in a month, even if the max week does not contain any days in the current month displayed. */ ')]),_:1},8,["onUpdate:toPage","onDayclick","attributes","is-dark","locale","masks"]),l(ye,{showing:!e.loaded},{default:g(()=>[l(he,{size:"50px",color:"primary"})]),_:1},8,["showing"])],512),[[P,e.moduleConfig.calendarPreview!==!1]]),I(l(u,{agenda:e.agenda},null,8,["agenda"]),[[P,e.moduleConfig.calendarAgenda!==!1]])])])}var Xe=J(Ye,[["render",He]]),ya=Object.freeze(Object.defineProperty({__proto__:null,default:Xe},Symbol.toStringTag,{value:"Module"}));export{fa as C,ha as E,ga as _,va as a,ma as b,pa as c,ya as d};
