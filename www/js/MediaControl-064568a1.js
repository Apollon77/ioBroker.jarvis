import{bt as Z,a4 as K,Q as g,d7 as _,dT as x,k as h,r as ee,an as oe,ao as ae,dU as N,aG as se,ay as S,W as j,X as n,C as A,a1 as M,D as c,b3 as d,bn as u,a2 as f,b1 as Q,U as E,V as w,bC as R,cO as te,I as U,bs as re,cq as q,bW as O,dp as H}from"./index-2b52c887.js";import{Q as ne}from"./QTooltip-942385cb.js";const{getPaletteColor:le,changeAlpha:ie}=re,de=K({name:"ModuleMediaControl",props:["widget","_containerSize","_widgetSize"],setup(e){const a=g(()=>e.widget.config),y=g(()=>({..._.joinConfig(a.value,x)})),l=g(()=>y.value.adapter.substr(0,y.value.adapter.indexOf("."))),T=h([]),k=h(null),p=g(()=>T.value.find(t=>t.id===k.value)||{}),s=ee({}),X=g(()=>({height:e._containerSize.height-50+"px","background-image":s.cover?"url('"+y.value.coverUrl+s.cover+"')":"none","background-size":y.value.coverMode?"auto 100%":"100% auto",paddingTop:e._containerSize.height-50-50-6+"px"})),F=g(()=>({background:ie(le("primary"),.8)})),G=g(()=>({width:(Math.floor(s.progress/s.duration*e._widgetSize.width)||0)+"px"})),I=h(0),$=h(0),W=o=>z("progress",Math.round(o.layerX/e._widgetSize.width*s.duration)),Y=o=>{I.value=Math.round(o.layerX/e._widgetSize.width*100),$.value=N(I.value/100*s.duration)},P=h({}),m=h({}),C=(o="",t=null)=>(t=t||k.value||"",t?(y.value.adapter+m.value[l.value]._namespace+o).replace("{PLAYER}",t||""):null),V=({val:o})=>{P.value[l.value]&&P.value[l.value].setPlayer&&P.value[l.value].setPlayer(t=>C(t,o),t=>C(t)),k.value=o,q.set("MediaControl.player."+e.widget.id,o)},z=(o,t=!0)=>{if(o==="play"&&p.value?(s.play=!0,V({val:p.value.id})):o==="pause"&&(s.play=!1),m.value[l.value][o]&&m.value[l.value][o].action){const i=C(m.value[l.value][o].action);i&&H.getConnection.setState(i,m.value[l.value][o].setter?m.value[l.value][o].setter(t,C):t).catch(b=>{console.error(b)})}},B=h([]),J=o=>{if(!B.value.includes(o)){B.value.push(o);const t=H.getConnection;for(const i in m.value[l.value]){let r=m.value[l.value][i];r=typeof r=="string"?{state:r}:r,r&&r.state&&(r.stateKey=i,t.subscribeState(C(r.state),({err:b,state:v})=>{!b&&v&&v.val!==void 0&&(v.val=r.display&&r.display[v.val]||v.val,s[i]=r.convert?r.convert(v.val):v.val)}))}}},L=()=>{P.value[l.value]&&P.value[l.value].getPlayers(y.value.adapter).then(o=>{if(o.length>0){T.value=o;const t=q.get("MediaControl.player."+e.widget.id)||o[0].id,i=t&&o[o.findIndex(r=>r.id===t)];k.value=i?i.id:o[0].id,J(k.value)}})};let D=null;return oe(()=>{const o={"./adapters/alexa2.js":()=>O(()=>import("./alexa2-02631167.js"),["js/alexa2-02631167.js","js/index-2b52c887.js","css/index-07d49e25.css"]),"./adapters/musiccast.js":()=>O(()=>import("./musiccast-ddb63e01.js"),["js/musiccast-ddb63e01.js","js/index-2b52c887.js","css/index-07d49e25.css"]),"./adapters/plex.js":()=>O(()=>import("./plex-22d43793.js"),["js/plex-22d43793.js","js/index-2b52c887.js","css/index-07d49e25.css"]),"./adapters/spotify-premium.js":()=>O(()=>import("./spotify-premium-f849e19c.js"),["js/spotify-premium-f849e19c.js","js/index-2b52c887.js","css/index-07d49e25.css"]),"./adapters/yamaha.js":()=>O(()=>import("./yamaha-479bf073.js"),["js/yamaha-479bf073.js","js/index-2b52c887.js","css/index-07d49e25.css"])},t=[];for(const i in o){const r=o[i]().then(b=>{const v=i.substr(i.lastIndexOf("/")+1).replace(".js","");return P.value[v]=b,m.value[v]=b.default,!0});t.push(r)}Promise.allSettled(t).then(()=>{L(),D=setInterval(()=>{L()},60*1e3)})}),ae(()=>D&&clearInterval(D)),{secondsToHoursMinutesSeconds:N,media:s,cover:X,trackInformation:F,trackProgress:G,updateProgressSetter:Y,setProgress:W,setProgressToTime:$,setProgressToPercent:I,selectPlayer:V,players:T,player:p,set:z,adapterStates:m}}}),ue={class:"full-height"},pe={class:"row"},me={class:"col nowrap ellipsis"},ve={class:"row"},ce={class:"col-grow",style:{overflow:"hidden"}},fe={class:"col-shrink",style:{"text-align":"right"}},ye={class:"track-duration disabled"},ge={class:"controls q-pa-sm"},he={class:"controlsLeft"},ke={class:"controlsCenter"},Pe={class:"controlsRight"};function be(e,a,y,l,T,k){const p=se("inputs");return S(),j("div",ue,[n("div",{class:"cover",style:A(e.cover)},[n("div",{class:"track-information q-pa-sm",style:A(e.trackInformation)},[n("div",pe,[n("div",me,[M(c((e.media.artist||"")+(e.media.album?" - "+e.media.album:""))+" ",1),d(n("span",null,"("+c(e.media.year)+")",513),[[u,e.media.align==="top"&&e.media.year]])])]),n("div",ve,[n("div",ce,[M(c(e.media.track)+" ",1),d(n("span",null,"("+c(e.media.year)+")",513),[[u,e.media.align==="bottom"&&e.media.year]])]),d(n("div",fe,[M(c(e.secondsToHoursMinutesSeconds(e.media.progress))+" ",1),d(n("span",null,"/ "+c(e.secondsToHoursMinutesSeconds(e.media.duration)),513),[[u,e.media.progress&&e.media.duration]])],512),[[u,e.media.progress||e.media.duration]])])],4),d(n("div",{class:"track-duration",onMousemove:a[1]||(a[1]=(...s)=>e.updateProgressSetter&&e.updateProgressSetter(...s)),onClick:a[2]||(a[2]=(...s)=>e.setProgress&&e.setProgress(...s))},[f(ne,{anchor:"top middle"},{default:Q(()=>[M(c(e.setProgressToTime)+" ("+c(e.setProgressToPercent)+"%)",1)]),_:1}),n("div",{class:"track-progress",style:A(e.trackProgress),onClick:a[0]||(a[0]=(...s)=>e.setProgress&&e.setProgress(...s))},null,4)],544),[[u,e.media.progress]]),d(n("div",ye,null,512),[[u,!e.media.progress]])],4),n("div",ge,[n("div",he,[e.media.type!=="RADIO"?(S(),E(p,{key:0,type:"button",color:"accent",icon:"mdi-monitor-cellphone-star",tooltip:e.player.name,items:e.players,onOnSelect:e.selectPlayer,selected:e.player.id},null,8,["tooltip","items","onOnSelect","selected"])):w("",!0)]),n("div",ke,[f(te,null,{default:Q(()=>[e.adapterStates.previous&&e.adapterStates.previous.action?d((S(),E(R,{key:0,color:"primary",onClick:a[3]||(a[3]=s=>e.set("previous")),icon:"mdi-skip-previous"},null,512)),[[u,e.media.type!=="RADIO"]]):w("",!0),f(R,{color:"primary",onClick:a[4]||(a[4]=s=>e.set(e.media.play?"pause":"play")),icon:e.media.play?"mdi-pause":"mdi-play"},null,8,["icon"]),e.adapterStates.next&&e.adapterStates.next.action?d((S(),E(R,{key:1,color:"primary",onClick:a[5]||(a[5]=s=>e.set("next")),icon:"mdi-skip-next"},null,512)),[[u,e.media.type!=="RADIO"]]):w("",!0)]),_:1})]),n("div",Pe,[e.media.type!=="RADIO"?(S(),j(U,{key:0},[d(f(p,{round:"",onOnClick:a[6]||(a[6]=s=>e.set("shuffle","on")),type:"button",color:"secondary",icon:"mdi-shuffle-disabled",tooltip:"shuffle is off"},null,512),[[u,e.adapterStates.shuffle&&e.media.shuffle==="off"]]),d(f(p,{round:"",onOnClick:a[7]||(a[7]=s=>e.set("shuffle","off")),type:"button",color:"secondary",icon:"mdi-shuffle-variant",tooltip:"shuffle is on"},null,512),[[u,e.adapterStates.shuffle&&e.media.shuffle==="on"]])],64)):w("",!0),e.media.type!=="RADIO"?(S(),j(U,{key:1},[d(f(p,{round:"",onOnClick:a[8]||(a[8]=s=>e.set("repeat","once")),type:"button",color:"secondary",icon:"mdi-repeat-off",tooltip:"repeat off"},null,512),[[u,e.adapterStates.repeat&&e.media.repeat==="off"]]),d(f(p,{round:"",onOnClick:a[9]||(a[9]=s=>e.set("repeat","all")),type:"button",color:"secondary",icon:"mdi-repeat-once",tooltip:"repeat once"},null,512),[[u,e.adapterStates.repeat&&e.media.repeat==="once"]]),d(f(p,{round:"",onOnClick:a[10]||(a[10]=s=>e.set("repeat","off")),type:"button",color:"secondary",icon:"mdi-repeat",tooltip:"repeat all"},null,512),[[u,e.adapterStates.repeat&&e.media.repeat==="all"]])],64)):w("",!0)])])])}var we=Z(de,[["render",be]]);export{we as default};
