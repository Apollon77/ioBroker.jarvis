var V=Object.defineProperty,q=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var R=(e,o,d)=>o in e?V(e,o,{enumerable:!0,configurable:!0,writable:!0,value:d}):e[o]=d,y=(e,o)=>{for(var d in o||(o={}))F.call(o,d)&&R(e,d,o[d]);if(B)for(var d of B(o))H.call(o,d)&&R(e,d,o[d]);return e},Q=(e,o)=>q(e,z(o));import{Q as w}from"./QTooltip-0f3749ca.js";import{_ as G,q as J,H as O,de as E,W as K,az as P,d5 as W,dw as Z,c as S,a2 as A,j as X,bD as Y,dm as x,k as l,w as t,J as b,a1 as k,L as $,o as m,a as v,i as p,t as i,g,M as u,Z as L,d as M,l as ee,e as h,cM as ae,I as le,N as T,f as te,Q as oe,F as de,K as se}from"./index-10e282a0.js";import{Q as re}from"./QBadge-e44dc03c.js";const ie=J({name:"ModuleAdapterStatus",props:["widget"],setup(e){const o=x.getConnection;O();const d=E(),I=K(),j=P(e.widget,"config"),n=W.joinConfig(j.value,Z);n.list=n.list?n.list.replace(/, /g,",").toLowerCase().split(","):null,n.blacklist=n.blacklist?n.blacklist.replace(/, /g,",").toLowerCase().split(","):null;const f=S(()=>{let s=d.instances;if(s=s&&s.val&&!s.val.error?y({},s.val):{},n.list)for(const r in s){const c=r.substr(0,r.indexOf("."));!n.list.includes(r)&&!n.list.includes(c)&&delete s[r]}else if(n.blacklist)for(const r in s){const c=r.substr(0,r.indexOf("."));(n.blacklist.includes(r)||n.blacklist.includes(c))&&delete s[r]}return s}),a=A([]),_=A([]);o.subscribeState("admin.0.info.updatesList",({err:s,state:r})=>{if(r){const c=r&&r.val?r.val.replace("js-controller,","").replace("js-controller",""):"";a.value=c?c.split(","):[],_.value=a.value.map(C=>f.value[C+".0"]?f.value[C+".0"].title+" ("+f.value[C+".0"].name+")":C).join(", ")}});const U=A({}),N=(s,r)=>{U.value[s]=!0,o.setAdapter(s,r).then(()=>{d.join("instances",{val:Q(y({},d.instances.val),{[s]:Q(y({},d.instances.val[s]),{enabled:r})}),ts:Date.now()})}).catch(c=>{console.error(c)}).finally(()=>{U.value[s]=!1})},D=S(()=>I.locale.substr(0,2));return{activeRepo:S(()=>d.meta.activeRepo),adapterUpdates:a,adapterUpdateList:_,instances:f,language:D,loading:U,moduleConfig:n,onSet:N}}}),ne=h("br",null,null,-1),ue=p(", "),pe={class:"UpdateAvailable"},fe={key:1},me={key:2};function ce(e,o,d,I,j,n){const f=X("icon");return Y([e.widget.revision],()=>l(T,null,{default:t(()=>[b(l($,{class:"UpdateAvailableListItem",style:{"background-color":"var(--q-accent)"}},{default:t(()=>[e.adapterUpdateList.length>60?(m(),v(w,{key:0},{default:t(()=>[p(i(e.adapterUpdateList),1)]),_:1})):g("",!0),l(u,{avatar:""},{default:t(()=>[l(f,{name:"refresh"})]),_:1}),l(u,null,{default:t(()=>[l(L,null,{default:t(()=>[p(i(e.adapterUpdateList.length>60?e.adapterUpdateList.substr(0,58)+"...":e.adapterUpdateList),1)]),_:1}),l(L,{caption:"",style:{color:"#fff"}},{default:t(()=>[p(i(e.adapterUpdates.length)+" "+i(e.$t("Updates available")),1),ne,p(" "+i(e.$t("Repository")+": "+e.activeRepo),1)]),_:1})]),_:1}),l(u,{side:""},{default:t(()=>[l(re,{rounded:"",color:"white",style:{color:"var(--q-accent)"},label:e.adapterUpdates.length},null,8,["label"])]),_:1})]),_:1},512),[[k,e.moduleConfig.updates&&e.adapterUpdates.length>0]]),(m(!0),M(de,null,ee(e.instances,a=>(m(),v($,{key:a.id,clickable:e.moduleConfig.switch&&a.mode!=="none"&&a.mode!=="once"&&e.loading[a.id]!==!0,"v-ripple":e.moduleConfig.switch&&a.mode!=="none"&&a.mode!=="once"&&e.loading[a.id]!==!0},{default:t(()=>[l(u,{avatar:""},{default:t(()=>[l(f,{name:"img:"+a.extIcon},null,8,["name"])]),_:2},1024),l(u,null,{default:t(()=>[l(L,null,{default:t(()=>[p(i(a.titleLang&&(a.titleLang[e.language]||a.titleLang.en||a.titleLang.de)||a.titleLang||a.title),1)]),_:2},1024),l(L,{caption:""},{default:t(()=>[h("span",null,i(a.id)+", v"+i(a.version),1),b(h("span",null,[ue,h("span",pe,i(e.$t("Update available")+" v"+a.update),1)],512),[[k,a.update]]),b(h("span",null,", "+i(e.$t("Compact Mode"))+" "+i(e.$t("on"))+" ("+i(e.$t("Group")+" "+a.compactGroup)+")",513),[[k,a.runAsCompactMode]])]),_:2},1024)]),_:2},1024),a.mode!=="none"&&a.mode!=="once"?b((m(),v(u,{key:0,side:""},{default:t(()=>[e.loading[a.id]===!0?(m(),v(ae,{key:0,color:"primary",size:"21px"})):g("",!0),e.loading[a.id]!==!0&&a.alive!==!1&&a.connectedToHost!==!1&&a.connectedToInstance!==!1?(m(),M("div",fe,[l(f,{color:"positive",name:"mdi-check-circle"}),l(w,null,{default:t(()=>[p(i(e.$t("Adapter")+" "+e.$t("alive")),1)]),_:1})])):g("",!0),e.loading[a.id]!==!0&&a.alive===!1||a.connectedToHost===!1||a.connectedToInstance===!1?(m(),M("div",me,[l(f,{color:"warning",name:"mdi-alert"}),l(w,null,{default:t(()=>[p(i(e.$t("Adapter")+" "+e.$t("not alive")),1)]),_:1})])):g("",!0)]),_:2},1536)),[[k,a.enabled===!0]]):g("",!0),a.mode!=="none"&&a.mode!=="once"?b((m(),v(u,{key:1,side:""},{default:t(()=>[l(f,{name:"mdi-close"}),l(w,null,{default:t(()=>[p(i(e.$t("Adapter")+" "+e.$t("disabled")),1)]),_:1})]),_:2},1536)),[[k,a.enabled===!1]]):g("",!0),e.moduleConfig.switch&&a.mode!=="none"&&a.mode!=="once"&&e.loading[a.id]!==!0?(m(),v(le,{key:2,ref_for:!0,ref:"menu","touch-position":""},{default:t(()=>[l(T,{style:{"min-width":"120px","man-width":"150px"},class:"body"},{default:t(()=>[l($,{class:te("text-white bg-"+(a.enabled?"positive":"negative"))},{default:t(()=>[l(u,{avatar:""}),l(u,null,{default:t(()=>[p(i(e.$t(a.enabled?"Currently running":"Currently stopped")),1)]),_:2},1024),l(u,{side:""})]),_:2},1032,["class"]),b((m(),v($,{clickable:"",onClick:_=>e.onSet(a.id,!a.enabled)},{default:t(()=>[l(u,{avatar:""},{default:t(()=>[l(oe,{color:a.enabled?"negative":"positive",name:a.enabled?"mdi-pause":"mdi-play"},null,8,["color","name"])]),_:2},1024),l(u,null,{default:t(()=>[p(i(e.$t(a.enabled?"Stop":"Start")+" "+e.$t("Adapter")),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[se]])]),_:2},1024)]),_:2},1536)):g("",!0)]),_:2},1032,["clickable","v-ripple"]))),128))]),_:1}),o,0)}var Ce=G(ie,[["render",ce]]);export{Ce as default};
