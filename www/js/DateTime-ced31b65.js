import{bt as Y,a4 as $,bN as R,Q as C,dc as W,dP as G,k as p,aY as b,am as q,aq as X,aG as Z,ay as c,W as v,X as f,V as m,a2 as j,U as H,cQ as S,D as y,a1 as J,cI as T,dv as z,dQ as K}from"./index-1747645b.js";var N={};Object.defineProperty(N,"__esModule",{value:!0});const B=90.8333,O=360/24,x=60*60*1e3;function ee(e){return Math.ceil((e.getTime()-new Date(e.getFullYear(),0,1).getTime())/864e5)}function E(e){return Math.sin(e*2*Math.PI/360)}function Q(e){return Math.acos(e)*360/(2*Math.PI)}function te(e){return Math.asin(e)*360/(2*Math.PI)}function ae(e){return Math.tan(e*2*Math.PI/360)}function A(e){return Math.cos(e*2*Math.PI/360)}function L(e,n){const o=e%n;return o<0?o+n:o}function F(e,n,o,a,i){const d=ee(i),l=n/O,h=o?d+(6-l)/24:d+(18-l)/24,D=.9856*h-3.289,g=L(D+1.916*E(D)+.02*E(2*D)+282.634,360),P=.91764*ae(g);let r;r=360/(2*Math.PI)*Math.atan(P),r=L(r,360);const k=Math.floor(g/90)*90,I=Math.floor(r/90)*90;r=r+(k-I),r/=O;const u=.39782*E(g),M=A(te(u)),_=(A(a)-u*E(e))/(M*A(e)),s=(o?360-Q(_):Q(_))/O+r-.06571*h-6.622,U=L(s-n/O,24),V=Date.UTC(i.getFullYear(),i.getMonth(),i.getDate());return new Date(V+U*x)}function se(e,n,o=new Date){return F(e,n,!0,B,o)}function ne(e,n,o=new Date){return F(e,n,!1,B,o)}var oe=N.getSunrise=se,ie=N.getSunset=ne;const re=$({name:"ModuleDateTime",props:["widget","_containerSize","_widgetSize"],setup(e){const n=R(),o=C(()=>e.widget.config),a=C(()=>{const t=W.joinConfig(o.value,G);return{...t,refresh:t.formatDate.indexOf("s")>-1||t.formatTime.indexOf("s")>-1?1:t.formatDate.indexOf("m")>-1||t.formatTime.indexOf("m")>-1?10:60}});let i=0;const d=p(null),l=p(null),h=p(null),D=p(null),g=p(null),P=C(()=>n.meta.city),r=C(()=>{const{latitude:t,longitude:s}=n.meta;return!t||!s?null:[t,s]}),k=t=>{if(a.value.sun!==!1&&r.value!==null)try{const s=new Date(t);h.value=T(oe(...r.value,s),"HH:mm"),D.value=T(ie(...r.value,s),"HH:mm")}catch(s){console.warn("DateTime",s.message||s)}},I=t=>{try{const s=new Date(t);d.value=a.value.formatDate?T(s,a.value.formatDate.replace(/(?:\r|\n|\r\n)/g,"'<br />'")):null,l.value=a.value.formatTime?T(s,a.value.formatTime.replace(/(?:\r|\n|\r\n)/g,"'<br />'")):null,g.value=K(s)}catch(s){console.warn("DateTime",s.message||s),d.value=a.value._defaults.formatDate?T(new Date,a.value._defaults.formatDate):null,l.value=a.value._defaults.formatTime?T(new Date,a.value._defaults.formatTime):null}};b(r,()=>k(i));let u=null;const M=()=>{u&&clearInterval(u),a.value.refresh&&a.value.refresh>0&&(z.getConnection.send("getTime",null,w),u=setInterval(()=>{i=i+a.value.refresh*1e3,I(i)},a.value.refresh*1e3))};let _=null;const w=t=>{i=parseInt(t),I(i),k(i),M()};return b(()=>e.widget.revision,()=>{if(e.widget.revision!==_){_=e.widget.revision;const t=z.getConnection;t.send("getTime",null,w),t.on("_timestamp",w)}}),q(()=>{!u&&M()}),X(()=>{u&&clearInterval(u),u=null}),{moduleConfig:a,date:d,time:l,sunrise:h,sunset:D,week:g,city:P}}}),le={class:"jarvis-DateTime-Clock"},ce=["innerHTML"],ue=["innerHTML"],me={class:"row jarvis-DateTime-Details"},de={key:0,class:"jarvis-DateTime-Details-Item"},ve={class:"jarvis-DateTime-Details-Item-City"},fe={key:1,class:"jarvis-DateTime-Details-Item"},De={class:"jarvis-DateTime-Details-Item-Sunrise"},ge={key:2,class:"jarvis-DateTime-Details-Item"},Te={class:"jarvis-DateTime-Details-Item-Sunset"},he={key:3,class:"jarvis-DateTime-Details-Item"},_e={class:"jarvis-DateTime-Details-Item-Week"};function pe(e,n,o,a,i,d){const l=Z("icon");return c(),v("div",{key:e.widget.revision,class:"jarvis-DateTime-Container"},[f("div",le,[e.date?(c(),v("span",{key:0,class:"jarvis-DateTime-Clock-Date",innerHTML:e.date},null,8,ce)):m("",!0),e.time?(c(),v("span",{key:1,class:"jarvis-DateTime-Clock-Time",innerHTML:e.time},null,8,ue)):m("",!0)]),f("div",me,[e.moduleConfig.city!==!1?(c(),v("div",de,[j(l,{size:"xs",name:"mdi-city-variant-outline",class:"jarvis-DateTime-Details-Icon"}),e.city?m("",!0):(c(),H(S,{key:0,color:"primary"})),f("span",ve,y(e.city),1)])):m("",!0),e.moduleConfig.sun!==!1?(c(),v("div",fe,[j(l,{size:"xs",name:"mdi-weather-sunset-up",class:"jarvis-DateTime-Details-Icon"}),e.sunrise?m("",!0):(c(),H(S,{key:0,color:"primary"})),f("span",De,y(e.sunrise),1)])):m("",!0),e.moduleConfig.sun!==!1?(c(),v("div",ge,[j(l,{size:"xs",name:"mdi-weather-sunset-down",class:"jarvis-DateTime-Details-Icon"}),e.sunset?m("",!0):(c(),H(S,{key:0,color:"primary"})),f("span",Te,y(e.sunset),1)])):m("",!0),e.moduleConfig.calendarweek!==!1?(c(),v("div",he,[j(l,{size:"xs",name:"mdi-calendar-week",class:"jarvis-DateTime-Details-Icon"}),e.week?m("",!0):(c(),H(S,{key:0,color:"primary"})),f("span",_e,[f("span",null,y(e.$t("CW")),1),J(" "+y(e.week),1)])])):m("",!0)])])}var ke=Y(re,[["render",pe]]);export{ke as default};
