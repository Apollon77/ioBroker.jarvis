var q=Object.defineProperty,D=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var R=(e,s,i)=>s in e?q(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i,$=(e,s)=>{for(var i in s||(s={}))H.call(s,i)&&R(e,i,s[i]);if(M)for(var i of M(s))O.call(s,i)&&R(e,i,s[i]);return e},Q=(e,s)=>D(e,F(s));import{Q as w}from"./QTooltip-30d1582f.js";import{_ as z,q as E,H as G,dg as J,aA as K,d7 as P,dx as W,c as S,a4 as j,j as X,bE as Y,dn as Z,k as l,N as T,w as t,J as k,a2 as h,o as m,a as v,i as p,t as r,g,M as u,a1 as L,L as _,d as B,l as x,e as C,cO as ee,I as ae,f as le,Q as te,F as oe,K as se}from"./index-8c8fca3a.js";import{Q as de}from"./QBadge-3185dea5.js";const re=E({name:"AdapterStatus",props:["widget"],setup(e){const s=Z.getConnection,i=G(),b=J(),I=K(e.widget,"config"),n=P.joinConfig(I.value,W);n.list=n.list?n.list.replace(/, /g,",").toLowerCase().split(","):null,n.blacklist=n.blacklist?n.blacklist.replace(/, /g,",").toLowerCase().split(","):null;const f=S(()=>{let o=b.instances;if(o=o&&o.val&&!o.val.error?$({},o.val):{},n.list)for(const d in o){const c=d.substr(0,d.indexOf("."));!n.list.includes(d)&&!n.list.includes(c)&&delete o[d]}else if(n.blacklist)for(const d in o){const c=d.substr(0,d.indexOf("."));(n.blacklist.includes(d)||n.blacklist.includes(c))&&delete o[d]}return o}),a=j([]),U=j([]);s.subscribeState("admin.0.info.updatesList",({err:o,state:d})=>{if(d){const c=d&&d.val?d.val.replace("js-controller,","").replace("js-controller",""):"";a.value=c?c.split(","):[],U.value=a.value.map(y=>f.value[y+".0"]?f.value[y+".0"].title+" ("+f.value[y+".0"].name+")":y).join(", ")}});const A=j({}),N=(o,d)=>{A.value[o]=!0,s.setAdapter(o,d).then(()=>{b.join("instances",{val:Q($({},b.instances.val),{[o]:Q($({},b.instances.val[o]),{enabled:d})}),ts:Date.now()})}).catch(c=>{console.error(c)}).finally(()=>{A.value[o]=!1})},V=S(()=>{const o=i.settings.language;return o?o.substr(0,2):null});return{activeRepo:S(()=>b.meta.activeRepo),adapterUpdates:a,adapterUpdateList:U,instances:f,language:V,loading:A,moduleConfig:n,onSet:N}}}),ne=C("br",null,null,-1),ie=p(", "),ue={class:"UpdateAvailable"},pe={key:1},fe={key:2};function me(e,s,i,b,I,n){const f=X("icon");return Y([e.widget.revision],()=>l(T,null,{default:t(()=>[k(l(_,{class:"UpdateAvailableListItem",style:{"background-color":"var(--q-accent)"}},{default:t(()=>[e.adapterUpdateList.length>60?(m(),v(w,{key:0},{default:t(()=>[p(r(e.adapterUpdateList),1)]),_:1})):g("",!0),l(u,{avatar:""},{default:t(()=>[l(f,{name:"refresh"})]),_:1}),l(u,null,{default:t(()=>[l(L,null,{default:t(()=>[p(r(e.adapterUpdateList.length>60?e.adapterUpdateList.substr(0,58)+"...":e.adapterUpdateList),1)]),_:1}),l(L,{caption:"",style:{color:"#fff"}},{default:t(()=>[p(r(e.adapterUpdates.length)+" "+r(e.$t("Updates available")),1),ne,p(" "+r(e.$t("Repository")+": "+e.activeRepo),1)]),_:1})]),_:1}),l(u,{side:""},{default:t(()=>[l(de,{rounded:"",color:"white",style:{color:"var(--q-accent)"},label:e.adapterUpdates.length},null,8,["label"])]),_:1})]),_:1},512),[[h,e.moduleConfig.updates&&e.adapterUpdates.length>0]]),(m(!0),B(oe,null,x(e.instances,a=>(m(),v(_,{key:a.id,clickable:e.moduleConfig.switch&&a.mode!=="none"&&a.mode!=="once"&&e.loading[a.id]!==!0,"v-ripple":e.moduleConfig.switch&&a.mode!=="none"&&a.mode!=="once"&&e.loading[a.id]!==!0},{default:t(()=>[l(u,{avatar:""},{default:t(()=>[l(f,{name:"img:"+a.extIcon},null,8,["name"])]),_:2},1024),l(u,null,{default:t(()=>[l(L,null,{default:t(()=>[p(r(a.titleLang&&a.titleLang[e.language]||a.titleLang||a.title),1)]),_:2},1024),l(L,{caption:""},{default:t(()=>[C("span",null,r(a.id)+", v"+r(a.version),1),k(C("span",null,[ie,C("span",ue,r(e.$t("Update available")+" v"+a.update),1)],512),[[h,a.update]]),k(C("span",null,", "+r(e.$t("Compact Mode"))+" "+r(e.$t("on"))+" ("+r(e.$t("Group")+" "+a.compactGroup)+")",513),[[h,a.runAsCompactMode]])]),_:2},1024)]),_:2},1024),a.mode!=="none"&&a.mode!=="once"?k((m(),v(u,{key:0,side:""},{default:t(()=>[e.loading[a.id]===!0?(m(),v(ee,{key:0,color:"primary",size:"21px"})):g("",!0),e.loading[a.id]!==!0&&a.alive!==!1&&a.connectedToHost!==!1&&a.connectedToInstance!==!1?(m(),B("div",pe,[l(f,{color:"positive",name:"mdi-check-circle"}),l(w,null,{default:t(()=>[p(r(e.$t("Adapter")+" "+e.$t("alive")),1)]),_:1})])):g("",!0),e.loading[a.id]!==!0&&a.alive===!1||a.connectedToHost===!1||a.connectedToInstance===!1?(m(),B("div",fe,[l(f,{color:"warning",name:"mdi-alert"}),l(w,null,{default:t(()=>[p(r(e.$t("Adapter")+" "+e.$t("not alive")),1)]),_:1})])):g("",!0)]),_:2},1536)),[[h,a.enabled===!0]]):g("",!0),a.mode!=="none"&&a.mode!=="once"?k((m(),v(u,{key:1,side:""},{default:t(()=>[l(f,{name:"mdi-close"}),l(w,null,{default:t(()=>[p(r(e.$t("Adapter")+" "+e.$t("disabled")),1)]),_:1})]),_:2},1536)),[[h,a.enabled===!1]]):g("",!0),e.moduleConfig.switch&&a.mode!=="none"&&a.mode!=="once"&&e.loading[a.id]!==!0?(m(),v(ae,{key:2,ref_for:!0,ref:"menu","touch-position":""},{default:t(()=>[l(T,{style:{"min-width":"120px","man-width":"150px"},class:"body"},{default:t(()=>[l(_,{class:le("text-white bg-"+(a.enabled?"positive":"negative"))},{default:t(()=>[l(u,{avatar:""}),l(u,null,{default:t(()=>[p(r(e.$t(a.enabled?"Currently running":"Currently stopped")),1)]),_:2},1024),l(u,{side:""})]),_:2},1032,["class"]),k((m(),v(_,{clickable:"",onClick:U=>e.onSet(a.id,!a.enabled)},{default:t(()=>[l(u,{avatar:""},{default:t(()=>[l(te,{color:a.enabled?"negative":"positive",name:a.enabled?"mdi-pause":"mdi-play"},null,8,["color","name"])]),_:2},1024),l(u,null,{default:t(()=>[p(r(e.$t(a.enabled?"Stop":"Start")+" "+e.$t("Adapter")),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[se]])]),_:2},1024)]),_:2},1536)):g("",!0)]),_:2},1032,["clickable","v-ripple"]))),128))]),_:1}),s,0)}var he=z(re,[["render",me]]);export{he as default};
