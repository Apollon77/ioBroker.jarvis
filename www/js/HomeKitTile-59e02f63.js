import{bt as M,a4 as P,bI as Q,co as U,bw as G,Q as g,d7 as J,dM as R,dr as K,k as h,aZ as W,ao as Z,bL as f,aG as B,ay as s,W as m,V as u,b3 as E,bn as I,a2 as D,c$ as X,b1 as Y,a1 as _,D as x,I as O,aE as V,A as k,C as ee,U as v,aI as b,dN as te}from"./index-b364605d.js";const{capitalize:ae}=te,ne=P({name:"ModuleHomeKitTile",props:["_containerSize","widget"],setup(e){const w=Q(),T=U(),H=G(),z=g(()=>e.widget.config),r=g(()=>({...J.joinConfig(z.value,R)})),t=g(()=>e.widget.items&&e.widget.items[0]||{}),d=g(()=>K.get(t.value.deviceId)),a=h({}),n=h({}),y=g(()=>({on:"true",off:"false",...a.value&&a.value.properties||{}})),F=g(()=>a.value&&a.value.val!==void 0&&a.value.val.toString()===y.value.on.toString()),$=(o,i)=>{if(p.value=!0,o){C.value=o;return}a.value=i},N=(o,i)=>{if(p.value=!0,o){C.value=o;return}n.value=i},p=h(!1),C=h();let S=[];W(()=>{d.value?t.value.bodyStateKey||t.value.primaryStateKey?(t.value.primaryStateKey&&(S=S.concat(K.listen(d.value.id,t.value.primaryStateKey,$))),t.value.bodyStateKey&&(S=S.concat(K.listen(d.value.id,t.value.bodyStateKey,N)))):p.value=!0:(C.value="HomeKitTile: "+w.t("Device {deviceId} not found").replace("{deviceId}",t.value.deviceId),console.warn(C.value),p.value=!0)}),Z(()=>K.unlisten(S));const j=(o,i,l)=>{if(Array.isArray(l))return l.some(L=>j(o,i,L));const c=r.value[o+ae(i)];return c===null?!1:l==="secondaryStates"?c===l&&t.value.secondaryStatesKeys:l==="state"?c===l&&t.value.primaryStateKey:l==="bodyElement"?c===l&&t.value.bodyStateKey&&t.value.bodyElement:l==="actionElement"?c===l&&t.value.primaryStateKey&&t.value.actionElement:c===l},q=(o,i="action",l="State")=>f.Components[o]&&f.Components[o][i][l]||f.Components._defaults&&f.Components._defaults[i][l]||null,A=()=>{if(r.value.action==="website"&&(r.value.website.indexOf("http")>-1||r.value.website.indexOf("www")>-1))window.open((r.value.website.indexOf("http")===-1?"http://":"")+r.value.website,"_blank");else if(r.value.action==="page"&&r.value.jumper)T.push({params:{tabId:r.value.jumper}}).catch(o=>console.warn(o));else if(r.value.action==="popup"&&d.value)H.set({selectedDeviceId:d.value.id});else if(d.value&&r.value.action==="trigger"&&t.value.primaryStateKey){const o=F.value?y.value.setOff:y.value.setOn;let i=F.value?y.value.off:y.value.on;i=typeof i=="string"&&(i==="true"||i==="false")?i==="true":i,K.set(d.value.id,t.value.primaryStateKey,o!==void 0?o:i)}};return{FunctionsComponents:f.Components,FunctionsIcons:f.Icons,horizontal:["left","center","right"],vertical:["top","middle","bottom"],moduleConfig:r,loaded:p,error:C,device:d,deviceConfig:t,primaryState:a,bodyState:n,getComponent:q,hasElement:j,jump:A}}}),ie=["v-ripple"],oe={key:0,class:"q-focus-helper"},le={key:1,class:"q-pa-sm full-height"};function se(e,w,T,H,z,r){const t=B("alert"),d=B("icon");return s(),m("div",{class:k(["HomeKitTile grid",{"cursor-pointer":e.moduleConfig.action&&e.moduleConfig.action!=="none","q-hoverable":e.moduleConfig.action&&e.moduleConfig.action!=="none"}]),style:ee({height:e._containerSize.height+"px",width:e._containerSize.width+"px"}),onClick:w[0]||(w[0]=(...a)=>e.jump&&e.jump(...a)),"v-ripple":e.moduleConfig.action&&e.moduleConfig.action!=="none"},[e.moduleConfig.action&&e.moduleConfig.action!=="none"?(s(),m("span",oe)):u("",!0),E(D(X,{indeterminate:""},null,512),[[I,!e.loaded&&!e.error]]),E(D(t,null,{default:Y(()=>[_(x(e.error),1)]),_:1},512),[[I,e.loaded&&e.error]]),e.device?E((s(),m("div",le,[(s(!0),m(O,null,V(e.vertical,a=>(s(),m("div",{key:a,class:k([a,"item row nowrap"])},[(s(!0),m(O,null,V(e.horizontal,n=>(s(),m("div",{key:n,class:k(["col-grow",n])},[e.hasElement(a,n,"icon")?(s(),v(d,{key:0,alignment:n,styles:e.primaryState.iconStyle||{},loading:!e.loaded,name:e.primaryState.icon,color:"primary",IconButton:""},null,8,["alignment","styles","loading","name"])):u("",!0),e.hasElement(a,n,"deviceIcon")?(s(),v(d,{key:1,alignment:n,styles:e.primaryState.iconStyle||{},loading:!e.loaded,name:e.device.icon||e.FunctionsIcons[e.device.function],color:"primary",IconButton:""},null,8,["alignment","styles","loading","name"])):u("",!0),e.hasElement(a,n,"label")?(s(),v(b(e.FunctionsComponents._defaults.components.Title),{key:2,alignment:n,device:e.device,state:e.bodyState,stateKey:e.deviceConfig.bodyStateKey,deviceConfig:e.deviceConfig},null,8,["alignment","device","state","stateKey","deviceConfig"])):u("",!0),e.hasElement(a,n,"secondaryStates")?(s(),v(b(e.FunctionsComponents._defaults.components.SecondaryStates),{key:3,alignment:n,device:e.device,state:e.primaryState,stateKey:e.deviceConfig.primaryStateKey,deviceConfig:e.deviceConfig},null,8,["alignment","device","state","stateKey","deviceConfig"])):u("",!0),e.hasElement(a,n,"state")?(s(),v(b(e.FunctionsComponents._defaults.components.State),{key:4,alignment:n,device:e.device,state:e.primaryState,stateKey:e.deviceConfig.primaryStateKey,deviceConfig:e.deviceConfig},null,8,["alignment","device","state","stateKey","deviceConfig"])):u("",!0),e.hasElement(a,n,"bodyElement")?(s(),v(b(e.getComponent(e.device.function,"body",e.deviceConfig.bodyElement)),{key:5,alignment:n,device:e.device,state:e.bodyState,stateKey:e.deviceConfig.bodyStateKey,deviceConfig:e.deviceConfig},null,8,["alignment","device","state","stateKey","deviceConfig"])):u("",!0),e.hasElement(a,n,"actionElement")?(s(),v(b(e.getComponent(e.device.function,"action",e.deviceConfig.actionElement)),{key:6,alignment:n,device:e.device,state:e.primaryState,stateKey:e.deviceConfig.primaryStateKey,deviceConfig:e.deviceConfig},null,8,["alignment","device","state","stateKey","deviceConfig"])):u("",!0)],2))),128))],2))),128))],512)),[[I,e.loaded&&!e.error]]):u("",!0)],14,ie)}var de=M(ne,[["render",se],["__scopeId","data-v-785412ec"]]);export{de as default};
