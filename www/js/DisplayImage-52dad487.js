import{_ as g,q as f,d5 as u,dI as c,dn as h,j as m,o as t,d as s,J as r,a1 as a,k as l,w as v,n,f as o,c$ as p,i as w,t as y}from"./index-bdb9984b.js";const I=f({name:"ModuleDisplayImage",props:["widget","_containerSize","_widgetSize","_alignment"],data(){return{size:{width:this._widgetSize.width,height:this._containerSize.height},url:null,state:{},loaded:!1,error:!1}},computed:{config(){return u.joinConfig(this.widget.config,c)},deviceConfig(){return this.widget.items&&this.widget.items[0]||{}},style(){return{width:this.config.size==="fit"||this.config.size==="cover"?this.size.width+"px":"auto",height:this.config.size==="fit"||this.config.size==="contain"?this.size.height+"px":"auto"}}},methods:{gotState(e,i){if(this.loaded=!0,e){this.error=e.message||e;return}this.url!==i.val&&this.setUrl(i.val||"")},runInterval(){this.config.refresh&&this.config.refresh>0&&(this.setRefreshInterval=setInterval(()=>{if(this.url&&this.url.startsWith("data:image")&&clearInterval(this.setRefreshInterval),this.url&&!this.url.startsWith("data:image")&&this.config.refreshMethod==="random"){const e=this.url.indexOf("?")!==-1?this.url.substr(this.url.indexOf("?")).replace("?","&").replace(/&_r=[0-9]*/,""):"";this.setUrl(this.url.substr(0,this.url.indexOf("?")>-1?this.url.indexOf("?"):this.url.length)+"?_r="+Date.now()+e)}else this.url&&!this.url.startsWith("data:image")&&this.config.refreshMethod==="whitespace"&&this.setUrl((this.url+" ").replace(/ {2}/g,""))},this.config.refresh*1e3))},setUrl(e){e=e.toString().trim(),e&&e.indexOf("<svg")!==-1&&(e=e.replace("<svg ",'<svg width="100%" height="100%" ')),e&&!e.startsWith("data:image")&&e.indexOf("/")===-1&&(e="data:image;base64,"+e),this.url=e,this.revision=Date.now().toString()}},watch:{_widgetSize(e){this.size.width=e.width},_containerSize(e){this.size.height=e.height},deviceConfig:{immediate:!0,handler:function(e){this.revision=this.widget.revision,this.widget.config.url?(this.setUrl(this.widget.config.url),this.loaded=!0):(this.device=h.get(e.deviceId),this.device?e.primaryStateKey&&h.listen(this.device.id,e.primaryStateKey,this.gotState):(this.error="DisplayImage: "+this.$i18n.t("Device {deviceId} not found").replace("{deviceId}",e.deviceId),console.warn(this.error),this.loaded=!0))}}},mounted(){this.runInterval()},beforeUnmount(){clearInterval(this.setRefreshInterval),this.device}}),z=["innerHTML"],_=["src"];function S(e,i,D,M,O,U){const d=m("alert");return t(),s("div",{class:o(["jarvis-DisplayImage",{[e._alignment.h]:!0,[e._alignment.v]:!0}]),style:n({width:e.size.width+"px",height:e.size.height+"px"})},[r(l(p,{indeterminate:""},null,512),[[a,!e.loaded&&!e.error]]),r(l(d,null,{default:v(()=>[w(y(e.error),1)]),_:1},512),[[a,e.loaded&&e.error]]),e.url&&e.url.startsWith("<svg")?(t(),s("div",{key:0,style:n(e.style),innerHTML:e.url},null,12,z)):r((t(),s("img",{key:1,class:o(["jarvis-DisplayImage-Image",{[e._alignment.h]:!0,[e._alignment.v]:!0}]),src:e.url,style:n(e.style)},null,14,_)),[[a,e.loaded&&!e.error]])],6)}var k=g(I,[["render",S]]);export{k as default};
