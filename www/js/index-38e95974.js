import{Q as B}from"./QToolbarTitle-622a9661.js";import{Q as I}from"./QTooltip-c0d9add2.js";import{bt as U,a4 as A,cl as j,cm as J,cn as F,bw as G,co as H,cp as R,cq as q,k as z,cr as K,Q as p,aG as h,ay as d,W as y,U as f,b1 as r,a2 as o,a1 as L,D as E,bC as v,I as Q,aE as X,cs as Y,V as b,bU as Z,bL as M,ct as _}from"./index-a04ffada.js";import{Q as W}from"./QToolbar-fbb89d4a.js";import{Q as x,a as ee,b as te,c as ie}from"./QFooter-d8bba942.js";import{Q as se}from"./QHeader-6ed15afa.js";const P=[{id:"devices",title:"Devices",icon:"mdi-devices"},{id:"widgets",title:"Widgets",icon:"mdi-view-grid"},{id:"layout",title:"Layout",icon:"mdi-file"},{id:"styles",title:"Styles",icon:"mdi-code-tags",pro:!0},{id:"scripts",title:"scripts",icon:"mdi-language-javascript",pro:!0},{id:"settings",title:"Settings",icon:"mdi-cog"},{id:"account",title:"Pro-Account",icon:"mdi-star"},{id:"help",title:"Help",icon:"mdi-help-box"}],ne=A({name:"ConfigurationLayout",components:{Login:j},setup(){var D;J.dev("DEBUG","ConfigurationLayout","setup()");const e=F(),i=G(),m=H(),w=R();if(e.init({devices:i.devices,layout:Array.isArray(i.layout)&&i.layout.length>0?i.layout:[{id:"2bbbe067-7506-4fac-8a1f-bfbf9f48a9e7",type:"page",icon:"mdi-view-dashboard-variant",title:"Overview",tabs:[{icon:"mdi-desktop-mac-dashboard",title:"Dashboard",id:"674d30a6-83d8-4876-9135-55791d7dfec9",widgetsDesktop:[],widgetsSmartphone:[]}]}],styles:i.styles,scripts:i.scripts,settings:i.settings,widgets:i.widgets}),m.name==="Configuration"){const s=q(((D=e.settings)==null?void 0:D.configTab)||P[0].id)+"Page";setTimeout(()=>{w.replace({name:s,params:m.params}).catch(t=>console.error(t))},500)}const $=z(K.get("secureConfiguration")),O=p(()=>i.settings),C=p(()=>e.hasErrors),S=p({get(){var s;return(s=e.settings)==null?void 0:s.configExpertMode},set(s){e.set("settings.configExpertMode",s)}}),k=p({get(){var s;return(s=e.settings)==null?void 0:s.configTab},set(s){s&&e.set("settings.configTab",s)}}),n=window.open,T=s=>window.location.href.endsWith("configuration")||window.location.href.endsWith("configuration/")?"/configuration/"+s:s,V=(s,t)=>(J.dev("DEBUG","ConfigurationLayout","setPageContainer",s,t),i.set("pageHeight",t-s),{"min-height":t-s+"px"}),N=()=>{i.set("drawerSidebar",!1),w.push({name:"home",params:{...m.params,tabId:i.getSelectedTabId}}).catch(()=>{})};return{hasErrors:C,settings:O,login:$,version:"3.1.0-alpha.36",configTab:k,expertMode:S,tabs:P,setPageContainer:V,to:T,onOpen:n,onCancel:N,onSave:s=>{const t={devices:e.devices,widgets:M(e.widgets),layout:M(e.getLayoutWithoutDeletions)||[],styles:e.styles,scripts:e.scripts,settings:e.settings};for(const u in t.widgets)t.widgets[u].items=t.widgets[u].items||[],t.widgets[u].items=t.widgets[u].items.filter(a=>t.devices[a.deviceId]&&(!t.devices[a.deviceId].attributes||t.devices[a.deviceId].attributes&&t.devices[a.deviceId].attributes.deleted!==!0));t.layout.forEach(u=>{u.tabs=u.tabs||[],u.tabs.forEach(a=>{delete a.widgets,a.widgetsDesktop=a.widgetsDesktop||[],a.widgetsDesktop.forEach(l=>{l.items=l.items||[],l.items=l.items.filter(c=>t.widgets[c]&&t.widgets[c]._deleted!==!0)}),a.widgetsSmartphone=a.widgetsSmartphone||[],a.widgetsSmartphone.forEach(l=>{l.items=l.items||[],l.items=l.items.filter(c=>t.widgets[c]&&t.widgets[c]._deleted!==!0)})})}),t.devices=e.getDevicesWithoutDeletions,t.widgets=e.getWidgetsWithoutDeletions;const g={};JSON.stringify(i.widgets)!==JSON.stringify(t.widgets)&&(g.widgets=t.widgets),JSON.stringify(i.devices)!==JSON.stringify(t.devices)&&(g.devices=t.devices),JSON.stringify(i.layout)!==JSON.stringify(t.layout)&&(g.layout=t.layout),JSON.stringify(i.settings)!==JSON.stringify(t.settings)&&(g.settings=t.settings),JSON.stringify(i.styles)!==JSON.stringify(t.styles)&&(g.styles=t.styles),JSON.stringify(i.scripts)!==JSON.stringify(t.scripts)&&(g.scripts=t.scripts),e.save(g),s?N():e.init(t)}}}}),oe={key:1};function ae(e,i,m,w,$,O){const C=h("icon"),S=h("Login"),k=h("router-view");return d(),y(Q,null,[!e.settings.secureConfiguration||e.settings.secureConfiguration&&e.login?(d(),f(se,{key:0},{default:r(()=>[o(W,null,{default:r(()=>[o(B,null,{default:r(()=>[o(C,{name:"mdi-cog",vAlign:"middle"}),L(" "+E(e.$t("Configuration"))+" (v"+E(e.version)+") ",1)]),_:1}),o(v,{flat:"",dense:"",round:"",icon:e.expertMode?"mdi-code-tags-check":"mdi-code-tags","aria-label":"$t('Expert Mode')",onClick:i[0]||(i[0]=n=>e.expertMode=!e.expertMode)},{default:r(()=>[o(I,null,{default:r(()=>[L(E(e.$t("Expert Mode")),1)]),_:1})]),_:1},8,["icon"])]),_:1}),o(Y,{modelValue:e.configTab,"onUpdate:modelValue":i[1]||(i[1]=n=>e.configTab=n),"inline-label":"",dense:"","outside-arrows":"","mobile-arrows":"",align:"left"},{default:r(()=>[(d(!0),y(Q,null,X(e.tabs,n=>(d(),y(Q,null,[n.link?(d(),f(_,{key:n.id,name:n.id,label:e.$t(n.title),icon:n.icon,onClick:T=>e.onOpen(n.link,"_blank")},null,8,["name","label","icon","onClick"])):(d(),f(ie,{key:n.id,name:n.id,label:e.$t(n.title),icon:n.icon,to:e.to(n.id)},null,8,["name","label","icon","to"]))],64))),256))]),_:1},8,["modelValue"])]),_:1})):b("",!0),o(ee,{class:"jarvis-configuration body"},{default:r(()=>[o(x,{"style-fn":e.setPageContainer},{default:r(()=>[e.settings.secureConfiguration!==void 0&&e.settings.secureConfiguration!==!1&&!e.login?(d(),f(S,{key:0,ns:"secureConfiguration",code:e.settings.secureConfiguration,onOnSuccess:i[2]||(i[2]=n=>e.login=!0)},null,8,["code"])):b("",!0),!e.settings.secureConfiguration||e.settings.secureConfiguration&&e.login?(d(),y("div",oe,[o(k)])):b("",!0)]),_:1},8,["style-fn"])]),_:1}),!e.settings.secureConfiguration||e.settings.secureConfiguration&&e.login?(d(),f(te,{key:1},{default:r(()=>[o(W,null,{default:r(()=>[o(v,{flat:"",icon:"mdi-window-close","aria-label":"Cancel",label:e.$t("Cancel"),class:"text-red",onClick:e.onCancel},null,8,["label","onClick"]),o(Z),o(v,{disable:e.hasErrors,icon:"mdi-content-save","aria-label":"Save",label:e.$t("Save"),flat:"",color:"primary",onClick:i[3]||(i[3]=n=>e.onSave(!1)),style:{"margin-right":"8px"}},null,8,["disable","label"]),o(v,{disable:e.hasErrors,icon:"mdi-content-save","aria-label":"Save & Exit",label:e.$t("Save")+" & "+e.$t("Exit"),color:"primary",onClick:i[4]||(i[4]=n=>e.onSave(!0))},null,8,["disable","label"])]),_:1})]),_:1})):b("",!0)],64)}var me=U(ne,[["render",ae]]);export{me as default};
