import{bt as u,a4 as c,da as v,dM as m,dt as n,aG as p,ay as i,W as s,b3 as r,bn as a,a2 as l,d1 as w,b1 as y,a1 as I,D as z,C as h,A as o}from"./index-04a011b3.js";const _=c({name:"ModuleDisplayImage",props:["widget","_containerSize","_widgetSize","_alignment"],data(){return{size:{width:this._widgetSize.width,height:this._containerSize.height-1},url:null,state:{},loaded:!1,error:!1}},computed:{config(){return v.joinConfig(this.widget.config,m)},deviceConfig(){return this.widget.items&&this.widget.items[0]||{}},style(){return{width:this.config.size==="fit"||this.config.size==="cover"?this.size.width+"px":"auto",height:this.config.size==="fit"||this.config.size==="contain"?this.size.height-1+"px":"auto"}}},methods:{gotState(e,d,g,t){if(this.loaded=!0,e){this.error=e&&e.message||e;return}this.url!==t.val&&this.setUrl(t.val||"")},runInterval(){this.config.refresh&&this.config.refresh>0&&(this.setRefreshInterval&&clearInterval(this.setRefreshInterval),this.setRefreshInterval=setInterval(()=>{if(this.url&&this.url.startsWith("data:image")&&clearInterval(this.setRefreshInterval),this.url&&!this.url.startsWith("data:image")&&this.config.refreshMethod==="random"){const e=this.url.indexOf("?")!==-1?this.url.substr(this.url.indexOf("?")).replace("?","&").replace(/&_r=[0-9]*/,""):"";this.setUrl(this.url.substr(0,this.url.indexOf("?")>-1?this.url.indexOf("?"):this.url.length)+"?_r="+Date.now()+e)}else this.url&&!this.url.startsWith("data:image")&&this.config.refreshMethod==="whitespace"&&this.setUrl((this.url+" ").replace(/ {2}/g,""))},this.config.refresh*1e3))},setUrl(e){e=e.toString().trim(),e&&e.indexOf("<svg")!==-1&&(e=e.replace("<svg ",'<svg width="100%" height="100%" ')),e&&!e.startsWith("data:image")&&e.indexOf("/")===-1&&(e="data:image;base64,"+e),this.url=e,this.revision=Date.now().toString()}},watch:{_widgetSize(e){this.size.width=e.width},_containerSize(e){this.size.height=e.height-1},deviceConfig:{immediate:!0,handler:function(e){this.revision=this.widget.revision,this.widget.config.url?(this.setUrl(this.widget.config.url),this.loaded=!0):(this.device=n.get(e.deviceId),this.device?e.primaryStateKey&&n.listen(this.device.id,e.primaryStateKey,this.gotState):(this.error="DisplayImage: "+this.$i18n.t("Device {deviceId} not found").replace("{deviceId}",e.deviceId),console.warn(this.error),this.loaded=!0))}}},mounted(){this.runInterval()},beforeUnmount(){this.setRefreshInterval&&clearInterval(this.setRefreshInterval),this.device}}),S=["innerHTML"],D=["src"];function b(e,d,g,t,M,C){const f=p("alert");return i(),s("div",{class:o(["jarvis-DisplayImage",{[e._alignment.h]:!0,[e._alignment.v]:!0}]),style:h({width:e.size.width+"px",height:e.size.height+"px"})},[r(l(w,{indeterminate:""},null,512),[[a,!e.loaded&&!e.error]]),r(l(f,null,{default:y(()=>[I(z(e.error),1)]),_:1},512),[[a,e.loaded&&e.error]]),e.url&&e.url.startsWith("<svg")?(i(),s("div",{key:0,style:h(e.style),innerHTML:e.url},null,12,S)):r((i(),s("img",{key:1,class:o(["jarvis-DisplayImage-Image",{[e._alignment.h]:!0,[e._alignment.v]:!0}]),src:e.url,style:h(e.style)},null,14,D)),[[a,e.loaded&&!e.error]])],6)}var R=u(_,[["render",b]]);export{R as default};
