import{bt as Z,a4 as K,Q as g,d9 as _,e9 as x,k as h,r as ee,an as ae,ao as oe,ea as N,aG as se,ay as S,W as R,X as n,C as $,a1 as I,D as c,b3 as d,bn as u,a2 as f,b1 as Q,U as j,V as w,bB as A,cR as te,I as q,bs as re,cI as H,b$ as O,dq as U}from"./index-70bf7b31.js";import{Q as ne}from"./QTooltip-743798f9.js";const{getPaletteColor:le,changeAlpha:ie}=re,de=K({name:"ModuleMediaControl",props:["widget","_containerSize","_widgetSize"],setup(e){const o=g(()=>e.widget.config),y=g(()=>({..._.joinConfig(o.value,x)})),l=g(()=>y.value.adapter.substr(0,y.value.adapter.indexOf("."))),T=h([]),k=h(null),p=g(()=>T.value.find(t=>t.id===k.value)||{}),s=ee({}),X=g(()=>({height:e._containerSize.height-50+"px","background-image":s.cover?"url('"+y.value.coverUrl+s.cover+"')":"none","background-size":y.value.coverMode?"auto 100%":"100% auto",paddingTop:e._containerSize.height-50-50-6+"px"})),F=g(()=>({background:ie(le("primary"),.8)})),G=g(()=>({width:(Math.floor(s.progress/s.duration*e._widgetSize.width)||0)+"px"})),M=h(0),E=h(0),W=a=>z("progress",Math.round(a.layerX/e._widgetSize.width*s.duration)),Y=a=>{M.value=Math.round(a.layerX/e._widgetSize.width*100),E.value=N(M.value/100*s.duration)},P=h({}),m=h({}),C=(a="",t=null)=>(t=t||k.value||"",t?(y.value.adapter+m.value[l.value]._namespace+a).replace("{PLAYER}",t||""):null),V=({val:a})=>{P.value[l.value]&&P.value[l.value].setPlayer&&P.value[l.value].setPlayer(t=>C(t,a),t=>C(t)),k.value=a,H.set("MediaControl.player."+e.widget.id,a)},z=(a,t=!0)=>{if(a==="play"&&p.value?(s.play=!0,V({val:p.value.id})):a==="pause"&&(s.play=!1),m.value[l.value][a]&&m.value[l.value][a].action){const i=C(m.value[l.value][a].action);i&&U.getConnection.setState(i,m.value[l.value][a].setter?m.value[l.value][a].setter(t,C):t).catch(b=>{console.error(b)})}},B=h([]),J=a=>{if(!B.value.includes(a)){B.value.push(a);const t=U.getConnection;for(const i in m.value[l.value]){let r=m.value[l.value][i];r=typeof r=="string"?{state:r}:r,r&&r.state&&(r.stateKey=i,t.subscribeState(C(r.state),({err:b,state:v})=>{!b&&v&&v.val!==void 0&&(v.val=r.display&&r.display[v.val]||v.val,s[i]=r.convert?r.convert(v.val):v.val)}))}}},L=()=>{P.value[l.value]&&P.value[l.value].getPlayers(y.value.adapter).then(a=>{if(a.length>0){T.value=a;const t=H.get("MediaControl.player."+e.widget.id)||a[0].id,i=t&&a[a.findIndex(r=>r.id===t)];k.value=i?i.id:a[0].id,J(k.value)}})};let D=null;return ae(()=>{const a={"./adapters/alexa2.js":()=>O(()=>import("./alexa2-0a8b45f3.js"),["js/alexa2-0a8b45f3.js","js/index-70bf7b31.js","css/index-5120b2e0.css"]),"./adapters/musiccast.js":()=>O(()=>import("./musiccast-e53c6522.js"),["js/musiccast-e53c6522.js","js/index-70bf7b31.js","css/index-5120b2e0.css"]),"./adapters/plex.js":()=>O(()=>import("./plex-fbf7416c.js"),["js/plex-fbf7416c.js","js/index-70bf7b31.js","css/index-5120b2e0.css"]),"./adapters/spotify-premium.js":()=>O(()=>import("./spotify-premium-ae75a107.js"),["js/spotify-premium-ae75a107.js","js/index-70bf7b31.js","css/index-5120b2e0.css"]),"./adapters/yamaha.js":()=>O(()=>import("./yamaha-e661e40b.js"),["js/yamaha-e661e40b.js","js/index-70bf7b31.js","css/index-5120b2e0.css"])},t=[];for(const i in a){const r=a[i]().then(b=>{const v=i.substr(i.lastIndexOf("/")+1).replace(".js","");return P.value[v]=b,m.value[v]=b.default,!0});t.push(r)}Promise.allSettled(t).then(()=>{L(),D=setInterval(()=>{L()},60*1e3)})}),oe(()=>D&&clearInterval(D)),{secondsToHoursMinutesSeconds:N,media:s,cover:X,trackInformation:F,trackProgress:G,updateProgressSetter:Y,setProgress:W,setProgressToTime:E,setProgressToPercent:M,selectPlayer:V,players:T,player:p,set:z,adapterStates:m}}}),ue={class:"full-height"},pe={class:"row"},me={class:"col nowrap ellipsis"},ve={class:"row"},ce={class:"col-grow",style:{overflow:"hidden"}},fe={class:"col-shrink",style:{"text-align":"right"}},ye={class:"track-duration disabled"},ge={class:"controls q-pa-sm"},he={class:"controlsLeft"},ke={class:"controlsCenter"},Pe={class:"controlsRight"};function be(e,o,y,l,T,k){const p=se("inputs");return S(),R("div",ue,[n("div",{class:"cover",style:$(e.cover)},[n("div",{class:"track-information q-pa-sm",style:$(e.trackInformation)},[n("div",pe,[n("div",me,[I(c((e.media.artist||"")+(e.media.album?" - "+e.media.album:""))+" ",1),d(n("span",null,"("+c(e.media.year)+")",513),[[u,e.media.align==="top"&&e.media.year]])])]),n("div",ve,[n("div",ce,[I(c(e.media.track)+" ",1),d(n("span",null,"("+c(e.media.year)+")",513),[[u,e.media.align==="bottom"&&e.media.year]])]),d(n("div",fe,[I(c(e.secondsToHoursMinutesSeconds(e.media.progress))+" ",1),d(n("span",null,"/ "+c(e.secondsToHoursMinutesSeconds(e.media.duration)),513),[[u,e.media.progress&&e.media.duration]])],512),[[u,e.media.progress||e.media.duration]])])],4),d(n("div",{class:"track-duration",onMousemove:o[1]||(o[1]=(...s)=>e.updateProgressSetter&&e.updateProgressSetter(...s)),onClick:o[2]||(o[2]=(...s)=>e.setProgress&&e.setProgress(...s))},[f(ne,{anchor:"top middle"},{default:Q(()=>[I(c(e.setProgressToTime)+" ("+c(e.setProgressToPercent)+"%)",1)]),_:1}),n("div",{class:"track-progress",style:$(e.trackProgress),onClick:o[0]||(o[0]=(...s)=>e.setProgress&&e.setProgress(...s))},null,4)],544),[[u,e.media.progress]]),d(n("div",ye,null,512),[[u,!e.media.progress]])],4),n("div",ge,[n("div",he,[e.media.type!=="RADIO"?(S(),j(p,{key:0,type:"button",color:"accent",icon:"mdi-monitor-cellphone-star",tooltip:e.player.name,items:e.players,onOnSelect:e.selectPlayer,selected:e.player.id},null,8,["tooltip","items","onOnSelect","selected"])):w("",!0)]),n("div",ke,[f(te,null,{default:Q(()=>[e.adapterStates.previous&&e.adapterStates.previous.action?d((S(),j(A,{key:0,color:"primary",onClick:o[3]||(o[3]=s=>e.set("previous")),icon:"mdi-skip-previous"},null,512)),[[u,e.media.type!=="RADIO"]]):w("",!0),f(A,{color:"primary",onClick:o[4]||(o[4]=s=>e.set(e.media.play?"pause":"play")),icon:e.media.play?"mdi-pause":"mdi-play"},null,8,["icon"]),e.adapterStates.next&&e.adapterStates.next.action?d((S(),j(A,{key:1,color:"primary",onClick:o[5]||(o[5]=s=>e.set("next")),icon:"mdi-skip-next"},null,512)),[[u,e.media.type!=="RADIO"]]):w("",!0)]),_:1})]),n("div",Pe,[e.media.type!=="RADIO"?(S(),R(q,{key:0},[d(f(p,{round:"",onOnClick:o[6]||(o[6]=s=>e.set("shuffle","on")),type:"button",color:"secondary",icon:"mdi-shuffle-disabled",tooltip:"shuffle is off"},null,512),[[u,e.adapterStates.shuffle&&e.media.shuffle==="off"]]),d(f(p,{round:"",onOnClick:o[7]||(o[7]=s=>e.set("shuffle","off")),type:"button",color:"secondary",icon:"mdi-shuffle-variant",tooltip:"shuffle is on"},null,512),[[u,e.adapterStates.shuffle&&e.media.shuffle==="on"]])],64)):w("",!0),e.media.type!=="RADIO"?(S(),R(q,{key:1},[d(f(p,{round:"",onOnClick:o[8]||(o[8]=s=>e.set("repeat","once")),type:"button",color:"secondary",icon:"mdi-repeat-off",tooltip:"repeat off"},null,512),[[u,e.adapterStates.repeat&&e.media.repeat==="off"]]),d(f(p,{round:"",onOnClick:o[9]||(o[9]=s=>e.set("repeat","all")),type:"button",color:"secondary",icon:"mdi-repeat-once",tooltip:"repeat once"},null,512),[[u,e.adapterStates.repeat&&e.media.repeat==="once"]]),d(f(p,{round:"",onOnClick:o[10]||(o[10]=s=>e.set("repeat","off")),type:"button",color:"secondary",icon:"mdi-repeat",tooltip:"repeat all"},null,512),[[u,e.adapterStates.repeat&&e.media.repeat==="all"]])],64)):w("",!0)])])])}var we=Z(de,[["render",be]]);export{we as default};
