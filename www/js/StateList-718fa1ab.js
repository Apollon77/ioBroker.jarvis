import{a4 as k,Q as C,dc as L,dx as D,k as v,aZ as h,dy as p,cq as I,ao as K,bt as F,aG as _,ay as n,U as c,b1 as B,W as g,I as w,aE as E,V as b,bU as P,A as $,bF as j}from"./index-9a251ba4.js";import z from"./StateListGroup-bf9f0c7e.js";import Q from"./StateListItem-0220cc12.js";const U=k({name:"ModuleStateList",props:["widget","isPopup","openDeviceDetails"],components:{StateListGroup:z,StateListItem:Q},setup(t){const S=C(()=>t.widget.config),y=C(()=>({...L.joinConfig(S.value,D)})),r=v({}),u=v({}),m=(i,o,s,f)=>{if(i||!f)return u.value[o.id+":"+s]=i&&i.message||i||"State is empty",console.warn("StateList",t.widget.id,o.name,s,f,u.value[o.id+":"+s]),u.value[o.id+":"+s];r.value[o.id+":"+s]={...f}};let l=v([]),a=null,e={},d=[];return h(()=>{l.value=[],a=null,e={},t.widget.items.forEach(i=>{if(i.type==="group"&&(a=i.id,e[a]={}),i.type==="divider"&&(a=null),i.type==="device"){const o=p.get(i.deviceId);if(!o)I.warn("StateList","Device with ID "+i.deviceId+" not found!");else{l.value.push({item:i,device:o});const s=i;a!==null&&e[a]!==void 0&&(e[a][o.id+"#"+i.primaryStateKey]={item:i,device:o}),r.value[o.id+":"+s.primaryStateKey]={},s.primaryStateKey&&(d=d.concat(p.listen(o.id,s.primaryStateKey,m))),r.value[o.id+":"+s.bodyStateKey]={},s.bodyStateKey&&(d=d.concat(p.listen(o.id,s.bodyStateKey,m)))}}else l.value.push({item:i})})}),K(()=>p.unlisten(d)),{entries:l,groups:e,moduleConfig:y,states:r,errors:u}}}),G={key:0};function M(t,S,y,r,u,m){const l=_("state-list-group"),a=_("state-list-item");return n(),c(j,{key:t.widget.revision,dense:t.moduleConfig.dense,class:$(["jarvis-StateList",{horizontal:t.moduleConfig.horizontal,stacked:t.moduleConfig.stacked}])},{default:B(()=>[(n(!0),g(w,null,E(t.entries,(e,d)=>(n(),g(w,{key:"item-"+e.item.id},[e.item.type==="group"?(n(),g("div",G)):b("",!0),e.item.type==="group"?(n(),c(l,{key:1,devices:t.groups[e.item.id],deviceConfig:e.item,moduleConfig:t.moduleConfig},null,8,["devices","deviceConfig","moduleConfig"])):e.item.type==="device"?(n(),c(a,{key:"state-list-item-"+e.item.id,isFirstItem:d===0,widget:t.widget,device:e.device,deviceConfig:e.item,moduleConfig:t.moduleConfig,primaryState:t.states[e.device.id+":"+e.item.primaryStateKey],bodyState:t.states[e.device.id+":"+e.item.bodyStateKey],isPopup:t.isPopup,openDeviceDetails:t.openDeviceDetails,error:t.errors[e.device.id+":"+e.item.bodyStateKey]},null,8,["isFirstItem","widget","device","deviceConfig","moduleConfig","primaryState","bodyState","isPopup","openDeviceDetails","error"])):e.item.type==="divider"?(n(),c(P,{key:3,class:"jarvis-StateListSeparator"})):b("",!0)],64))),128))]),_:1},8,["dense","class"])}var N=F(U,[["render",M],["__scopeId","data-v-0901e14f"]]);export{N as default};
