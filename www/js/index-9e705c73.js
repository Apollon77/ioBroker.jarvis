import{Q as L}from"./QToolbarTitle-a356f6b1.js";import{q as S,ck as _,W as F,cn as A,cl as G,a2 as I,y as K,_ as M,j as y,o as s,d as r,k as o,w as l,F as P,l as j,J,a1 as V,a as $,i as k,t as u,f as W,O as C,g as T,e as z,cJ as X,H as Y,c as v,ab as Z,n as x,d4 as ee}from"./index-80522cd8.js";import{Q as te}from"./QToolbar-1e1c36cc.js";import{Q as oe}from"./QExpansionItem-ebbf8237.js";import{J as ie}from"./json-editor-c8a8a34c.js";import{Q as U,a as B,b,c as se}from"./QTable-3e7d6338.js";import{Q as le}from"./QTooltip-839cbf20.js";import{W as ne}from"./WidgetPage-b9937559.js";import"./QSlideTransition-6b240e02.js";import"./_commonjsHelpers-45ea234c.js";import"./QVirtualScroll-e571f125.js";import"./useDragDrop-cc6a0951.js";import"./vue.runtime.esm-bundler-8a4aefb4.js";const ae=S({name:"WidgetsTable",props:["widgets"],emits:["onEditWidget"],setup(e,{emit:c}){_.dev("DEBUG","WidgetsTable","setup()",e.widgets);const g=F(),f=A(),m=G(),h={sortBy:"title",rowsPerPage:15},w=[{name:"id",label:g.t("ID"),field:"id",align:"left",sortable:!0},{name:"title",label:g.t("Title")+" ("+g.t("ID")+")",field:"title",align:"left",sortable:!0,style:{width:"20%"}},{name:"module",label:g.t("Module"),field:"module",align:"left",sortable:!0,style:{width:"15%"}},{name:"usage",label:g.t("Usage")+" [ #: "+g.t("Tab")+" ("+g.t("Page")+") ]",field:"usage",align:"left",sortable:!0,style:{width:"65%"}}],t=I({});return K(()=>{_.dev("DEBUG","WidgetsTable","watchEffect");const i={};for(const D of m.layout){const O=D.tabs||[];for(const E of O){const H=[...E.widgetsDesktop||[],...E.widgetsSmartphone||[]];for(const R of H){const q=R.items||[];for(const Q of q)i[Q]=i[Q]||[],i[Q].push({widget:R,tab:E,page:D})}}}t.value=i}),{pagination:h,columns:w,usage:t,copyClipboard:i=>useCopyToClipboard(i),goTo:(i,D,O)=>{_.dev("DEBUG","WidgetsTable","goTo"),m.set({selectedPage:i,selectedTab:D}),f.push({name:"LayoutPage"})},isDeleted:i=>i._deleted===!0,onWidgetEdit:i=>c("onEditWidget",i),onWidgetCopy:i=>m.copyWidget({widget:i}),onWidgetRemove:i=>m.removeWidget({widget:i}),onWidgetRestore:i=>m.restoreWidget({widget:i})}}}),de={class:"q-pa-md"},re={key:0},ce=["onClick"],ge={key:0},ue={key:1},me={key:2};function we(e,c,g,f,m,h){const w=y("icon");return s(),r("div",de,[o(se,{rows:e.widgets,columns:e.columns,pagination:e.pagination,"rows-per-page-label":e.$t("Widgets per page")},{header:l(t=>[o(U,{props:t},{default:l(()=>[o(B,{"auto-width":""}),(s(!0),r(P,null,j(t.cols,n=>J((s(),$(B,{key:n.name,props:t},{default:l(()=>[k(u(n.label),1)]),_:2},1032,["props"])),[[V,n.field!=="id"]])),128)),o(B,{"auto-width":""})]),_:2},1032,["props"])]),body:l(t=>[o(U,{props:t,class:W({rowDeleted:e.isDeleted(t.row)})},{default:l(()=>[o(b,{"auto-width":""},{default:l(()=>[e.isDeleted(t.row)!==!0?(s(),r("div",re,[o(C,{size:"sm",flat:"",round:"",onClick:n=>e.onWidgetEdit(t.row),icon:"mdi-pencil"},null,8,["onClick"]),o(C,{size:"sm",flat:"",round:"",onClick:n=>e.onWidgetCopy(t.row),icon:"mdi-content-copy"},null,8,["onClick"])])):T("",!0)]),_:2},1024),o(b,null,{default:l(()=>[z("div",{class:W({itemDeleted:e.isDeleted(t.row)}),onClick:n=>e.copyClipboard(t.cols[0].value)},[o(le,null,{default:l(()=>[k(" ID: "+u(t.cols[0].value)+" ("+u(e.$t("click to copy to clipboard"))+") ",1)]),_:2},1024),t.cols[1].value?(s(),r("span",ge,u(t.cols[1].value),1)):(s(),r("em",ue,"("+u(e.$t("no title"))+")",1)),t.row.label?(s(),r("span",me," ("+u(t.row.label)+")",1)):T("",!0),o(w,{name:"clipboard-text-multiple-outline",size:"xs",style:{"margin-left":"4px"}})],10,ce)]),_:2},1024),o(b,null,{default:l(()=>[z("div",{class:W({itemDeleted:e.isDeleted(t.row)})},u(t.cols[2].value),3)]),_:2},1024),o(b,null,{default:l(()=>[e.usage[t.row.id]?(s(),r("div",{key:1,class:W({itemDeleted:e.isDeleted(t.row)})},[k(u(e.usage[t.row.id].length)+": ",1),(s(!0),r(P,null,j(e.usage[t.row.id],({widget:n,tab:p,page:a},d)=>(s(),$(X,{key:t.row.id+"-"+d,square:"",color:"primary","text-color":"white",onClick:N=>e.goTo(a,p,n),clickable:""},{default:l(()=>[k(u(p.title+" ("+a.title+")"),1)]),_:2},1032,["onClick"]))),128))],2)):(s(),r("div",{key:0,class:W({itemDeleted:e.isDeleted(t.row)})},null,2))]),_:2},1024),o(b,{"auto-width":""},{default:l(()=>[e.isDeleted(t.row)!==!0?(s(),$(C,{key:0,size:"sm",flat:"",round:"",onClick:n=>e.onWidgetRemove(t.row),icon:"mdi-delete",color:"negative"},null,8,["onClick"])):T("",!0),e.isDeleted(t.row)?(s(),$(C,{key:1,size:"sm",flat:"",round:"",onClick:n=>e.onWidgetRestore(t.row),icon:"mdi-restore",color:"positive"},null,8,["onClick"])):T("",!0)]),_:2},1024)]),_:2},1032,["props","class"])]),_:1},8,["rows","columns","pagination","rows-per-page-label"])])}var pe=M(ae,[["render",we]]);const fe=S({name:"WidgetsPage",components:{JsonEditor:ie,WidgetsTable:pe,WidgetPage:ne},setup(){_.dev("DEBUG","WidgetsPage","setup()");const e=Y(),c=G(),g=v(()=>e.pageHeight),f=v(()=>c.getGroupedWidgets),m=v(()=>c.getWidgetsWthoutDeletionsCount),h=v(()=>c.widgets),w=v(()=>{var d;return(d=c.settings)==null?void 0:d.configExpertMode}),t=I(),n=()=>{t.value=ee()},p=d=>{t.value=d.id},a=d=>!d._error&&c.set({[d.id]:JSON.parse(d.value)});return{expanded:I({}),pageHeight:g,groups:f,json:h,expertMode:w,widgetsCount:m,selectedWidgetId:t,addWidget:n,editWidget:p,onJsonEditor:a}}}),he={class:"full-height WidgetsPage"},We={class:"row no-wrap"};function ve(e,c,g,f,m,h){const w=y("widget-page"),t=y("widgets-table"),n=y("json-editor"),p=y("paper");return s(),r("div",he,[z("div",We,[o(te,{class:"paper",style:{"min-height":"56px"}},{default:l(()=>[o(L,{shrink:""},{default:l(()=>[k(u(e.$t("Widgets"))+" ("+u(e.widgetsCount)+")",1)]),_:1}),o(Z),o(C,{color:"primary",icon:"mdi-plus-circle",label:e.$t("Add Widget"),onClick:e.addWidget},null,8,["label","onClick"])]),_:1})]),o(w,{onOnClose:c[0]||(c[0]=a=>e.selectedWidgetId=null),widgetId:e.selectedWidgetId},null,8,["widgetId"]),(s(!0),r(P,null,j(e.groups,a=>J((s(),r("div",{class:"row no-wrap paper",key:a.id},[o(oe,{modelValue:e.expanded[a.id],"onUpdate:modelValue":d=>e.expanded[a.id]=d,icon:a.icon,label:a.label+" ("+a.widgets.length+")",class:"full-width"},{default:l(()=>[o(t,{onOnEditWidget:e.editWidget,widgets:a.widgets},null,8,["onOnEditWidget","widgets"])]),_:2},1032,["modelValue","onUpdate:modelValue","icon","label"])])),[[V,!e.expertMode&&a.widgets.length>0]])),128)),J(o(p,{style:x({height:e.pageHeight-66-16+"px"})},{default:l(()=>[o(n,{id:"widgets",json:e.json,onOnChange:e.onJsonEditor},null,8,["json","onOnChange"])]),_:1},8,["style"]),[[V,e.expertMode]])])}var Ve=M(fe,[["render",ve]]);export{Ve as default};
