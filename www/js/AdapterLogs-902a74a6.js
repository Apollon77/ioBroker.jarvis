import{_ as Q,q as S,dl as w,de as A,c as b,a2 as h,y as B,j as I,o as i,d as N,J as _,a1 as k,k as r,w as l,n as P,c$ as T,i as c,t as u,Q as d,a as m,e as V,f as $,d5 as j,dv as D,cG as E,d4 as F,cE as O}from"./index-bdb9984b.js";import{c as H,Q as J,b as g}from"./QTable-d66e5940.js";import"./QVirtualScroll-e68aa7b7.js";const q=S({name:"ModuleAdapterLogs",props:["widget","_containerSize"],setup(a){console.debug("ModuleAdapterLogs");const v=w.getConnection,C=A(),x=b(()=>a.widget.config),t=b(()=>({...j.joinConfig(x.value,D)})),z=[{name:"from",field:"from",label:"Adapter",align:"left",sortable:!0},{name:"ts",field:"ts",label:"Time",align:"left",sortable:!0},{name:"severity",field:"severity",label:"Severity",align:"left",sortable:!0},{name:"message",field:"message",label:"Message",align:"left",sortable:!1}],p=b(()=>({sortBy:t.value.sortColumn||"",descending:t.value.sortDirection!==void 0?t.value.sortDirection:!1,rowsPerPage:t.value.rowsPerPage||10})),s=e=>!(!t.value.adapters.includes(e.from)||!t.value.severity.includes(e.severity)||t.value.message&&RegExp(t.value.message,"gi").test(e.message)),y=(e,o)=>(e.from.startsWith("host.")||e.from,e.raw=e.message,e._id=F(),e.ts=Number.isInteger(e.ts)?O(e.ts,t.value.timeFormat||"dd.MM.yyyy HH:mm:ss"):e.ts,e.icon=o[e.from]&&o[e.from].extIcon?"img:"+o[e.from].extIcon:"",e.message=e.message.replace(e.from,""),e.message=e.message.indexOf(") ")!==-1?e.message.substr(e.message.indexOf(") ")+2):e.message,e),L=h(!1),M=h(null),f=h();return B(()=>{const e=C.instances.val||{};v.getLogs("current").then(o=>{f.value=o.filter(n=>s(n)).map(n=>y(n,e)),E.getInstance().on("message",n=>{s(n)&&f.value.unshift(y(n,e))}),v.on("_log",n=>{s(n)&&f.value.unshift(y(n,e))})}).catch(o=>{console.error(o),M.value=o.message||o}).finally(()=>{L.value=!0})},{flush:"post"}),{moduleConfig:t,columns:z,columnsVisible:["from","ts","severity","message"],pagination:p,loaded:L,error:M,logs:f}}});function G(a,v,C,x,t,z){const p=I("alert");return i(),N("div",{key:a.widget.revision,class:"jarvis-AdapterLogs",style:P({height:a._containerSize.height+"px"})},[_(r(T,{indeterminate:""},null,512),[[k,!a.loaded&&!a.error]]),_(r(p,null,{default:l(()=>[c(u(a.error),1)]),_:1},512),[[k,a.loaded&&a.error]]),_(r(H,{rows:a.logs,flat:"",dense:a.moduleConfig.dense,pagination:a.pagination,"binary-state-sort":"",columns:a.columns,"row-key":"_id","visible-columns":a.columnsVisible,class:"sticky-table-header full-height"},{body:l(({row:s})=>[r(J,null,{default:l(()=>[r(g,null,{default:l(()=>[r(d,{name:s.icon},null,8,["name"]),c(" \xA0"+u(s.from),1)]),_:2},1024),r(g,null,{default:l(()=>[c(u(s.ts),1)]),_:2},1024),r(g,null,{default:l(()=>[s.severity==="info"?(i(),m(d,{key:0,size:"xs",name:"mdi-information",color:"blue"})):s.severity==="warn"?(i(),m(d,{key:1,size:"xs",name:"mdi-alert-box",color:"warning"})):s.severity==="error"?(i(),m(d,{key:2,size:"xs",name:"mdi-close-box",color:"negative"})):(i(),m(d,{key:3,size:"xs",name:"mdi-bug",color:"grey"})),V("span",{style:{"margin-left":"4px"},class:$("text-"+(s.severity==="info"?"primary":s.severity==="warn"?"warning":s.severity==="error"?"negative":"grey"))},u(s.severity),3)]),_:2},1024),r(g,null,{default:l(()=>[c(u(typeof s.message=="object"?JSON.stringify(s.message):s.message),1)]),_:2},1024)]),_:2},1024)]),_:1},8,["rows","dense","pagination","columns","visible-columns"]),[[k,a.loaded&&!a.error]])],4)}var U=Q(q,[["render",G]]);export{U as default};
