(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[8],{ff43:function(t,e,s){"use strict";s.r(e),s.d(e,"default",(function(){return N}));var a=function(){var t,e=this,s=e.$createElement,a=e._self._c||s;return a("div",[a("div",{staticClass:"row q-pa-md"},[a("div",{staticClass:"col-5"},[a("q-card",[a("q-card-section",{staticClass:"bg-primary text-white"},[a("div",{staticClass:"text-h6"},[e._v(e._s(e.$t("Sign In")))]),a("div",{staticClass:"text-subtitle2"})]),a("q-card-section",[a("div",{directives:[{name:"show",rawName:"v-show",value:null===e.login,expression:"login === null"}],staticClass:"text-center"},[a("q-spinner",{attrs:{color:"primary",size:"3em"}})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:!0===e.login,expression:"login === true"}]},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-12"},[a("inputs",{attrs:{standout:"",value:e.userId,label:"User",disable:""}})],1)]),a("div",{staticClass:"row"},[e.installations.length>0?a("div",{class:(t={},t["col-"+(e.installations.length>1?10:12)]=!0,t)},[a("q-select",{staticStyle:{margin:"0 8px"},attrs:{standout:"","stack-label":"",options:e.installations,label:"Licence valid for following installation"},model:{value:e.selectedInstallation,callback:function(t){e.selectedInstallation=t},expression:"selectedInstallation"}})],1):e._e(),e.installations.length>1?a("div",{staticClass:"col-2",staticStyle:{margin:"8px 0","text-align":"center"}},[a("q-btn",{attrs:{label:e.$t("Apply"),color:"primary"},on:{click:e.selectInstallation}})],1):e._e()])]),a("div",{directives:[{name:"show",rawName:"v-show",value:!1===e.login,expression:"login === false"}],staticClass:"text-center"},[a("div",{attrs:{id:"paypal-button-login"}})])])],1),a("q-card",{directives:[{name:"show",rawName:"v-show",value:e.invoices.length>0,expression:"invoices.length > 0"}],staticClass:"q-mt-md"},[a("q-card-section",{staticClass:"bg-primary text-white"},[a("div",{staticClass:"text-h6"},[e._v(e._s(e.$t("Bills")))]),a("div",{staticClass:"text-subtitle2"})]),a("q-card-section",[a("q-list",[e._l(e.invoices,(function(t){return[a("q-item",{key:"item-"+t.invoiceId,class:{"bg-positive":t.expires>e.now}},[a("q-item-section",[a("q-item-label",[e._v(e._s(t.date)+", #"+e._s(t.invoiceId))]),a("q-item-label",{attrs:{caption:""}},[e._v(e._s(e.$t("valid to"))+" "+e._s(e.format(1e3*t.expires,"dd. MMM yyyy, HH:mm")))])],1)],1),a("q-separator",{key:"separator-"+t.invoiceId})]}))],2)],1)],1)],1),a("div",{staticClass:"col-2 items-center"},[a("q-separator",{staticStyle:{margin:"auto",height:"100%"},attrs:{vertical:""}})],1),a("div",{staticClass:"col-5"},[a("q-card",[a("q-card-section",{staticClass:"bg-primary text-white"},[a("div",{staticClass:"text-h6"},[e._v(e._s(e.$t("Buy"))+" & "+e._s(e.$t("Subscribe")))]),a("div",{staticClass:"text-subtitle2"})]),a("q-card-section",{directives:[{name:"show",rawName:"v-show",value:!1===e.login,expression:"login === false"}],staticClass:"text-center"},[e._v("\n\t\t\t\t\tLogin first to subscribe.\n\t\t\t\t")]),a("q-card-section",{directives:[{name:"show",rawName:"v-show",value:!0===e.login,expression:"login === true"}],staticClass:"text-center"},[a("div",{directives:[{name:"show",rawName:"v-show",value:!1===e.paying,expression:"paying === false"}]},[a("div",{attrs:{id:"paypal-button-subscribe"}}),a("q-separator")],1),a("div",{directives:[{name:"show",rawName:"v-show",value:!0===e.paying,expression:"paying === true"}]},[a("q-spinner",{attrs:{color:"primary",size:"3em"}})],1)])],1)],1)])])},i=[],n=s("a6f4"),o=s("ec26"),l=s("7ead"),r=s("9ea4"),c=s("853a"),d=s("a078"),p=s("e580"),u=Object(n["c"])({name:"AccountPage",data(){return{login:null,paying:!1,userId:null,invoices:[],installations:[],selectedInstallation:null}},computed:{now(){return Math.ceil(Date.now()/1e3)}},methods:{selectInstallation(){console.warn(this.selectedInstallation)},mountPaypalAPI(){window.paypal?window.paypal.use(["login"],(t=>{const e=this.$store.state.jarvis.iobroker.uuid,s=this.$store.state.jarvis.iobroker.system,a=c["a"]._systemId;t.render({appid:"Ad8Db5feNlBy6SdFa7O0fpJ2QYIcyFO9SGSg4tNpxOgOlLyWTkN6JmOFBV58ItTpdUwfBGW2L8WuoIAn",scopes:"openid",containerid:"paypal-button-login",responseType:"code",locale:"de-de",buttonType:"LWP",buttonShape:"pill",buttonSize:"lg",fullPage:"true",state:btoa(this.sessionId+"|"+e+"|"+a+"|"+JSON.stringify(s)+"|"+window.location.href),returnurl:"https://www.zefau.net/jarvis/user/paypal_login.php"})})):setTimeout((()=>this.mountPaypalAPI()),100)},mountPaypalSDK(){if(window.paypal_sdk){const t={style:{shape:"rect",color:"blue",layout:"vertical",label:"subscribe"},createSubscription:(t,e)=>e.subscription.create({plan_id:d["a"].get("IS_DEV")?"P-8FA02261WK027140TMEKBCAI":"P-8EY03930L1769123MMEFPZPI"}),onApprove:(t,e)=>{this.paying=!0,r["a"].post("user/invoice",{action:"assignUserToInvoice",userId:this.userId,subscriptionId:t.subscriptionID}).then((e=>c["a"].setToken(e,t.subscriptionID,this.selectedInstallation.value))).catch((t=>console.error(t))).finally((()=>{this.paying="done"}))}};window.paypal_sdk.Buttons(t).render("#paypal-button-subscribe")}else setTimeout((()=>this.mountPaypalSDK()),100)}},beforeCreate(){this.format=p["a"];const t=d["a"].get("IS_DEV")?"AX8Jm7Cb5vgcRjIhjmkYUNR_jc9cvaUpyl-a33W7aDlj-6DJJqmDvJgWhAu8z6dUoRzp3gdgfkD5iRuw":"Ad8Db5feNlBy6SdFa7O0fpJ2QYIcyFO9SGSg4tNpxOgOlLyWTkN6JmOFBV58ItTpdUwfBGW2L8WuoIAn",e=document.createElement("script");e.setAttribute("src","https://www.paypal.com/sdk/js?client-id="+t+"&components=buttons&currency=EUR&vault=true&intent=subscription"),e.setAttribute("data-namespace","paypal_sdk"),document.body.appendChild(e),this.sessionId=l["a"].get("sessionId")||Object(o["a"])(),l["a"].set("sessionId",this.sessionId),r["a"].post("user/details",{action:"getLoginBySessionId",sessionId:this.sessionId}).then((t=>{if(l["a"].set("userId",t),!t)throw new Error("User not signed in!");this.login=!0,this.userId=t,console.log("User signed-in: "+t),r["a"].post("user/invoice",{action:"getInvoicesByUserId",userId:t}).then((t=>{this.invoices=t})).catch((t=>{console.error(t.message)})),r["a"].post("user/details",{action:"getInstallations",userId:t}).then((t=>{this.installations=t.map((t=>{const e=JSON.parse(t.system),s={value:t.ioBrokerId,label:"System: "+e.hostname+" ("+e.platform+"), ID: "+t.ioBrokerId.substr(-7)+", Expires: "+t.expires};return"1"===t.selected&&(this.selectedInstallation=s),s}))})).catch((t=>{console.error(t.message)}))})).catch((t=>{console.error(t.message),this.login=!1}))},mounted(){this.mountPaypalSDK(),this.mountPaypalAPI()}}),v=u,m=s("2877"),h=s("f09f"),g=s("a370"),b=s("0d59"),w=s("ddd8"),y=s("9c40"),I=s("eb85"),f=s("1c1c"),x=s("66e5"),C=s("4074"),S=s("0170"),_=s("eebe"),q=s.n(_),k=Object(m["a"])(v,a,i,!1,null,null,null),N=k.exports;q()(k,"components",{QCard:h["a"],QCardSection:g["a"],QSpinner:b["a"],QSelect:w["a"],QBtn:y["a"],QSeparator:I["a"],QList:f["a"],QItem:x["a"],QItemSection:C["a"],QItemLabel:S["a"]})}}]);