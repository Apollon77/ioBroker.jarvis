import{c as Se,a1 as Be,w as le,a3 as Ee,y as he,n as be,o as ee,j as ce,k as N,p as X,s as $e,t as Ce,U as ye,X as Ue,K as Y,an as Pe,am as _e,Z as Ne,a8 as Oe,a as de,d as te,e as Q,ai as Le,T as Ve,al as We,f as se,V as qe,ac as je,ab as Me,ao as Qe,W as Ge,R as Ae,a2 as fe,ap as Ie,C as ge,m as re,aq as we}from"./vendor.quasar-78ba37d9.js";import{d as W,p as M,u as c,q as Te,b as k,v as j,o as d,a as S,h as i,e as L,i as o,r as z,f,t as A,n as I,x as ke,w as x,I as De,g as C,F as G,k as F,y as U,j as O,P as Je,G as Fe,B as Z,s as Ke}from"./vendor.vue-1bbf3cb4.js";import{c as ae}from"./config-f4693115.js";import{u as J,b as Xe}from"./stores-22cbae97.js";import{P as ve,C as K,a as pe,L as H,i as ze}from"./controllers-596cf83c.js";import{_ as q}from"./helpers-7b53fe93.js";import{v as Ye,u as ue}from"./vendor.uuid-b6f2345c.js";import{S as Ze,a as xe}from"./assets.css-f32cb8a5.js";import{f as et,g as tt,a as me,u as st}from"./composables-a7e68882.js";import{S as at}from"./module.StateList-525b0894.js";import{u as it}from"./vendor.vue-i18n-e0977824.js";import{b as He,u as nt}from"./vendor.vue-router-7a2a9812.js";import{_ as ie}from"./vendor.rfdc-06a2e69e.js";import{S as ot}from"./modules-9c8c454f.js";import{t as lt,D as rt}from"./components-6142be1b.js";import{d as dt}from"./vendor.pinia-de474293.js";var ut={More:"mehr",Close:"schlie\xDFen","Remember login from current browser":"Anmeldung vom aktuellen Browser merken"},zs=Object.freeze(Object.defineProperty({__proto__:null,default:ut},Symbol.toStringTag,{value:"Module"})),ct={},Hs=Object.freeze(Object.defineProperty({__proto__:null,default:ct},Symbol.toStringTag,{value:"Module"})),vt={More:"\u0414\u0430\u043B\u0435\u0435",Close:"","Remember login from current browser":""},Rs=Object.freeze(Object.defineProperty({__proto__:null,default:vt},Symbol.toStringTag,{value:"Module"})),gt={Notifications:"Benachrichtigungen","hide archived notifications":"verstecke archivierte Benachrichtigungen","show archived notifications":"zeige archivierte Benachrichtigungen",Delete:"l\xF6schen",Archive:"archivieren","Mark as Read":"als gelesen markieren","Mark as Unread":"als ungelesen markieren","Restore from Archive":"aus dem Archiv wiederherstellen"},Bs=Object.freeze(Object.defineProperty({__proto__:null,default:gt},Symbol.toStringTag,{value:"Module"})),pt={},Es=Object.freeze(Object.defineProperty({__proto__:null,default:pt},Symbol.toStringTag,{value:"Module"})),mt={Notifications:"\u0423\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u044F","hide archived notifications":"\u0441\u043A\u0440\u044B\u0442\u044C \u0430\u0440\u0445\u0438\u0432\u043D\u044B\u0435 \u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u044F","show archived notifications":"\u043F\u043E\u043A\u0430\u0437\u0430\u0442\u044C \u0430\u0440\u0445\u0438\u0432\u043D\u044B\u0435 \u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u044F"},Us=Object.freeze(Object.defineProperty({__proto__:null,default:mt},Symbol.toStringTag,{value:"Module"}));const ne=dt("notifications",{state:()=>({all:[],new:null}),getters:{getAll(e){return e.all},getNew(e){return e.new},getUnread(e){const s=K.getConnection;return e.all.filter(n=>{const u=!n.devices||Array.isArray(n.devices)?n.devices:[n.devices];return(!n.state||n.state==="unread")&&(!u||u.includes(s.client.id))})},getActive(e){const s=K.getConnection;return e.all.filter(n=>{const u=!n.devices||Array.isArray(n.devices)?n.devices:[n.devices];return n.state!=="archived"&&(!u||u.includes(s.client.id))}).reverse()},getArchived(e){const s=K.getConnection;return e.all.filter(n=>{const u=!n.devices||Array.isArray(n.devices)?n.devices:[n.devices];return n.state==="archived"&&(!u||u.includes(s.client.id))}).reverse()}},actions:{setAll(e){const s=!e.notifications||!Array.isArray(e.notifications)?[]:e.notifications.map(n=>({...n,id:n.id||Ye()}));JSON.stringify(s)!==JSON.stringify(this.all)&&(this.all=s)},setNew(e){this.new={ts:Date.now(),notifications:e.notifications}},set(e){const s=this.all.findIndex(n=>n.id===e.notificationId);s>-1&&(this.all.splice(s,1,{...this.all[s],...e.props}),this.save({notifications:this.all}))},del(e){const s=this.all.findIndex(n=>n.id===e.notificationId);s>-1&&(this.all.splice(s,1),this.save({notifications:this.all}))},save(e){K.getConnection.setState(ae.get("NODE_NOTIFICATIONS"),JSON.stringify(e.notifications),!0).catch(n=>console.warn("Notifications",n.message||n))},subscribe(){if(!ve.isPro())return Promise.reject("Notifications is only available to Pro!");const e=K.getConnection;return e.on("notification",s=>{s=Array.isArray(s)?s:[s],this.setNew({notifications:s})}),e.subscribeState(ae.get("NODE_NOTIFICATIONS"),({err:s,state:n})=>{let u=[];if(!s&&n&&n.val)try{u=JSON.parse(n.val),this.setAll({notifications:u})}catch(g){console.warn(g)}}),Promise.resolve()}}});const ft=W({name:"Login",props:["ns"],emits:["onSuccess"],setup(e,{emit:s}){const n=J(),u=Xe(),g=M(!1),r=M(),l=M(),t=M(n.settings.secureLogin),a=M(""),p=M(""),P=M(!1),w=c(()=>n.settings[e.ns+"Type"]),R=c(()=>n.settings[e.ns+"Password"]),V=c(()=>ue(n.settings[e.ns+"Password"],ae.get("UUID"))),v=c(()=>n.settings[e.ns+"Groups"]),b=T=>{if(H.dev("DEBUG","Login","onChange()",T),P.value=!1,w.value==="password"&&R.value===T)l.value=!0,n.settings.secureLogin&&t.value&&pe.set("login-"+e.ns,V.value),setTimeout(()=>{console.log("Login successful!"),s("onSuccess")},250);else if(w.value==="iobroker"&&a.value){let B=u.users.find(h=>h.id===a.value);if(B=B?B.value._id:null,B){let h=null;u.groups.forEach(_=>{(_.value.common.members||[]).includes(B)&&(h=_.value._id)}),p.value&&h&&(P.value=!0,K.getConnection.send("verifyLogin",[a.value,p.value],m=>{P.value=!1,m.login&&(l.value=!0,n.settings.secureLogin&&t.value&&pe.set("login-"+e.ns,ue(h,ae.get("UUID"))),setTimeout(()=>{console.log("Login successful!"),s("onSuccess")},250))}))}}};return Te(()=>{const T=pe.get("login-"+e.ns);if(l.value=!n.settings.secureLogin||T===null?!1:w.value==="password"?T===V.value:v.value.some(B=>T===ue(B,ae.get("UUID"))),!ve.isPro()||w.value===!1||l.value||w.value==="password"&&!R.value||w.value==="iobroker"&&(!v.value||v.value.length===0)){s("onSuccess");return}g.value=!0,r.value&&r.value.focus()}),{settings:n.settings,configuredType:w,loaded:g,statusVerifyPassword:P,user:a,password:p,remember:t,isPassword:M(!0),elPassword:r,login:l,onChange:b}}}),bt={class:"jarvis-login-container"},yt={class:"jarvis-login"};function ht(e,s,n,u,g,r){return k((d(),S("div",bt,[k(i(Se,{indeterminate:"",style:{position:"absolute"}},null,512),[[j,e.login]]),L("div",yt,[k(i(Be,{modelValue:e.remember,"onUpdate:modelValue":s[0]||(s[0]=l=>e.remember=l),label:e.$t("Remember login from current browser"),style:{color:"rgb(104, 104, 104)"}},null,8,["modelValue","label"]),[[j,e.settings.secureLogin]]),k(i(he,{ref:"elUser",modelValue:e.user,"onUpdate:modelValue":[s[1]||(s[1]=l=>e.user=l),e.onChange],"stack-label":"",autofocus:"",standout:"bg-primary text-white",class:"jarvis-login-input","input-class":"jarvis-login-input-user",label:e.$t("User"),disable:e.login,"bg-color":e.login?"positive":void 0},{prepend:o(()=>[k(i(le,{name:"mdi-account"},null,512),[[j,!e.login]]),k(i(le,{name:"mdi-check"},null,512),[[j,e.login]])]),append:o(()=>[k(i(Ee,null,null,512),[[j,e.statusVerifyPassword]])]),_:1},8,["modelValue","onUpdate:modelValue","label","disable","bg-color"]),[[j,e.configuredType!=="password"]]),i(he,{ref:"elPassword",modelValue:e.password,"onUpdate:modelValue":[s[3]||(s[3]=l=>e.password=l),e.onChange],type:e.isPassword?"password":"text","stack-label":"",autofocus:"",standout:"bg-primary text-white",class:"jarvis-login-input","input-class":"jarvis-login-input-password",label:e.$t("Password")+" "+e.$t("or")+" "+e.$t("PIN"),disable:e.login,"bg-color":e.login?"positive":void 0,debounce:500},{prepend:o(()=>[k(i(le,{name:"mdi-lock"},null,512),[[j,!e.login]]),k(i(le,{name:"mdi-check"},null,512),[[j,e.login]])]),append:o(()=>[i(le,{name:e.isPassword?"visibility_off":"visibility",class:"cursor-pointer",onClick:s[2]||(s[2]=l=>e.isPassword=!e.isPassword)},null,8,["name"])]),_:1},8,["modelValue","onUpdate:modelValue","type","label","disable","bg-color"])])],512)),[[j,e.loaded]])}var Ns=q(ft,[["render",ht]]);const wt=W({name:"DeviceDetailsPopup",components:{StateList:at},setup(){const e=J(),s=c(()=>e.selectedDevice),n=c(()=>{const g=[];for(const r in s.value.states){const l=s.value.states[r];if(l.hide===!0||l.state===void 0&&l.action===void 0)continue;const{label:t,...a}=l;g.push({id:ue(s.value.id+":"+r,ae.get("UUID")),type:"device",deviceId:s.value.id,bodyStateKey:r,primaryStateKey:r,...a,deviceStateDetails:!0})}return{items:g}});return{onClose:()=>e.set("selectedDeviceId",null),device:s,widget:n}}}),kt={class:"text-h6"};function St(e,s,n,u,g,r){const l=z("state-list");return d(),f(Ce,{"model-value":!!e.device.id,onHide:e.onClose,class:I({"jarvis-popup-container":!0,["jarvis-device-"+e.device.id]:!0})},{default:o(()=>[i(be,{class:"column jarvis-popup",style:{width:"800px","max-width":"95vw","flex-wrap":"nowrap"}},{default:o(()=>[i(ee,{class:"row items-center"},{default:o(()=>[L("div",kt,A(e.device.label||e.device.name),1),i(ce),i(N,{flat:"",round:"",color:"grey",icon:"close",onClick:e.onClose},null,8,["onClick"])]),_:1}),i(X),i(ee,{class:"col q-pa-none scroll body",style:{"overflow-x":"hidden"}},{default:o(()=>[i(l,{openDeviceDetails:!1,widget:e.widget,isPopup:""},null,8,["widget"])]),_:1}),i(X),i($e,{align:"right"},{default:o(()=>[i(N,{flat:"",label:e.$t("Close"),onClick:e.onClose,color:"primary"},null,8,["label","onClick"])]),_:1})]),_:1})]),_:1},8,["model-value","onHide","class"])}var $t=q(wt,[["render",St]]);const Ct=W({name:"Container",props:["tabsCount"],setup(e){H.dev("DEBUG","Container","setup()");const s=J(),n=c(()=>s.drawerMiniMode);return{settings:c(()=>s.settings),drawerMiniMode:n,onHeaderReveals:r=>{H.dev("DEBUG","Container","onHeaderReveals()"),s.set("headerVisible",r)}}}});function Pt(e,s,n,u,g,r){return e.settings.tabsBottom!==!0?k((d(),f(ye,{key:0,class:"jarvis-header text-white",bordered:"",onReveal:e.onHeaderReveals,reveal:e.settings.tabsShow==="hide"},{default:o(()=>[ke(e.$slots,"default")]),_:3},8,["onReveal","reveal"])),[[j,e.drawerMiniMode!==!0||e.drawerMiniMode===!0&&e.tabsCount>1]]):k((d(),f(Ue,{key:1,class:"jarvis-footer text-white",bordered:"",onReveal:e.onHeaderReveals,reveal:e.settings.tabsShow==="hide"},{default:o(()=>[ke(e.$slots,"default")]),_:3},8,["onReveal","reveal"])),[[j,e.drawerMiniMode!==!0||e.drawerMiniMode===!0&&e.tabsCount>1]])}var _t=q(Ct,[["render",Pt]]);const jt=W({name:"Tabs",props:["page","tabs"],setup(e){H.dev("DEBUG","Tabs","setup()");const s=Y(),n=J(),u=ne(),g=ve.isPro(),r=M([]),l=m=>{const D=r.value.findIndex(y=>y.id===m.id);r.value[D]={...m,revision:Pe().substr(0,5)}};x(()=>e.tabs,()=>{H.dev("DEBUG","Tabs","tabsWithResolvedBindings()"),r.value=ie(e.tabs);for(const m of r.value)m.config=ie(m),ze.getBindings(m,l)},{immediate:!0});const t=c(()=>n.drawerMiniMode),a=c(()=>n.settings),p=c({get(){return n.getSelectedTabId},set(m){m&&n.set({selectedTabId:m})}}),P=M([]),w=M(!1),R=M(!1),V=()=>{H.dev("DEBUG","Tabs","tabsHiddenShow()"),R.value=!s.platform.is.mobile},v=De([]),b=(m,D)=>{v[m]=D},T=m=>{H.dev("DEBUG","Tabs","onResize");const D=m&&m.width||s.screen.width;w.value=!1,P.value=[],v&&v.length&&a.value.tabsCollapse!==!1?v.forEach((y,E)=>{const $=y.$el;$.style.display="inherit",($.offsetLeft+$.offsetWidth+220>D||w.value===!0)&&($.style.display="none",w.value=!0,P.value.push(r.value[E]))}):v&&v.length&&a.value.tabsCollapse===!1&&v.forEach(y=>{const E=y.$el;E.style.display="inherit"})},B=m=>n.set("drawerSidebar",m),h=c(()=>u.getUnread.length);return{setRef:b,elTabs:v,tabsWithResolvedBindings:r,tabId:p,tabsHiddenDropdownEnabled:w,tabsHiddenDropdown:R,tabsHiddenShow:V,tabsHidden:P,toggleNotifications:m=>n.set("drawerNotifications",m),toggleSidebar:B,notificationsUnread:h,drawerMiniMode:t,settings:a,isPro:g,isMobile:s.platform.is.mobile===!0,onResize:T}}}),Mt={class:"row nowrap",style:{margin:"2px 0"}},At={key:0,class:"q-tab__label"},It={class:"q-tab__label"};function Tt(e,s,n,u,g,r){const l=z("icon");return d(),f(Ve,{modelValue:e.tabId,"onUpdate:modelValue":s[4]||(s[4]=t=>e.tabId=t),"inline-label":"",dense:"",align:"left",style:U({"padding-left":(e.drawerMiniMode!==!0?0:5)+"px","padding-right":"48px"}),id:"tabBar",class:I({"jarvis-tabs-container":!0,"jarvis-tabs-bottom":e.settings.tabsBottom===!0}),"content-class":"jarvis-tabs","indicator-color":"white"},{default:o(()=>[i(_e,{onResize:e.onResize},null,8,["onResize"]),e.settings.drawerShowMenuButton!==!1?(d(),f(N,{key:0,flat:"",dense:"",round:"",icon:"menu","aria-label":"Menu",onClick:s[0]||(s[0]=t=>e.toggleSidebar(!0)),class:I(["q-ml-sm",{"lt-md":e.drawerMiniMode===!0}])},null,8,["class"])):C("",!0),L("div",Mt,[(d(!0),S(G,null,F(e.tabsWithResolvedBindings,(t,a)=>(d(),f(Ne,{key:t.id+"-"+t.revision,ref_for:!0,ref:p=>e.setRef(a,p),name:t.id,to:{params:{tabId:t.id}},style:U(e.isPro&&t.id===e.tabId&&t.bodySelectedStyle||e.isPro&&t.bodyStyle||{}),class:I(["jarvis-tab",["jarvis-tab-"+t.id,e.isPro&&t.id===e.tabId&&t.bodySelectedStyle&&t.bodySelectedStyle.display&&t.bodySelectedStyle.display.startsWith("none")?"hidden":"",e.isPro&&t.bodyStyle&&t.bodyStyle.display&&t.bodyStyle.display.startsWith("none")?"hidden":""]]),"content-class":e.settings.tabsDense?"dense":"normal"},{default:o(()=>[k(i(l,{name:t.icon,size:"xs",class:"tabIcon",style:U({margin:e.settings.tabsDense?"4px 4px 0 0":"0",...e.isPro&&t.id===e.tabId&&t.iconSelectedStyle||e.isPro&&t.iconStyle||{}})},null,8,["name","style"]),[[j,t.icon]]),e.page.hideLabels!==!0?(d(),S("div",At,A(t.title),1)):C("",!0)]),_:2},1032,["name","to","style","class","content-class"]))),128)),k(i(Oe,{modelValue:e.tabsHiddenDropdown,"onUpdate:modelValue":s[1]||(s[1]=t=>e.tabsHiddenDropdown=t),onMouseover:s[2]||(s[2]=t=>e.tabsHiddenDropdown=e.isMobile?e.tabsHiddenDropdown:!0),stretch:"",flat:""},{label:o(()=>[L("div",{class:I(e.settings.tabsDense?"dense":"normal")},[i(l,{name:"mdi-tab-unselected",size:"xs",class:"tabIcon",style:U({margin:e.settings.tabsDense?"1px 5px 0 0":"-1px 0 1px 0"})},null,8,["style"]),L("div",It,A(e.$t("More")+"..."),1)],2)]),default:o(()=>[i(de,null,{default:o(()=>[(d(!0),S(G,null,F(e.tabsHidden,t=>(d(),f(te,{key:t.id,clickable:"",onClick:a=>e.tabId=t.id,class:I({"q-tab--active":t.id===e.tabId})},{default:o(()=>[i(Q,{avatar:""},{default:o(()=>[i(l,{name:t.icon},null,8,["name"])]),_:2},1024),i(Q,null,{default:o(()=>[O(A(t.title),1)]),_:2},1024)]),_:2},1032,["onClick","class"]))),128))]),_:1})]),_:1},8,["modelValue"]),[[j,e.tabsHiddenDropdownEnabled]])]),k(i(N,{flat:"",dense:"",round:"",icon:"mdi-bell","aria-label":"Notifications",onClick:s[3]||(s[3]=t=>e.toggleNotifications(!0)),class:"q-mr-sm notification-drawer-button"},{default:o(()=>[i(Le,{color:"secondary",align:"middle",floating:""},{default:o(()=>[O(A(e.notificationsUnread),1)]),_:1})]),_:1},512),[[j,e.isPro]])]),_:1},8,["modelValue","style","class"])}var Dt=q(jt,[["render",Tt]]);const zt=W({name:"Widget",props:["page","tab","widgets","config","layout","containerSize"],setup(e){const s=Y(),n=He(),u=J(),g=Je(e,"config")||{};M();const r=M(),l=c(()=>{const $=g.value.alignmentHorizontal||"center",oe=g.value.alignmentVertical||"top",Re=g.value.scaleToFitContents!==void 0?g.value.scaleToFitContents:!0;return{h:$,v:oe,fit:Re}}),t=c(()=>l.value.v!=="middle"?{}:{transform:"translateY(-50%)",position:"relative",top:"50%"}),a=De({width:0,height:0}),p=c(()=>r.value&&r.value.$el.offsetHeight||0),P=c(()=>e.containerSize.height-p.value),w=c(()=>l.value.fit===!1||ot.includes(T.value.module)?{x:1,y:1}:{x:a?Math.min(1,e.containerSize.width/a.width):1,y:a?Math.min(1,P.value/a.height):1}),R=c(()=>{const $=[0,0];return $[0]=l.value.h==="center"?"50%":l.value.h==="right"?"100%":l.value.h,$[1]=l.value.v==="middle"?"50%":l.value.v==="bottom"?"100%":l.value.v,$}),V=c(()=>({width:l.value.h!=="fill-width"?"100%":Math.floor(1/(w.value.y<w.value.x?w.value.y:w.value.x)*100)+"% !important",height:P.value-1+"px"})),v=c(()=>D.value===!0?1:w.value.y<w.value.x?w.value.y:w.value.x),b=c(()=>{const $={"-webkit-transform":"scale("+v.value+")","-webkit-transform-origin":R.value.join(" "),transform:"scale("+v.value+")","transform-origin":R.value.join(" ")};return l.value.v==="middle"&&($.margin="auto"),s.screen.lt.lg||e.layout==="desktop"&&s.platform.is.mobile?{}:$}),T=c(()=>{const $=e.widgets[0];return $&&u.widgets[$]||{}}),B=()=>{H.dev("DEBUG","Widget","jump"),T.value.link&&(T.value.link.indexOf("http")>-1||T.value.link.indexOf("www")>-1)?window.open((T.value.link.indexOf("http")===-1?"http://":"")+T.value.link,"_blank"):T.value.link&&n.push({params:{tabId:T.value.link}}).catch($=>console.warn($))};let h=null;const _=$=>{h&&clearTimeout(h),h=setTimeout(()=>{H.dev("DEBUG","Widget","onResize()"),Object.assign(a,$)},500)},{fullscreenElement:m,fullscreenActive:D,fullscreenToggle:y}=et(P),E=M(g.value.allowFullscreen||!1);return{alignment:l,verticalAlignment:t,scaleSizes:V,scaleStyle:b,size:a,widget:T,widgetTitle:r,widgetTitleSize:p,jump:B,onResize:_,fullscreenEnabled:E,fullscreenElement:m,fullscreenActive:D,fullscreenToggle:y}}});function Ht(e,s,n,u,g,r){const l=z("icon");return d(),S("div",{ref:"fullscreenElement",onDblclick:s[1]||(s[1]=t=>e.fullscreenEnabled&&e.fullscreenToggle()),class:I(["jarvis-widget-container bgcolor",{tile:e.tab.widgetEdges,paper:!e.tab.widgetEdges,fullscreenEnabled:e.fullscreenEnabled}])},[e.fullscreenEnabled?(d(),S("div",{key:0,class:I(["fullscreener",{close:e.fullscreenActive}]),onClick:s[0]||(s[0]=(...t)=>e.fullscreenToggle&&e.fullscreenToggle(...t))},null,2)):C("",!0),i(be,{flat:"",class:I(["jarvis-widget full-width full-height",{["jarvis-widget-module-"+e.widget.module]:!0,["jarvis-widget-"+e.widget.id]:!0}])},{default:o(()=>[e.widget.hideTitle!==!0&&(e.widget.icon||e.widget.title)?(d(),f(te,{key:0,class:"jarvis-widget-header",ref:"widgetTitle"},{default:o(()=>[e.widget.icon?(d(),f(Q,{key:0,side:"",class:I({"cursor-pointer":e.widget.link}),onClick:e.jump},{default:o(()=>[i(We,{square:e.tab.widgetEdges,rounded:!e.tab.widgetEdges,class:"jarvis-widget-icon","font-size":"24px"},{default:o(()=>[i(l,{name:e.widget.icon},null,8,["name"])]),_:1},8,["square","rounded"])]),_:1},8,["class","onClick"])):C("",!0),i(Q,null,{default:o(()=>[i(se,{class:I(["text-h6",{"cursor-pointer":e.widget.link}]),onClick:e.jump},{default:o(()=>[O(A(e.widget.label||e.widget.title),1)]),_:1},8,["class","onClick"])]),_:1})]),_:1},512)):C("",!0),e.widget.hideSeparator!==!0&&e.widget.hideTitle!==!0&&(e.widget.icon||e.widget.title)?(d(),f(X,{key:1})):C("",!0),i(ee,{horizontal:"",class:"jarvis-widget-content",style:U(e.alignment.fit===!1?{"overflow-y":"auto",...e.scaleSizes,...e.verticalAlignment}:e.verticalAlignment)},{default:o(()=>[i(_e,{onResize:e.onResize},null,8,["onResize"]),L("div",{class:"jarvis-widget-scaler full-width",style:U(e.scaleStyle)},[(d(),f(Fe(e.widget.module),{key:e.widget.revision,class:"full-width",widget:e.widget,_alignment:e.alignment,_fullscreen:e.fullscreenActive,_containerSize:{width:e.containerSize.width,height:e.containerSize.height-e.widgetTitleSize},_widgetSize:{width:e.size.width,height:e.size.height}},null,8,["widget","_alignment","_fullscreen","_containerSize","_widgetSize"]))],4)]),_:1},8,["style"])]),_:1},8,["class"])],34)}var Rt=q(zt,[["render",Ht]]);const Bt=W({name:"TabPanel",props:["page","tab"],components:{Widget:Rt},setup(e){H.dev("DEBUG","TabPanel","setup()");const s=J(),n=Y(),u=n.platform.is.mobile,g=!1,r=c(()=>e.tab.widgetConfig),l=c(()=>Math.max(u&&r.value.smartphoneGapSize||g||r.value.desktopGapSize||5,0)),t=c(()=>{let v=[];return u&&r.value.smartphoneSameAs==="specific-layout"||g?v=e.tab.widgetsSmartphone||[]:u&&r.value.smartphoneSameAs==="tablet"?v=e.tab.widgetsTablet||[]:v=e.tab.widgetsDesktop||[],v}),a=c(()=>Math.max.apply(Math,t.value.map(v=>v.y+v.h))),p=c(()=>{var v;return((v=t.value)==null?void 0:v[0])||{}}),P=n.screen.width,w=c(()=>s.pageHeight),R=c(()=>{const v=(u?r.value.smartphoneFitPageHeight:r.value.desktopFitPageHeight)||!1,b=u&&r.value.smartphoneWidgetHeight||g||r.value.desktopWidgetHeight||50;return v===!0?(w.value-2*l.value)/a.value-l.value:b}),V=c(()=>u&&r.value.smartphoneSameAs==="specific-layout"||g?"smartphone":u&&r.value.smartphoneSameAs==="tablet"?"tablet":"desktop");return{containerRows:a,fullscreenContainer:p,pageWidth:P,pageHeight:w,widgetGap:l,widgetHeight:R,widgetLayout:V,widgetContainers:t}}});function Et(e,s,n,u,g,r){const l=z("widget");return d(),S("div",{class:I({["jarvis-page-"+e.page.id]:!0,["jarvis-tab-"+e.tab.id]:!0})},[e.tab.fullscreen!==!0?(d(),S("div",{key:0,class:I(["container",e.widgetLayout]),style:U({gridTemplateRows:"repeat("+e.containerRows+", "+e.widgetHeight+"px)",columnGap:e.widgetGap+"px",rowGap:e.widgetGap+"px",padding:e.widgetGap+"px"})},[(d(!0),S(G,null,F(e.widgetContainers,t=>(d(),S(G,null,[t&&t.items&&t.items.length>0?(d(),S("div",{key:t.i,style:U({gridArea:t.y+1+" / "+(t.x+1)+" / span "+t.h+" / span "+t.w}),class:"box"},[i(l,{page:e.page,tab:e.tab,widgets:t.items||[],config:t,layout:e.widgetLayout,containerSize:{width:e.pageWidth/12*t.w,height:t.h*e.widgetHeight+(t.h-1)*e.widgetGap}},null,8,["page","tab","widgets","config","layout","containerSize"])],4)):C("",!0)],64))),256))],6)):(d(),S("div",{key:1,style:U({height:e.pageHeight+"px"})},[i(l,{fullscreen:"",page:e.page,tab:e.tab,widgets:e.fullscreenContainer.items||[],config:e.fullscreenContainer,layout:e.widgetLayout,containerSize:{width:e.pageWidth,height:e.pageHeight}},null,8,["page","tab","widgets","config","layout","containerSize"])],4))],2)}var Ut=q(Bt,[["render",Et]]);const Nt=W({name:"Page",props:["page"],components:{Container:_t,Tabs:Dt,TabPanel:Ut},setup(e){H.dev("DEBUG","Page","setup()");const s=Y(),n=it(),u=He(),g=nt(),r=J(),l=c(()=>s.platform.is.mobile),t=c(()=>r.drawerMiniMode),a=c(()=>r.settings),p=c(()=>Object.keys(e.page.tabs).length),P=c({get(){return"tab-"+r.getSelectedTabId},set(h){h&&u.push({params:{tabId:h.replace("tab-","")}})}}),w=(h,_)=>{const m=document.querySelector(".jarvis-header");h=m&&m.offsetHeight?m.offsetHeight:h;const D=_-h;return D!==r.pageHeight&&(H.dev("DEBUG","Page","setPageContainer",h,_,D,r.pageHeight),r.set("pageHeight",_-h)),{}},R=()=>r.set("selectedTabReady",!1),V=()=>r.set("selectedTabReady",!0),{jumperOpen:v}=tt(),b=(h,_,m)=>{const D=_.id;u.push({params:{...g.params,tabId:D}}).then(()=>{if(m.id!=="_root"){const y=l.value&&_.widgetConfig.smartphoneWidgetHeight||_.widgetConfig.desktopWidgetHeight||50,E=document.querySelector(".jarvis-header"),$=E&&E.offsetHeight?E.offsetHeight:0;setTimeout(()=>window.scrollTo(0,m.y*y+$+1),100)}}).catch(y=>{console.warn("Page",y.message)})},T=(h,_)=>{let m=s.platform.is.mobile?_.widgetsSmartphone:_.widgetsDesktop;m=r.getWidgets(m),m=m.concat([{},{color:"primary",icon:"mdi-tab",label:n.t("Jump directly to")+" "+_.label,id:"_root"}]),v(m,{class:"jarvis-quick-jumper",message:h.title+" / "+_.title+": "+n.t("Widgets"),onSuccess:D=>b(h,_,D)})},B=h=>{const _=r.getTabs(h);v(_,{class:"jarvis-quick-jumper",message:h.title+": "+n.t("Tabs"),onSuccess:m=>T(h,m)})};return{jumperOpen:()=>v(r.getPages,{class:"jarvis-quick-jumper",message:n.t("Pages"),onSuccess:B}),setPageContainer:w,onSelectedTabMoving:R,onSelectedTabReady:V,drawerMiniMode:t,isMobile:l,tabsCount:p,tabId:P,tabAnimated:c(()=>a.value.tabsSwipeAnimation==="always"||(!a.value.tabsSwipeAnimation||a.value.tabsSwipeAnimation==="mobile")&&l.value),tabSwipeable:c(()=>a.value.tabsSwipe==="always"||(!a.value.tabsSwipe||a.value.tabsSwipe==="mobile")&&l.value),settings:a}}});function Ot(e,s,n,u,g,r){const l=z("Tabs"),t=z("Container"),a=z("TabPanel");return d(),f(Ge,{style:{"padding-top":"0"}},{default:o(()=>[i(t,{tabsCount:e.tabsCount},{default:o(()=>[i(l,{page:e.page,tabs:e.page.tabs},null,8,["page","tabs"])]),_:1},8,["tabsCount"]),i(qe,{"style-fn":e.setPageContainer,class:"jarvis-page jarvis-body"},{default:o(()=>[i(je,{modelValue:e.tabId,"onUpdate:modelValue":s[0]||(s[0]=p=>e.tabId=p),"keep-alive":!0,animated:e.tabAnimated,swipeable:e.tabSwipeable,style:{"background-color":"transparent"},onBeforeTransition:e.onSelectedTabMoving,onTransition:e.onSelectedTabReady},{default:o(()=>[(d(!0),S(G,null,F(e.page.tabs,p=>(d(),f(Me,{key:p.id,name:"tab-"+p.id,style:U({padding:0,"margin-top":e.drawerMiniMode&&(e.settings.tabsBottom||e.page.tabs.length<=1)?0:e.settings.tabsDense?"40px":"60px"})},{default:o(()=>[i(a,{page:e.page,tab:{widgetConfig:{},...p}},null,8,["page","tab"])]),_:2},1032,["name","style"]))),128))]),_:1},8,["modelValue","animated","swipeable","onBeforeTransition","onTransition"]),k(i(Qe,{position:"bottom-right",offset:[18,18],style:{"z-index":"5999"}},{default:o(()=>[i(N,{fab:"",icon:"mdi-tab-search",color:"accent",onClick:s[1]||(s[1]=Z(p=>e.jumperOpen(),["stop"]))})]),_:1},512),[[j,e.settings.quickJumper==="always"||e.isMobile&&e.settings.quickJumper==="mobile"]])]),_:1},8,["style-fn"])]),_:1})}var Lt=q(Nt,[["render",Ot],["__scopeId","data-v-3c02f346"]]);const Vt=W({name:"Jarvis",components:{DeviceDetailsPopup:$t,Page:Lt,tours:lt},setup(){H.dev("DEBUG","Jarvis","setup()");const e=Y(),s=J(),n=c(()=>s.settings);e.iconMapFn=r=>{if(!r.startsWith("img:")&&!r.startsWith("mdi")&&r.indexOf(":")!==-1&&!r.startsWith("M"))return{cls:"iconify","data-icon":r}},x(()=>n.value.scrollbars,()=>{H.dev("DEBUG","Jarvis","watch","scrollbar"),me("style",n.value.scrollbars==="desktop"&&(e.platform.is.desktop||e.platform.is.mobile)||n.value.scrollbars==="mobile"&&e.platform.is.mobile?Ze:" ",{id:"scrollbar",type:"text/css",onlyPro:!1})},{immediate:!0}),x(e.screen.sizes,()=>{me("style",xe.replace(/\$breakpoint-sm-min/g,e.screen.sizes.sm+"px").replace(/\$breakpoint-md-min/g,e.screen.sizes.md+"px"),{id:"responsive",type:"text/css",onlyPro:!1})},{immediate:!0});try{x(()=>s.styles,()=>{H.dev("DEBUG","Jarvis","watch","styles"),st("styles",s.styles,{tag:"link",src:"href",rel:"stylesheet"}).then(r=>me("style",r,{id:"css",type:"text/css"}))},{immediate:!0})}catch(r){console.warn("Jarvis-B7cq4T4m","Error injecting custom styles: "+r.message),console.debug("Jarvis-B7cq4T4m",s.styles)}const u=c(()=>s.layout||[]),g=c(()=>"page-"+s.getSelectedPageId);return{settings:n,pages:u,pageId:g}}});function Wt(e,s,n,u,g,r){const l=z("tours"),t=z("DeviceDetailsPopup"),a=z("Page");return d(),S(G,null,[i(l,{tour:"introduction",start:e.settings.tourIntroduction!==!0},null,8,["start"]),i(l,{tour:"interface",start:e.settings.tourIntroduction===!0&&e.settings.tourInterface!==!0},null,8,["start"]),i(t),i(je,{"model-value":e.pageId,"keep-alive":!0,style:{"background-color":"transparent"},vertical:""},{default:o(()=>[(d(!0),S(G,null,F(e.pages,p=>(d(),f(Me,{key:p.id,name:"page-"+p.id,style:{padding:"0",margin:"0"}},{default:o(()=>[i(a,{page:p},null,8,["page"])]),_:2},1032,["name"]))),128))]),_:1},8,["model-value"])],64)}var qt=q(Vt,[["render",Wt]]),Os=Object.freeze(Object.defineProperty({__proto__:null,default:qt},Symbol.toStringTag,{value:"Module"}));const Qt=W({name:"Sidebar",setup(){const e=J(),s=Y(),n=ve.isPro(),u=s.platform.is.mobile,g=s.screen.sizes.md,r=c(()=>n?e.layout:e.layout.slice(0,1)),l=c(()=>e.drawerMiniMode),t=M(!0),a=M([]),p=y=>{const E=a.value.findIndex($=>$.id===y.id);a.value[E]={...y,revision:Pe().substr(0,5)}};x(()=>r.value,()=>{a.value=ie(r.value);for(const y of a.value)y.config=ie(y),ze.getBindings(y,p)},{immediate:!0});const P=y=>e.set("drawerSidebar",y),w=c({get(){return e.drawerSidebar},set(y){P(y)}}),R=c(()=>e.settings),V=c(()=>{var y;return(y=e.getSelectedPage)==null?void 0:y.id}),v=y=>{var $,oe;H.dev("Sidebar","setPage",y);const E=(oe=($=y.tabs)==null?void 0:$[0])==null?void 0:oe.id;if(!E)return console.warn("Sidebar","Page "+y.id+" has no tabs!",y),!1;e.set({selectedTabId:E})},b=c(()=>{var y,E;return((E=(y=e.getSelectedPage)==null?void 0:y.tabs)==null?void 0:E.count)||0}),T=c(()=>l.value===!0?!t.value:!0),B=c(()=>l.value===!0?b.value<=1:!0),h=M(),_=c(()=>h.value&&h.value.$el.clientHeight||0),m=M(window.innerHeight-(B.value?40:0)),D=()=>{H.dev("Sidebar","onResize()"),m.value=window.innerHeight-(B.value?40:0)};return Te(()=>{H.dev("Sidebar","onMounted()"),window.addEventListener("orientationchange",D),window.addEventListener("resize",D)}),Ke(()=>{H.dev("Sidebar","onUnmounted()"),window.removeEventListener("orientationchange",D),window.removeEventListener("resize",D)}),{elementSidebarBottom:h,elementSidebarBottomHeight:_,isPro:n,isSmartphone:u,maxMobileSize:g,windowHeight:m,itemsWithResolvedBindings:a,drawerMiniMode:l,drawerMiniState:t,sidebar:w,toggleSidebar:P,setPage:v,selectedPageId:V,expanded:T,header:B,settings:R}}}),Gt={class:"headerInvisible"};function Jt(e,s,n,u,g,r){const l=z("icon");return e.settings.drawerShowMenuButton!==!1?(d(),f(Ie,{key:0,ref:"drawer",modelValue:e.sidebar,"onUpdate:modelValue":s[1]||(s[1]=t=>e.sidebar=t),mini:e.drawerMiniMode&&e.drawerMiniState,onMouseover:s[2]||(s[2]=t=>e.drawerMiniState=!1),onMouseout:s[3]||(s[3]=t=>e.drawerMiniState=!0),"mini-to-overlay":"",bordered:"",behavior:e.drawerMiniMode?"default":"mobile",overlay:!e.drawerMiniMode,"show-if-above":e.drawerMiniMode,breakpoint:e.maxMobileSize,class:I(["jarvis-sidebar-container",{"jarvis-sidebar-minimode":e.drawerMiniMode===!0,"jarvis-tabs-bottom":e.settings.tabsBottom===!0,"jarvis-sidebar-header-hidden":e.settings.headerVisible!==!0}]),"content-class":"jarvis-sidebar"},{default:o(()=>[e.drawerMiniMode!==!0?(d(),f(ye,{key:0,style:{position:"relative"}},{default:o(()=>[i(Ae,null,{default:o(()=>[i(ce),i(N,{flat:"",dense:"",round:"",icon:"mdi-chevron-left","aria-label":"Menu",onClick:s[0]||(s[0]=t=>e.toggleSidebar(!1))})]),_:1})]),_:1})):C("",!0),L("div",{style:U({height:e.windowHeight-44+"px"}),class:"q-mt-xs"},[i(de,{dense:"",class:"jarvis-sidebar-items",style:U({"overflow-x":"hidden","overflow-y":e.expanded?"auto":"hidden",maxHeight:e.windowHeight-(e.header?40:0)-e.elementSidebarBottomHeight+"px"})},{default:o(()=>[(d(!0),S(G,null,F(e.itemsWithResolvedBindings,t=>(d(),S("div",{key:t.id+"-"+t.revision,class:I(["jarvis-sidebar-item",["jarvis-sidebar-item-"+t.type,"jarvis-sidebar-item-"+t.type+"-"+t.id,t.tabs&&t.tabs[0]&&t.tabs[0].id?"jarvis-route-tab-"+(t.tabs&&t.tabs[0]&&t.tabs[0].id):""]])},[t.type==="divider"?(d(),f(X,{key:0,spaced:""})):C("",!0),t.type==="header"?k((d(),f(se,{key:1,header:"",style:U(e.isPro&&t.id===e.selectedPageId&&t.bodySelectedStyle||e.isPro&&t.bodyStyle||{})},{default:o(()=>[O(A(t.title),1)]),_:2},1032,["style"])),[[j,e.expanded]]):C("",!0),t.type==="header"?k((d(),S("div",{key:2,class:"headerInvisible",style:U(e.isPro&&t.id===e.selectedPageId&&t.bodySelectedStyle||e.isPro&&t.bodyStyle||{})},"\xA0",4)),[[j,!e.expanded]]):C("",!0),!t.type||t.type==="page"?(d(),f(te,{key:3,to:{params:{tabId:t.tabs&&t.tabs[0]&&t.tabs[0].id}},clickable:"",onClick:a=>e.setPage(t),class:I(["full-width",{selected:t.id===e.selectedPageId}]),style:U(e.isPro&&t.id===e.selectedPageId&&t.bodySelectedStyle||e.isPro&&t.bodyStyle||(t.id===e.selectedPageId?{"background-color":"var(--q-primary)",color:"#fff"}:{color:"var(--q-primary)"})),"active-class":"selected"},{default:o(()=>[i(Q,{avatar:"",center:"",class:I({selected:t.id===e.selectedPageId})},{default:o(()=>[i(l,{name:t.icon,style:U(e.isPro&&t.id===e.selectedPageId&&t.iconSelectedStyle||e.isPro&&t.iconStyle||(t.id===e.selectedPageId?"white":"primary"))},null,8,["name","style"])]),_:2},1032,["class"]),i(Q,null,{default:o(()=>[i(se,{class:I({selectedText:t.id===e.selectedPageId})},{default:o(()=>[O(A(t.title),1)]),_:2},1032,["class"])]),_:2},1024)]),_:2},1032,["to","onClick","style","class"])):C("",!0),!t.type||t.type==="page"?(d(),S("div",{key:4,class:I(["spacer",{selected:t.id===e.selectedPageId}])},null,2)):C("",!0)],2))),128))]),_:1},8,["style"]),e.isSmartphone?C("",!0):k((d(),f(de,{key:0,ref:"elementSidebarBottom",class:"sidebarBottom"},{default:o(()=>[i(X,{spaced:""}),k(i(se,{header:""},{default:o(()=>[O("jarvis")]),_:1},512),[[j,e.expanded]]),k(L("div",Gt,"\xA0",512),[[j,!e.expanded]]),e.isPro?C("",!0):k((d(),f(te,{key:0,clickable:"",to:{name:"AccountPage"},exact:""},{default:o(()=>[i(Q,{avatar:""},{default:o(()=>[i(l,{name:"mdi-heart",color:"primary"})]),_:1}),i(Q,null,{default:o(()=>[O(A(e.$t("Pro Account")),1)]),_:1})]),_:1})),[[fe]]),k((d(),f(te,{clickable:"",to:{name:"DevicesPage"},exact:"",id:"SettingsButton"},{default:o(()=>[i(Q,{avatar:""},{default:o(()=>[i(l,{name:"mdi-cog",color:"primary"})]),_:1}),i(Q,null,{default:o(()=>[O(A(e.$t("Configuration"))+" & "+A(e.$t("Help")),1)]),_:1})]),_:1})),[[fe]])]),_:1},512)),[[j,e.settings.drawerShowSettings!==!1]])],4)]),_:1},8,["modelValue","mini","behavior","overlay","show-if-above","breakpoint","class"])):C("",!0)}var Ft=q(Qt,[["render",Jt]]),Ls=Object.freeze(Object.defineProperty({__proto__:null,default:Ft},Symbol.toStringTag,{value:"Module"}));const Kt=W({name:"NotificationEventPopup",setup(e){const s=K.getConnection,n=Y(),u=ne(),g=c(()=>n.dark.isActive),r=M({}),l=M(0),t={},a=(v,b=50)=>{setTimeout(()=>{t[v.id]=Math.max(0,t[v.id]-b),l.value=Date.now(),t[v.id]>0?a(v):r.value[v.id]=!1},b)},p=v=>u.set({notificationId:v.id,props:{state:"read"}}),P=v=>u.set({notificationId:v.id,props:{state:"archived"}}),w=v=>u.del({notificationId:v.id});x(()=>u.new,v=>V(v.notifications));const R=M([]),V=v=>{v=ie(v),v.forEach(b=>{b.devices=!b.devices||Array.isArray(b.devices)?b.devices:b.devices.indexOf(",")>-1?b.devices.split(","):[b.devices],b.display==="popup"&&(!b.devices||b.devices.includes(s.client.id))&&((b.timeout||b.autoHideDuration||b.progress)&&(b.progress=!0,b.timeout=b.timeout||b.autoHideDuration||5e3,t[b.id]=b.timeout,a(b,500)),r.value[b.id]=!0,R.value.push(b))})};return{isDark:g,notificationList:R,dialogs:r,markAsArchived:P,markAsRead:p,remove:w}}}),Xt={class:"text-h6"},Yt={key:0,class:"text-caption"},Zt=["innerHTML"];function xt(e,s,n,u,g,r){const l=z("icon");return d(!0),S(G,null,F(e.notificationList,t=>(d(),S("div",{key:t.id},[i(Ce,{"model-value":e.dialogs[t.id],onHide:a=>e.dialogs[t.id]=!1,"transition-show":"scale","transition-hide":"scale"},{default:o(()=>[i(be,{class:I({"jarvis-notification-event-popup":!0,[t.category]:t.category!==void 0,["bg-"+(t.color||t.type||t.criticality||"primary")]:!0,["text-"+(t.textColor||"white")]:!0}),style:{width:"550px","max-width":"95vw"}},{default:o(()=>[t.title||t.caption?(d(),f(ee,{key:0,class:"jarvis-notification-event-popup-title"},{default:o(()=>[L("div",Xt,[i(l,{name:t.icon,color:t.iconColor||"primary"},null,8,["name","color"]),O(" "+A(t.title),1)]),t.caption?(d(),S("div",Yt,A(t.caption),1)):C("",!0)]),_:2},1024)):C("",!0),t.message?(d(),f(ee,{key:1,class:"q-pt-none jarvis-notification-event-popup-message"},{default:o(()=>[L("div",{innerHTML:t.message},null,8,Zt)]),_:2},1024)):C("",!0),t.progress?(d(),f(ee,{key:2,class:I(["q-pa-none",{["updated-"+e.refresh]:!0,["text-"+(t.textColor||t.type||t.criticality||"primary")]:!0,["bg-"+(t.color||"white")]:!0}])},{default:o(()=>[i(Se,{value:e.timers[t.id]?e.timers[t.id]/t.timeout:0,class:"q-mt-md",color:t.color||t.type||t.criticality||"accent"},null,8,["value","color"])]),_:2},1032,["class"])):C("",!0),k(i($e,{class:I(["jarvis-notification-event-popup-actions nowrap",{["bg-"+(t.textColor||t.type||t.criticality||(e.isDark?"grey-10":"white"))]:!0,["text-"+(t.color||"primary")]:!0}])},{default:o(()=>[k(i(N,{dense:"",flat:"",label:e.$t("Delete"),icon:"mdi-delete",color:t.type==="negative"||t.criticality==="negative"?"yellow":"negative",onClick:a=>e.remove(t)},null,8,["label","color","onClick"]),[[ge]]),i(ce),k(i(N,{dense:"",flat:"",label:e.$t("Archive"),icon:"mdi-package-down",onClick:a=>e.markAsArchived(t)},null,8,["label","onClick"]),[[ge]]),k(i(N,{dense:"",flat:"",label:e.$t("Mark as Read"),icon:"mdi-check",onClick:a=>e.markAsRead(t)},null,8,["label","onClick"]),[[ge]])]),_:2},1032,["class"]),[[j,t.state!=="delete"]])]),_:2},1032,["class"])]),_:2},1032,["model-value","onHide"])]))),128)}var es=q(Kt,[["render",xt]]);const ts=W({name:"NotificationEventSnackbar",setup(){const e=Y(),s=K.getConnection,n=ne(),u=a=>n.set({notificationId:a.id,props:{state:"read"}}),g=a=>n.set({notificationId:a.id,props:{state:"archived"}}),r=a=>n.del({notificationId:a.id}),l=(a={})=>{!a.type&&a.criticality&&(a.type=a.criticality==="error"?"negative":a.criticality==="success"?"positive":a.criticality),!a.position&&a.snackbarOrigin&&(a.position=[],a.snackbarOrigin.horizontal&&a.position.push(a.snackbarOrigin.horizontal),a.snackbarOrigin.vertical&&a.position.push(a.snackbarOrigin.vertical),a.position=a.position.join(a.position.length===2?"-":""));const p={badgeStyle:"display: none",html:!0,position:"bottom-right",progress:!0,progressClass:"jarvis-notification-event-snackbar-progress",classes:"jarvis-notification-event-snackbar "+(a.category||""),actions:a.state!=="delete"&&[{icon:"mdi-circle-slice-8",size:"sm",color:a.textColor||"white",handler:()=>u(a)},{icon:"mdi-package-down",size:"sm",color:a.textColor||"white",handler:()=>g(a)},{icon:"mdi-delete",size:"sm",color:a.type==="negative"||a.criticality==="negative"?"yellow":"negative",handler:()=>r(a)}],...a,color:a.type||a.criticality||a.color||"primary",textColor:"white",type:a.type||a.criticality||void 0,timeout:a.timeout||a.autoHideDuration||5e3,message:a.title||a.message,group:a.id};e.notify(p)};x(()=>n.new,a=>t(a.notifications));const t=a=>{a=ie(a),a.forEach(p=>{p.devices=!p.devices||Array.isArray(p.devices)?p.devices:p.devices.indexOf(",")>-1?p.devices.split(","):[p.devices],p.display==="snackbar"&&(!p.devices||p.devices.includes(s.client.id))&&l(p)})};return{}}});function ss(e,s,n,u,g,r){return d(),S("div")}var as=q(ts,[["render",ss]]);const is=W({name:"NotificationListItem",props:["notification"],setup(e){const s=ne();return{show:()=>{s.setNew({notifications:[{...e.notification,progress:!1,autoHideDuration:null,timeout:null}]})},markAsRead:()=>s.set({notificationId:e.notification.id,props:{state:"read"}}),markAsUnread:()=>s.set({notificationId:e.notification.id,props:{state:"unread"}}),markAsArchived:()=>s.set({notificationId:e.notification.id,props:{state:"archived"}}),remove:()=>s.del({notificationId:e.notification.id})}}}),ns={class:"text-weight-medium"},os=["innerHTML"],ls={class:"text-grey-8 q-gutter-xs"};function rs(e,s,n,u,g,r){const l=z("icon");return d(),S("div",null,[k((d(),f(te,{clickable:"",class:I(["jarvis-notifications-item",{[e.notification.state||"unread"]:!0,[e.notification.category]:e.notification.category!==void 0}]),onClick:Z(e.show,["stop"]),id:"notification-"+e.notification.id},{default:o(()=>[i(Q,{avatar:""},{default:o(()=>[i(l,{name:e.notification.icon||"mdi-comment",color:e.notification.iconColor||"primary",size:"sm"},null,8,["name","color"])]),_:1}),i(Q,null,{default:o(()=>[i(se,{lines:"1"},{default:o(()=>[L("span",ns,A(e.notification.title),1),k(L("span",null," - "+A(e.notification.caption),513),[[j,e.notification.caption]])]),_:1}),e.notification.message?(d(),f(se,{key:0,caption:"",lines:"1",style:{"max-height":"200px"}},{default:o(()=>[L("div",{innerHTML:e.notification.message,class:"overflow-dots"},null,8,os)]),_:1})):C("",!0)]),_:1}),i(Q,{side:""},{default:o(()=>[L("div",ls,[e.notification.state==="read"?(d(),f(N,{key:0,onClick:Z(e.markAsUnread,["stop"]),class:"gt-xs",size:"12px",flat:"",dense:"",round:"",icon:"mdi-check"},{default:o(()=>[i(re,null,{default:o(()=>[O(A(e.$t("Mark as Unread")),1)]),_:1})]),_:1},8,["onClick"])):C("",!0),e.notification.state!=="read"&&e.notification.state!=="archived"?(d(),f(N,{key:1,onClick:Z(e.markAsRead,["stop"]),class:"gt-xs",size:"12px",flat:"",dense:"",round:"",icon:"mdi-circle-outline"},{default:o(()=>[i(re,null,{default:o(()=>[O(A(e.$t("Mark as Read")),1)]),_:1})]),_:1},8,["onClick"])):C("",!0),e.notification.state!=="archived"?(d(),f(N,{key:2,onClick:Z(e.markAsArchived,["stop"]),class:"gt-xs",size:"12px",flat:"",dense:"",round:"",icon:"mdi-package-down"},{default:o(()=>[i(re,null,{default:o(()=>[O(A(e.$t("Archive")),1)]),_:1})]),_:1},8,["onClick"])):C("",!0),e.notification.state==="archived"?(d(),f(N,{key:3,onClick:Z(e.markAsUnread,["stop"]),class:"gt-xs",size:"12px",flat:"",dense:"",round:"",icon:"mdi-package-up"},{default:o(()=>[i(re,null,{default:o(()=>[O(A(e.$t("Restore from Archive")),1)]),_:1})]),_:1},8,["onClick"])):C("",!0),e.notification.state==="archived"?(d(),f(N,{key:4,onClick:Z(e.remove,["stop"]),color:"negative",class:"gt-xs",size:"12px",flat:"",dense:"",round:"",icon:"delete"},{default:o(()=>[i(re,null,{default:o(()=>[O(A(e.$t("Delete")),1)]),_:1})]),_:1},8,["onClick"])):C("",!0)])]),_:1})]),_:1},8,["class","onClick","id"])),[[fe]]),i(X)])}var ds=q(is,[["render",rs]]);const us=W({name:"NotificationList",components:{NotificationItem:ds,Divider:rt},setup(){const e=ne();return{showArchived:M(!1),notificationsActive:c(()=>e.getActive),notificationsArchived:c(()=>e.getArchived)}}}),cs={class:"q-mt-xs jarvis-notifications-items"},vs={key:2};function gs(e,s,n,u,g,r){const l=z("notification-item"),t=z("divider");return d(),S("div",cs,[i(X),e.notificationsActive.length<200?(d(),f(de,{key:0},{default:o(()=>[(d(!0),S(G,null,F(e.notificationsActive,a=>(d(),f(l,{key:a.id,notification:a},null,8,["notification"]))),128))]),_:1})):(d(),f(we,{key:1,items:e.notificationsActive},{default:o(({item:a})=>[i(l,{notification:a},null,8,["notification"])]),_:1},8,["items"])),k(i(N,{flat:"",class:"full-width",onClick:s[0]||(s[0]=a=>e.showArchived=!e.showArchived)},{default:o(()=>[e.showArchived?(d(),f(t,{key:0,label:e.$t("hide archived notifications")},null,8,["label"])):(d(),f(t,{key:1,label:e.$t("show archived notifications")},null,8,["label"]))]),_:1},512),[[j,e.notificationsArchived&&e.notificationsArchived.length>0]]),e.showArchived?(d(),S("div",vs,[i(X),e.notificationsArchived.length<200?(d(),f(de,{key:0},{default:o(()=>[(d(!0),S(G,null,F(e.notificationsArchived,a=>(d(),f(l,{key:a.id,notification:a},null,8,["notification"]))),128))]),_:1})):(d(),f(we,{key:1,items:e.notificationsArchived},{default:o(({item:a})=>[i(l,{notification:a},null,8,["notification"])]),_:1},8,["items"]))])):C("",!0)])}var ps=q(us,[["render",gs]]);const ms=W({name:"NotificationDrawer",components:{NotificationEventPopup:es,NotificationEventSnackbar:as,NotificationList:ps},setup(){const e=J(),s=ne(),n=Math.min(500,Math.max(document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth,document.documentElement.clientWidth)),u=t=>e.set("drawerNotifications",t),g=c({get(){return e.drawerNotifications},set(t){u(t)}}),r=c(()=>s.getUnread.length),l=c(()=>s.getActive.length+s.getArchived.length);return{toggleNotifications:u,drawerNotifications:g,unread:r,all:l,width:n}}});function fs(e,s,n,u,g,r){const l=z("notification-event-popup"),t=z("notification-event-snackbar"),a=z("icon"),p=z("notification-list");return d(),S(G,null,[i(l),i(t),i(Ie,{modelValue:e.drawerNotifications,"onUpdate:modelValue":s[1]||(s[1]=P=>e.drawerNotifications=P),side:"right",behavior:"mobile",width:e.width,overlay:"",bordered:"","content-class":"jarvis-notifications body",class:"jarvis-notifications-container"},{default:o(()=>[i(ye,{style:{position:"relative",left:"0"}},{default:o(()=>[i(Ae,null,{default:o(()=>[L("h6",null,[i(a,{name:"mdi-bell"}),O(" "+A(e.$t("Notifications"))+" ("+A(e.unread)+" / "+A(e.all)+") ",1)]),i(ce),i(N,{flat:"",dense:"",round:"",icon:"mdi-chevron-right","aria-label":"Menu",onClick:s[0]||(s[0]=P=>e.toggleNotifications(!1))})]),_:1})]),_:1}),e.drawerNotifications?(d(),f(p,{key:0})):C("",!0)]),_:1},8,["modelValue","width"])],64)}var Vs=q(ms,[["render",fs]]);export{Vs as D,Os as J,Ns as L,Ls as S,zs as _,Hs as a,Rs as b,Bs as c,Es as d,Us as e,ne as u};
