import{Q as A}from"./QToolbarTitle-eedfae79.js";import{a4 as S,cq as B,bM as F,cs as X,cn as q,k as V,aZ as Z,bt as H,aG as E,ay as a,W as c,a2 as o,b1 as l,I as j,aE as U,b3 as z,U as _,a1 as b,D as u,bn as J,A as k,bB as $,V as Q,X as R,cN as K,bw as Y,Q as C,bD as x,C as ee,d8 as te}from"./index-1747645b.js";import{Q as oe}from"./QToolbar-7f7d1f05.js";import{Q as ie}from"./QExpansionItem-bb8dfee2.js";import{J as se}from"./json-editor-89a8f40c.js";import{Q as N,a as P,b as D,c as ne}from"./QTable-145922a7.js";import{Q as O}from"./QTooltip-aea48bc1.js";import{u as le}from"./useCopyToClipboard-ef8d73d5.js";import{W as ae}from"./WidgetPage-9496389e.js";import"./QSlideTransition-6e95d58f.js";import"./_commonjsHelpers-55d1ff45.js";import"./QVirtualScroll-97ac88ed.js";import"./useDragDrop-5ffdbd62.js";const de=S({name:"WidgetsTable",props:["widgets"],emits:["onEditWidget"],setup(e,{emit:r}){B.dev("DEBUG","WidgetsTable","setup()",e.widgets);const g=F(),h=X(),m=q(),v={sortBy:"title",rowsPerPage:15},f=[{name:"id",label:g.t("ID"),field:"id",align:"left",sortable:!0},{name:"title",label:g.t("Title")+" ("+g.t("ID")+")",field:"title",align:"left",sortable:!0,style:{width:"20%"}},{name:"module",label:g.t("Module"),field:"module",align:"left",sortable:!0,style:{width:"15%"}},{name:"usage",label:g.t("Usage")+" [ #: "+g.t("Tab")+" ("+g.t("Page")+") ]",field:"usage",align:"left",sortable:!0,style:{width:"65%"}}],t=V({});Z(()=>{B.dev("DEBUG","WidgetsTable","watchEffect");const i={};for(const W of m.layout){const M=W.tabs||[];for(const T of M){for(const y of T.widgetsDesktop||[]){const I=y.items||[];for(const w of I)i[w]=i[w]||[],i[w].push({type:"desktop",widget:y,tab:T,page:W})}for(const y of T.widgetsSmartphone||[]){const I=y.items||[];for(const w of I)i[w]=i[w]||[],i[w].push({type:"smartphone",widget:y,tab:T,page:W})}}}t.value=i});const{copyToClipboard:n}=le();return{pagination:v,columns:f,usage:t,copyClipboard:n,goTo:(i,W,M)=>{B.dev("DEBUG","WidgetsTable","goTo"),m.set({selectedPage:i,selectedTab:W}),h.push({name:"LayoutPage"})},isDeleted:i=>i._deleted===!0,onWidgetEdit:i=>r("onEditWidget",i),onWidgetCopy:i=>m.copyWidget({widget:i}),onWidgetRemove:i=>m.removeWidget({widget:i}),onWidgetRestore:i=>m.restoreWidget({widget:i})}}}),re={class:"q-pa-md"},ue={key:0},ce=["onClick"],ge={key:0},me={key:1},fe={key:2};function we(e,r,g,h,m,v){const f=E("icon");return a(),c("div",re,[o(ne,{rows:e.widgets,columns:e.columns,pagination:e.pagination,"rows-per-page-label":e.$t("Widgets per page")},{header:l(t=>[o(N,{props:t},{default:l(()=>[o(P,{"auto-width":""}),(a(!0),c(j,null,U(t.cols,n=>z((a(),_(P,{key:n.name,props:t},{default:l(()=>[b(u(n.label),1)]),_:2},1032,["props"])),[[J,n.field!=="id"]])),128)),o(P,{"auto-width":""})]),_:2},1032,["props"])]),body:l(t=>[o(N,{props:t,class:k({rowDeleted:e.isDeleted(t.row)})},{default:l(()=>[o(D,{"auto-width":""},{default:l(()=>[e.isDeleted(t.row)!==!0?(a(),c("div",ue,[o($,{size:"sm",flat:"",round:"",onClick:n=>e.onWidgetEdit(t.row),icon:"mdi-pencil"},null,8,["onClick"]),o($,{size:"sm",flat:"",round:"",onClick:n=>e.onWidgetCopy(t.row),icon:"mdi-content-copy"},null,8,["onClick"])])):Q("",!0)]),_:2},1024),o(D,null,{default:l(()=>[R("div",{class:k({itemDeleted:e.isDeleted(t.row)}),onClick:n=>e.copyClipboard(t.cols[0].value)},[o(O,null,{default:l(()=>[b(" ID: "+u(t.cols[0].value)+" ("+u(e.$t("click to copy to clipboard"))+") ",1)]),_:2},1024),t.cols[1].value?(a(),c("span",ge,u(t.cols[1].value),1)):(a(),c("em",me,"("+u(e.$t("no title"))+")",1)),t.row.label?(a(),c("span",fe," ("+u(t.row.label)+")",1)):Q("",!0),o(f,{name:"clipboard-text-multiple-outline",size:"xs",style:{"margin-left":"4px"}})],10,ce)]),_:2},1024),o(D,null,{default:l(()=>[R("div",{class:k({itemDeleted:e.isDeleted(t.row)})},u(t.cols[2].value),3)]),_:2},1024),o(D,null,{default:l(()=>[e.usage[t.row.id]?(a(),c("div",{key:1,class:k({itemDeleted:e.isDeleted(t.row)})},[b(u(e.usage[t.row.id].length)+": ",1),(a(!0),c(j,null,U(e.usage[t.row.id],({type:n,widget:p,tab:d,page:s},G)=>(a(),_(K,{key:t.row.id+"-"+G,square:"",color:n==="desktop"?"primary":"secondary","text-color":"white",onClick:L=>e.goTo(s,d,p),clickable:""},{default:l(()=>[b(u(d.title+" ("+s.title+")")+" ",1),o(O,null,{default:l(()=>[b(u(n),1)]),_:2},1024)]),_:2},1032,["color","onClick"]))),128))],2)):(a(),c("div",{key:0,class:k({itemDeleted:e.isDeleted(t.row)})},null,2))]),_:2},1024),o(D,{"auto-width":""},{default:l(()=>[e.isDeleted(t.row)!==!0?(a(),_($,{key:0,size:"sm",flat:"",round:"",onClick:n=>e.onWidgetRemove(t.row),icon:"mdi-delete",color:"negative"},null,8,["onClick"])):Q("",!0),e.isDeleted(t.row)?(a(),_($,{key:1,size:"sm",flat:"",round:"",onClick:n=>e.onWidgetRestore(t.row),icon:"mdi-restore",color:"positive"},null,8,["onClick"])):Q("",!0)]),_:2},1024)]),_:2},1032,["props","class"])]),_:1},8,["rows","columns","pagination","rows-per-page-label"])])}var pe=H(de,[["render",we]]);const be=S({name:"WidgetsPage",components:{JsonEditor:se,WidgetsTable:pe,WidgetPage:ae},setup(){B.dev("DEBUG","WidgetsPage","setup()");const e=Y(),r=q(),g=C(()=>e.pageHeight),h=C(()=>r.getGroupedWidgets),m=C(()=>r.getWidgetsWthoutDeletionsCount),v=C(()=>r.widgets),f=C(()=>{var s;return(s=r.settings)==null?void 0:s.configExpertMode}),t=V(),n=()=>{t.value=te()},p=s=>{t.value=s.id},d=s=>{if(s._error){r.addError(s.id,s._error);return}r.removeError(s.id),s.value&&r.set({tmpJsonEditor:{key:s.id,json:JSON.parse(s.value)}})};return{expanded:V({}),pageHeight:g,groups:h,json:v,expertMode:f,widgetsCount:m,selectedWidgetId:t,addWidget:n,editWidget:p,onJsonEditor:d}}}),he={class:"full-height WidgetsPage"},ve={class:"row no-wrap"};function We(e,r,g,h,m,v){const f=E("widget-page"),t=E("widgets-table"),n=E("json-editor"),p=E("paper");return a(),c("div",he,[R("div",ve,[o(oe,{class:"paper",style:{"min-height":"56px"}},{default:l(()=>[o(A,{shrink:""},{default:l(()=>[b(u(e.$t("Widgets"))+" ("+u(e.widgetsCount)+")",1)]),_:1}),o(x),o($,{color:"primary",icon:"mdi-plus-circle",label:e.$t("Add Widget"),onClick:e.addWidget},null,8,["label","onClick"])]),_:1})]),o(f,{onOnClose:r[0]||(r[0]=d=>e.selectedWidgetId=null),widgetId:e.selectedWidgetId},null,8,["widgetId"]),(a(!0),c(j,null,U(e.groups,d=>z((a(),c("div",{class:"row no-wrap paper",key:d.id},[o(ie,{modelValue:e.expanded[d.id],"onUpdate:modelValue":s=>e.expanded[d.id]=s,icon:d.icon,label:d.label+" ("+d.widgets.length+")",class:"full-width"},{default:l(()=>[o(t,{onOnEditWidget:e.editWidget,widgets:d.widgets},null,8,["onOnEditWidget","widgets"])]),_:2},1032,["modelValue","onUpdate:modelValue","icon","label"])])),[[J,!e.expertMode&&d.widgets.length>0]])),128)),z(o(p,{style:ee({height:e.pageHeight-66-16+"px"})},{default:l(()=>[o(n,{id:"widgets",json:e.json,onOnChange:e.onJsonEditor},null,8,["json","onOnChange"])]),_:1},8,["style"]),[[J,e.expertMode]])])}var Ue=H(be,[["render",We]]);export{Ue as default};
