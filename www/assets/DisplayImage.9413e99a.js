import{_ as g,x as f,de as u,dQ as c,dx as t,m,o as s,f as r,N as a,ah as h,q as l,d8 as v,w as p,n,j as o,l as w,t as y}from"./index.21fe8de3.js";const z=f({name:"DisplayImage",props:["widget","_containerSize","_widgetSize","_alignment"],data(){return{size:{width:this._widgetSize.width,height:this._containerSize.height},url:null,state:{},loaded:!1,error:!1}},computed:{config(){return u.joinConfig(this.widget.config,c)},deviceConfig(){return this.widget.items&&this.widget.items[0]||{}},style(){return{width:this.config.size==="fit"||this.config.size==="cover"?this.size.width+"px":"auto",height:this.config.size==="fit"||this.config.size==="contain"?this.size.height+"px":"auto"}}},methods:{gotState(e,i){if(this.loaded=!0,e){this.error=e.message||e;return}this.url!==i.val&&this.setUrl(i.val||"")},runInterval(){this.config.refresh&&this.config.refresh>0&&(this.setRefreshInterval=setInterval(()=>{if(this.url&&this.url.startsWith("data:image")&&clearInterval(this.setRefreshInterval),this.url&&!this.url.startsWith("data:image")&&this.config.refreshMethod==="random"){const e=this.url.indexOf("?")!==-1?this.url.substr(this.url.indexOf("?")).replace("?","&").replace(/&_r=[0-9]*/,""):"";this.setUrl(this.url.substr(0,this.url.indexOf("?")>-1?this.url.indexOf("?"):this.url.length)+"?_r="+Date.now()+e)}else this.url&&!this.url.startsWith("data:image")&&this.config.refreshMethod==="whitespace"&&this.setUrl((this.url+" ").replace(/ {2}/g,""))},this.config.refresh*1e3))},setUrl(e){e=e.toString().trim(),e&&e.indexOf("<svg")!==-1&&(e=e.replace("<svg ",'<svg width="100%" height="100%" ')),e&&!e.startsWith("data:image")&&e.indexOf("/")===-1&&(e="data:image;base64,"+e),this.url=e,this.revision=Date.now().toString()}},watch:{_widgetSize(e){this.size.width=e.width},_containerSize(e){this.size.height=e.height},deviceConfig:{immediate:!0,handler:function(e){this.revision=this.widget.revision,this.widget.config.url?(this.setUrl(this.widget.config.url),this.loaded=!0):(this.device=t.get(e.deviceId),this.device?e.primaryStateKey&&t.listen(this.device.id,e.primaryStateKey,this.gotState):(this.error="DisplayImage: "+this.$i18n.t("Device {deviceId} not found").replace("{deviceId}",e.deviceId),console.warn(this.error),this.loaded=!0))}}},mounted(){this.runInterval()},beforeUnmount(){clearInterval(this.setRefreshInterval),this.device&&this.deviceConfig.primaryStateKey&&t.unlisten(this.device.id,this.deviceConfig.primaryStateKey,this.gotState)}}),I=["innerHTML"],S=["src"];function _(e,i,D,C,O,U){const d=m("alert");return s(),r("div",{class:o(["jarvis-DisplayImage",{[e._alignment.h]:!0,[e._alignment.v]:!0}]),style:n({width:e.size.width+"px",height:e.size.height+"px"})},[a(l(v,{indeterminate:""},null,512),[[h,!e.loaded&&!e.error]]),a(l(d,null,{default:p(()=>[w(y(e.error),1)]),_:1},512),[[h,e.loaded&&e.error]]),e.url&&e.url.startsWith("<svg")?(s(),r("div",{key:0,style:n(e.style),innerHTML:e.url},null,12,I)):a((s(),r("img",{key:1,class:o(["jarvis-DisplayImage-Image",{[e._alignment.h]:!0,[e._alignment.v]:!0}]),src:e.url,style:n(e.style)},null,14,S)),[[h,e.loaded&&!e.error]])],6)}var W=g(z,[["render",_]]);export{W as default};
