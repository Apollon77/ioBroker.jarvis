{"version":3,"sources":["pages/ConfigurationPage/DevicesPage/StateExplorer.js"],"names":["useStyles","makeStyles","theme","divider","flexGrow","TreeView","padding","spacing","backgroundColor","TreeItem","color","palette","text","secondary","action","hover","TreeItemContent","paddingRight","TreeItemError","error","light","textDecoration","cursor","fontWeight","TreeItemExpanded","TreeItemSelected","TreeItemGroup","paddingLeft","TreeItemLabel","Entry","display","alignItems","Group","EntryIcon","marginRight","EntryText","indexObjects","list","index","objectsTree","root","objectId","substr","lastIndexOf","namespace","indexOf","id","undefined","push","StateExplorer","React","memo","props","val","_onChange","classes","useState","Cache","get","objectList","setObjectList","selectedItem","useRef","searchTimeout","useEffect","Connection","connection","getObjects","then","res","forEach","promise","i","status","value","Array","isArray","rows","obj","sort","tree","_objectList","Date","now","set","catch","Log","_","message","stack","Fieldset","Text","label","onChange","clearTimeout","current","setTimeout","data","filter","toLowerCase","prevObjectList","className","style","margin","i18n","t","timeConverter","parseDate","updated","Button","startIcon","onClick","defaultCollapseIcon","defaultExpandIcon","onNodeSelect","e","map","key","renderTree","states","children","Object","keys","channelKey","type","length","concat","stateKey","Item","nodeId","channel","details","group","otherProps","clsx","content","expanded","selected","common","name","GroupIcon","StateIcon","width","caption","title","arrow","role","variant","getLanguage","StateExplorerPopup","open","_onClose","state","header","actions","dense","maxWidth","fullWidth","onClose","s"],"mappings":"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","file":"static/js/48.780d40a1.chunk.js","sourcesContent":["import React, { useState, useEffect, useRef } from 'react'\r\nimport clsx from 'clsx'\r\n\r\nimport Cache from '../../../controller/Cache'\r\nimport Connection from '../../../controller/Connection'\r\nimport i18n from '../../../controller/i18n'\r\nimport Log from '../../../controller/Log'\r\nimport timeConverter from '../../../helpers/timeConverter'\r\n\r\nimport LinearProgress from '@material-ui/core/LinearProgress'\r\nimport Divider from '@material-ui/core/Divider'\r\nimport Paper from '@material-ui/core/Paper'\r\nimport TreeItem from '@material-ui/lab/TreeItem'\r\nimport TreeView from '@material-ui/lab/TreeView'\r\nimport Tooltip from '@material-ui/core/Tooltip'\r\nimport Typography from '@material-ui/core/Typography'\r\n\r\nimport CollapseIcon from '@material-ui/icons/ArrowDropDown'\r\nimport ExpandIcon from '@material-ui/icons/ArrowRight'\r\nimport GroupIcon from '@material-ui/icons/Folder'\r\nimport RefreshIcon from '@material-ui/icons/Refresh'\r\nimport StateIcon from '@material-ui/icons/BookmarkBorder'\r\n\r\nimport Dialog from '../../../components/Dialog'\r\nimport Inputs from '../../../components/Inputs'\r\n\r\n\r\n/*\r\n * STYLES\r\n */\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nconst useStyles = makeStyles(theme => ({\r\n\tdivider: {\r\n\t\tflexGrow: 1\r\n\t},\r\n\tTreeView: {\r\n\t\tpadding: theme.spacing(2),\r\n\t\t'&:focus > $TreeItemContent $TreeItemLabel, &:hover > $TreeItemContent $TreeItemLabel, &$TreeItemSelected > $TreeItemContent $TreeItemLabel': {\r\n\t\t\tbackgroundColor: 'transparent',\r\n\t\t},\r\n\t},\r\n\tTreeItem: {\r\n\t\tcolor: theme.palette.text.secondary,\r\n\t\t'&:hover > $TreeItemContent': {\r\n\t\t\tbackgroundColor: theme.palette.action.hover,\r\n\t\t},\r\n\t},\r\n\tTreeItemContent: {\r\n\t\tcolor: theme.palette.text.secondary,\r\n\t\tpaddingRight: theme.spacing(1),\r\n\t\t//fontWeight: theme.typography.fontWeightMedium,\r\n\t\t'$TreeItemExpanded > &': {\r\n\t\t\t//fontWeight: theme.typography.fontWeightRegular,\r\n\t\t},\r\n\t},\r\n\tTreeItemError: {\r\n\t\tbackgroundColor: theme.palette.error.light,\r\n\t\ttextDecoration: 'line-through',\r\n\t\tcursor: 'not-allowed !important',\r\n\t\tfontWeight: 'normal',\r\n\t},\r\n\tTreeItemExpanded: {\r\n\t},\r\n\tTreeItemSelected: {\r\n\t\tfontWeight: 'bold !important',\r\n\t},\r\n\tTreeItemGroup: {\r\n\t\tfontWeight: 'initial',\r\n\t\t'& $TreeItemContent': {\r\n\t\t\tpaddingLeft: theme.spacing(2),\r\n\t\t},\r\n\t},\r\n\tTreeItemLabel: {\r\n\t\tfontWeight: 'inherit',\r\n\t\tcolor: 'inherit',\r\n\t},\r\n\tEntry: {\r\n\t\tdisplay: 'flex',\r\n\t\talignItems: 'center',\r\n\t\tpadding: theme.spacing(0.5, 0),\r\n\t},\r\n\tGroup: {\r\n\t\t//fontWeight: 'bold'\r\n\t},\r\n\tEntryIcon: {\r\n\t\tmarginRight: theme.spacing(1),\r\n\t},\r\n\tEntryText: {\r\n\t\tfontWeight: 'inherit',\r\n\t\tflexGrow: 1,\r\n\t}\r\n}));\r\n\r\n\r\n/*\r\n *\r\n */\r\nconst indexObjects = (list, index) => {\r\n\tlet objectsTree = {}\r\n\tlet root = [];\r\n\t\r\n\tfor (let objectId of list) {\r\n\t\t\r\n\t\t// index state\r\n\t\tobjectsTree[objectId.substr(0, objectId.lastIndexOf('.'))] = objectsTree[objectId.substr(0, objectId.lastIndexOf('.'))] || {}\r\n\t\tobjectsTree[objectId.substr(0, objectId.lastIndexOf('.'))][objectId] = index[objectId];\r\n\t\t\r\n\t\t// make sure state is added to all its parents\r\n\t\tlet namespace = objectId;\r\n\t\twhile (namespace.indexOf('.') > -1) {\r\n\t\t\tconst id = namespace;\r\n\t\t\tnamespace = namespace.substr(0, namespace.lastIndexOf('.'));\r\n\t\t\t\r\n\t\t\tif (objectsTree[namespace] === undefined || objectsTree[namespace][id] === undefined) {\r\n\t\t\t\tobjectsTree[namespace] = objectsTree[namespace] || {}\r\n\t\t\t\tobjectsTree[namespace][id] = {}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (namespace && namespace.indexOf('.') === -1 && root.indexOf(namespace) === -1) {\r\n\t\t\t\troot.push(namespace);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\treturn [ root, objectsTree ];\r\n}\r\n\r\n/*\r\n *\r\n */\r\nconst StateExplorer = React.memo(props => {\r\n\tconst { val, _onChange } = props;\r\n\tconst classes = useStyles();\r\n\t\r\n\t\r\n\tconst [objectList,setObjectList] = useState(Cache.get('objectList') || null);\r\n\tconst selectedItem = useRef(val);\r\n\tconst searchTimeout = useRef();\r\n\t\r\n\tuseEffect(() => {\r\n\t\t\r\n\t\tif (objectList === null || !objectList.root) {\r\n\t\t\tconst socket = Connection.connection;\r\n\t\t\tsocket.getObjects()\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\tlet list = [];\r\n\t\t\t\t\tlet index = {}\r\n\t\t\t\t\t\r\n\t\t\t\t\tres.forEach((promise, i) => {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (promise.status === 'fulfilled' && promise.value && Array.isArray(promise.value.rows)) {\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// read results and sort\r\n\t\t\t\t\t\t\tfor (let obj of promise.value.rows) {\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t// skip system\r\n\t\t\t\t\t\t\t\tif (obj.id.substr(0,6) === 'system') {\r\n\t\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t// index result\r\n\t\t\t\t\t\t\t\tindex[obj.id] = obj.value;\r\n\t\t\t\t\t\t\t\tlist.push(obj.id);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\t// index sorted results\r\n\t\t\t\t\tlist.sort();\r\n\t\t\t\t\tconst [ root, tree ] = indexObjects(list, index);\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst _objectList = {\r\n\t\t\t\t\t\t'updated': Date.now(),\r\n\t\t\t\t\t\t'root': root.sort(),\r\n\t\t\t\t\t\t'list': list,\r\n\t\t\t\t\t\t'tree': tree\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tCache.set('objectList', _objectList);\r\n\t\t\t\t\tsetObjectList(_objectList);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(error => {\r\n\t\t\t\t\tLog._('StateExplorer', error.message, 'error', true, error.stack);\r\n\t\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t}, [objectList]);\r\n\t\r\n\t//\r\n\tconst search = (props, val) => {\r\n\t\tclearTimeout(searchTimeout.current);\r\n\t\tsearchTimeout.current = setTimeout(() => {\r\n\t\t\tconst data = Cache.get('objectList');\r\n\t\t\t\r\n\t\t\tconst [ root, tree ] = indexObjects(data.list.filter(obj => obj.toLowerCase().indexOf(val.toLowerCase()) > -1), data.tree);\r\n\t\t\tsetObjectList(prevObjectList => ({\r\n\t\t\t\t...prevObjectList,\r\n\t\t\t\t'root': root.sort(),\r\n\t\t\t\t'tree': tree\r\n\t\t\t}));\r\n\t\t\t\r\n\t\t}, 750);\r\n\t}\r\n\t\r\n\t//\r\n\tconst selectObject = (e, val) => {\r\n\t\tconst selected = objectList.tree[val] || null; // tree only holds channels, thus null will be a state\r\n\t\t\r\n\t\tif (selected === null) {\r\n\t\t\tval = val.indexOf(' ') === -1 ? val : '';\r\n\t\t\tselectedItem.current = val;\r\n\t\t\t_onChange(val);\r\n\t\t}\r\n\t}\r\n\t\r\n\t//\r\n\tconst renderTree = key => {\r\n\t\tlet states = [];\r\n\t\tlet children = [];\r\n\t\t\r\n\t\t// channels\r\n\t\tif (objectList.tree[key]) {\r\n\t\t\tObject.keys(objectList.tree[key]).forEach(channelKey => {\r\n\t\t\t\tconst child = objectList.tree[key][channelKey];\r\n\t\t\t\t\r\n\t\t\t\tif (child.type === 'state') {\r\n\t\t\t\t\tstates.push(channelKey);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tchildren.push(renderTree(channelKey));\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t\t\r\n\t\t// states\r\n\t\tif (states.length > 0) {\r\n\t\t\tchildren = children.concat(\r\n\t\t\t\tstates.map(stateKey => <Item key={stateKey} error={(stateKey.indexOf(' ') > -1)} nodeId={stateKey} label={<Entry key={stateKey} error={(stateKey.indexOf(' ') > -1)} id={stateKey.substr(stateKey.lastIndexOf('.')+1)} {...objectList.tree[stateKey.substr(0, stateKey.lastIndexOf('.'))][stateKey]} />} />)\r\n\t\t\t);\r\n\t\t}\r\n\t\t\r\n\t\tconst channel = key.substr(key.lastIndexOf('.')+1);\r\n\t\tconst details = key.indexOf('.') > -1 ? objectList.tree[key.substr(0, key.lastIndexOf('.'))][key] : {}\r\n\t\treturn (\r\n\t\t\t<Item key={key} nodeId={key} children={children} label={<Entry key={key} group id={channel} {...details} />} />\r\n\t\t);\r\n\t}\r\n\t\r\n\treturn (\r\n\t\t<Paper>\r\n\t\t\t<Inputs.Fieldset>\r\n\t\t\t\t<Inputs.Text\r\n\t\t\t\t\tid='search'\r\n\t\t\t\t\tlabel='Search'\r\n\t\t\t\t\tonChange={search}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\r\n\t\t\t\t<div className={classes.divider} />\r\n\t\t\t\t<div style={{ margin: 'auto 0' }}>\r\n\t\t\t\t\t{objectList !== null && <span style={{ margin: 'auto 0' }}>{i18n.t('Last refresh') + ': ' + timeConverter.parseDate(objectList.updated, 'dd.MM.yyyy, HH:mm:ss')}</span>}\r\n\t\t\t\t\t<Inputs.Button\r\n\t\t\t\t\t\tlabel='refresh'\r\n\t\t\t\t\t\tstartIcon={<RefreshIcon />}\r\n\t\t\t\t\t\tonClick={() => setObjectList(null)}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t</Inputs.Fieldset>\r\n\t\t\t<Divider />\r\n\t\t\t\r\n\t\t\t{(objectList === null || !objectList.root) ?\r\n\t\t\t<LinearProgress />\r\n\t\t\t:\r\n\t\t\t<TreeView\r\n\t\t\t\tclassName={classes.TreeView}\r\n\t\t\t\tdefaultCollapseIcon={<CollapseIcon />}\r\n\t\t\t\tdefaultExpandIcon={<ExpandIcon />}\r\n\t\t\t\tonNodeSelect={selectObject}\r\n\t\t\t\t>\r\n\t\t\t\t\r\n\t\t\t\t{objectList.root.map(key => renderTree(key))}\r\n\t\t\t</TreeView>}\r\n\t\t</Paper>\r\n\t);\r\n});\r\n\r\n/*\r\n *\r\n */\r\nconst Item = props => {\r\n\tconst { children, error, ...otherProps } = props;\r\n\tconst classes = useStyles();\r\n\t\r\n\treturn (\r\n\t\t<TreeItem\r\n\t\t\tclasses={{\r\n\t\t\t\troot: clsx(error && classes.TreeItemError, classes.TreeItem),\r\n\t\t\t\tcontent: classes.TreeItemContent,\r\n\t\t\t\texpanded: classes.TreeItemExpanded,\r\n\t\t\t\tselected: classes.TreeItemSelected,\r\n\t\t\t\tgroup: classes.TreeItemGroup,\r\n\t\t\t\tlabel: classes.TreeItemLabel\r\n\t\t\t}}\r\n\t\t\t\r\n\t\t\t{...otherProps}\r\n\t\t\t>\r\n\t\t\t\r\n\t\t\t{children || null}\r\n\t\t</TreeItem>\r\n\t);\r\n}\r\n\r\n/*\r\n *\r\n */\r\nconst Entry = props => {\r\n\tconst { id, error, type, group, common } = props;\r\n\tconst classes = useStyles();\r\n\t\r\n\tconst name = common && common.name ? common.name : '';\t\r\n\tconst EntryIcon = group ? GroupIcon : StateIcon;\r\n\treturn (\r\n\t\t<div className={clsx(error && classes.TreeItemError, classes.Entry, group && classes.Group)}>\r\n\t\t\t<EntryIcon color=\"inherit\" className={classes.EntryIcon} />\r\n\t\t\t<EntryText width=\"40%\" caption label={id} />\r\n\t\t\t{name.length > 60 ? \r\n\t\t\t\t<Tooltip title={name} arrow>\r\n\t\t\t\t\t<div style={{ width: '40%' }}>\r\n\t\t\t\t\t\t<EntryText label={name.substr(0, 60) + '...'} />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</Tooltip>\r\n\t\t\t:\r\n\t\t\t\t<EntryText width=\"40%\" label={name} />\r\n\t\t\t}\r\n\t\t\t<EntryText width=\"10%\" label={type} />\r\n\t\t\t<EntryText width=\"10%\" label={common && common.role} />\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\n/*\r\n *\r\n */\r\nconst EntryText = props => {\r\n\tconst { label, width, caption } = props;\r\n\tconst classes = useStyles();\r\n\t\r\n\treturn (\r\n\t\t<div style={{ width: width || '100%' }}>\r\n\t\t\t<Typography variant={caption ? 'caption' : 'body2'} className={classes.EntryText}>\r\n\t\t\t\t{(label && label[i18n.getLanguage()]) || label || ''}\r\n\t\t\t</Typography>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\n/*\r\n *\r\n */\r\nexport const StateExplorerPopup = React.memo(props => {\r\n\tconst { open, _onClose, _onChange } = props;\r\n\t\r\n\tconst state = useRef(props.val);\r\n\treturn (\r\n\t\t<Dialog\r\n\t\t\theader={i18n.t('State Explorer')}\r\n\t\t\tactions={[\r\n\t\t\t\t<Inputs.Button key='action-cancel' variant=\"text\" onClick={_onClose} color=\"secondary\" label=\"Cancel\" />,\r\n\t\t\t\t<Inputs.Button key=\"action-save\" variant=\"text\" onClick={() => _onChange(state.current)} color=\"primary\" label=\"Apply\" />\r\n\t\t\t]}\r\n\t\t\t\r\n\t\t\tdense\r\n\t\t\tmaxWidth='lg'\r\n\t\t\tfullWidth={true}\r\n\t\t\t\r\n\t\t\topen={open}\r\n\t\t\tonClose={_onClose}\r\n\t\t\t>\r\n\t\t\t\r\n\t\t\t<StateExplorer {...props} _onChange={s => state.current = s} />\r\n\t\t</Dialog>\r\n\t);\r\n});\r\n\r\nexport default StateExplorer;\r\n"],"sourceRoot":""}