(this.webpackJsonpjarvis=this.webpackJsonpjarvis||[]).push([[0],{121:function(e,t){},131:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),i=n(12),o=n.n(i),r=(n(93),n(8)),c=n(11),l=n(17),u=n(16),p=n(10),d=n(18),h=n(13),v=n(19),f=n(37),g=n.n(f),m=n(74),y=n.n(m),b=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(u.a)(this,t),(e=Object(d.a)(this,Object(h.a)(t).call(this))).socket=y()(n,Object(c.a)({},a,{query:"ws=true"})),e.statesSubscribes={},e.socket.on("connect",(function(){return e.emit("connect")})),e.socket.on("reconnect_attempt",(function(t){return e.emit("reconnect",t)})),e.socket.on("reconnect",(function(t){return e.emit("reconnect",t)})),e.socket.on("reconnect_error",(function(t){return e.emit("error",{type:"reconnect",event:"reconnect_error",error:t})})),e.socket.on("reconnect_failed",(function(){return e.emit("error",{type:"reconnect",event:"reconnect_failed",error:null})})),e.socket.on("disconnect",(function(t){return e.emit("disconnect",t)})),e.socket.on("connect_error",(function(t){return e.emit("error",{type:"connect",event:"connect_error",error:t})})),e.socket.on("connect_timeout",(function(t){return e.emit("error",{type:"connect",event:"connect_timeout",error:t})})),e.socket.on("error",(function(t){return e.emit("error",{type:"error",event:"error",error:t})})),e}return Object(v.a)(t,e),Object(p.a)(t,[{key:"subscribeState",value:function(e,t){if(this.statesSubscribes[e])-1===this.statesSubscribes[e].cbs.indexOf(t)&&this.statesSubscribes[e].cbs.push(t);else{var n=e.replace(/\./g,"\\.").replace(/\*/g,".*").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\+/g,"\\+").replace(/\[/g,"\\[");-1===n.indexOf("*")&&(n+="$"),this.statesSubscribes[e]={reg:new RegExp(n),cbs:[t]},this.connected&&this.socket.emit("subscribe",e)}"function"===typeof t&&this.socket.emit("getForeignStates",e,(function(e,n){return n&&Object.keys(n).forEach((function(e){return t(e,n[e])}))}))}},{key:"stateChange",value:function(e,t){for(var n in e=e?e.replace(/[\s'"]/g,"_"):"",this.statesSubscribes)this.statesSubscribes.hasOwnProperty(n)&&this.statesSubscribes[n].reg.test(e)&&this.statesSubscribes[n].cbs.forEach((function(n){return n(e,t)}))}},{key:"getState",value:function(e,t){var n=this;if(!t)return new Promise((function(t,a){return n.getState(e,(function(e,n){return e?a(e):t(n)}))}));this.socket.emit("getState",e,t)}},{key:"setState",value:function(e,t,n){var a=this;if(!n)return new Promise((function(n,s){return a.setState(e,t,(function(e){return e?s(e):n()}))}));this.socket.emit("setState",e,t,n)}}]),t}(g.a),S=n(81),j=n(80),O=n(22),k=n(187),E=n(184),D=n(166),w=Object(D.a)((function(e){return{slider:{padding:e.spacing(2,30,2,2)}}}));function C(e){var t=e.title;return s.a.createElement(O.a,null,t)}function K(e){var t=e.device,n=e.state,a=e.title,i=e.min,o=e.max,r=e.step,c=e.markSteps,u=w();r=r||1;var p=((o=o||100)-(i=i||0))/((c=c||11)-1)||10;return s.a.createElement(s.a.Fragment,null,s.a.createElement(C,{title:a||n.stateKey}),s.a.createElement("div",{classes:u.slider},s.a.createElement(k.a,{onChangeCommitted:function(e,a){return t.setDeviceState(n.stateKey,a)},defaultValue:n.state&&n.state.value&&n.state.value.val||0,valueLabelDisplay:"auto",marks:Object(l.a)(Array(c).keys()).map((function(e){return{value:i+e*p,label:i+e*p}})),min:i,max:o,step:r})))}var I={defaults:{configurations:{power:{value:function(e){return e.toString()}},battery:{unit:" %"},humidity:{unit:" %"},level:{unit:" %"},temperature:{unit:" \xb0C"},wind:{unit:" km/h"}}},light:{configurations:{level:{value:function(e){return e>0&&e<=1?100*e:e},unit:function(e){return e>0?" %":""}},colorTemperature:{unit:" \xb0K"},hue:{unit:" \xb0"}},icons:{defaultOn:"",defaultOff:"",power:"light-switch",level:"brightness-percent",colorTemperature:"thermometer"},components:{level:K,colorTemperature:function(e){return s.a.createElement(K,Object.assign({min:2e3,max:6500,step:10},e))}},actions:{power:function(e){var t=e.device,n=e.state,i=Object(a.useState)(n.state&&n.state.value&&n.state.value.val||!1),o=Object(j.a)(i,2),r=o[0],c=o[1];return Object(a.useEffect)((function(){t.on("stateChange",(function(e,t){"power"===e&&c(t.val)}))})),s.a.createElement(E.a,{checked:r,onChange:function(e,a){return t.setDeviceState(n.stateKey,a)},value:"true",color:"primary"})}}},heating:{configurations:{temperature:{value:function(e){return e.toFixed(1)},unit:" \xb0C"},setTemperature:{unit:" \xb0C"},humidity:{unit:" %"}},icons:{},components:{},actions:{}}},x=function(e){function t(e){var n;if(Object(u.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this))).function=e,!n.function)throw new Error("No function given!");return n.functionId=n.function.toLowerCase(),n.icon=I[n.functionId]&&I[n.functionId].icons||{},n.component=I[n.functionId]&&I[n.functionId].components||{},n.action=I[n.functionId]&&I[n.functionId].actions||{},n.configuration=I[n.functionId]&&I[n.functionId].configurations||I.defaults.configurations,n}return Object(v.a)(t,e),Object(p.a)(t,[{key:"setStateValue",value:function(e,t){var n=this;return["value","unit"].forEach((function(a){t[a]=n.configuration[e]&&n.configuration[e][a]&&("function"===typeof n.configuration[e][a]&&n.configuration[e][a](t.val)||"function"!==typeof n.configuration[e][a]&&n.configuration[e][a])||t[a]||""})),t}}]),t}(g.a),_=n(76),L=n.n(_),N=function(e){function t(e,n){var a,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{states:{},styles:{}};Object(u.a)(this,t);try{a=Object(d.a)(this,Object(h.a)(t).call(this,e.function))}catch(i){throw new Error("No function given for device "+e.name+"!")}if(a.id=e.id,a.name=e.name,a.room=e.room||null,a.states=e.states,a.options=e.options,a.attributes=e.attributes||{},a.socket=n,!a.options||"object"!==typeof a.options||0===Object.keys(a.options).length)throw new Error("Device"+(e.id||e.name?" "+(e.name||e.id):"")+" not defined for jarvis!");if(!a.states||"object"!==typeof a.states||0===Object.keys(a.states).length)throw new Error("Insufficent properties provided"+(e.id||e.name?" for device "+(e.name||e.id):"")+" (no states defined)!");if(!(a.id&&a.name&&a.function))throw new Error("Insufficent properties provided"+(e.id||e.name?" for device "+(e.name||e.id):"")+" (no id, name or function defined)!");if(!a.socket)throw new Error("No socket given!");return a.defaults=s,a._setProperties(),a.stateSubscriptions=[],a}return Object(v.a)(t,e),Object(p.a)(t,[{key:"_getStateFromKey",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e&&"object"===typeof e)return e;var t=this.states[e||this.primaryStateKey];if(!t||!t.state)return"Incorrect or non-defined state key for device "+this.name+"!";if("string"==typeof t.state)t.state={node:t.state};else if("object"==typeof t.state&&!t.state.node)return"No state specified to retrieve for device "+this.name+"!";return t}},{key:"_setObjectStructure",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e&&"object"==typeof e?"object"!=typeof e||e.default||(e.default=t):e={default:e||t},e}},{key:"_setProperties",value:function(){this.primaryStateKey=this.options.primary||Object.keys(this.states)[0],this.secondaryStateKey=this.options.secondary||null,this.options.styles=Object(c.a)({},this.defaults.styles,{},this.options.styles||{}),this.options.groups=Array.isArray(this.options.group)?this.options.group:[this.options.group],this.options.sort=this.options.sort||999,this.options.label=this.options.label&&"string"===typeof this.options.label&&this.options.label.replace(/%name%/g,this.name)||this.options.label||this.name,this.options.icon=this._setObjectStructure(this.options.icon,"square-medium"),this.options.mapping=this._setObjectStructure(Object(c.a)({},this.defaults.states,{},this.options.secondaryStateMapping,{},this.options.primaryStateMapping)),this.options.subtitle=this.options.subtitle,this.options.divider=this.options.divider||!1}},{key:"_updateDeviceState",value:function(e,n){return n.timeChanged=L()(n.lc-2e3).fromNow(),n.value=this.options.mapping[e+"#"+n.val]||this.options.mapping[n.val]||n.val,Object(S.a)(Object(h.a)(t.prototype),"setStateValue",this).call(this,e,n)}},{key:"get",value:function(e){return this[e]||null}},{key:"getAction",value:function(e){var t=this.action[e];return t&&s.a.createElement(t,{device:this,state:Object(c.a)({},this.states[e],{stateKey:e})})||null}},{key:"getComponent",value:function(e){var t=this.component[e];return t&&s.a.createElement(t,{device:this,state:Object(c.a)({},this.states[e],{stateKey:e})})||e}},{key:"getDeviceState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.states[e||this.primaryStateKey],a=null;return n&&n.state&&null!==t&&void 0!==n.state.value&&void 0!==n.state.value[t]?a=n.state.value[t]:n&&n.state&&null===t&&void 0!==n.state.value&&(a=n.state.value),a}},{key:"getIcon",value:function(e){return this.icon[e]}},{key:"getOption",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";return this.options[e]&&(this.options[e][t]||this.options[e].default)||this.options[e]||null}},{key:"getStyle",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";return this.options.styles[e]&&(this.options.styles[e][t]||this.options.styles[e].default)||{}}},{key:"render",value:function(){return null}},{key:"requestDeviceStates",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=[];for(var n in this.states)t.push(this.requestDeviceState(n,e));return t}},{key:"requestDeviceState",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t=t||this.primaryStateKey;var a=this._getStateFromKey(t);return"string"==typeof a?Promise.reject({success:!1,stateKey:t,error:a}):new Promise((function(s,i){void 0!==a.state.value&&e.stateSubscriptions.indexOf(t)>-1?(e.emit("stateChange",t,a.state.value),s({success:!0,stateKey:t,cached:!0})):e.socket.getState(a.state.node).then((function(i){a.state.value=e._updateDeviceState(t,i),e.emit("stateChange",t,a.state.value),n&&e.subscribeDeviceState(t),s({success:!0,stateKey:t,cached:!1})})).catch((function(e){return i({success:!1,stateKey:t,error:e.message})}))}))}},{key:"setDeviceState",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1?arguments[1]:void 0;t=t||this.primaryStateKey;var a=this._getStateFromKey(t);return"string"==typeof a?Promise.reject({success:!1,stateKey:t,error:a}):new Promise((function(s){e.socket.setState(a.state.node,n).then((function(n){-1===e.stateSubscriptions.indexOf(t)&&e.requestDeviceState(t),s({success:!0,stateKey:t})}))}))}},{key:"subscribeDeviceState",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t=t||this.primaryStateKey;var n=this._getStateFromKey(t);if("string"==typeof n)return Promise.reject({success:!1,stateKey:t,error:n});this.stateSubscriptions.push(t),this.socket.subscribeState(n.state.node,(function(a,s){s&&s.val!==e.getDeviceState(t,"val")&&(n.state.value=e._updateDeviceState(t,s),e.emit("stateChange",t,n.state.value))}))}}]),t}(x),A=n(20),z=n(181),M=n(2),T=n(177),P=n(183),F=n(174),q=n(175),G=n(176),W=n(169),B=n(77),V=n.n(B),J=n(173),U=n(51),H=n.n(U),R=n(186),$=n(170),Q=n(172),X=n(171),Y=n(4),Z=function(e){return{defaultListIcon:function(t){return Object(c.a)({},e.components.icon,{},t.styles)},defaultListItemActionPrimary:function(e){return Object(c.a)({},e.styles)},defaultListItemActionSecondary:function(e){return Object(c.a)({color:"#999",fontSize:"14px"},e.styles)},horizontalListItem:{display:"inline-block",textAlign:"center",paddingRight:"16px",minWidth:"150px",marginTop:"10px"},horizontalListItemIcon:{minWidth:"auto"},horizontalListItemAction:{textAlign:"center",top:0,right:0,position:"static",transform:"none"},verticalListItemAction:{textAlign:"right"}}},ee=function(e){var t=e.title;return s.a.createElement(s.a.Fragment,null,s.a.createElement(R.a,{divider:!0,style:{margin:"5px 0 0 0"}}),s.a.createElement("li",null,s.a.createElement(O.a,{style:{margin:"5px 0 0 0px"},display:"block",variant:"caption"},t)))},te=Object(Y.a)(Z)((function(e){var t=e.customClassNames,n=e.children,a=e.classes,i=(e.styles,Array.isArray(t)?t:[t]);return i=i.map((function(e){return a[e]?a[e]:e})),s.a.createElement("span",{className:H()(i)},n)})),ne=te,ae=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).state={},n.state[n.props.device.primaryStateKey]=n.props.device.getDeviceState()||{},n.props.device.secondaryStateKey&&(n.state[n.props.device.secondaryStateKey]=n.props.device.getDeviceState(n.props.device.secondaryStateKey)||{}),n}return Object(v.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.device.on("stateChange",(function(t,n){t!==e.props.device.primaryStateKey&&t!==e.props.device.secondaryStateKey||e.setState(Object(r.a)({},t,n))}))}},{key:"openDialog",value:function(){this.props.openDialog(this.props.device)}},{key:"render",value:function(){var e=this.props,t=e.classes,n=e.horizontal,a=e.prevSubgroup,i=e.device;console.log(i);var o,r=i.get("options"),l=null,u=null,p=null;return o=this.state[i.secondaryStateKey]&&s.a.createElement(ne,{key:"secondary_"+i.id,customClassNames:"defaultListItemActionSecondary",styles:Object(c.a)({},i.getStyle("state",this.state[i.secondaryStateKey].val),{},i.getStyle("secondaryState",this.state[i.secondaryStateKey].val))},this.state[i.secondaryStateKey].value," ",this.state[i.secondaryStateKey].unit),this.state[i.primaryStateKey]&&(l=i.getOption("icon",this.state[i.primaryStateKey].val),u=s.a.createElement(ne,{key:"primary_"+i.id,customClassNames:"defaultListItemActionPrimary",styles:Object(c.a)({},i.getStyle("state",this.state[i.primaryStateKey].val),{},i.getStyle("primaryState",this.state[i.primaryStateKey].val))},this.state[i.primaryStateKey].value," ",this.state[i.primaryStateKey].unit),p=i.getOption("action")||(o?[u,s.a.createElement("br",{key:"br_"+i.id}),o]:u)),s.a.createElement(s.a.Fragment,null,r.divider&&s.a.createElement(R.a,{divider:!0,style:{margin:"5px 0"}}),null!==a&&null!==r.subgroup&&r.subgroup!==a&&s.a.createElement(ee,{title:r.subgroup}),s.a.createElement(R.a,{className:H()(this.props.openDialog&&t.finger,n&&t.horizontalListItem),button:null!==this.props.openDialog,onClick:this.props.openDialog&&this.openDialog.bind(this)},null!==l&&s.a.createElement($.a,{className:n&&t.horizontalListItemIcon},s.a.createElement(te,{customClassNames:["defaultListIcon","mdi mdi-"+l],styles:i.getStyle("icon",this.state[i.primaryStateKey].val)})),s.a.createElement(X.a,{primary:i.getOption("label"),secondary:null!==r.subtitle&&(r.subtitle||this.state[i.primaryStateKey]&&this.state[i.primaryStateKey].timeChanged)||null}),s.a.createElement(Q.a,{className:n?t.horizontalListItemAction:t.verticalListItemAction},p)))}}]),t}(s.a.Component),se=Object(Y.a)(Z)(ae),ie=Object(D.a)((function(e){return{horizontalList:{display:"flex",flexDirection:"row",flexWrap:"wrap"}}}));function oe(e){var t,n=e.horizontal,a=e.openDialog,i=e.devices,o=ie();return s.a.createElement(J.a,{dense:!0,className:n&&o.horizontalList},i.map((function(e){var i=s.a.createElement(se,{horizontal:n,openDialog:a,prevSubgroup:t,key:e.get("id"),device:e});return t=e.getOption("subgroup"),i})))}var re=Object(Y.a)((function(e){return{root:{margin:0,padding:e.spacing(2)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}}))((function(e){var t=e.children,n=e.classes,a=e.onClose,i=Object(M.a)(e,["children","classes","onClose"]);return s.a.createElement(F.a,Object.assign({disableTypography:!0,className:n.root},i),s.a.createElement(O.a,{variant:"h6"},t),a?s.a.createElement(W.a,{"aria-label":"close",className:n.closeButton,onClick:a},s.a.createElement(V.a,null)):null)})),ce=Object(Y.a)((function(e){return{root:{padding:e.spacing(2)}}}))(q.a),le=Object(Y.a)((function(e){return{root:{margin:0,padding:e.spacing(1)}}}))(G.a),ue=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).state={children:[]},n}return Object(v.a)(t,e),Object(p.a)(t,[{key:"componentDidUpdate",value:function(e,t){var n=this;if(this.props.contents&&this.props.contents.device&&this.props.contents.ts!==e.contents.ts){var a=this.props.contents&&this.props.contents.device,s=[],i=[];for(var o in a.states)if(void 0!==a.states[o].state){var c=new N({id:a.id+"#"+o,name:a.name,function:a.function,states:Object(r.a)({},o,a.states[o]),options:{primary:o,icon:{default:a.getIcon(o)||"tune"},label:a.getComponent(o),action:a.getAction(o),divider:0!==i.length,subgroup:null,subtitle:null}},a.socket);s.push(c.requestDeviceState(null,!0)),i.push(c)}Promise.allSettled(s).then((function(){return n.setState({children:i},(function(){return n.forceUpdate()}))}))}}},{key:"shouldComponentUpdate",value:function(e,t){return!this.props.contents||this.props.contents.ts!==e.contents.ts}},{key:"render",value:function(){var e=this.props,t=e.open,n=e.closeDialog,a=e.contents,i=(a.ts,a.device);return s.a.createElement(P.a,{onClose:n,open:t||!1,maxWidth:"md",fullWidth:!0},s.a.createElement(re,{onClose:n},i.name),s.a.createElement(ce,{dividers:!0,style:{padding:0}},s.a.createElement(oe,{openDialog:null,devices:this.state.children})),s.a.createElement(le,null,s.a.createElement(T.a,{autoFocus:!0,onClick:n,color:"primary"},"Close")))}}]),t}(s.a.Component),pe=n(178),de=n(179),he=n(180),ve=n(185),fe=Object(D.a)((function(e){return{card:Object(r.a)({margin:e.spacing(),marginLeft:0},e.breakpoints.down("md"),{margin:e.spacing(.5)}),cardHeaderNoContents:{padding:e.spacing()},cardAvatar:function(t){return Object(c.a)({backgroundColor:e.palette.primary.main,color:"#fff",fontSize:"24px"},t)},cardContent:Object(r.a)({padding:e.spacing(0,2)},e.breakpoints.down("md"),{padding:e.spacing(0)})}}));function ge(e){var t=e.title,n=e.icon,a=e.iconStyle,i=fe(a);return s.a.createElement(pe.a,{className:i.card},s.a.createElement(de.a,{avatar:null!==n&&s.a.createElement(ve.a,{variant:"rounded",classes:{root:i.cardAvatar}},s.a.createElement("span",{className:"mdi mdi-"+(n||"home")})),title:t&&s.a.createElement(O.a,{variant:"h5",component:"h2"},t)}),s.a.createElement(he.a,{className:i.cardContent},e.children))}var me=n(182),ye=n(79),be=n(43),Se=n(78),je=n.n(Se).a[700],Oe=(be.a,Object(ye.a)({palette:{primary:{main:je},secondary:be.a},components:{icon:{fontSize:"24px",color:je},finger:{cursor:"pointer"}}}));console.debug(Oe);var ke=Oe,Ee={StateList:oe,StateListHorizontal:function(e){return s.a.createElement(oe,Object.assign({horizontal:!0},e))},Map:Map},De=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;console.log("getGridColumn()");var a=[];for(var i in e){var o=e[i],r=t[o];if(r){var c=Ee[r.settings.component||"StateList"];void 0!==c?a.push(s.a.createElement(ge,{key:"Box"+o,title:null!==r.settings.title?r.settings.title||r.name:null,icon:r.settings.icon,iconStyle:r.settings.iconStyle},s.a.createElement(c,{key:"Tag"+o,devices:r.devices,openDialog:n}))):console.error('Undefined component "'+r.settings.component+'" used!')}else console.error("Group "+o+" defined in columns but not assigned to any devices!")}return a},we=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).state={notificationDrawer:!1,dialog:!1,dialogContents:{ts:0,device:{}}},n.openDialog=n.openDialog.bind(Object(A.a)(n)),n.closeDialog=n.closeDialog.bind(Object(A.a)(n)),n}return Object(v.a)(t,e),Object(p.a)(t,[{key:"openDialog",value:function(e){this.setState({dialog:!0,dialogContents:{ts:Date.now(),device:e}})}},{key:"closeDialog",value:function(){this.setState({dialog:!1,dialogContents:{ts:Date.now(),device:{}}})}},{key:"render",value:function(){var e=this.props.classes,t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;console.log("getGrid()");for(var i=[],o=1;o<=e;o++)if(t[o]){var r=De(t[o],n,a);i.push(s.a.createElement(z.a,{key:o,item:!0,xs:12,sm:6,md:6,lg:Math.round(12/e),xl:Math.round(12/e)},r))}else console.error("No content for column #"+o+"!");return i}(this.props.settings.columns&&this.props.settings.columns.number,this.props.settings.columns&&this.props.settings.columns.groups,this.props.groups,this.openDialog);return s.a.createElement(me.a,{theme:ke},s.a.createElement(ue,{open:this.state.dialog,contents:this.state.dialogContents,closeDialog:this.closeDialog}),s.a.createElement(z.a,{container:!0,spacing:0,className:e.gridContainer},t))}}]),t}(s.a.Component),Ce=Object(Y.a)((function(e){return{gridContainer:Object(r.a)({paddingLeft:e.spacing()},e.breakpoints.down("md"),{paddingLeft:e.spacing(0),backgroundColor:"#f00"})}}))(we),Ke={true:"an",false:"aus",0:"aus"},Ie={state:{true:{color:"#090",fontWeight:"bold"},false:{color:"#999"},0:{color:"#999"}}},xe=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).state={loaded:[],error:!1,errorMessage:""},n}return Object(v.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e=this,t="localhost"===window.location.hostname?"https://192.168.178.29:8082":null;this.socket=new b(t),this.socket.on("error",(function(t){e.setState({error:!0,errorMessage:t})})),this.settings={},this.socket.getState("jarvis.0.settings").then((function(t){try{e.settings=t&&JSON.parse(t.val),e.useSettings(),e.setState({loaded:[].concat(Object(l.a)(e.state.loaded),["settings"])})}catch(n){console.error("GET_SETTINGS: "+n.message),e.setState({error:!0,errorMessage:"Error parsing settings!"})}})).catch((function(t){console.error("GET_SETTINGS: "+t.message),e.setState({error:!0,errorMessage:t})})),this.devices={},this.groups={},this.socket.getState("jarvis.0.devices").then((function(t){try{e.devices=t&&JSON.parse(t.val),e.groups=e.processDevices(e.devices),e.setState({loaded:[].concat(Object(l.a)(e.state.loaded),["groups"])})}catch(n){console.error("GET_DEVICES: "+n.message),e.setState({error:!0,errorMessage:"Error parsing devices!"})}})).catch((function(t){console.error("GET_DEVICES: "+t.message),e.setState({error:!0,errorMessage:t})}))}},{key:"useSettings",value:function(){this.settings.title&&(document.title=this.settings.title),this.settings.favicon&&"data:"===this.settings.favicon.substr(0,5)&&(document.getElementById("favicon").href=this.settings.favicon)}},{key:"groupDevice",value:function(e,t){var n=this;return t.get("options").groups.forEach((function(a){var s=a.toLowerCase().replace(/ /g,"");e[s]?e[s].devices.push(t):e[s]={id:s,name:a,settings:n.settings.groups&&n.settings.groups[s]||{},devices:[t]}})),e}},{key:"processDevice",value:function(e){var t=null;try{(t=new N(e,this.socket,{states:Ke,styles:Ie})).requestDeviceState(null,!0).catch((function(e){return console.error(e)})),t.secondaryStateKey&&t.requestDeviceState(t.secondaryStateKey,!0).catch((function(e){return console.error(e)}))}catch(n){console.warn(n.message)}return t}},{key:"processDevices",value:function(e){var t,n,a={},s=0,i=0;for(var o in e){s++,e[o].options=e[o].jarvis,delete e[o].jarvis,n=Object(c.a)({},e[o],{id:o}),null!==(t=this.processDevice(n))&&(i++,a=this.groupDevice(a,t));var l=void 0;for(var u in n.states)(l=n.states[u])&&void 0!==l.jarvis&&null!==(t=this.processDevice(Object(c.a)({},n,{id:o+"#"+u,states:Object(r.a)({},u,l),options:l.jarvis})))&&(i++,a=this.groupDevice(a,t))}for(var p in a)a[p].devices.sort((function(e,t){return e.options.sort>t.options.sort?1:t.options.sort>e.options.sort?-1:0}));return console.info("Processed "+s+" devices. Added "+i+" devices in "+Object.keys(a).length+" groups."),console.debug(a),a}},{key:"renderLoading",value:function(){return null}},{key:"render",value:function(){return this.state.error&&alert(this.state.errorMessage),this.state.loaded.length<2?this.renderLoading():s.a.createElement(Ce,{settings:this.settings,groups:this.groups})}}]),t}(s.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(s.a.createElement(xe,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},88:function(e,t,n){e.exports=n(131)},93:function(e,t,n){}},[[88,1,2]]]);
//# sourceMappingURL=main.9a1c714c.chunk.js.map